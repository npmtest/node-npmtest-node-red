{"/home/travis/build/npmtest/node-npmtest-node-red/test.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/test.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":1,"12":1,"13":1,"14":1,"15":2,"16":2,"17":2,"18":2,"19":1,"20":1,"21":2,"22":2,"23":2,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":2,"38":2,"39":1,"40":2,"41":2,"42":1,"43":2,"44":2,"45":1,"46":2,"47":2,"48":1,"49":1,"50":1,"51":1,"52":1},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[1,1],"5":[1,1],"6":[1,1],"7":[1,1],"8":[1,1],"9":[1,1,1],"10":[1,1],"11":[1,1],"12":[1,1],"13":[1,1],"14":[1,1],"15":[1,1],"16":[1,1]},"f":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":1,"7":1,"8":2,"9":2,"10":2,"11":2,"12":1},"fnMap":{"1":{"name":"(anonymous_1)","line":12,"loc":{"start":{"line":12,"column":1},"end":{"line":12,"column":13}}},"2":{"name":"(anonymous_2)","line":19,"loc":{"start":{"line":19,"column":5},"end":{"line":19,"column":17}}},"3":{"name":"(anonymous_3)","line":23,"loc":{"start":{"line":23,"column":24},"end":{"line":23,"column":36}}},"4":{"name":"(anonymous_4)","line":61,"loc":{"start":{"line":61,"column":5},"end":{"line":61,"column":17}}},"5":{"name":"(anonymous_5)","line":82,"loc":{"start":{"line":82,"column":5},"end":{"line":82,"column":17}}},"6":{"name":"(anonymous_6)","line":102,"loc":{"start":{"line":102,"column":83},"end":{"line":105,"column":10}},"skip":true},"7":{"name":"(anonymous_7)","line":113,"loc":{"start":{"line":113,"column":77},"end":{"line":116,"column":10}},"skip":true},"8":{"name":"(anonymous_8)","line":129,"loc":{"start":{"line":129,"column":12},"end":{"line":129,"column":40}},"skip":true},"9":{"name":"(anonymous_9)","line":137,"loc":{"start":{"line":137,"column":77},"end":{"line":140,"column":10}},"skip":true},"10":{"name":"(anonymous_10)","line":148,"loc":{"start":{"line":148,"column":83},"end":{"line":151,"column":10}},"skip":true},"11":{"name":"(anonymous_11)","line":159,"loc":{"start":{"line":159,"column":79},"end":{"line":162,"column":10}},"skip":true},"12":{"name":"(anonymous_12)","line":170,"loc":{"start":{"line":170,"column":75},"end":{"line":173,"column":10}},"skip":true}},"statementMap":{"1":{"start":{"line":12,"column":0},"end":{"line":185,"column":5}},"2":{"start":{"line":14,"column":4},"end":{"line":14,"column":14}},"3":{"start":{"line":19,"column":4},"end":{"line":56,"column":9}},"4":{"start":{"line":21,"column":8},"end":{"line":21,"column":19}},"5":{"start":{"line":23,"column":8},"end":{"line":35,"column":13}},"6":{"start":{"line":24,"column":12},"end":{"line":34,"column":13}},"7":{"start":{"line":25,"column":16},"end":{"line":28,"column":30}},"8":{"start":{"line":30,"column":16},"end":{"line":33,"column":27}},"9":{"start":{"line":37,"column":8},"end":{"line":39,"column":21}},"10":{"start":{"line":40,"column":8},"end":{"line":53,"column":9}},"11":{"start":{"line":43,"column":12},"end":{"line":46,"column":14}},"12":{"start":{"line":47,"column":12},"end":{"line":47,"column":18}},"13":{"start":{"line":50,"column":12},"end":{"line":51,"column":46}},"14":{"start":{"line":52,"column":12},"end":{"line":52,"column":18}},"15":{"start":{"line":55,"column":8},"end":{"line":55,"column":35}},"16":{"start":{"line":61,"column":4},"end":{"line":63,"column":9}},"17":{"start":{"line":62,"column":8},"end":{"line":62,"column":15}},"18":{"start":{"line":64,"column":4},"end":{"line":77,"column":5}},"19":{"start":{"line":70,"column":8},"end":{"line":70,"column":14}},"20":{"start":{"line":76,"column":8},"end":{"line":76,"column":14}},"21":{"start":{"line":82,"column":4},"end":{"line":84,"column":9}},"22":{"start":{"line":83,"column":8},"end":{"line":83,"column":15}},"23":{"start":{"line":85,"column":4},"end":{"line":184,"column":5}},"24":{"start":{"line":92,"column":8},"end":{"line":94,"column":63}},"25":{"start":{"line":95,"column":8},"end":{"line":95,"column":14}},"26":{"start":{"line":102,"column":8},"end":{"line":111,"column":10},"skip":true},"27":{"start":{"line":109,"column":12},"end":{"line":109,"column":55},"skip":true},"28":{"start":{"line":110,"column":12},"end":{"line":110,"column":48},"skip":true},"29":{"start":{"line":113,"column":8},"end":{"line":126,"column":10},"skip":true},"30":{"start":{"line":120,"column":12},"end":{"line":120,"column":76},"skip":true},"31":{"start":{"line":121,"column":12},"end":{"line":121,"column":73},"skip":true},"32":{"start":{"line":122,"column":12},"end":{"line":122,"column":74},"skip":true},"33":{"start":{"line":123,"column":12},"end":{"line":123,"column":79},"skip":true},"34":{"start":{"line":124,"column":12},"end":{"line":124,"column":25},"skip":true},"35":{"start":{"line":125,"column":12},"end":{"line":125,"column":45},"skip":true},"36":{"start":{"line":128,"column":8},"end":{"line":135,"column":14},"skip":true},"37":{"start":{"line":133,"column":16},"end":{"line":133,"column":29},"skip":true},"38":{"start":{"line":134,"column":16},"end":{"line":134,"column":55},"skip":true},"39":{"start":{"line":137,"column":8},"end":{"line":146,"column":10},"skip":true},"40":{"start":{"line":144,"column":12},"end":{"line":144,"column":25},"skip":true},"41":{"start":{"line":145,"column":12},"end":{"line":145,"column":45},"skip":true},"42":{"start":{"line":148,"column":8},"end":{"line":157,"column":10},"skip":true},"43":{"start":{"line":155,"column":12},"end":{"line":155,"column":25},"skip":true},"44":{"start":{"line":156,"column":12},"end":{"line":156,"column":48},"skip":true},"45":{"start":{"line":159,"column":8},"end":{"line":168,"column":10},"skip":true},"46":{"start":{"line":166,"column":12},"end":{"line":166,"column":25},"skip":true},"47":{"start":{"line":167,"column":12},"end":{"line":167,"column":46},"skip":true},"48":{"start":{"line":170,"column":8},"end":{"line":179,"column":10},"skip":true},"49":{"start":{"line":177,"column":12},"end":{"line":177,"column":94},"skip":true},"50":{"start":{"line":178,"column":12},"end":{"line":178,"column":48},"skip":true},"51":{"start":{"line":182,"column":8},"end":{"line":182,"column":35},"skip":true},"52":{"start":{"line":183,"column":8},"end":{"line":183,"column":14},"skip":true}},"branchMap":{"1":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":23},"end":{"line":25,"column":62}},{"start":{"line":26,"column":20},"end":{"line":26,"column":70}},{"start":{"line":27,"column":20},"end":{"line":27,"column":71}},{"start":{"line":28,"column":20},"end":{"line":28,"column":29}}]},"2":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":23},"end":{"line":30,"column":37}},{"start":{"line":31,"column":20},"end":{"line":31,"column":61}},{"start":{"line":32,"column":20},"end":{"line":32,"column":70}},{"start":{"line":33,"column":20},"end":{"line":33,"column":26}}]},"3":{"line":37,"type":"cond-expr","locations":[{"start":{"line":38,"column":14},"end":{"line":38,"column":20}},{"start":{"line":39,"column":14},"end":{"line":39,"column":20}}]},"4":{"line":40,"type":"switch","locations":[{"start":{"line":42,"column":8},"end":{"line":47,"column":18}},{"start":{"line":49,"column":8},"end":{"line":52,"column":18}}]},"5":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":16},"end":{"line":44,"column":44}},{"start":{"line":44,"column":48},"end":{"line":44,"column":66}}]},"6":{"line":50,"type":"binary-expr","locations":[{"start":{"line":50,"column":21},"end":{"line":50,"column":49}},{"start":{"line":50,"column":53},"end":{"line":50,"column":72}}]},"7":{"line":64,"type":"switch","locations":[{"start":{"line":69,"column":4},"end":{"line":70,"column":14}},{"start":{"line":75,"column":4},"end":{"line":76,"column":14}}]},"8":{"line":85,"type":"switch","locations":[{"start":{"line":90,"column":4},"end":{"line":95,"column":14}},{"start":{"line":101,"column":4},"end":{"line":183,"column":14},"skip":true}]},"9":{"line":92,"type":"binary-expr","locations":[{"start":{"line":92,"column":18},"end":{"line":92,"column":32}},{"start":{"line":93,"column":12},"end":{"line":93,"column":53}},{"start":{"line":94,"column":12},"end":{"line":94,"column":61}}]},"10":{"line":102,"type":"binary-expr","locations":[{"start":{"line":102,"column":45},"end":{"line":102,"column":79},"skip":true},{"start":{"line":102,"column":83},"end":{"line":111,"column":9},"skip":true}]},"11":{"line":113,"type":"binary-expr","locations":[{"start":{"line":113,"column":42},"end":{"line":113,"column":73},"skip":true},{"start":{"line":113,"column":77},"end":{"line":126,"column":9},"skip":true}]},"12":{"line":128,"type":"binary-expr","locations":[{"start":{"line":128,"column":48},"end":{"line":128,"column":85},"skip":true},{"start":{"line":129,"column":12},"end":{"line":135,"column":13},"skip":true}]},"13":{"line":137,"type":"binary-expr","locations":[{"start":{"line":137,"column":42},"end":{"line":137,"column":73},"skip":true},{"start":{"line":137,"column":77},"end":{"line":146,"column":9},"skip":true}]},"14":{"line":148,"type":"binary-expr","locations":[{"start":{"line":148,"column":45},"end":{"line":148,"column":79},"skip":true},{"start":{"line":148,"column":83},"end":{"line":157,"column":9},"skip":true}]},"15":{"line":159,"type":"binary-expr","locations":[{"start":{"line":159,"column":43},"end":{"line":159,"column":75},"skip":true},{"start":{"line":159,"column":79},"end":{"line":168,"column":9},"skip":true}]},"16":{"line":170,"type":"binary-expr","locations":[{"start":{"line":170,"column":41},"end":{"line":170,"column":71},"skip":true},{"start":{"line":170,"column":75},"end":{"line":179,"column":9},"skip":true}]}},"code":["/* istanbul instrument in package npmtest_node_red */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - pre-init","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        switch (local.modeJs) {","        // re-init local from window.local","        case 'browser':","            local = local.global.utility2.objectSetDefault(","                local.global.utility2_rollup || local.global.local,","                local.global.utility2","            );","            break;","        // re-init local from example.js","        case 'node':","            local = (local.global.utility2_rollup || require('utility2'))","                .requireExampleJsFromReadme();","            break;","        }","        // export local","        local.global.local = local;","    }());","","","","    // run shared js-env code - function","    (function () {","        return;","    }());","    switch (local.modeJs) {","","","","    // run browser js-env code - function","    case 'browser':","        break;","","","","    // run node js-env code - function","    case 'node':","        break;","    }","","","","    // run shared js-env code - post-init","    (function () {","        return;","    }());","    switch (local.modeJs) {","","","","    // run browser js-env code - post-init","    case 'browser':","        // run tests","        local.nop(local.modeTest &&","            document.querySelector('#testRunButton1') &&","            document.querySelector('#testRunButton1').click());","        break;","","","","    // run node js-env code - post-init","    /* istanbul ignore next */","    case 'node':","        local.testCase_buildApidoc_default = local.testCase_buildApidoc_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildApidoc's default handling-behavior-behavior","         */","            options = { modulePathList: module.paths };","            local.buildApidoc(options, onError);","        };","","        local.testCase_buildApp_default = local.testCase_buildApp_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildApp's default handling-behavior-behavior","         */","            local.testCase_buildReadme_default(options, local.onErrorThrow);","            local.testCase_buildLib_default(options, local.onErrorThrow);","            local.testCase_buildTest_default(options, local.onErrorThrow);","            local.testCase_buildCustomOrg_default(options, local.onErrorThrow);","            options = [];","            local.buildApp(options, onError);","        };","","        local.testCase_buildCustomOrg_default = local.testCase_buildCustomOrg_default ||","            function (options, onError) {","            /*","             * this function will test buildCustomOrg's default handling-behavior","             */","                options = {};","                local.buildCustomOrg(options, onError);","            };","","        local.testCase_buildLib_default = local.testCase_buildLib_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildLib's default handling-behavior","         */","            options = {};","            local.buildLib(options, onError);","        };","","        local.testCase_buildReadme_default = local.testCase_buildReadme_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildReadme's default handling-behavior-behavior","         */","            options = {};","            local.buildReadme(options, onError);","        };","","        local.testCase_buildTest_default = local.testCase_buildTest_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildTest's default handling-behavior","         */","            options = {};","            local.buildTest(options, onError);","        };","","        local.testCase_webpage_default = local.testCase_webpage_default || function (","            options,","            onError","        ) {","        /*","         * this function will test webpage's default handling-behavior","         */","            options = { modeCoverageMerge: true, url: local.serverLocalHost + '?modeTest=1' };","            local.browserTest(options, onError);","        };","","        // run test-server","        local.testRunServer(local);","        break;","    }","}());",""],"l":{"12":2,"14":2,"19":2,"21":2,"23":2,"24":2,"25":2,"30":1,"37":2,"40":2,"43":1,"47":1,"50":1,"52":1,"55":2,"61":2,"62":2,"64":2,"70":1,"76":1,"82":2,"83":2,"85":2,"92":1,"95":1,"102":1,"109":1,"110":1,"113":1,"120":1,"121":1,"122":1,"123":1,"124":1,"125":1,"128":1,"133":2,"134":2,"137":1,"144":2,"145":2,"148":1,"155":2,"156":2,"159":1,"166":2,"167":2,"170":1,"177":1,"178":1,"182":1,"183":1}},"/home/travis/build/npmtest/node-npmtest-node-red/lib.npmtest_node_red.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/lib.npmtest_node_red.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":2,"12":2,"13":1,"14":1,"15":1,"16":1},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[2,2],"5":[1,1]},"f":{"1":2,"2":2,"3":2},"fnMap":{"1":{"name":"(anonymous_1)","line":12,"loc":{"start":{"line":12,"column":1},"end":{"line":12,"column":13}}},"2":{"name":"(anonymous_2)","line":19,"loc":{"start":{"line":19,"column":5},"end":{"line":19,"column":17}}},"3":{"name":"(anonymous_3)","line":23,"loc":{"start":{"line":23,"column":24},"end":{"line":23,"column":36}}}},"statementMap":{"1":{"start":{"line":12,"column":0},"end":{"line":53,"column":5}},"2":{"start":{"line":14,"column":4},"end":{"line":14,"column":14}},"3":{"start":{"line":19,"column":4},"end":{"line":52,"column":9}},"4":{"start":{"line":21,"column":8},"end":{"line":21,"column":19}},"5":{"start":{"line":23,"column":8},"end":{"line":35,"column":13}},"6":{"start":{"line":24,"column":12},"end":{"line":34,"column":13}},"7":{"start":{"line":25,"column":16},"end":{"line":28,"column":30}},"8":{"start":{"line":30,"column":16},"end":{"line":33,"column":27}},"9":{"start":{"line":37,"column":8},"end":{"line":39,"column":21}},"10":{"start":{"line":41,"column":8},"end":{"line":41,"column":54}},"11":{"start":{"line":43,"column":8},"end":{"line":43,"column":53}},"12":{"start":{"line":45,"column":8},"end":{"line":51,"column":9}},"13":{"start":{"line":46,"column":12},"end":{"line":46,"column":59}},"14":{"start":{"line":48,"column":12},"end":{"line":48,"column":35}},"15":{"start":{"line":49,"column":12},"end":{"line":49,"column":49}},"16":{"start":{"line":50,"column":12},"end":{"line":50,"column":43}}},"branchMap":{"1":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":23},"end":{"line":25,"column":62}},{"start":{"line":26,"column":20},"end":{"line":26,"column":70}},{"start":{"line":27,"column":20},"end":{"line":27,"column":71}},{"start":{"line":28,"column":20},"end":{"line":28,"column":29}}]},"2":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":23},"end":{"line":30,"column":37}},{"start":{"line":31,"column":20},"end":{"line":31,"column":61}},{"start":{"line":32,"column":20},"end":{"line":32,"column":70}},{"start":{"line":33,"column":20},"end":{"line":33,"column":26}}]},"3":{"line":37,"type":"cond-expr","locations":[{"start":{"line":38,"column":14},"end":{"line":38,"column":20}},{"start":{"line":39,"column":14},"end":{"line":39,"column":20}}]},"4":{"line":41,"type":"binary-expr","locations":[{"start":{"line":41,"column":16},"end":{"line":41,"column":44}},{"start":{"line":41,"column":48},"end":{"line":41,"column":53}}]},"5":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":45,"column":8}},{"start":{"line":45,"column":8},"end":{"line":45,"column":8}}]}},"code":["/* istanbul instrument in package npmtest_node_red */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - pre-init","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        // init utility2_rollup","        local = local.global.utility2_rollup || local;","        // init lib","        local.local = local.npmtest_node_red = local;","        // init exports","        if (local.modeJs === 'browser') {","            local.global.utility2_npmtest_node_red = local;","        } else {","            module.exports = local;","            module.exports.__dirname = __dirname;","            module.exports.module = module;","        }","    }());","}());",""],"l":{"12":2,"14":2,"19":2,"21":2,"23":2,"24":2,"25":2,"30":1,"37":2,"41":2,"43":2,"45":2,"46":1,"48":1,"49":1,"50":1}},"/home/travis/build/npmtest/node-npmtest-node-red/example.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/example.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":2,"12":2,"13":1,"14":2,"15":2,"16":2,"17":2,"18":2,"19":0,"20":2,"21":1,"22":1,"23":1,"24":1,"25":1,"26":0,"27":0,"28":1,"29":1,"30":2,"31":0,"32":0,"33":0,"34":1,"35":2,"36":2,"37":2,"38":2,"39":2,"40":2,"41":0,"42":2,"43":2,"44":2,"45":1,"46":3,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":0,"58":1,"59":6,"60":6,"61":1,"62":2,"63":0,"64":2,"65":1,"66":1,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[2,2],"5":[1,1],"6":[1,1],"7":[2,0],"8":[2,1,1,1,1,1],"9":[0,2,0],"10":[1,1],"11":[2,1,1],"12":[1,0],"13":[0,2],"14":[2,0,0,0,0,0,0],"15":[0,2],"16":[2,0],"17":[1,1],"18":[0,1],"19":[1,2,0,2],"20":[1,0],"21":[1,1],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0]},"f":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":2,"9":3,"10":1,"11":6,"12":0},"fnMap":{"1":{"name":"(anonymous_1)","line":26,"loc":{"start":{"line":26,"column":1},"end":{"line":26,"column":13}}},"2":{"name":"(anonymous_2)","line":33,"loc":{"start":{"line":33,"column":5},"end":{"line":33,"column":17}}},"3":{"name":"(anonymous_3)","line":37,"loc":{"start":{"line":37,"column":24},"end":{"line":37,"column":36}}},"4":{"name":"(anonymous_4)","line":69,"loc":{"start":{"line":69,"column":31},"end":{"line":69,"column":48}},"skip":true},"5":{"name":"(anonymous_5)","line":78,"loc":{"start":{"line":78,"column":26},"end":{"line":78,"column":45}},"skip":true},"6":{"name":"(anonymous_6)","line":123,"loc":{"start":{"line":123,"column":33},"end":{"line":123,"column":48}},"skip":true},"7":{"name":"(anonymous_7)","line":125,"loc":{"start":{"line":125,"column":27},"end":{"line":125,"column":39}},"skip":true},"8":{"name":"(anonymous_8)","line":133,"loc":{"start":{"line":133,"column":59},"end":{"line":133,"column":74}},"skip":true},"9":{"name":"(anonymous_9)","line":143,"loc":{"start":{"line":143,"column":45},"end":{"line":143,"column":62}},"skip":true},"10":{"name":"(anonymous_10)","line":144,"loc":{"start":{"line":144,"column":73},"end":{"line":144,"column":92}},"skip":true},"11":{"name":"(anonymous_11)","line":272,"loc":{"start":{"line":272,"column":51},"end":{"line":272,"column":77}},"skip":true},"12":{"name":"(anonymous_12)","line":314,"loc":{"start":{"line":314,"column":32},"end":{"line":314,"column":61}},"skip":true}},"statementMap":{"1":{"start":{"line":26,"column":0},"end":{"line":325,"column":5}},"2":{"start":{"line":28,"column":4},"end":{"line":28,"column":14}},"3":{"start":{"line":33,"column":4},"end":{"line":60,"column":9}},"4":{"start":{"line":35,"column":8},"end":{"line":35,"column":19}},"5":{"start":{"line":37,"column":8},"end":{"line":49,"column":13}},"6":{"start":{"line":38,"column":12},"end":{"line":48,"column":13}},"7":{"start":{"line":39,"column":16},"end":{"line":42,"column":30}},"8":{"start":{"line":44,"column":16},"end":{"line":47,"column":27}},"9":{"start":{"line":51,"column":8},"end":{"line":53,"column":21}},"10":{"start":{"line":55,"column":8},"end":{"line":57,"column":45}},"11":{"start":{"line":59,"column":8},"end":{"line":59,"column":35}},"12":{"start":{"line":61,"column":4},"end":{"line":324,"column":5}},"13":{"start":{"line":69,"column":8},"end":{"line":121,"column":10},"skip":true},"14":{"start":{"line":70,"column":12},"end":{"line":88,"column":13},"skip":true},"15":{"start":{"line":76,"column":16},"end":{"line":87,"column":19},"skip":true},"16":{"start":{"line":79,"column":20},"end":{"line":86,"column":21},"skip":true},"17":{"start":{"line":82,"column":24},"end":{"line":82,"column":43},"skip":true},"18":{"start":{"line":83,"column":24},"end":{"line":83,"column":30},"skip":true},"19":{"start":{"line":85,"column":24},"end":{"line":85,"column":49},"skip":true},"20":{"start":{"line":89,"column":12},"end":{"line":107,"column":13},"skip":true},"21":{"start":{"line":92,"column":16},"end":{"line":102,"column":17},"skip":true},"22":{"start":{"line":93,"column":20},"end":{"line":93,"column":86},"skip":true},"23":{"start":{"line":94,"column":20},"end":{"line":95,"column":45},"skip":true},"24":{"start":{"line":96,"column":20},"end":{"line":96,"column":42},"skip":true},"25":{"start":{"line":97,"column":20},"end":{"line":97,"column":48},"skip":true},"26":{"start":{"line":100,"column":20},"end":{"line":100,"column":85},"skip":true},"27":{"start":{"line":101,"column":20},"end":{"line":101,"column":96},"skip":true},"28":{"start":{"line":103,"column":16},"end":{"line":103,"column":22},"skip":true},"29":{"start":{"line":106,"column":16},"end":{"line":106,"column":22},"skip":true},"30":{"start":{"line":108,"column":12},"end":{"line":120,"column":13},"skip":true},"31":{"start":{"line":114,"column":16},"end":{"line":119,"column":17},"skip":true},"32":{"start":{"line":116,"column":20},"end":{"line":116,"column":78},"skip":true},"33":{"start":{"line":118,"column":20},"end":{"line":118,"column":53},"skip":true},"34":{"start":{"line":123,"column":8},"end":{"line":141,"column":11},"skip":true},"35":{"start":{"line":124,"column":12},"end":{"line":124,"column":54},"skip":true},"36":{"start":{"line":125,"column":12},"end":{"line":140,"column":14},"skip":true},"37":{"start":{"line":126,"column":16},"end":{"line":126,"column":28},"skip":true},"38":{"start":{"line":127,"column":16},"end":{"line":127,"column":69},"skip":true},"39":{"start":{"line":128,"column":16},"end":{"line":128,"column":75},"skip":true},"40":{"start":{"line":129,"column":16},"end":{"line":131,"column":17},"skip":true},"41":{"start":{"line":130,"column":20},"end":{"line":130,"column":27},"skip":true},"42":{"start":{"line":133,"column":16},"end":{"line":137,"column":36},"skip":true},"43":{"start":{"line":134,"column":20},"end":{"line":136,"column":55},"skip":true},"44":{"start":{"line":139,"column":16},"end":{"line":139,"column":57},"skip":true},"45":{"start":{"line":143,"column":8},"end":{"line":147,"column":11},"skip":true},"46":{"start":{"line":144,"column":12},"end":{"line":146,"column":15},"skip":true},"47":{"start":{"line":145,"column":16},"end":{"line":145,"column":70},"skip":true},"48":{"start":{"line":149,"column":8},"end":{"line":149,"column":31},"skip":true},"49":{"start":{"line":150,"column":8},"end":{"line":150,"column":14},"skip":true},"50":{"start":{"line":158,"column":8},"end":{"line":158,"column":31},"skip":true},"51":{"start":{"line":160,"column":8},"end":{"line":160,"column":33},"skip":true},"52":{"start":{"line":161,"column":8},"end":{"line":161,"column":37},"skip":true},"53":{"start":{"line":162,"column":8},"end":{"line":162,"column":35},"skip":true},"54":{"start":{"line":164,"column":8},"end":{"line":164,"column":50},"skip":true},"55":{"start":{"line":166,"column":8},"end":{"line":256,"column":2},"skip":true},"56":{"start":{"line":258,"column":8},"end":{"line":286,"column":9},"skip":true},"57":{"start":{"line":259,"column":12},"end":{"line":269,"column":14},"skip":true},"58":{"start":{"line":271,"column":12},"end":{"line":285,"column":19},"skip":true},"59":{"start":{"line":274,"column":20},"end":{"line":274,"column":35},"skip":true},"60":{"start":{"line":275,"column":20},"end":{"line":284,"column":21},"skip":true},"61":{"start":{"line":277,"column":24},"end":{"line":277,"column":64},"skip":true},"62":{"start":{"line":279,"column":24},"end":{"line":279,"column":40},"skip":true},"63":{"start":{"line":281,"column":24},"end":{"line":281,"column":40},"skip":true},"64":{"start":{"line":283,"column":24},"end":{"line":283,"column":39},"skip":true},"65":{"start":{"line":288,"column":8},"end":{"line":290,"column":9},"skip":true},"66":{"start":{"line":289,"column":12},"end":{"line":289,"column":18},"skip":true},"67":{"start":{"line":291,"column":8},"end":{"line":293,"column":54},"skip":true},"68":{"start":{"line":294,"column":8},"end":{"line":301,"column":37},"skip":true},"69":{"start":{"line":302,"column":8},"end":{"line":302,"column":82},"skip":true},"70":{"start":{"line":305,"column":8},"end":{"line":307,"column":9},"skip":true},"71":{"start":{"line":306,"column":12},"end":{"line":306,"column":82},"skip":true},"72":{"start":{"line":309,"column":8},"end":{"line":311,"column":9},"skip":true},"73":{"start":{"line":310,"column":12},"end":{"line":310,"column":18},"skip":true},"74":{"start":{"line":312,"column":8},"end":{"line":312,"column":54},"skip":true},"75":{"start":{"line":313,"column":8},"end":{"line":313,"column":69},"skip":true},"76":{"start":{"line":314,"column":8},"end":{"line":322,"column":36},"skip":true},"77":{"start":{"line":315,"column":12},"end":{"line":315,"column":61},"skip":true},"78":{"start":{"line":316,"column":12},"end":{"line":319,"column":13},"skip":true},"79":{"start":{"line":317,"column":16},"end":{"line":317,"column":75},"skip":true},"80":{"start":{"line":318,"column":16},"end":{"line":318,"column":23},"skip":true},"81":{"start":{"line":320,"column":12},"end":{"line":320,"column":38},"skip":true},"82":{"start":{"line":321,"column":12},"end":{"line":321,"column":27},"skip":true},"83":{"start":{"line":323,"column":8},"end":{"line":323,"column":14},"skip":true}},"branchMap":{"1":{"line":39,"type":"binary-expr","locations":[{"start":{"line":39,"column":23},"end":{"line":39,"column":62}},{"start":{"line":40,"column":20},"end":{"line":40,"column":70}},{"start":{"line":41,"column":20},"end":{"line":41,"column":71}},{"start":{"line":42,"column":20},"end":{"line":42,"column":29}}]},"2":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":23},"end":{"line":44,"column":37}},{"start":{"line":45,"column":20},"end":{"line":45,"column":61}},{"start":{"line":46,"column":20},"end":{"line":46,"column":70}},{"start":{"line":47,"column":20},"end":{"line":47,"column":26}}]},"3":{"line":51,"type":"cond-expr","locations":[{"start":{"line":52,"column":14},"end":{"line":52,"column":20}},{"start":{"line":53,"column":14},"end":{"line":53,"column":20}}]},"4":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":16},"end":{"line":55,"column":44}},{"start":{"line":55,"column":49},"end":{"line":57,"column":43}}]},"5":{"line":55,"type":"cond-expr","locations":[{"start":{"line":56,"column":14},"end":{"line":56,"column":52}},{"start":{"line":57,"column":14},"end":{"line":57,"column":43}}]},"6":{"line":61,"type":"switch","locations":[{"start":{"line":68,"column":4},"end":{"line":150,"column":14},"skip":true},{"start":{"line":156,"column":4},"end":{"line":323,"column":14},"skip":true}]},"7":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":12},"end":{"line":70,"column":12},"skip":true},{"start":{"line":70,"column":12},"end":{"line":70,"column":12},"skip":true}]},"8":{"line":70,"type":"binary-expr","locations":[{"start":{"line":70,"column":16},"end":{"line":70,"column":22},"skip":true},{"start":{"line":70,"column":27},"end":{"line":70,"column":32},"skip":true},{"start":{"line":71,"column":20},"end":{"line":71,"column":39},"skip":true},{"start":{"line":72,"column":20},"end":{"line":72,"column":49},"skip":true},{"start":{"line":73,"column":20},"end":{"line":73,"column":58},"skip":true},{"start":{"line":74,"column":20},"end":{"line":74,"column":69},"skip":true}]},"9":{"line":79,"type":"switch","locations":[{"start":{"line":80,"column":20},"end":{"line":80,"column":33},"skip":true},{"start":{"line":81,"column":20},"end":{"line":83,"column":30},"skip":true},{"start":{"line":84,"column":20},"end":{"line":85,"column":49},"skip":true}]},"10":{"line":89,"type":"switch","locations":[{"start":{"line":90,"column":12},"end":{"line":103,"column":22},"skip":true},{"start":{"line":105,"column":12},"end":{"line":106,"column":22},"skip":true}]},"11":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":20},"end":{"line":89,"column":25},"skip":true},{"start":{"line":89,"column":29},"end":{"line":89,"column":48},"skip":true},{"start":{"line":89,"column":52},"end":{"line":89,"column":74},"skip":true}]},"12":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":16},"end":{"line":92,"column":16},"skip":true},{"start":{"line":92,"column":16},"end":{"line":92,"column":16},"skip":true}]},"13":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":12},"end":{"line":108,"column":12},"skip":true},{"start":{"line":108,"column":12},"end":{"line":108,"column":12},"skip":true}]},"14":{"line":108,"type":"binary-expr","locations":[{"start":{"line":108,"column":16},"end":{"line":108,"column":61},"skip":true},{"start":{"line":108,"column":66},"end":{"line":108,"column":72},"skip":true},{"start":{"line":108,"column":77},"end":{"line":108,"column":82},"skip":true},{"start":{"line":109,"column":20},"end":{"line":109,"column":39},"skip":true},{"start":{"line":110,"column":20},"end":{"line":110,"column":49},"skip":true},{"start":{"line":111,"column":20},"end":{"line":111,"column":58},"skip":true},{"start":{"line":112,"column":20},"end":{"line":112,"column":68},"skip":true}]},"15":{"line":129,"type":"if","locations":[{"start":{"line":129,"column":16},"end":{"line":129,"column":16},"skip":true},{"start":{"line":129,"column":16},"end":{"line":129,"column":16},"skip":true}]},"16":{"line":134,"type":"cond-expr","locations":[{"start":{"line":135,"column":26},"end":{"line":135,"column":29},"skip":true},{"start":{"line":136,"column":26},"end":{"line":136,"column":54},"skip":true}]},"17":{"line":164,"type":"binary-expr","locations":[{"start":{"line":164,"column":27},"end":{"line":164,"column":43},"skip":true},{"start":{"line":164,"column":47},"end":{"line":164,"column":49},"skip":true}]},"18":{"line":258,"type":"if","locations":[{"start":{"line":258,"column":8},"end":{"line":258,"column":8},"skip":true},{"start":{"line":258,"column":8},"end":{"line":258,"column":8},"skip":true}]},"19":{"line":275,"type":"switch","locations":[{"start":{"line":276,"column":20},"end":{"line":277,"column":64},"skip":true},{"start":{"line":278,"column":20},"end":{"line":279,"column":40},"skip":true},{"start":{"line":280,"column":20},"end":{"line":281,"column":40},"skip":true},{"start":{"line":282,"column":20},"end":{"line":283,"column":39},"skip":true}]},"20":{"line":288,"type":"if","locations":[{"start":{"line":288,"column":8},"end":{"line":288,"column":8},"skip":true},{"start":{"line":288,"column":8},"end":{"line":288,"column":8},"skip":true}]},"21":{"line":288,"type":"binary-expr","locations":[{"start":{"line":288,"column":12},"end":{"line":288,"column":40},"skip":true},{"start":{"line":288,"column":44},"end":{"line":288,"column":67},"skip":true}]},"22":{"line":292,"type":"binary-expr","locations":[{"start":{"line":292,"column":12},"end":{"line":292,"column":50},"skip":true},{"start":{"line":293,"column":12},"end":{"line":293,"column":53},"skip":true}]},"23":{"line":295,"type":"binary-expr","locations":[{"start":{"line":295,"column":12},"end":{"line":295,"column":66},"skip":true},{"start":{"line":296,"column":12},"end":{"line":301,"column":36},"skip":true}]},"24":{"line":302,"type":"binary-expr","locations":[{"start":{"line":302,"column":43},"end":{"line":302,"column":75},"skip":true},{"start":{"line":302,"column":79},"end":{"line":302,"column":81},"skip":true}]},"25":{"line":305,"type":"if","locations":[{"start":{"line":305,"column":8},"end":{"line":305,"column":8},"skip":true},{"start":{"line":305,"column":8},"end":{"line":305,"column":8},"skip":true}]},"26":{"line":309,"type":"if","locations":[{"start":{"line":309,"column":8},"end":{"line":309,"column":8},"skip":true},{"start":{"line":309,"column":8},"end":{"line":309,"column":8},"skip":true}]},"27":{"line":312,"type":"binary-expr","locations":[{"start":{"line":312,"column":27},"end":{"line":312,"column":43},"skip":true},{"start":{"line":312,"column":47},"end":{"line":312,"column":53},"skip":true}]},"28":{"line":316,"type":"if","locations":[{"start":{"line":316,"column":12},"end":{"line":316,"column":12},"skip":true},{"start":{"line":316,"column":12},"end":{"line":316,"column":12},"skip":true}]}},"code":["/*","example.js","","quickstart example","","instruction","    1. save this script as example.js","    2. run the shell command:","        $ npm install npmtest-node-red && PORT=8081 node example.js","    3. play with the browser-demo on http://127.0.0.1:8081","*/","","","","/* istanbul instrument in package npmtest_node_red */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - pre-init","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        // init utility2_rollup","        local = local.global.utility2_rollup || (local.modeJs === 'browser'","            ? local.global.utility2_npmtest_node_red","            : global.utility2_moduleExports);","        // export local","        local.global.local = local;","    }());","    switch (local.modeJs) {","","","","    // post-init","    // run browser js-env code - post-init","    /* istanbul ignore next */","    case 'browser':","        local.testRunBrowser = function (event) {","            if (!event || (event &&","                    event.currentTarget &&","                    event.currentTarget.className &&","                    event.currentTarget.className.includes &&","                    event.currentTarget.className.includes('onreset'))) {","                // reset output","                Array.from(","                    document.querySelectorAll('body > .resettable')","                ).forEach(function (element) {","                    switch (element.tagName) {","                    case 'INPUT':","                    case 'TEXTAREA':","                        element.value = '';","                        break;","                    default:","                        element.textContent = '';","                    }","                });","            }","            switch (event && event.currentTarget && event.currentTarget.id) {","            case 'testRunButton1':","                // show tests","                if (document.querySelector('#testReportDiv1').style.display === 'none') {","                    document.querySelector('#testReportDiv1').style.display = 'block';","                    document.querySelector('#testRunButton1').textContent =","                        'hide internal test';","                    local.modeTest = true;","                    local.testRunDefault(local);","                // hide tests","                } else {","                    document.querySelector('#testReportDiv1').style.display = 'none';","                    document.querySelector('#testRunButton1').textContent = 'run internal test';","                }","                break;","            // custom-case","            default:","                break;","            }","            if (document.querySelector('#inputTextareaEval1') && (!event || (event &&","                    event.currentTarget &&","                    event.currentTarget.className &&","                    event.currentTarget.className.includes &&","                    event.currentTarget.className.includes('oneval')))) {","                // try to eval input-code","                try {","                    /*jslint evil: true*/","                    eval(document.querySelector('#inputTextareaEval1').value);","                } catch (errorCaught) {","                    console.error(errorCaught.stack);","                }","            }","        };","        // log stderr and stdout to #outputTextareaStdout1","        ['error', 'log'].forEach(function (key) {","            console[key + '_original'] = console[key];","            console[key] = function () {","                var element;","                console[key + '_original'].apply(console, arguments);","                element = document.querySelector('#outputTextareaStdout1');","                if (!element) {","                    return;","                }","                // append text to #outputTextareaStdout1","                element.value += Array.from(arguments).map(function (arg) {","                    return typeof arg === 'string'","                        ? arg","                        : JSON.stringify(arg, null, 4);","                }).join(' ') + '\\n';","                // scroll textarea to bottom","                element.scrollTop = element.scrollHeight;","            };","        });","        // init event-handling","        ['change', 'click', 'keyup'].forEach(function (event) {","            Array.from(document.querySelectorAll('.on' + event)).forEach(function (element) {","                element.addEventListener(event, local.testRunBrowser);","            });","        });","        // run tests","        local.testRunBrowser();","        break;","","","","    // run node js-env code - post-init","    /* istanbul ignore next */","    case 'node':","        // export local","        module.exports = local;","        // require modules","        local.fs = require('fs');","        local.http = require('http');","        local.url = require('url');","        // init assets","        local.assetsDict = local.assetsDict || {};","        /* jslint-ignore-begin */","        local.assetsDict['/assets.index.template.html'] = '\\","<!doctype html>\\n\\","<html lang=\"en\">\\n\\","<head>\\n\\","<meta charset=\"UTF-8\">\\n\\","<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\\n\\","<title>{{env.npm_package_name}} (v{{env.npm_package_version}})</title>\\n\\","<style>\\n\\","/*csslint\\n\\","    box-sizing: false,\\n\\","    universal-selector: false\\n\\","*/\\n\\","* {\\n\\","    box-sizing: border-box;\\n\\","}\\n\\","body {\\n\\","    background: #dde;\\n\\","    font-family: Arial, Helvetica, sans-serif;\\n\\","    margin: 2rem;\\n\\","}\\n\\","body > * {\\n\\","    margin-bottom: 1rem;\\n\\","}\\n\\",".utility2FooterDiv {\\n\\","    margin-top: 20px;\\n\\","    text-align: center;\\n\\","}\\n\\","</style>\\n\\","<style>\\n\\","/*csslint\\n\\","*/\\n\\","textarea {\\n\\","    font-family: monospace;\\n\\","    height: 10rem;\\n\\","    width: 100%;\\n\\","}\\n\\","textarea[readonly] {\\n\\","    background: #ddd;\\n\\","}\\n\\","</style>\\n\\","</head>\\n\\","<body>\\n\\","<!-- utility2-comment\\n\\","<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 0.5s, width 1.5s; width: 25%;\"></div>\\n\\","utility2-comment -->\\n\\","<h1>\\n\\","<!-- utility2-comment\\n\\","    <a\\n\\","        {{#if env.npm_package_homepage}}\\n\\","        href=\"{{env.npm_package_homepage}}\"\\n\\","        {{/if env.npm_package_homepage}}\\n\\","        target=\"_blank\"\\n\\","    >\\n\\","utility2-comment -->\\n\\","        {{env.npm_package_name}} (v{{env.npm_package_version}})\\n\\","<!-- utility2-comment\\n\\","    </a>\\n\\","utility2-comment -->\\n\\","</h1>\\n\\","<h3>{{env.npm_package_description}}</h3>\\n\\","<!-- utility2-comment\\n\\","<h4><a download href=\"assets.app.js\">download standalone app</a></h4>\\n\\","<button class=\"onclick onreset\" id=\"testRunButton1\">run internal test</button><br>\\n\\","<div id=\"testReportDiv1\" style=\"display: none;\"></div>\\n\\","utility2-comment -->\\n\\","\\n\\","\\n\\","\\n\\","<label>stderr and stdout</label>\\n\\","<textarea class=\"resettable\" id=\"outputTextareaStdout1\" readonly></textarea>\\n\\","<!-- utility2-comment\\n\\","{{#if isRollup}}\\n\\","<script src=\"assets.app.js\"></script>\\n\\","{{#unless isRollup}}\\n\\","utility2-comment -->\\n\\","<script src=\"assets.utility2.rollup.js\"></script>\\n\\","<script src=\"jsonp.utility2._stateInit?callback=window.utility2._stateInit\"></script>\\n\\","<script src=\"assets.npmtest_node_red.rollup.js\"></script>\\n\\","<script src=\"assets.example.js\"></script>\\n\\","<script src=\"assets.test.js\"></script>\\n\\","<!-- utility2-comment\\n\\","{{/if isRollup}}\\n\\","utility2-comment -->\\n\\","<div class=\"utility2FooterDiv\">\\n\\","    [ this app was created with\\n\\","    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\\n\\","    ]\\n\\","</div>\\n\\","</body>\\n\\","</html>\\n\\","';","        /* jslint-ignore-end */","        if (local.templateRender) {","            local.assetsDict['/'] = local.templateRender(","                local.assetsDict['/assets.index.template.html'],","                {","                    env: local.objectSetDefault(local.env, {","                        npm_package_description: 'the greatest app in the world!',","                        npm_package_name: 'my-app',","                        npm_package_nameAlias: 'my_app',","                        npm_package_version: '0.0.1'","                    })","                }","            );","        } else {","            local.assetsDict['/'] = local.assetsDict['/assets.index.template.html']","                .replace((/\\{\\{env\\.(\\w+?)\\}\\}/g), function (match0, match1) {","                    // jslint-hack","                    String(match0);","                    switch (match1) {","                    case 'npm_package_description':","                        return 'the greatest app in the world!';","                    case 'npm_package_name':","                        return 'my-app';","                    case 'npm_package_nameAlias':","                        return 'my_app';","                    case 'npm_package_version':","                        return '0.0.1';","                    }","                });","        }","        // run the cli","        if (local.global.utility2_rollup || module !== require.main) {","            break;","        }","        local.assetsDict['/assets.example.js'] =","            local.assetsDict['/assets.example.js'] ||","            local.fs.readFileSync(__filename, 'utf8');","        local.assetsDict['/assets.npmtest_node_red.rollup.js'] =","            local.assetsDict['/assets.npmtest_node_red.rollup.js'] ||","            local.fs.readFileSync(","                // buildCustomOrg-hack","                local.npmtest_node_red.__dirname +","                    '/lib.npmtest_node_red.js',","                'utf8'","            ).replace((/^#!/), '//');","        local.assetsDict['/favicon.ico'] = local.assetsDict['/favicon.ico'] || '';","        // if $npm_config_timeout_exit exists,","        // then exit this process after $npm_config_timeout_exit ms","        if (Number(process.env.npm_config_timeout_exit)) {","            setTimeout(process.exit, Number(process.env.npm_config_timeout_exit));","        }","        // start server","        if (local.global.utility2_serverHttp1) {","            break;","        }","        process.env.PORT = process.env.PORT || '8081';","        console.error('server starting on port ' + process.env.PORT);","        local.http.createServer(function (request, response) {","            request.urlParsed = local.url.parse(request.url);","            if (local.assetsDict[request.urlParsed.pathname] !== undefined) {","                response.end(local.assetsDict[request.urlParsed.pathname]);","                return;","            }","            response.statusCode = 404;","            response.end();","        }).listen(process.env.PORT);","        break;","    }","}());",""],"l":{"26":2,"28":2,"33":2,"35":2,"37":2,"38":2,"39":2,"44":1,"51":2,"55":2,"59":2,"61":2,"69":1,"70":2,"76":2,"79":2,"82":2,"83":2,"85":1,"89":2,"92":1,"93":1,"94":1,"96":1,"97":1,"100":1,"101":1,"103":1,"106":1,"108":2,"114":1,"116":1,"118":1,"123":1,"124":2,"125":2,"126":2,"127":2,"128":2,"129":2,"130":1,"133":2,"134":2,"139":2,"143":1,"144":3,"145":1,"149":1,"150":1,"158":1,"160":1,"161":1,"162":1,"164":1,"166":1,"258":1,"259":1,"271":1,"274":6,"275":6,"277":1,"279":2,"281":1,"283":2,"288":1,"289":1,"291":1,"294":1,"302":1,"305":1,"306":1,"309":1,"310":1,"312":1,"313":1,"314":1,"315":1,"316":1,"317":1,"318":1,"320":1,"321":1,"323":1}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/red.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/red.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":0,"12":0,"13":0,"14":1,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":1,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0},"b":{"1":[1,1],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},"fnMap":{"1":{"name":"checkVersion","line":30,"loc":{"start":{"line":30,"column":0},"end":{"line":30,"column":36}}},"2":{"name":"checkBuild","line":41,"loc":{"start":{"line":41,"column":0},"end":{"line":41,"column":22}}},"3":{"name":"(anonymous_3)","line":53,"loc":{"start":{"line":53,"column":10},"end":{"line":53,"column":44}}},"4":{"name":"(anonymous_4)","line":81,"loc":{"start":{"line":81,"column":11},"end":{"line":81,"column":22}}},"5":{"name":"(anonymous_5)","line":82,"loc":{"start":{"line":82,"column":36},"end":{"line":82,"column":47}}},"6":{"name":"(anonymous_6)","line":88,"loc":{"start":{"line":88,"column":10},"end":{"line":88,"column":21}}},"7":{"name":"(anonymous_7)","line":89,"loc":{"start":{"line":89,"column":35},"end":{"line":89,"column":46}}},"8":{"name":"(anonymous_8)","line":105,"loc":{"start":{"line":105,"column":11},"end":{"line":105,"column":14}}},"9":{"name":"(anonymous_9)","line":106,"loc":{"start":{"line":106,"column":17},"end":{"line":106,"column":20}}},"10":{"name":"(anonymous_10)","line":107,"loc":{"start":{"line":107,"column":16},"end":{"line":107,"column":19}}},"11":{"name":"(anonymous_11)","line":108,"loc":{"start":{"line":108,"column":14},"end":{"line":108,"column":17}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":23}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"3":{"start":{"line":20,"column":0},"end":{"line":20,"column":35}},"4":{"start":{"line":21,"column":0},"end":{"line":21,"column":27}},"5":{"start":{"line":23,"column":0},"end":{"line":23,"column":87}},"6":{"start":{"line":25,"column":0},"end":{"line":25,"column":19}},"7":{"start":{"line":26,"column":0},"end":{"line":26,"column":20}},"8":{"start":{"line":27,"column":0},"end":{"line":27,"column":18}},"9":{"start":{"line":28,"column":0},"end":{"line":28,"column":23}},"10":{"start":{"line":30,"column":0},"end":{"line":39,"column":1}},"11":{"start":{"line":31,"column":4},"end":{"line":31,"column":35}},"12":{"start":{"line":32,"column":4},"end":{"line":38,"column":5}},"13":{"start":{"line":37,"column":8},"end":{"line":37,"column":59}},"14":{"start":{"line":41,"column":0},"end":{"line":50,"column":1}},"15":{"start":{"line":42,"column":4},"end":{"line":42,"column":89}},"16":{"start":{"line":43,"column":4},"end":{"line":49,"column":5}},"17":{"start":{"line":44,"column":8},"end":{"line":44,"column":44}},"18":{"start":{"line":46,"column":8},"end":{"line":46,"column":48}},"19":{"start":{"line":47,"column":8},"end":{"line":47,"column":29}},"20":{"start":{"line":48,"column":8},"end":{"line":48,"column":16}},"21":{"start":{"line":52,"column":0},"end":{"line":109,"column":2}},"22":{"start":{"line":54,"column":8},"end":{"line":57,"column":9}},"23":{"start":{"line":55,"column":12},"end":{"line":55,"column":38}},"24":{"start":{"line":56,"column":12},"end":{"line":56,"column":30}},"25":{"start":{"line":59,"column":8},"end":{"line":62,"column":9}},"26":{"start":{"line":60,"column":12},"end":{"line":60,"column":39}},"27":{"start":{"line":61,"column":12},"end":{"line":61,"column":25}},"28":{"start":{"line":64,"column":8},"end":{"line":66,"column":9}},"29":{"start":{"line":65,"column":12},"end":{"line":65,"column":88}},"30":{"start":{"line":68,"column":8},"end":{"line":75,"column":9}},"31":{"start":{"line":69,"column":12},"end":{"line":69,"column":43}},"32":{"start":{"line":70,"column":12},"end":{"line":70,"column":41}},"33":{"start":{"line":71,"column":12},"end":{"line":71,"column":30}},"34":{"start":{"line":73,"column":12},"end":{"line":73,"column":39}},"35":{"start":{"line":74,"column":12},"end":{"line":74,"column":31}},"36":{"start":{"line":76,"column":8},"end":{"line":76,"column":45}},"37":{"start":{"line":77,"column":8},"end":{"line":77,"column":34}},"38":{"start":{"line":78,"column":8},"end":{"line":78,"column":41}},"39":{"start":{"line":79,"column":8},"end":{"line":79,"column":15}},"40":{"start":{"line":82,"column":8},"end":{"line":86,"column":11}},"41":{"start":{"line":83,"column":12},"end":{"line":85,"column":13}},"42":{"start":{"line":84,"column":16},"end":{"line":84,"column":35}},"43":{"start":{"line":89,"column":8},"end":{"line":93,"column":10}},"44":{"start":{"line":90,"column":12},"end":{"line":92,"column":13}},"45":{"start":{"line":91,"column":16},"end":{"line":91,"column":34}},"46":{"start":{"line":105,"column":16},"end":{"line":105,"column":85}},"47":{"start":{"line":105,"column":86},"end":{"line":105,"column":105}},"48":{"start":{"line":106,"column":22},"end":{"line":106,"column":38}},"49":{"start":{"line":107,"column":21},"end":{"line":107,"column":36}},"50":{"start":{"line":108,"column":19},"end":{"line":108,"column":33}}},"branchMap":{"1":{"line":23,"type":"binary-expr","locations":[{"start":{"line":23,"column":28},"end":{"line":23,"column":53}},{"start":{"line":23,"column":57},"end":{"line":23,"column":86}}]},"2":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":4},"end":{"line":32,"column":4}},{"start":{"line":32,"column":4},"end":{"line":32,"column":4}}]},"3":{"line":54,"type":"if","locations":[{"start":{"line":54,"column":8},"end":{"line":54,"column":8}},{"start":{"line":54,"column":8},"end":{"line":54,"column":8}}]},"4":{"line":59,"type":"if","locations":[{"start":{"line":59,"column":8},"end":{"line":59,"column":8}},{"start":{"line":59,"column":8},"end":{"line":59,"column":8}}]},"5":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":8},"end":{"line":64,"column":8}},{"start":{"line":64,"column":8},"end":{"line":64,"column":8}}]},"6":{"line":68,"type":"if","locations":[{"start":{"line":68,"column":8},"end":{"line":68,"column":8}},{"start":{"line":68,"column":8},"end":{"line":68,"column":8}}]},"7":{"line":83,"type":"if","locations":[{"start":{"line":83,"column":12},"end":{"line":83,"column":12}},{"start":{"line":83,"column":12},"end":{"line":83,"column":12}}]},"8":{"line":90,"type":"if","locations":[{"start":{"line":90,"column":12},"end":{"line":90,"column":12}},{"start":{"line":90,"column":12},"end":{"line":90,"column":12}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var fs = require(\"fs\");","var path = require('path');","","var runtime = require(\"./runtime\");","var api = require(\"./api\");","","process.env.NODE_RED_HOME = process.env.NODE_RED_HOME || path.resolve(__dirname+\"/..\");","","var nodeApp = null;","var adminApp = null;","var server = null;","var apiEnabled = false;","","function checkVersion(userSettings) {","    var semver = require('semver');","    if (!semver.satisfies(process.version,\">=4.0.0\")) {","        // TODO: in the future, make this a hard error.","        // var e = new Error(\"Unsupported version of node.js\");","        // e.code = \"unsupported_version\";","        // throw e;","        userSettings.UNSUPPORTED_VERSION = process.version;","    }","}","","function checkBuild() {","    var editorFile = path.resolve(path.join(__dirname,\"..\",\"public\",\"red\",\"red.min.js\"));","    try {","        var stats = fs.statSync(editorFile);","    } catch(err) {","        var e = new Error(\"Node-RED not built\");","        e.code = \"not_built\";","        throw e;","    }","}","","module.exports = {","    init: function(httpServer,userSettings) {","        if (!userSettings) {","            userSettings = httpServer;","            httpServer = null;","        }","","        if (!userSettings.SKIP_BUILD_CHECK) {","            checkVersion(userSettings);","            checkBuild();","        }","","        if (!userSettings.coreNodesDir) {","            userSettings.coreNodesDir = path.resolve(path.join(__dirname,\"..\",\"nodes\"));","        }","","        if (userSettings.httpAdminRoot !== false) {","            runtime.init(userSettings,api);","            api.init(httpServer,runtime);","            apiEnabled = true;","        } else {","            runtime.init(userSettings);","            apiEnabled = false;","        }","        adminApp = runtime.adminApi.adminApp;","        nodeApp = runtime.nodeApp;","        server = runtime.adminApi.server;","        return;","    },","    start: function() {","        return runtime.start().then(function() {","            if (apiEnabled) {","                return api.start();","            }","        });","    },","    stop: function() {","        return runtime.stop().then(function() {","            if (apiEnabled) {","                return api.stop();","            }","        })","    },","    nodes: runtime.nodes,","    log: runtime.log,","    settings:runtime.settings,","    util: runtime.util,","    version: runtime.version,","","    comms: api.comms,","    library: api.library,","    auth: api.auth,","","    get app() { console.log(\"Deprecated use of RED.app - use RED.httpAdmin instead\"); return runtime.app },","    get httpAdmin() { return adminApp },","    get httpNode() { return nodeApp },","    get server() { return server }","};",""],"l":{"17":1,"18":1,"20":1,"21":1,"23":1,"25":1,"26":1,"27":1,"28":1,"30":1,"31":0,"32":0,"37":0,"41":1,"42":0,"43":0,"44":0,"46":0,"47":0,"48":0,"52":1,"54":0,"55":0,"56":0,"59":0,"60":0,"61":0,"64":0,"65":0,"68":0,"69":0,"70":0,"71":0,"73":0,"74":0,"76":0,"77":0,"78":0,"79":0,"82":0,"83":0,"84":0,"89":0,"90":0,"91":0,"105":0,"106":0,"107":0,"108":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":1,"26":1,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":1,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":1,"83":0,"84":0,"85":0,"86":0,"87":1,"88":0,"89":0,"90":0,"91":0,"92":0,"93":1,"94":0,"95":0,"96":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0},"fnMap":{"1":{"name":"(anonymous_1)","line":36,"loc":{"start":{"line":36,"column":9},"end":{"line":36,"column":20}}},"2":{"name":"(anonymous_2)","line":37,"loc":{"start":{"line":37,"column":10},"end":{"line":37,"column":21}}},"3":{"name":"(anonymous_3)","line":38,"loc":{"start":{"line":38,"column":9},"end":{"line":38,"column":20}}},"4":{"name":"(anonymous_4)","line":39,"loc":{"start":{"line":39,"column":12},"end":{"line":39,"column":23}}},"5":{"name":"(anonymous_5)","line":43,"loc":{"start":{"line":43,"column":18},"end":{"line":43,"column":29}}},"6":{"name":"(anonymous_6)","line":46,"loc":{"start":{"line":46,"column":25},"end":{"line":46,"column":36}}},"7":{"name":"(anonymous_7)","line":49,"loc":{"start":{"line":49,"column":17},"end":{"line":49,"column":28}}},"8":{"name":"init","line":57,"loc":{"start":{"line":57,"column":0},"end":{"line":57,"column":38}}},"9":{"name":"getVersion","line":72,"loc":{"start":{"line":72,"column":0},"end":{"line":72,"column":22}}},"10":{"name":"start","line":86,"loc":{"start":{"line":86,"column":0},"end":{"line":86,"column":17}}},"11":{"name":"(anonymous_11)","line":88,"loc":{"start":{"line":88,"column":14},"end":{"line":88,"column":25}}},"12":{"name":"(anonymous_12)","line":91,"loc":{"start":{"line":91,"column":14},"end":{"line":91,"column":25}}},"13":{"name":"(anonymous_13)","line":92,"loc":{"start":{"line":92,"column":14},"end":{"line":92,"column":25}}},"14":{"name":"(anonymous_14)","line":93,"loc":{"start":{"line":93,"column":14},"end":{"line":93,"column":25}}},"15":{"name":"(anonymous_15)","line":96,"loc":{"start":{"line":96,"column":52},"end":{"line":96,"column":63}}},"16":{"name":"(anonymous_16)","line":112,"loc":{"start":{"line":112,"column":40},"end":{"line":112,"column":51}}},"17":{"name":"(anonymous_17)","line":115,"loc":{"start":{"line":115,"column":54},"end":{"line":115,"column":66}}},"18":{"name":"(anonymous_18)","line":116,"loc":{"start":{"line":116,"column":55},"end":{"line":116,"column":67}}},"19":{"name":"(anonymous_19)","line":136,"loc":{"start":{"line":136,"column":68},"end":{"line":136,"column":82}}},"20":{"name":"(anonymous_20)","line":153,"loc":{"start":{"line":153,"column":25},"end":{"line":153,"column":39}}},"21":{"name":"reportMetrics","line":159,"loc":{"start":{"line":159,"column":0},"end":{"line":159,"column":25}}},"22":{"name":"stop","line":179,"loc":{"start":{"line":179,"column":0},"end":{"line":179,"column":16}}},"23":{"name":"(anonymous_23)","line":202,"loc":{"start":{"line":202,"column":16},"end":{"line":202,"column":19}}},"24":{"name":"(anonymous_24)","line":203,"loc":{"start":{"line":203,"column":15},"end":{"line":203,"column":18}}},"25":{"name":"(anonymous_25)","line":204,"loc":{"start":{"line":204,"column":15},"end":{"line":204,"column":26}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":19,"column":0},"end":{"line":19,"column":34}},"3":{"start":{"line":20,"column":0},"end":{"line":20,"column":35}},"4":{"start":{"line":21,"column":0},"end":{"line":21,"column":27}},"5":{"start":{"line":22,"column":0},"end":{"line":22,"column":29}},"6":{"start":{"line":23,"column":0},"end":{"line":23,"column":33}},"7":{"start":{"line":24,"column":0},"end":{"line":24,"column":37}},"8":{"start":{"line":26,"column":0},"end":{"line":26,"column":33}},"9":{"start":{"line":27,"column":0},"end":{"line":27,"column":27}},"10":{"start":{"line":28,"column":0},"end":{"line":28,"column":23}},"11":{"start":{"line":29,"column":0},"end":{"line":29,"column":23}},"12":{"start":{"line":31,"column":0},"end":{"line":31,"column":33}},"13":{"start":{"line":33,"column":0},"end":{"line":33,"column":20}},"14":{"start":{"line":35,"column":0},"end":{"line":40,"column":1}},"15":{"start":{"line":41,"column":0},"end":{"line":53,"column":1}},"16":{"start":{"line":55,"column":0},"end":{"line":55,"column":12}},"17":{"start":{"line":57,"column":0},"end":{"line":68,"column":1}},"18":{"start":{"line":58,"column":4},"end":{"line":58,"column":40}},"19":{"start":{"line":59,"column":4},"end":{"line":59,"column":27}},"20":{"start":{"line":60,"column":4},"end":{"line":60,"column":32}},"21":{"start":{"line":62,"column":4},"end":{"line":62,"column":24}},"22":{"start":{"line":64,"column":4},"end":{"line":66,"column":5}},"23":{"start":{"line":65,"column":8},"end":{"line":65,"column":29}},"24":{"start":{"line":67,"column":4},"end":{"line":67,"column":27}},"25":{"start":{"line":70,"column":0},"end":{"line":70,"column":12}},"26":{"start":{"line":72,"column":0},"end":{"line":84,"column":1}},"27":{"start":{"line":73,"column":4},"end":{"line":82,"column":5}},"28":{"start":{"line":74,"column":8},"end":{"line":74,"column":81}},"29":{"start":{"line":76,"column":8},"end":{"line":81,"column":9}},"30":{"start":{"line":77,"column":12},"end":{"line":77,"column":63}},"31":{"start":{"line":78,"column":12},"end":{"line":78,"column":30}},"32":{"start":{"line":83,"column":4},"end":{"line":83,"column":19}},"33":{"start":{"line":86,"column":0},"end":{"line":157,"column":1}},"34":{"start":{"line":87,"column":4},"end":{"line":156,"column":11}},"35":{"start":{"line":89,"column":12},"end":{"line":89,"column":117}},"36":{"start":{"line":91,"column":27},"end":{"line":91,"column":55}},"37":{"start":{"line":92,"column":27},"end":{"line":92,"column":56}},"38":{"start":{"line":95,"column":12},"end":{"line":99,"column":13}},"39":{"start":{"line":96,"column":16},"end":{"line":98,"column":58}},"40":{"start":{"line":97,"column":20},"end":{"line":97,"column":36}},"41":{"start":{"line":100,"column":12},"end":{"line":100,"column":80}},"42":{"start":{"line":101,"column":12},"end":{"line":103,"column":13}},"43":{"start":{"line":102,"column":16},"end":{"line":102,"column":103}},"44":{"start":{"line":104,"column":12},"end":{"line":104,"column":94}},"45":{"start":{"line":105,"column":12},"end":{"line":110,"column":13}},"46":{"start":{"line":106,"column":16},"end":{"line":106,"column":95}},"47":{"start":{"line":107,"column":16},"end":{"line":107,"column":136}},"48":{"start":{"line":108,"column":16},"end":{"line":108,"column":95}},"49":{"start":{"line":109,"column":16},"end":{"line":109,"column":139}},"50":{"start":{"line":111,"column":12},"end":{"line":111,"column":83}},"51":{"start":{"line":112,"column":12},"end":{"line":155,"column":15}},"52":{"start":{"line":114,"column":16},"end":{"line":114,"column":22}},"53":{"start":{"line":115,"column":16},"end":{"line":115,"column":90}},"54":{"start":{"line":115,"column":68},"end":{"line":115,"column":87}},"55":{"start":{"line":116,"column":16},"end":{"line":116,"column":124}},"56":{"start":{"line":116,"column":69},"end":{"line":116,"column":121}},"57":{"start":{"line":117,"column":16},"end":{"line":123,"column":17}},"58":{"start":{"line":118,"column":20},"end":{"line":118,"column":87}},"59":{"start":{"line":119,"column":20},"end":{"line":121,"column":21}},"60":{"start":{"line":120,"column":24},"end":{"line":120,"column":80}},"61":{"start":{"line":122,"column":20},"end":{"line":122,"column":87}},"62":{"start":{"line":124,"column":16},"end":{"line":147,"column":17}},"63":{"start":{"line":125,"column":20},"end":{"line":125,"column":62}},"64":{"start":{"line":126,"column":20},"end":{"line":126,"column":44}},"65":{"start":{"line":127,"column":20},"end":{"line":130,"column":21}},"66":{"start":{"line":128,"column":24},"end":{"line":128,"column":53}},"67":{"start":{"line":129,"column":24},"end":{"line":129,"column":116}},"68":{"start":{"line":131,"column":20},"end":{"line":131,"column":38}},"69":{"start":{"line":132,"column":20},"end":{"line":142,"column":21}},"70":{"start":{"line":133,"column":24},"end":{"line":141,"column":25}},"71":{"start":{"line":134,"column":28},"end":{"line":134,"column":80}},"72":{"start":{"line":135,"column":28},"end":{"line":140,"column":29}},"73":{"start":{"line":136,"column":32},"end":{"line":139,"column":35}},"74":{"start":{"line":143,"column":20},"end":{"line":146,"column":21}},"75":{"start":{"line":144,"column":24},"end":{"line":144,"column":67}},"76":{"start":{"line":145,"column":24},"end":{"line":145,"column":51}},"77":{"start":{"line":148,"column":16},"end":{"line":150,"column":17}},"78":{"start":{"line":149,"column":20},"end":{"line":149,"column":91}},"79":{"start":{"line":151,"column":16},"end":{"line":151,"column":63}},"80":{"start":{"line":152,"column":16},"end":{"line":152,"column":31}},"81":{"start":{"line":154,"column":16},"end":{"line":154,"column":33}},"82":{"start":{"line":159,"column":0},"end":{"line":177,"column":1}},"83":{"start":{"line":160,"column":4},"end":{"line":160,"column":41}},"84":{"start":{"line":162,"column":4},"end":{"line":166,"column":7}},"85":{"start":{"line":167,"column":4},"end":{"line":171,"column":7}},"86":{"start":{"line":172,"column":4},"end":{"line":176,"column":7}},"87":{"start":{"line":179,"column":0},"end":{"line":186,"column":1}},"88":{"start":{"line":180,"column":4},"end":{"line":183,"column":5}},"89":{"start":{"line":181,"column":8},"end":{"line":181,"column":45}},"90":{"start":{"line":182,"column":8},"end":{"line":182,"column":37}},"91":{"start":{"line":184,"column":4},"end":{"line":184,"column":20}},"92":{"start":{"line":185,"column":4},"end":{"line":185,"column":32}},"93":{"start":{"line":188,"column":0},"end":{"line":207,"column":1}},"94":{"start":{"line":202,"column":21},"end":{"line":202,"column":37}},"95":{"start":{"line":203,"column":20},"end":{"line":203,"column":35}},"96":{"start":{"line":205,"column":8},"end":{"line":205,"column":23}}},"branchMap":{"1":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":4},"end":{"line":64,"column":4}},{"start":{"line":64,"column":4},"end":{"line":64,"column":4}}]},"2":{"line":73,"type":"if","locations":[{"start":{"line":73,"column":4},"end":{"line":73,"column":4}},{"start":{"line":73,"column":4},"end":{"line":73,"column":4}}]},"3":{"line":95,"type":"if","locations":[{"start":{"line":95,"column":12},"end":{"line":95,"column":12}},{"start":{"line":95,"column":12},"end":{"line":95,"column":12}}]},"4":{"line":98,"type":"binary-expr","locations":[{"start":{"line":98,"column":19},"end":{"line":98,"column":49}},{"start":{"line":98,"column":51},"end":{"line":98,"column":56}}]},"5":{"line":101,"type":"if","locations":[{"start":{"line":101,"column":12},"end":{"line":101,"column":12}},{"start":{"line":101,"column":12},"end":{"line":101,"column":12}}]},"6":{"line":105,"type":"if","locations":[{"start":{"line":105,"column":12},"end":{"line":105,"column":12}},{"start":{"line":105,"column":12},"end":{"line":105,"column":12}}]},"7":{"line":116,"type":"binary-expr","locations":[{"start":{"line":116,"column":76},"end":{"line":116,"column":84}},{"start":{"line":116,"column":88},"end":{"line":116,"column":97}},{"start":{"line":116,"column":101},"end":{"line":116,"column":110}},{"start":{"line":116,"column":114},"end":{"line":116,"column":120}}]},"8":{"line":117,"type":"if","locations":[{"start":{"line":117,"column":16},"end":{"line":117,"column":16}},{"start":{"line":117,"column":16},"end":{"line":117,"column":16}}]},"9":{"line":124,"type":"if","locations":[{"start":{"line":124,"column":16},"end":{"line":124,"column":16}},{"start":{"line":124,"column":16},"end":{"line":124,"column":16}}]},"10":{"line":129,"type":"binary-expr","locations":[{"start":{"line":129,"column":58},"end":{"line":129,"column":88}},{"start":{"line":129,"column":90},"end":{"line":129,"column":92}}]},"11":{"line":133,"type":"if","locations":[{"start":{"line":133,"column":24},"end":{"line":133,"column":24}},{"start":{"line":133,"column":24},"end":{"line":133,"column":24}}]},"12":{"line":135,"type":"if","locations":[{"start":{"line":135,"column":28},"end":{"line":135,"column":28}},{"start":{"line":135,"column":28},"end":{"line":135,"column":28}}]},"13":{"line":135,"type":"binary-expr","locations":[{"start":{"line":135,"column":32},"end":{"line":135,"column":59}},{"start":{"line":135,"column":63},"end":{"line":135,"column":78}}]},"14":{"line":143,"type":"if","locations":[{"start":{"line":143,"column":20},"end":{"line":143,"column":20}},{"start":{"line":143,"column":20},"end":{"line":143,"column":20}}]},"15":{"line":148,"type":"if","locations":[{"start":{"line":148,"column":16},"end":{"line":148,"column":16}},{"start":{"line":148,"column":16},"end":{"line":148,"column":16}}]},"16":{"line":180,"type":"if","locations":[{"start":{"line":180,"column":4},"end":{"line":180,"column":4}},{"start":{"line":180,"column":4},"end":{"line":180,"column":4}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var when = require('when');","","var redNodes = require(\"./nodes\");","var storage = require(\"./storage\");","var log = require(\"./log\");","var i18n = require(\"./i18n\");","var events = require(\"./events\");","var settings = require(\"./settings\");","","var express = require(\"express\");","var path = require('path');","var fs = require(\"fs\");","var os = require(\"os\");","","var runtimeMetricInterval = null;","","var started = false;","","var stubbedExpressApp = {","    get: function() {},","    post: function() {},","    put: function() {},","    delete: function() {}","}","var adminApi = {","    library: {","        register: function() {}","    },","    auth: {","        needsPermission: function() {}","    },","    comms: {","        publish: function() {}","    },","    adminApp: stubbedExpressApp,","    server: {}","}","","var nodeApp;","","function init(userSettings,_adminApi) {","    userSettings.version = getVersion();","    log.init(userSettings);","    settings.init(userSettings);","","    nodeApp = express();","","    if (_adminApi) {","        adminApi = _adminApi;","    }","    redNodes.init(runtime);","}","","var version;","","function getVersion() {","    if (!version) {","        version = require(path.join(__dirname,\"..\",\"..\",\"package.json\")).version;","        /* istanbul ignore else */","        try {","            fs.statSync(path.join(__dirname,\"..\",\"..\",\".git\"));","            version += \"-git\";","        } catch(err) {","            // No git directory","        }","    }","    return version;","}","","function start() {","    return i18n.init()","        .then(function() {","            return i18n.registerMessageCatalog(\"runtime\",path.resolve(path.join(__dirname,\"locales\")),\"runtime.json\")","        })","        .then(function() { return storage.init(runtime)})","        .then(function() { return settings.load(storage)})","        .then(function() {","","            if (log.metric()) {","                runtimeMetricInterval = setInterval(function() {","                    reportMetrics();","                }, settings.runtimeMetricInterval||15000);","            }","            log.info(\"\\n\\n\"+log._(\"runtime.welcome\")+\"\\n===================\\n\");","            if (settings.version) {","                log.info(log._(\"runtime.version\",{component:\"Node-RED\",version:\"v\"+settings.version}));","            }","            log.info(log._(\"runtime.version\",{component:\"Node.js \",version:process.version}));","            if (settings.UNSUPPORTED_VERSION) {","                log.error(\"*****************************************************************\");","                log.error(\"* \"+log._(\"runtime.unsupported_version\",{component:\"Node.js\",version:process.version,requires: \">=4\"})+\" *\");","                log.error(\"*****************************************************************\");","                events.emit(\"runtime-event\",{id:\"runtime-unsupported-version\",type:\"error\",text:\"notification.errors.unsupportedVersion\"});","            }","            log.info(os.type()+\" \"+os.release()+\" \"+os.arch()+\" \"+os.endianness());","            return redNodes.load().then(function() {","","                var i;","                var nodeErrors = redNodes.getNodeList(function(n) { return n.err!=null;});","                var nodeMissing = redNodes.getNodeList(function(n) { return n.module && n.enabled && !n.loaded && !n.err;});","                if (nodeErrors.length > 0) {","                    log.warn(\"------------------------------------------------------\");","                    for (i=0;i<nodeErrors.length;i+=1) {","                        log.warn(\"[\"+nodeErrors[i].name+\"] \"+nodeErrors[i].err);","                    }","                    log.warn(\"------------------------------------------------------\");","                }","                if (nodeMissing.length > 0) {","                    log.warn(log._(\"server.missing-modules\"));","                    var missingModules = {};","                    for (i=0;i<nodeMissing.length;i++) {","                        var missing = nodeMissing[i];","                        missingModules[missing.module] = (missingModules[missing.module]||[]).concat(missing.types);","                    }","                    var promises = [];","                    for (i in missingModules) {","                        if (missingModules.hasOwnProperty(i)) {","                            log.warn(\" - \"+i+\": \"+missingModules[i].join(\", \"));","                            if (settings.autoInstallModules && i != \"node-red\") {","                                redNodes.installModule(i).otherwise(function(err) {","                                    // Error already reported. Need the otherwise handler","                                    // to stop the error propagating any further","                                });","                            }","                        }","                    }","                    if (!settings.autoInstallModules) {","                        log.info(log._(\"server.removing-modules\"));","                        redNodes.cleanModuleList();","                    }","                }","                if (settings.settingsFile) {","                    log.info(log._(\"runtime.paths.settings\",{path:settings.settingsFile}));","                }","                redNodes.loadFlows().then(redNodes.startFlows);","                started = true;","            }).otherwise(function(err) {","                console.log(err);","            });","        });","}","","function reportMetrics() {","    var memUsage = process.memoryUsage();","","    log.log({","        level: log.METRIC,","        event: \"runtime.memory.rss\",","        value: memUsage.rss","    });","    log.log({","        level: log.METRIC,","        event: \"runtime.memory.heapTotal\",","        value: memUsage.heapTotal","    });","    log.log({","        level: log.METRIC,","        event: \"runtime.memory.heapUsed\",","        value: memUsage.heapUsed","    });","}","","function stop() {","    if (runtimeMetricInterval) {","        clearInterval(runtimeMetricInterval);","        runtimeMetricInterval = null;","    }","    started = false;","    return redNodes.stopFlows();","}","","var runtime = module.exports = {","    init: init,","    start: start,","    stop: stop,","","    version: getVersion,","","    log: log,","    i18n: i18n,","    settings: settings,","    storage: storage,","    events: events,","    nodes: redNodes,","    util: require(\"./util\"),","    get adminApi() { return adminApi },","    get nodeApp() { return nodeApp },","    isStarted: function() {","        return started;","    }","}",""],"l":{"17":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"26":1,"27":1,"28":1,"29":1,"31":1,"33":1,"35":1,"41":1,"55":1,"57":1,"58":0,"59":0,"60":0,"62":0,"64":0,"65":0,"67":0,"70":1,"72":1,"73":0,"74":0,"76":0,"77":0,"78":0,"83":0,"86":1,"87":0,"89":0,"91":0,"92":0,"95":0,"96":0,"97":0,"100":0,"101":0,"102":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"111":0,"112":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"122":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"143":0,"144":0,"145":0,"148":0,"149":0,"151":0,"152":0,"154":0,"159":1,"160":0,"162":0,"167":0,"172":0,"179":1,"180":0,"181":0,"182":0,"184":0,"185":0,"188":1,"202":0,"203":0,"205":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":1,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":1,"38":0,"39":0,"40":0,"41":0,"42":0,"43":1,"44":0,"45":0,"46":1,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"registerType","line":42,"loc":{"start":{"line":42,"column":0},"end":{"line":42,"column":53}}},"2":{"name":"createNode","line":64,"loc":{"start":{"line":64,"column":0},"end":{"line":64,"column":30}}},"3":{"name":"init","line":85,"loc":{"start":{"line":85,"column":0},"end":{"line":85,"column":23}}},"4":{"name":"disableNode","line":93,"loc":{"start":{"line":93,"column":0},"end":{"line":93,"column":25}}},"5":{"name":"uninstallModule","line":98,"loc":{"start":{"line":98,"column":0},"end":{"line":98,"column":33}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":23}},"4":{"start":{"line":21,"column":0},"end":{"line":21,"column":37}},"5":{"start":{"line":22,"column":0},"end":{"line":22,"column":43}},"6":{"start":{"line":23,"column":0},"end":{"line":23,"column":31}},"7":{"start":{"line":24,"column":0},"end":{"line":24,"column":38}},"8":{"start":{"line":25,"column":0},"end":{"line":25,"column":35}},"9":{"start":{"line":26,"column":0},"end":{"line":26,"column":29}},"10":{"start":{"line":27,"column":0},"end":{"line":27,"column":28}},"11":{"start":{"line":29,"column":0},"end":{"line":29,"column":34}},"12":{"start":{"line":31,"column":0},"end":{"line":31,"column":45}},"13":{"start":{"line":33,"column":0},"end":{"line":33,"column":13}},"14":{"start":{"line":42,"column":0},"end":{"line":56,"column":1}},"15":{"start":{"line":43,"column":4},"end":{"line":51,"column":5}},"16":{"start":{"line":46,"column":8},"end":{"line":46,"column":135}},"17":{"start":{"line":47,"column":8},"end":{"line":47,"column":27}},"18":{"start":{"line":48,"column":8},"end":{"line":48,"column":27}},"19":{"start":{"line":49,"column":8},"end":{"line":49,"column":23}},"20":{"start":{"line":50,"column":8},"end":{"line":50,"column":21}},"21":{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},"22":{"start":{"line":53,"column":8},"end":{"line":53,"column":52}},"23":{"start":{"line":55,"column":4},"end":{"line":55,"column":52}},"24":{"start":{"line":64,"column":0},"end":{"line":83,"column":1}},"25":{"start":{"line":65,"column":4},"end":{"line":65,"column":24}},"26":{"start":{"line":66,"column":4},"end":{"line":66,"column":21}},"27":{"start":{"line":67,"column":4},"end":{"line":69,"column":5}},"28":{"start":{"line":68,"column":8},"end":{"line":68,"column":24}},"29":{"start":{"line":70,"column":4},"end":{"line":70,"column":36}},"30":{"start":{"line":71,"column":4},"end":{"line":82,"column":5}},"31":{"start":{"line":74,"column":8},"end":{"line":78,"column":9}},"32":{"start":{"line":75,"column":12},"end":{"line":77,"column":13}},"33":{"start":{"line":76,"column":16},"end":{"line":76,"column":54}},"34":{"start":{"line":79,"column":8},"end":{"line":79,"column":33}},"35":{"start":{"line":80,"column":11},"end":{"line":82,"column":5}},"36":{"start":{"line":81,"column":8},"end":{"line":81,"column":30}},"37":{"start":{"line":85,"column":0},"end":{"line":91,"column":1}},"38":{"start":{"line":86,"column":4},"end":{"line":86,"column":32}},"39":{"start":{"line":87,"column":4},"end":{"line":87,"column":30}},"40":{"start":{"line":88,"column":4},"end":{"line":88,"column":24}},"41":{"start":{"line":89,"column":4},"end":{"line":89,"column":27}},"42":{"start":{"line":90,"column":4},"end":{"line":90,"column":35}},"43":{"start":{"line":93,"column":0},"end":{"line":96,"column":1}},"44":{"start":{"line":94,"column":4},"end":{"line":94,"column":29}},"45":{"start":{"line":95,"column":4},"end":{"line":95,"column":36}},"46":{"start":{"line":98,"column":0},"end":{"line":108,"column":1}},"47":{"start":{"line":99,"column":4},"end":{"line":99,"column":46}},"48":{"start":{"line":100,"column":4},"end":{"line":107,"column":5}},"49":{"start":{"line":101,"column":8},"end":{"line":101,"column":83}},"50":{"start":{"line":103,"column":8},"end":{"line":105,"column":9}},"51":{"start":{"line":104,"column":12},"end":{"line":104,"column":64}},"52":{"start":{"line":106,"column":8},"end":{"line":106,"column":48}},"53":{"start":{"line":110,"column":0},"end":{"line":161,"column":2}}},"branchMap":{"1":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":4},"end":{"line":43,"column":4}},{"start":{"line":43,"column":4},"end":{"line":43,"column":4}}]},"2":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":4},"end":{"line":52,"column":4}},{"start":{"line":52,"column":4},"end":{"line":52,"column":4}}]},"3":{"line":52,"type":"binary-expr","locations":[{"start":{"line":52,"column":8},"end":{"line":52,"column":12}},{"start":{"line":52,"column":16},"end":{"line":52,"column":32}}]},"4":{"line":67,"type":"if","locations":[{"start":{"line":67,"column":4},"end":{"line":67,"column":4}},{"start":{"line":67,"column":4},"end":{"line":67,"column":4}}]},"5":{"line":71,"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":71,"column":4}},{"start":{"line":71,"column":4},"end":{"line":71,"column":4}}]},"6":{"line":75,"type":"if","locations":[{"start":{"line":75,"column":12},"end":{"line":75,"column":12}},{"start":{"line":75,"column":12},"end":{"line":75,"column":12}}]},"7":{"line":80,"type":"if","locations":[{"start":{"line":80,"column":11},"end":{"line":80,"column":11}},{"start":{"line":80,"column":11},"end":{"line":80,"column":11}}]},"8":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":4},"end":{"line":100,"column":4}},{"start":{"line":100,"column":4},"end":{"line":100,"column":4}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var when = require(\"when\");","var path = require(\"path\");","var fs = require(\"fs\");","","var registry = require(\"./registry\");","var credentials = require(\"./credentials\");","var flows = require(\"./flows\");","var flowUtil = require(\"./flows/util\")","var context = require(\"./context\");","var Node = require(\"./Node\");","var log = require(\"../log\");","","var events = require(\"../events\");","","var child_process = require('child_process');","","var settings;","","/**"," * Registers a node constructor"," * @param nodeSet - the nodeSet providing the node (module/set)"," * @param type - the string type name"," * @param constructor - the constructor function for this node type"," * @param opts - optional additional options for the node"," */","function registerType(nodeSet,type,constructor,opts) {","    if (typeof type !== \"string\") {","        // This is someone calling the api directly, rather than via the","        // RED object provided to a node. Log a warning","        log.warn(\"[\"+nodeSet+\"] Deprecated call to RED.runtime.nodes.registerType - node-set name must be provided as first argument\");","        opts = constructor;","        constructor = type;","        type = nodeSet;","        nodeSet = \"\";","    }","    if (opts && opts.credentials) {","        credentials.register(type,opts.credentials);","    }","    registry.registerType(nodeSet,type,constructor);","}","","/**"," * Called from a Node's constructor function, invokes the super-class"," * constructor and attaches any credentials to the node."," * @param node the node object being created"," * @param def the instance definition for the node"," */","function createNode(node,def) {","    Node.call(node,def);","    var id = node.id;","    if (def._alias) {","        id = def._alias;","    }","    var creds = credentials.get(id);","    if (creds) {","        //console.log(\"Attaching credentials to \",node.id);","        // allow $(foo) syntax to substitute env variables for credentials also...","        for (var p in creds) {","            if (creds.hasOwnProperty(p)) {","                flowUtil.mapEnvVarProperties(creds,p);","            }","        }","        node.credentials = creds;","    } else if (credentials.getDefinition(node.type)) {","        node.credentials = {};","    }","}","","function init(runtime) {","    settings = runtime.settings;","    credentials.init(runtime);","    flows.init(runtime);","    registry.init(runtime);","    context.init(runtime.settings);","}","","function disableNode(id) {","    flows.checkTypeInUse(id);","    return registry.disableNode(id);","}","","function uninstallModule(module) {","    var info = registry.getModuleInfo(module);","    if (!info) {","        throw new Error(log._(\"nodes.index.unrecognised-module\", {module:module}));","    } else {","        for (var i=0;i<info.nodes.length;i++) {","            flows.checkTypeInUse(module+\"/\"+info.nodes[i].name);","        }","        return registry.uninstallModule(module);","    }","}","","module.exports = {","    // Lifecycle","    init: init,","    load: registry.load,","","    // Node registry","    createNode: createNode,","    getNode: flows.get,","    eachNode: flows.eachNode,","","    paletteEditorEnabled: registry.paletteEditorEnabled,","    installModule: registry.installModule,","    uninstallModule: uninstallModule,","","    enableNode: registry.enableNode,","    disableNode: disableNode,","","    // Node type registry","    registerType: registerType,","    getType: registry.get,","","    getNodeInfo: registry.getNodeInfo,","    getNodeList: registry.getNodeList,","","    getModuleInfo: registry.getModuleInfo,","","    getNodeConfigs: registry.getNodeConfigs,","    getNodeConfig: registry.getNodeConfig,","","    clearRegistry: registry.clear,","    cleanModuleList: registry.cleanModuleList,","","    // Flow handling","    loadFlows:  flows.load,","    startFlows: flows.startFlows,","    stopFlows:  flows.stopFlows,","    setFlows:   flows.setFlows,","    getFlows:   flows.getFlows,","","    addFlow:     flows.addFlow,","    getFlow:     flows.getFlow,","    updateFlow:  flows.updateFlow,","    removeFlow:  flows.removeFlow,","    // disableFlow: flows.disableFlow,","    // enableFlow:  flows.enableFlow,","","    // Credentials","    addCredentials: credentials.add,","    getCredentials: credentials.get,","    deleteCredentials: credentials.delete,","    getCredentialDefinition: credentials.getDefinition","};",""],"l":{"17":1,"18":1,"19":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"29":1,"31":1,"33":1,"42":1,"43":0,"46":0,"47":0,"48":0,"49":0,"50":0,"52":0,"53":0,"55":0,"64":1,"65":0,"66":0,"67":0,"68":0,"70":0,"71":0,"74":0,"75":0,"76":0,"79":0,"80":0,"81":0,"85":1,"86":0,"87":0,"88":0,"89":0,"90":0,"93":1,"94":0,"95":0,"98":1,"99":0,"100":0,"101":0,"103":0,"104":0,"106":0,"110":1}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/registry/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/registry/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":0,"11":0,"12":0,"13":0,"14":1,"15":0,"16":0,"17":1,"18":0,"19":0,"20":1,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":1},"b":{"1":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"init","line":28,"loc":{"start":{"line":28,"column":0},"end":{"line":28,"column":23}}},"2":{"name":"load","line":35,"loc":{"start":{"line":35,"column":0},"end":{"line":35,"column":16}}},"3":{"name":"addModule","line":40,"loc":{"start":{"line":40,"column":0},"end":{"line":40,"column":27}}},"4":{"name":"(anonymous_4)","line":41,"loc":{"start":{"line":41,"column":41},"end":{"line":41,"column":52}}},"5":{"name":"enableNodeSet","line":46,"loc":{"start":{"line":46,"column":0},"end":{"line":46,"column":33}}},"6":{"name":"(anonymous_6)","line":47,"loc":{"start":{"line":47,"column":49},"end":{"line":47,"column":60}}},"7":{"name":"(anonymous_7)","line":50,"loc":{"start":{"line":50,"column":79},"end":{"line":50,"column":90}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":23}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":27}},"4":{"start":{"line":21,"column":0},"end":{"line":21,"column":37}},"5":{"start":{"line":22,"column":0},"end":{"line":22,"column":37}},"6":{"start":{"line":23,"column":0},"end":{"line":23,"column":33}},"7":{"start":{"line":24,"column":0},"end":{"line":24,"column":39}},"8":{"start":{"line":26,"column":0},"end":{"line":26,"column":13}},"9":{"start":{"line":28,"column":0},"end":{"line":33,"column":1}},"10":{"start":{"line":29,"column":4},"end":{"line":29,"column":32}},"11":{"start":{"line":30,"column":4},"end":{"line":30,"column":37}},"12":{"start":{"line":31,"column":4},"end":{"line":31,"column":25}},"13":{"start":{"line":32,"column":4},"end":{"line":32,"column":35}},"14":{"start":{"line":35,"column":0},"end":{"line":38,"column":1}},"15":{"start":{"line":36,"column":4},"end":{"line":36,"column":20}},"16":{"start":{"line":37,"column":4},"end":{"line":37,"column":53}},"17":{"start":{"line":40,"column":0},"end":{"line":44,"column":1}},"18":{"start":{"line":41,"column":4},"end":{"line":43,"column":7}},"19":{"start":{"line":42,"column":8},"end":{"line":42,"column":46}},"20":{"start":{"line":46,"column":0},"end":{"line":56,"column":1}},"21":{"start":{"line":47,"column":4},"end":{"line":55,"column":7}},"22":{"start":{"line":48,"column":8},"end":{"line":48,"column":53}},"23":{"start":{"line":49,"column":8},"end":{"line":53,"column":9}},"24":{"start":{"line":50,"column":12},"end":{"line":52,"column":15}},"25":{"start":{"line":51,"column":16},"end":{"line":51,"column":54}},"26":{"start":{"line":54,"column":8},"end":{"line":54,"column":37}},"27":{"start":{"line":58,"column":0},"end":{"line":86,"column":2}}},"branchMap":{"1":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":8},"end":{"line":49,"column":8}},{"start":{"line":49,"column":8},"end":{"line":49,"column":8}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var when = require(\"when\");","var fs = require(\"fs\");","var path = require(\"path\");","","var events = require(\"../../events\");","var registry = require(\"./registry\");","var loader = require(\"./loader\");","var installer = require(\"./installer\");","","var settings;","","function init(runtime) {","    settings = runtime.settings;","    installer.init(runtime.settings);","    loader.init(runtime);","    registry.init(settings,loader);","}","","function load() {","    registry.load();","    return installer.checkPrereq().then(loader.load);","}","","function addModule(module) {","    return loader.addModule(module).then(function() {","        return registry.getModuleInfo(module);","    });","}","","function enableNodeSet(typeOrId) {","    return registry.enableNodeSet(typeOrId).then(function() {","        var nodeSet = registry.getNodeInfo(typeOrId);","        if (!nodeSet.loaded) {","            return loader.loadNodeSet(registry.getFullNodeInfo(typeOrId)).then(function() {","                return registry.getNodeInfo(typeOrId);","            });","        }","        return when.resolve(nodeSet);","    });","}","","module.exports = {","    init:init,","    load:load,","    clear: registry.clear,","    registerType: registry.registerNodeConstructor,","","    get: registry.getNodeConstructor,","    getNodeInfo: registry.getNodeInfo,","    getNodeList: registry.getNodeList,","","    getModuleInfo: registry.getModuleInfo,","    getModuleList: registry.getModuleList,","","    getNodeConfigs: registry.getAllNodeConfigs,","    getNodeConfig: registry.getNodeConfig,","","    enableNode: enableNodeSet,","    disableNode: registry.disableNodeSet,","","    addModule: addModule,","    removeModule: registry.removeModule,","","    installModule: installer.installModule,","    uninstallModule: installer.uninstallModule,","","    cleanModuleList: registry.cleanModuleList,","","    paletteEditorEnabled: installer.paletteEditorEnabled","};",""],"l":{"17":1,"18":1,"19":1,"21":1,"22":1,"23":1,"24":1,"26":1,"28":1,"29":0,"30":0,"31":0,"32":0,"35":1,"36":0,"37":0,"40":1,"41":0,"42":0,"46":1,"47":0,"48":0,"49":0,"50":0,"51":0,"54":0,"58":1}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/events.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/events.js","s":{"1":1,"2":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":31}},"2":{"start":{"line":19,"column":0},"end":{"line":19,"column":43}}},"branchMap":{},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var events = require(\"events\"); ","","module.exports = new events.EventEmitter(); ",""],"l":{"17":1,"19":1}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/registry/registry.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/registry/registry.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":1,"23":0,"24":0,"25":0,"26":1,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":1,"34":0,"35":0,"36":1,"37":0,"38":0,"39":1,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":1,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":1,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":1,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":1,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":1,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":1,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":1,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":1,"162":0,"163":1,"164":0,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"173":1,"174":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"182":0,"183":0,"184":1,"185":0,"186":0,"187":0,"188":0,"189":0,"190":0,"191":0,"192":0,"193":0,"194":1,"195":0,"196":0,"197":0,"198":0,"199":0,"200":0,"201":0,"202":0,"203":0,"204":0,"205":1,"206":0,"207":0,"208":0,"209":0,"210":0,"211":0,"212":0,"213":0,"214":0,"215":0,"216":0,"217":1,"218":0,"219":0,"220":0,"221":0,"222":0,"223":0,"224":0,"225":0,"226":0,"227":1,"228":0,"229":0,"230":0,"231":0,"232":0,"233":0,"234":0,"235":0,"236":1,"237":0,"238":0,"239":0,"240":0,"241":0,"242":1,"243":0,"244":0,"245":0,"246":1,"247":0,"248":0,"249":0,"250":0,"251":0,"252":0,"253":0,"254":0,"255":0,"256":0,"257":0,"258":0,"259":0,"260":0,"261":1,"262":0,"263":0,"264":0,"265":0,"266":0,"267":0,"268":0,"269":0,"270":0,"271":0,"272":0,"273":0,"274":0,"275":1,"276":0,"277":0,"278":0,"279":0,"280":0,"281":0,"282":0,"283":0,"284":0,"285":0,"286":0,"287":0,"288":0,"289":0,"290":0,"291":0,"292":0,"293":0,"294":0,"295":0,"296":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0,0],"56":[0,0],"57":[0,0],"58":[0,0],"59":[0,0],"60":[0,0],"61":[0,0],"62":[0,0],"63":[0,0],"64":[0,0],"65":[0,0,0],"66":[0,0],"67":[0,0],"68":[0,0],"69":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0},"fnMap":{"1":{"name":"init","line":35,"loc":{"start":{"line":35,"column":0},"end":{"line":35,"column":33}}},"2":{"name":"load","line":46,"loc":{"start":{"line":46,"column":0},"end":{"line":46,"column":16}}},"3":{"name":"filterNodeInfo","line":54,"loc":{"start":{"line":54,"column":0},"end":{"line":54,"column":27}}},"4":{"name":"getModule","line":73,"loc":{"start":{"line":73,"column":0},"end":{"line":73,"column":23}}},"5":{"name":"getNode","line":78,"loc":{"start":{"line":78,"column":0},"end":{"line":78,"column":21}}},"6":{"name":"saveNodeList","line":83,"loc":{"start":{"line":83,"column":0},"end":{"line":83,"column":24}}},"7":{"name":"loadNodeConfigs","line":121,"loc":{"start":{"line":121,"column":0},"end":{"line":121,"column":27}}},"8":{"name":"addNodeSet","line":165,"loc":{"start":{"line":165,"column":0},"end":{"line":165,"column":36}}},"9":{"name":"(anonymous_9)","line":167,"loc":{"start":{"line":167,"column":26},"end":{"line":167,"column":38}}},"10":{"name":"removeNode","line":191,"loc":{"start":{"line":191,"column":0},"end":{"line":191,"column":24}}},"11":{"name":"(anonymous_11)","line":201,"loc":{"start":{"line":201,"column":25},"end":{"line":201,"column":37}}},"12":{"name":"removeModule","line":214,"loc":{"start":{"line":214,"column":0},"end":{"line":214,"column":30}}},"13":{"name":"getNodeInfo","line":232,"loc":{"start":{"line":232,"column":0},"end":{"line":232,"column":31}}},"14":{"name":"getFullNodeInfo","line":255,"loc":{"start":{"line":255,"column":0},"end":{"line":255,"column":35}}},"15":{"name":"getNodeList","line":272,"loc":{"start":{"line":272,"column":0},"end":{"line":272,"column":29}}},"16":{"name":"getModuleList","line":293,"loc":{"start":{"line":293,"column":0},"end":{"line":293,"column":25}}},"17":{"name":"getModuleInfo","line":306,"loc":{"start":{"line":306,"column":0},"end":{"line":306,"column":31}}},"18":{"name":"getCaller","line":326,"loc":{"start":{"line":326,"column":0},"end":{"line":326,"column":20}}},"19":{"name":"(anonymous_19)","line":328,"loc":{"start":{"line":328,"column":30},"end":{"line":328,"column":48}}},"20":{"name":"inheritNode","line":338,"loc":{"start":{"line":338,"column":0},"end":{"line":338,"column":34}}},"21":{"name":"registerNodeConstructor","line":359,"loc":{"start":{"line":359,"column":0},"end":{"line":359,"column":59}}},"22":{"name":"getAllNodeConfigs","line":385,"loc":{"start":{"line":385,"column":0},"end":{"line":385,"column":33}}},"23":{"name":"getNodeConfig","line":408,"loc":{"start":{"line":408,"column":0},"end":{"line":408,"column":32}}},"24":{"name":"getNodeConstructor","line":427,"loc":{"start":{"line":427,"column":0},"end":{"line":427,"column":34}}},"25":{"name":"clear","line":443,"loc":{"start":{"line":443,"column":0},"end":{"line":443,"column":17}}},"26":{"name":"getTypeId","line":451,"loc":{"start":{"line":451,"column":0},"end":{"line":451,"column":25}}},"27":{"name":"enableNodeSet","line":459,"loc":{"start":{"line":459,"column":0},"end":{"line":459,"column":33}}},"28":{"name":"(anonymous_28)","line":474,"loc":{"start":{"line":474,"column":35},"end":{"line":474,"column":46}}},"29":{"name":"disableNodeSet","line":482,"loc":{"start":{"line":482,"column":0},"end":{"line":482,"column":34}}},"30":{"name":"(anonymous_30)","line":496,"loc":{"start":{"line":496,"column":35},"end":{"line":496,"column":46}}},"31":{"name":"cleanModuleList","line":504,"loc":{"start":{"line":504,"column":0},"end":{"line":504,"column":27}}}},"statementMap":{"1":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"2":{"start":{"line":19,"column":0},"end":{"line":19,"column":27}},"3":{"start":{"line":20,"column":0},"end":{"line":20,"column":37}},"4":{"start":{"line":22,"column":0},"end":{"line":22,"column":13}},"5":{"start":{"line":24,"column":0},"end":{"line":24,"column":9}},"6":{"start":{"line":26,"column":0},"end":{"line":26,"column":11}},"7":{"start":{"line":28,"column":0},"end":{"line":28,"column":27}},"8":{"start":{"line":29,"column":0},"end":{"line":29,"column":23}},"9":{"start":{"line":30,"column":0},"end":{"line":30,"column":18}},"10":{"start":{"line":31,"column":0},"end":{"line":31,"column":26}},"11":{"start":{"line":32,"column":0},"end":{"line":32,"column":22}},"12":{"start":{"line":33,"column":0},"end":{"line":33,"column":21}},"13":{"start":{"line":35,"column":0},"end":{"line":44,"column":1}},"14":{"start":{"line":36,"column":4},"end":{"line":36,"column":25}},"15":{"start":{"line":37,"column":4},"end":{"line":37,"column":21}},"16":{"start":{"line":38,"column":4},"end":{"line":38,"column":21}},"17":{"start":{"line":39,"column":4},"end":{"line":39,"column":22}},"18":{"start":{"line":40,"column":4},"end":{"line":40,"column":26}},"19":{"start":{"line":41,"column":4},"end":{"line":41,"column":18}},"20":{"start":{"line":42,"column":4},"end":{"line":42,"column":27}},"21":{"start":{"line":43,"column":4},"end":{"line":43,"column":30}},"22":{"start":{"line":46,"column":0},"end":{"line":52,"column":1}},"23":{"start":{"line":47,"column":4},"end":{"line":51,"column":5}},"24":{"start":{"line":48,"column":8},"end":{"line":48,"column":42}},"25":{"start":{"line":50,"column":8},"end":{"line":50,"column":27}},"26":{"start":{"line":54,"column":0},"end":{"line":69,"column":1}},"27":{"start":{"line":55,"column":4},"end":{"line":61,"column":6}},"28":{"start":{"line":62,"column":4},"end":{"line":64,"column":5}},"29":{"start":{"line":63,"column":8},"end":{"line":63,"column":28}},"30":{"start":{"line":65,"column":4},"end":{"line":67,"column":5}},"31":{"start":{"line":66,"column":8},"end":{"line":66,"column":33}},"32":{"start":{"line":68,"column":4},"end":{"line":68,"column":13}},"33":{"start":{"line":73,"column":0},"end":{"line":76,"column":1}},"34":{"start":{"line":74,"column":4},"end":{"line":74,"column":30}},"35":{"start":{"line":75,"column":4},"end":{"line":75,"column":51}},"36":{"start":{"line":78,"column":0},"end":{"line":81,"column":1}},"37":{"start":{"line":79,"column":4},"end":{"line":79,"column":30}},"38":{"start":{"line":80,"column":4},"end":{"line":80,"column":33}},"39":{"start":{"line":83,"column":0},"end":{"line":119,"column":1}},"40":{"start":{"line":84,"column":4},"end":{"line":84,"column":24}},"41":{"start":{"line":86,"column":4},"end":{"line":113,"column":5}},"42":{"start":{"line":88,"column":8},"end":{"line":112,"column":9}},"43":{"start":{"line":89,"column":12},"end":{"line":111,"column":13}},"44":{"start":{"line":90,"column":16},"end":{"line":97,"column":17}},"45":{"start":{"line":91,"column":20},"end":{"line":96,"column":22}},"46":{"start":{"line":98,"column":16},"end":{"line":98,"column":56}},"47":{"start":{"line":99,"column":16},"end":{"line":110,"column":17}},"48":{"start":{"line":101,"column":20},"end":{"line":109,"column":21}},"49":{"start":{"line":102,"column":24},"end":{"line":102,"column":49}},"50":{"start":{"line":103,"column":24},"end":{"line":103,"column":55}},"51":{"start":{"line":104,"column":24},"end":{"line":104,"column":37}},"52":{"start":{"line":105,"column":24},"end":{"line":105,"column":38}},"53":{"start":{"line":106,"column":24},"end":{"line":106,"column":36}},"54":{"start":{"line":107,"column":24},"end":{"line":107,"column":45}},"55":{"start":{"line":108,"column":24},"end":{"line":108,"column":59}},"56":{"start":{"line":114,"column":4},"end":{"line":118,"column":5}},"57":{"start":{"line":115,"column":8},"end":{"line":115,"column":48}},"58":{"start":{"line":117,"column":8},"end":{"line":117,"column":51}},"59":{"start":{"line":121,"column":0},"end":{"line":163,"column":1}},"60":{"start":{"line":122,"column":4},"end":{"line":122,"column":40}},"61":{"start":{"line":124,"column":4},"end":{"line":162,"column":5}},"62":{"start":{"line":125,"column":8},"end":{"line":125,"column":18}},"63":{"start":{"line":126,"column":11},"end":{"line":162,"column":5}},"64":{"start":{"line":127,"column":8},"end":{"line":127,"column":23}},"65":{"start":{"line":130,"column":8},"end":{"line":130,"column":28}},"66":{"start":{"line":131,"column":8},"end":{"line":159,"column":9}},"67":{"start":{"line":133,"column":12},"end":{"line":158,"column":13}},"68":{"start":{"line":134,"column":16},"end":{"line":134,"column":45}},"69":{"start":{"line":135,"column":16},"end":{"line":135,"column":31}},"70":{"start":{"line":136,"column":16},"end":{"line":136,"column":32}},"71":{"start":{"line":138,"column":16},"end":{"line":144,"column":17}},"72":{"start":{"line":139,"column":20},"end":{"line":139,"column":51}},"73":{"start":{"line":140,"column":20},"end":{"line":140,"column":64}},"74":{"start":{"line":142,"column":20},"end":{"line":142,"column":44}},"75":{"start":{"line":143,"column":20},"end":{"line":143,"column":90}},"76":{"start":{"line":146,"column":16},"end":{"line":151,"column":17}},"77":{"start":{"line":147,"column":20},"end":{"line":150,"column":22}},"78":{"start":{"line":152,"column":16},"end":{"line":157,"column":18}},"79":{"start":{"line":160,"column":8},"end":{"line":160,"column":41}},"80":{"start":{"line":161,"column":8},"end":{"line":161,"column":26}},"81":{"start":{"line":165,"column":0},"end":{"line":189,"column":1}},"82":{"start":{"line":166,"column":4},"end":{"line":170,"column":5}},"83":{"start":{"line":167,"column":8},"end":{"line":169,"column":11}},"84":{"start":{"line":168,"column":12},"end":{"line":168,"column":33}},"85":{"start":{"line":171,"column":4},"end":{"line":171,"column":58}},"86":{"start":{"line":172,"column":4},"end":{"line":172,"column":43}},"87":{"start":{"line":174,"column":4},"end":{"line":179,"column":5}},"88":{"start":{"line":175,"column":8},"end":{"line":178,"column":10}},"89":{"start":{"line":181,"column":4},"end":{"line":183,"column":5}},"90":{"start":{"line":182,"column":8},"end":{"line":182,"column":52}},"91":{"start":{"line":184,"column":4},"end":{"line":184,"column":48}},"92":{"start":{"line":186,"column":4},"end":{"line":186,"column":52}},"93":{"start":{"line":187,"column":4},"end":{"line":187,"column":22}},"94":{"start":{"line":188,"column":4},"end":{"line":188,"column":27}},"95":{"start":{"line":191,"column":0},"end":{"line":212,"column":1}},"96":{"start":{"line":192,"column":4},"end":{"line":192,"column":65}},"97":{"start":{"line":193,"column":4},"end":{"line":195,"column":5}},"98":{"start":{"line":194,"column":8},"end":{"line":194,"column":48}},"99":{"start":{"line":196,"column":4},"end":{"line":196,"column":59}},"100":{"start":{"line":197,"column":4},"end":{"line":197,"column":33}},"101":{"start":{"line":198,"column":4},"end":{"line":200,"column":5}},"102":{"start":{"line":199,"column":8},"end":{"line":199,"column":29}},"103":{"start":{"line":201,"column":4},"end":{"line":207,"column":7}},"104":{"start":{"line":202,"column":8},"end":{"line":202,"column":37}},"105":{"start":{"line":203,"column":8},"end":{"line":206,"column":9}},"106":{"start":{"line":204,"column":12},"end":{"line":204,"column":39}},"107":{"start":{"line":205,"column":12},"end":{"line":205,"column":35}},"108":{"start":{"line":208,"column":4},"end":{"line":208,"column":27}},"109":{"start":{"line":209,"column":4},"end":{"line":209,"column":26}},"110":{"start":{"line":210,"column":4},"end":{"line":210,"column":27}},"111":{"start":{"line":211,"column":4},"end":{"line":211,"column":34}},"112":{"start":{"line":214,"column":0},"end":{"line":230,"column":1}},"113":{"start":{"line":215,"column":4},"end":{"line":217,"column":5}},"114":{"start":{"line":216,"column":8},"end":{"line":216,"column":48}},"115":{"start":{"line":218,"column":4},"end":{"line":218,"column":36}},"116":{"start":{"line":219,"column":4},"end":{"line":221,"column":5}},"117":{"start":{"line":220,"column":8},"end":{"line":220,"column":56}},"118":{"start":{"line":222,"column":4},"end":{"line":222,"column":22}},"119":{"start":{"line":223,"column":4},"end":{"line":225,"column":5}},"120":{"start":{"line":224,"column":8},"end":{"line":224,"column":55}},"121":{"start":{"line":226,"column":4},"end":{"line":226,"column":31}},"122":{"start":{"line":227,"column":4},"end":{"line":227,"column":33}},"123":{"start":{"line":228,"column":4},"end":{"line":228,"column":19}},"124":{"start":{"line":229,"column":4},"end":{"line":229,"column":20}},"125":{"start":{"line":232,"column":0},"end":{"line":253,"column":1}},"126":{"start":{"line":233,"column":4},"end":{"line":233,"column":22}},"127":{"start":{"line":234,"column":4},"end":{"line":236,"column":5}},"128":{"start":{"line":235,"column":8},"end":{"line":235,"column":36}},"129":{"start":{"line":238,"column":4},"end":{"line":251,"column":5}},"130":{"start":{"line":239,"column":8},"end":{"line":239,"column":50}},"131":{"start":{"line":240,"column":8},"end":{"line":250,"column":9}},"132":{"start":{"line":241,"column":12},"end":{"line":241,"column":51}},"133":{"start":{"line":242,"column":12},"end":{"line":249,"column":13}},"134":{"start":{"line":243,"column":16},"end":{"line":243,"column":50}},"135":{"start":{"line":244,"column":16},"end":{"line":246,"column":17}},"136":{"start":{"line":245,"column":20},"end":{"line":245,"column":48}},"137":{"start":{"line":247,"column":16},"end":{"line":247,"column":46}},"138":{"start":{"line":248,"column":16},"end":{"line":248,"column":28}},"139":{"start":{"line":252,"column":4},"end":{"line":252,"column":16}},"140":{"start":{"line":255,"column":0},"end":{"line":270,"column":1}},"141":{"start":{"line":258,"column":4},"end":{"line":258,"column":22}},"142":{"start":{"line":259,"column":4},"end":{"line":261,"column":5}},"143":{"start":{"line":260,"column":8},"end":{"line":260,"column":36}},"144":{"start":{"line":263,"column":4},"end":{"line":268,"column":5}},"145":{"start":{"line":264,"column":8},"end":{"line":264,"column":50}},"146":{"start":{"line":265,"column":8},"end":{"line":267,"column":9}},"147":{"start":{"line":266,"column":12},"end":{"line":266,"column":45}},"148":{"start":{"line":269,"column":4},"end":{"line":269,"column":16}},"149":{"start":{"line":272,"column":0},"end":{"line":291,"column":1}},"150":{"start":{"line":273,"column":4},"end":{"line":273,"column":18}},"151":{"start":{"line":274,"column":4},"end":{"line":289,"column":5}},"152":{"start":{"line":276,"column":8},"end":{"line":288,"column":9}},"153":{"start":{"line":277,"column":12},"end":{"line":277,"column":52}},"154":{"start":{"line":278,"column":12},"end":{"line":287,"column":13}},"155":{"start":{"line":280,"column":16},"end":{"line":286,"column":17}},"156":{"start":{"line":281,"column":20},"end":{"line":281,"column":63}},"157":{"start":{"line":282,"column":20},"end":{"line":282,"column":69}},"158":{"start":{"line":283,"column":20},"end":{"line":285,"column":21}},"159":{"start":{"line":284,"column":24},"end":{"line":284,"column":44}},"160":{"start":{"line":290,"column":4},"end":{"line":290,"column":16}},"161":{"start":{"line":293,"column":0},"end":{"line":304,"column":1}},"162":{"start":{"line":302,"column":4},"end":{"line":302,"column":25}},"163":{"start":{"line":306,"column":0},"end":{"line":324,"column":1}},"164":{"start":{"line":307,"column":4},"end":{"line":323,"column":5}},"165":{"start":{"line":308,"column":8},"end":{"line":308,"column":40}},"166":{"start":{"line":309,"column":8},"end":{"line":314,"column":10}},"167":{"start":{"line":315,"column":8},"end":{"line":319,"column":9}},"168":{"start":{"line":316,"column":12},"end":{"line":316,"column":81}},"169":{"start":{"line":317,"column":12},"end":{"line":317,"column":41}},"170":{"start":{"line":318,"column":12},"end":{"line":318,"column":35}},"171":{"start":{"line":320,"column":8},"end":{"line":320,"column":17}},"172":{"start":{"line":322,"column":8},"end":{"line":322,"column":20}},"173":{"start":{"line":326,"column":0},"end":{"line":336,"column":1}},"174":{"start":{"line":327,"column":4},"end":{"line":327,"column":39}},"175":{"start":{"line":328,"column":4},"end":{"line":328,"column":66}},"176":{"start":{"line":328,"column":50},"end":{"line":328,"column":63}},"177":{"start":{"line":329,"column":4},"end":{"line":329,"column":26}},"178":{"start":{"line":330,"column":4},"end":{"line":330,"column":51}},"179":{"start":{"line":331,"column":4},"end":{"line":331,"column":26}},"180":{"start":{"line":332,"column":4},"end":{"line":332,"column":35}},"181":{"start":{"line":333,"column":4},"end":{"line":333,"column":18}},"182":{"start":{"line":334,"column":4},"end":{"line":334,"column":18}},"183":{"start":{"line":335,"column":4},"end":{"line":335,"column":34}},"184":{"start":{"line":338,"column":0},"end":{"line":357,"column":1}},"185":{"start":{"line":339,"column":4},"end":{"line":356,"column":5}},"186":{"start":{"line":340,"column":8},"end":{"line":340,"column":40}},"187":{"start":{"line":342,"column":8},"end":{"line":342,"column":42}},"188":{"start":{"line":343,"column":8},"end":{"line":345,"column":9}},"189":{"start":{"line":344,"column":12},"end":{"line":344,"column":49}},"190":{"start":{"line":349,"column":8},"end":{"line":349,"column":40}},"191":{"start":{"line":350,"column":8},"end":{"line":355,"column":9}},"192":{"start":{"line":351,"column":12},"end":{"line":351,"column":57}},"193":{"start":{"line":354,"column":12},"end":{"line":354,"column":45}},"194":{"start":{"line":359,"column":0},"end":{"line":383,"column":1}},"195":{"start":{"line":360,"column":4},"end":{"line":362,"column":5}},"196":{"start":{"line":361,"column":8},"end":{"line":361,"column":52}},"197":{"start":{"line":366,"column":4},"end":{"line":368,"column":5}},"198":{"start":{"line":367,"column":8},"end":{"line":367,"column":33}},"199":{"start":{"line":370,"column":4},"end":{"line":370,"column":47}},"200":{"start":{"line":371,"column":4},"end":{"line":379,"column":5}},"201":{"start":{"line":372,"column":8},"end":{"line":378,"column":9}},"202":{"start":{"line":377,"column":12},"end":{"line":377,"column":41}},"203":{"start":{"line":381,"column":4},"end":{"line":381,"column":41}},"204":{"start":{"line":382,"column":4},"end":{"line":382,"column":40}},"205":{"start":{"line":385,"column":0},"end":{"line":406,"column":1}},"206":{"start":{"line":386,"column":4},"end":{"line":404,"column":5}},"207":{"start":{"line":387,"column":8},"end":{"line":387,"column":24}},"208":{"start":{"line":388,"column":8},"end":{"line":388,"column":24}},"209":{"start":{"line":389,"column":8},"end":{"line":397,"column":9}},"210":{"start":{"line":390,"column":12},"end":{"line":390,"column":33}},"211":{"start":{"line":391,"column":12},"end":{"line":391,"column":73}},"212":{"start":{"line":392,"column":12},"end":{"line":396,"column":13}},"213":{"start":{"line":393,"column":16},"end":{"line":393,"column":40}},"214":{"start":{"line":394,"column":16},"end":{"line":394,"column":71}},"215":{"start":{"line":403,"column":8},"end":{"line":403,"column":33}},"216":{"start":{"line":405,"column":4},"end":{"line":405,"column":27}},"217":{"start":{"line":408,"column":0},"end":{"line":425,"column":1}},"218":{"start":{"line":409,"column":4},"end":{"line":409,"column":46}},"219":{"start":{"line":410,"column":4},"end":{"line":412,"column":5}},"220":{"start":{"line":411,"column":8},"end":{"line":411,"column":20}},"221":{"start":{"line":413,"column":4},"end":{"line":413,"column":39}},"222":{"start":{"line":414,"column":4},"end":{"line":424,"column":5}},"223":{"start":{"line":415,"column":8},"end":{"line":415,"column":35}},"224":{"start":{"line":416,"column":8},"end":{"line":416,"column":58}},"225":{"start":{"line":421,"column":8},"end":{"line":421,"column":22}},"226":{"start":{"line":423,"column":8},"end":{"line":423,"column":20}},"227":{"start":{"line":427,"column":0},"end":{"line":441,"column":1}},"228":{"start":{"line":428,"column":4},"end":{"line":428,"column":32}},"229":{"start":{"line":430,"column":4},"end":{"line":430,"column":15}},"230":{"start":{"line":431,"column":4},"end":{"line":435,"column":5}},"231":{"start":{"line":432,"column":8},"end":{"line":432,"column":27}},"232":{"start":{"line":434,"column":8},"end":{"line":434,"column":65}},"233":{"start":{"line":437,"column":4},"end":{"line":439,"column":5}},"234":{"start":{"line":438,"column":8},"end":{"line":438,"column":38}},"235":{"start":{"line":440,"column":4},"end":{"line":440,"column":16}},"236":{"start":{"line":443,"column":0},"end":{"line":449,"column":1}},"237":{"start":{"line":444,"column":4},"end":{"line":444,"column":27}},"238":{"start":{"line":445,"column":4},"end":{"line":445,"column":23}},"239":{"start":{"line":446,"column":4},"end":{"line":446,"column":18}},"240":{"start":{"line":447,"column":4},"end":{"line":447,"column":26}},"241":{"start":{"line":448,"column":4},"end":{"line":448,"column":22}},"242":{"start":{"line":451,"column":0},"end":{"line":457,"column":1}},"243":{"start":{"line":452,"column":4},"end":{"line":456,"column":5}},"244":{"start":{"line":453,"column":8},"end":{"line":453,"column":34}},"245":{"start":{"line":455,"column":8},"end":{"line":455,"column":20}},"246":{"start":{"line":459,"column":0},"end":{"line":480,"column":1}},"247":{"start":{"line":460,"column":4},"end":{"line":462,"column":5}},"248":{"start":{"line":461,"column":8},"end":{"line":461,"column":48}},"249":{"start":{"line":464,"column":4},"end":{"line":464,"column":22}},"250":{"start":{"line":465,"column":4},"end":{"line":467,"column":5}},"251":{"start":{"line":466,"column":8},"end":{"line":466,"column":36}},"252":{"start":{"line":468,"column":4},"end":{"line":468,"column":15}},"253":{"start":{"line":469,"column":4},"end":{"line":479,"column":5}},"254":{"start":{"line":470,"column":8},"end":{"line":470,"column":65}},"255":{"start":{"line":471,"column":8},"end":{"line":471,"column":26}},"256":{"start":{"line":472,"column":8},"end":{"line":472,"column":30}},"257":{"start":{"line":473,"column":8},"end":{"line":473,"column":31}},"258":{"start":{"line":474,"column":8},"end":{"line":476,"column":11}},"259":{"start":{"line":475,"column":12},"end":{"line":475,"column":42}},"260":{"start":{"line":478,"column":8},"end":{"line":478,"column":54}},"261":{"start":{"line":482,"column":0},"end":{"line":502,"column":1}},"262":{"start":{"line":483,"column":4},"end":{"line":485,"column":5}},"263":{"start":{"line":484,"column":8},"end":{"line":484,"column":48}},"264":{"start":{"line":486,"column":4},"end":{"line":486,"column":22}},"265":{"start":{"line":487,"column":4},"end":{"line":489,"column":5}},"266":{"start":{"line":488,"column":8},"end":{"line":488,"column":36}},"267":{"start":{"line":490,"column":4},"end":{"line":490,"column":15}},"268":{"start":{"line":491,"column":4},"end":{"line":501,"column":5}},"269":{"start":{"line":492,"column":8},"end":{"line":492,"column":65}},"270":{"start":{"line":494,"column":8},"end":{"line":494,"column":31}},"271":{"start":{"line":495,"column":8},"end":{"line":495,"column":31}},"272":{"start":{"line":496,"column":8},"end":{"line":498,"column":11}},"273":{"start":{"line":497,"column":12},"end":{"line":497,"column":42}},"274":{"start":{"line":500,"column":8},"end":{"line":500,"column":48}},"275":{"start":{"line":504,"column":0},"end":{"line":541,"column":1}},"276":{"start":{"line":505,"column":4},"end":{"line":505,"column":24}},"277":{"start":{"line":506,"column":4},"end":{"line":537,"column":5}},"278":{"start":{"line":508,"column":8},"end":{"line":536,"column":9}},"279":{"start":{"line":509,"column":12},"end":{"line":509,"column":49}},"280":{"start":{"line":510,"column":12},"end":{"line":510,"column":21}},"281":{"start":{"line":511,"column":12},"end":{"line":535,"column":13}},"282":{"start":{"line":513,"column":16},"end":{"line":522,"column":17}},"283":{"start":{"line":515,"column":20},"end":{"line":521,"column":21}},"284":{"start":{"line":516,"column":24},"end":{"line":516,"column":44}},"285":{"start":{"line":517,"column":24},"end":{"line":520,"column":25}},"286":{"start":{"line":518,"column":28},"end":{"line":518,"column":53}},"287":{"start":{"line":519,"column":28},"end":{"line":519,"column":43}},"288":{"start":{"line":524,"column":16},"end":{"line":534,"column":17}},"289":{"start":{"line":526,"column":20},"end":{"line":532,"column":21}},"290":{"start":{"line":528,"column":24},"end":{"line":531,"column":25}},"291":{"start":{"line":529,"column":28},"end":{"line":529,"column":53}},"292":{"start":{"line":530,"column":28},"end":{"line":530,"column":43}},"293":{"start":{"line":533,"column":20},"end":{"line":533,"column":46}},"294":{"start":{"line":538,"column":4},"end":{"line":540,"column":5}},"295":{"start":{"line":539,"column":8},"end":{"line":539,"column":23}},"296":{"start":{"line":543,"column":0},"end":{"line":575,"column":2}}},"branchMap":{"1":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":4},"end":{"line":47,"column":4}},{"start":{"line":47,"column":4},"end":{"line":47,"column":4}}]},"2":{"line":56,"type":"binary-expr","locations":[{"start":{"line":56,"column":12},"end":{"line":56,"column":16}},{"start":{"line":56,"column":18},"end":{"line":56,"column":37}}]},"3":{"line":60,"type":"binary-expr","locations":[{"start":{"line":60,"column":15},"end":{"line":60,"column":22}},{"start":{"line":60,"column":24},"end":{"line":60,"column":29}}]},"4":{"line":62,"type":"if","locations":[{"start":{"line":62,"column":4},"end":{"line":62,"column":4}},{"start":{"line":62,"column":4},"end":{"line":62,"column":4}}]},"5":{"line":65,"type":"if","locations":[{"start":{"line":65,"column":4},"end":{"line":65,"column":4}},{"start":{"line":65,"column":4},"end":{"line":65,"column":4}}]},"6":{"line":88,"type":"if","locations":[{"start":{"line":88,"column":8},"end":{"line":88,"column":8}},{"start":{"line":88,"column":8},"end":{"line":88,"column":8},"skip":true}]},"7":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":12},"end":{"line":89,"column":12}},{"start":{"line":89,"column":12},"end":{"line":89,"column":12}}]},"8":{"line":90,"type":"if","locations":[{"start":{"line":90,"column":16},"end":{"line":90,"column":16}},{"start":{"line":90,"column":16},"end":{"line":90,"column":16}}]},"9":{"line":94,"type":"binary-expr","locations":[{"start":{"line":94,"column":31},"end":{"line":94,"column":58}},{"start":{"line":94,"column":60},"end":{"line":94,"column":65}}]},"10":{"line":101,"type":"if","locations":[{"start":{"line":101,"column":20},"end":{"line":101,"column":20}},{"start":{"line":101,"column":20},"end":{"line":101,"column":20},"skip":true}]},"11":{"line":114,"type":"if","locations":[{"start":{"line":114,"column":4},"end":{"line":114,"column":4}},{"start":{"line":114,"column":4},"end":{"line":114,"column":4}}]},"12":{"line":124,"type":"if","locations":[{"start":{"line":124,"column":4},"end":{"line":124,"column":4}},{"start":{"line":124,"column":4},"end":{"line":124,"column":4}}]},"13":{"line":126,"type":"if","locations":[{"start":{"line":126,"column":11},"end":{"line":126,"column":11}},{"start":{"line":126,"column":11},"end":{"line":126,"column":11}}]},"14":{"line":133,"type":"if","locations":[{"start":{"line":133,"column":12},"end":{"line":133,"column":12}},{"start":{"line":133,"column":12},"end":{"line":133,"column":12},"skip":true}]},"15":{"line":138,"type":"if","locations":[{"start":{"line":138,"column":16},"end":{"line":138,"column":16}},{"start":{"line":138,"column":16},"end":{"line":138,"column":16}}]},"16":{"line":146,"type":"if","locations":[{"start":{"line":146,"column":16},"end":{"line":146,"column":16}},{"start":{"line":146,"column":16},"end":{"line":146,"column":16}}]},"17":{"line":166,"type":"if","locations":[{"start":{"line":166,"column":4},"end":{"line":166,"column":4}},{"start":{"line":166,"column":4},"end":{"line":166,"column":4}}]},"18":{"line":171,"type":"binary-expr","locations":[{"start":{"line":171,"column":30},"end":{"line":171,"column":53}},{"start":{"line":171,"column":55},"end":{"line":171,"column":57}}]},"19":{"line":174,"type":"if","locations":[{"start":{"line":174,"column":4},"end":{"line":174,"column":4}},{"start":{"line":174,"column":4},"end":{"line":174,"column":4}}]},"20":{"line":181,"type":"if","locations":[{"start":{"line":181,"column":4},"end":{"line":181,"column":4}},{"start":{"line":181,"column":4},"end":{"line":181,"column":4}}]},"21":{"line":193,"type":"if","locations":[{"start":{"line":193,"column":4},"end":{"line":193,"column":4}},{"start":{"line":193,"column":4},"end":{"line":193,"column":4}}]},"22":{"line":198,"type":"if","locations":[{"start":{"line":198,"column":4},"end":{"line":198,"column":4}},{"start":{"line":198,"column":4},"end":{"line":198,"column":4}}]},"23":{"line":203,"type":"if","locations":[{"start":{"line":203,"column":8},"end":{"line":203,"column":8}},{"start":{"line":203,"column":8},"end":{"line":203,"column":8}}]},"24":{"line":215,"type":"if","locations":[{"start":{"line":215,"column":4},"end":{"line":215,"column":4}},{"start":{"line":215,"column":4},"end":{"line":215,"column":4}}]},"25":{"line":219,"type":"if","locations":[{"start":{"line":219,"column":4},"end":{"line":219,"column":4}},{"start":{"line":219,"column":4},"end":{"line":219,"column":4}}]},"26":{"line":234,"type":"if","locations":[{"start":{"line":234,"column":4},"end":{"line":234,"column":4}},{"start":{"line":234,"column":4},"end":{"line":234,"column":4}}]},"27":{"line":238,"type":"if","locations":[{"start":{"line":238,"column":4},"end":{"line":238,"column":4}},{"start":{"line":238,"column":4},"end":{"line":238,"column":4},"skip":true}]},"28":{"line":240,"type":"if","locations":[{"start":{"line":240,"column":8},"end":{"line":240,"column":8}},{"start":{"line":240,"column":8},"end":{"line":240,"column":8}}]},"29":{"line":242,"type":"if","locations":[{"start":{"line":242,"column":12},"end":{"line":242,"column":12}},{"start":{"line":242,"column":12},"end":{"line":242,"column":12}}]},"30":{"line":244,"type":"if","locations":[{"start":{"line":244,"column":16},"end":{"line":244,"column":16}},{"start":{"line":244,"column":16},"end":{"line":244,"column":16}}]},"31":{"line":259,"type":"if","locations":[{"start":{"line":259,"column":4},"end":{"line":259,"column":4}},{"start":{"line":259,"column":4},"end":{"line":259,"column":4}}]},"32":{"line":263,"type":"if","locations":[{"start":{"line":263,"column":4},"end":{"line":263,"column":4}},{"start":{"line":263,"column":4},"end":{"line":263,"column":4},"skip":true}]},"33":{"line":265,"type":"if","locations":[{"start":{"line":265,"column":8},"end":{"line":265,"column":8}},{"start":{"line":265,"column":8},"end":{"line":265,"column":8}}]},"34":{"line":276,"type":"if","locations":[{"start":{"line":276,"column":8},"end":{"line":276,"column":8}},{"start":{"line":276,"column":8},"end":{"line":276,"column":8},"skip":true}]},"35":{"line":280,"type":"if","locations":[{"start":{"line":280,"column":16},"end":{"line":280,"column":16}},{"start":{"line":280,"column":16},"end":{"line":280,"column":16},"skip":true}]},"36":{"line":283,"type":"if","locations":[{"start":{"line":283,"column":20},"end":{"line":283,"column":20}},{"start":{"line":283,"column":20},"end":{"line":283,"column":20}}]},"37":{"line":283,"type":"binary-expr","locations":[{"start":{"line":283,"column":24},"end":{"line":283,"column":31}},{"start":{"line":283,"column":35},"end":{"line":283,"column":54}}]},"38":{"line":307,"type":"if","locations":[{"start":{"line":307,"column":4},"end":{"line":307,"column":4}},{"start":{"line":307,"column":4},"end":{"line":307,"column":4}}]},"39":{"line":339,"type":"if","locations":[{"start":{"line":339,"column":4},"end":{"line":339,"column":4}},{"start":{"line":339,"column":4},"end":{"line":339,"column":4}}]},"40":{"line":350,"type":"if","locations":[{"start":{"line":350,"column":8},"end":{"line":350,"column":8}},{"start":{"line":350,"column":8},"end":{"line":350,"column":8}}]},"41":{"line":360,"type":"if","locations":[{"start":{"line":360,"column":4},"end":{"line":360,"column":4}},{"start":{"line":360,"column":4},"end":{"line":360,"column":4}}]},"42":{"line":366,"type":"if","locations":[{"start":{"line":366,"column":4},"end":{"line":366,"column":4}},{"start":{"line":366,"column":4},"end":{"line":366,"column":4}}]},"43":{"line":371,"type":"if","locations":[{"start":{"line":371,"column":4},"end":{"line":371,"column":4}},{"start":{"line":371,"column":4},"end":{"line":371,"column":4}}]},"44":{"line":372,"type":"if","locations":[{"start":{"line":372,"column":8},"end":{"line":372,"column":8}},{"start":{"line":372,"column":8},"end":{"line":372,"column":8}}]},"45":{"line":386,"type":"if","locations":[{"start":{"line":386,"column":4},"end":{"line":386,"column":4}},{"start":{"line":386,"column":4},"end":{"line":386,"column":4}}]},"46":{"line":392,"type":"if","locations":[{"start":{"line":392,"column":12},"end":{"line":392,"column":12}},{"start":{"line":392,"column":12},"end":{"line":392,"column":12}}]},"47":{"line":392,"type":"binary-expr","locations":[{"start":{"line":392,"column":16},"end":{"line":392,"column":30}},{"start":{"line":392,"column":34},"end":{"line":392,"column":45}}]},"48":{"line":394,"type":"binary-expr","locations":[{"start":{"line":394,"column":26},"end":{"line":394,"column":66}},{"start":{"line":394,"column":68},"end":{"line":394,"column":70}}]},"49":{"line":394,"type":"binary-expr","locations":[{"start":{"line":394,"column":52},"end":{"line":394,"column":56}},{"start":{"line":394,"column":58},"end":{"line":394,"column":65}}]},"50":{"line":410,"type":"if","locations":[{"start":{"line":410,"column":4},"end":{"line":410,"column":4}},{"start":{"line":410,"column":4},"end":{"line":410,"column":4}}]},"51":{"line":414,"type":"if","locations":[{"start":{"line":414,"column":4},"end":{"line":414,"column":4}},{"start":{"line":414,"column":4},"end":{"line":414,"column":4}}]},"52":{"line":416,"type":"binary-expr","locations":[{"start":{"line":416,"column":44},"end":{"line":416,"column":48}},{"start":{"line":416,"column":50},"end":{"line":416,"column":57}}]},"53":{"line":431,"type":"if","locations":[{"start":{"line":431,"column":4},"end":{"line":431,"column":4}},{"start":{"line":431,"column":4},"end":{"line":431,"column":4}}]},"54":{"line":437,"type":"if","locations":[{"start":{"line":437,"column":4},"end":{"line":437,"column":4}},{"start":{"line":437,"column":4},"end":{"line":437,"column":4}}]},"55":{"line":437,"type":"binary-expr","locations":[{"start":{"line":437,"column":8},"end":{"line":437,"column":15}},{"start":{"line":437,"column":20},"end":{"line":437,"column":34}},{"start":{"line":437,"column":38},"end":{"line":437,"column":49}}]},"56":{"line":452,"type":"if","locations":[{"start":{"line":452,"column":4},"end":{"line":452,"column":4}},{"start":{"line":452,"column":4},"end":{"line":452,"column":4}}]},"57":{"line":460,"type":"if","locations":[{"start":{"line":460,"column":4},"end":{"line":460,"column":4}},{"start":{"line":460,"column":4},"end":{"line":460,"column":4}}]},"58":{"line":465,"type":"if","locations":[{"start":{"line":465,"column":4},"end":{"line":465,"column":4}},{"start":{"line":465,"column":4},"end":{"line":465,"column":4}}]},"59":{"line":483,"type":"if","locations":[{"start":{"line":483,"column":4},"end":{"line":483,"column":4}},{"start":{"line":483,"column":4},"end":{"line":483,"column":4}}]},"60":{"line":487,"type":"if","locations":[{"start":{"line":487,"column":4},"end":{"line":487,"column":4}},{"start":{"line":487,"column":4},"end":{"line":487,"column":4}}]},"61":{"line":508,"type":"if","locations":[{"start":{"line":508,"column":8},"end":{"line":508,"column":8}},{"start":{"line":508,"column":8},"end":{"line":508,"column":8},"skip":true}]},"62":{"line":511,"type":"if","locations":[{"start":{"line":511,"column":12},"end":{"line":511,"column":12}},{"start":{"line":511,"column":12},"end":{"line":511,"column":12}}]},"63":{"line":515,"type":"if","locations":[{"start":{"line":515,"column":20},"end":{"line":515,"column":20}},{"start":{"line":515,"column":20},"end":{"line":515,"column":20},"skip":true}]},"64":{"line":517,"type":"if","locations":[{"start":{"line":517,"column":24},"end":{"line":517,"column":24}},{"start":{"line":517,"column":24},"end":{"line":517,"column":24}}]},"65":{"line":517,"type":"binary-expr","locations":[{"start":{"line":517,"column":28},"end":{"line":517,"column":37}},{"start":{"line":517,"column":41},"end":{"line":517,"column":47}},{"start":{"line":517,"column":51},"end":{"line":517,"column":60}}]},"66":{"line":524,"type":"if","locations":[{"start":{"line":524,"column":16},"end":{"line":524,"column":16}},{"start":{"line":524,"column":16},"end":{"line":524,"column":16}}]},"67":{"line":524,"type":"binary-expr","locations":[{"start":{"line":524,"column":20},"end":{"line":524,"column":38}},{"start":{"line":524,"column":42},"end":{"line":524,"column":59}}]},"68":{"line":528,"type":"if","locations":[{"start":{"line":528,"column":24},"end":{"line":528,"column":24}},{"start":{"line":528,"column":24},"end":{"line":528,"column":24},"skip":true}]},"69":{"line":538,"type":"if","locations":[{"start":{"line":538,"column":4},"end":{"line":538,"column":4}},{"start":{"line":538,"column":4},"end":{"line":538,"column":4}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/",""," //var UglifyJS = require(\"uglify-js\");","var util = require(\"util\");","var when = require(\"when\");","var events = require(\"../../events\");","","var settings;","","var Node;","","var loader;","","var nodeConfigCache = null;","var moduleConfigs = {};","var nodeList = [];","var nodeConstructors = {};","var nodeTypeToId = {};","var moduleNodes = {};","","function init(_settings,_loader) {","    settings = _settings;","    loader = _loader;","    moduleNodes = {};","    nodeTypeToId = {};","    nodeConstructors = {};","    nodeList = [];","    nodeConfigCache = null;","    Node = require(\"../Node\");","}","","function load() {","    if (settings.available()) {","        moduleConfigs = loadNodeConfigs();","    } else {","        moduleConfigs = {};","    }","}","","function filterNodeInfo(n) {","    var r = {","        id: n.id||n.module+\"/\"+n.name,","        name: n.name,","        types: n.types,","        enabled: n.enabled,","        local: n.local||false","    };","    if (n.hasOwnProperty(\"module\")) {","        r.module = n.module;","    }","    if (n.hasOwnProperty(\"err\")) {","        r.err = n.err.toString();","    }","    return r;","}","","","","function getModule(id) {","    var parts = id.split(\"/\");","    return parts.slice(0,parts.length-1).join(\"/\");","}","","function getNode(id) {","    var parts = id.split(\"/\");","    return parts[parts.length-1];","}","","function saveNodeList() {","    var moduleList = {};","","    for (var module in moduleConfigs) {","        /* istanbul ignore else */","        if (moduleConfigs.hasOwnProperty(module)) {","            if (Object.keys(moduleConfigs[module].nodes).length > 0) {","                if (!moduleList[module]) {","                    moduleList[module] = {","                        name: module,","                        version: moduleConfigs[module].version,","                        local: moduleConfigs[module].local||false,","                        nodes: {}","                    };","                }","                var nodes = moduleConfigs[module].nodes;","                for(var node in nodes) {","                    /* istanbul ignore else */","                    if (nodes.hasOwnProperty(node)) {","                        var config = nodes[node];","                        var n = filterNodeInfo(config);","                        delete n.err;","                        delete n.file;","                        delete n.id;","                        n.file = config.file;","                        moduleList[module].nodes[node] = n;","                    }","                }","            }","        }","    }","    if (settings.available()) {","        return settings.set(\"nodes\",moduleList);","    } else {","        return when.reject(\"Settings unavailable\");","    }","}","","function loadNodeConfigs() {","    var configs = settings.get(\"nodes\");","","    if (!configs) {","        return {};","    } else if (configs['node-red']) {","        return configs;","    } else {","        // Migrate from the 0.9.1 format of settings","        var newConfigs = {};","        for (var id in configs) {","            /* istanbul ignore else */","            if (configs.hasOwnProperty(id)) {","                var nodeConfig = configs[id];","                var moduleName;","                var nodeSetName;","","                if (nodeConfig.module) {","                    moduleName = nodeConfig.module;","                    nodeSetName = nodeConfig.name.split(\":\")[1];","                } else {","                    moduleName = \"node-red\";","                    nodeSetName = nodeConfig.name.replace(/^\\d+-/,\"\").replace(/\\.js$/,\"\");","                }","","                if (!newConfigs[moduleName]) {","                    newConfigs[moduleName] = {","                        name: moduleName,","                        nodes:{}","                    };","                }","                newConfigs[moduleName].nodes[nodeSetName] = {","                    name: nodeSetName,","                    types: nodeConfig.types,","                    enabled: nodeConfig.enabled,","                    module: moduleName","                };","            }","        }","        settings.set(\"nodes\",newConfigs);","        return newConfigs;","    }","}","","function addNodeSet(id,set,version) {","    if (!set.err) {","        set.types.forEach(function(t) {","            nodeTypeToId[t] = id;","        });","    }","    moduleNodes[set.module] = moduleNodes[set.module]||[];","    moduleNodes[set.module].push(set.name);","","    if (!moduleConfigs[set.module]) {","        moduleConfigs[set.module] = {","            name: set.module,","            nodes: {}","        };","    }","","    if (version) {","        moduleConfigs[set.module].version = version;","    }","    moduleConfigs[set.module].local = set.local;","","    moduleConfigs[set.module].nodes[set.name] = set;","    nodeList.push(id);","    nodeConfigCache = null;","}","","function removeNode(id) {","    var config = moduleConfigs[getModule(id)].nodes[getNode(id)];","    if (!config) {","        throw new Error(\"Unrecognised id: \"+id);","    }","    delete moduleConfigs[getModule(id)].nodes[getNode(id)];","    var i = nodeList.indexOf(id);","    if (i > -1) {","        nodeList.splice(i,1);","    }","    config.types.forEach(function(t) {","        var typeId = nodeTypeToId[t];","        if (typeId === id) {","            delete nodeConstructors[t];","            delete nodeTypeToId[t];","        }","    });","    config.enabled = false;","    config.loaded = false;","    nodeConfigCache = null;","    return filterNodeInfo(config);","}","","function removeModule(module) {","    if (!settings.available()) {","        throw new Error(\"Settings unavailable\");","    }","    var nodes = moduleNodes[module];","    if (!nodes) {","        throw new Error(\"Unrecognised module: \"+module);","    }","    var infoList = [];","    for (var i=0;i<nodes.length;i++) {","        infoList.push(removeNode(module+\"/\"+nodes[i]));","    }","    delete moduleNodes[module];","    delete moduleConfigs[module];","    saveNodeList();","    return infoList;","}","","function getNodeInfo(typeOrId) {","    var id = typeOrId;","    if (nodeTypeToId.hasOwnProperty(typeOrId)) {","        id = nodeTypeToId[typeOrId];","    }","    /* istanbul ignore else */","    if (id) {","        var module = moduleConfigs[getModule(id)];","        if (module) {","            var config = module.nodes[getNode(id)];","            if (config) {","                var info = filterNodeInfo(config);","                if (config.hasOwnProperty(\"loaded\")) {","                    info.loaded = config.loaded;","                }","                info.version = module.version;","                return info;","            }","        }","    }","    return null;","}","","function getFullNodeInfo(typeOrId) {","    // Used by index.enableNodeSet so that .file can be retrieved to pass","    // to loader.loadNodeSet","    var id = typeOrId;","    if (nodeTypeToId.hasOwnProperty(typeOrId)) {","        id = nodeTypeToId[typeOrId];","    }","    /* istanbul ignore else */","    if (id) {","        var module = moduleConfigs[getModule(id)];","        if (module) {","            return module.nodes[getNode(id)];","        }","    }","    return null;","}","","function getNodeList(filter) {","    var list = [];","    for (var module in moduleConfigs) {","        /* istanbul ignore else */","        if (moduleConfigs.hasOwnProperty(module)) {","            var nodes = moduleConfigs[module].nodes;","            for (var node in nodes) {","                /* istanbul ignore else */","                if (nodes.hasOwnProperty(node)) {","                    var nodeInfo = filterNodeInfo(nodes[node]);","                    nodeInfo.version = moduleConfigs[module].version;","                    if (!filter || filter(nodes[node])) {","                        list.push(nodeInfo);","                    }","                }","            }","        }","    }","    return list;","}","","function getModuleList() {","    //var list = [];","    //for (var module in moduleNodes) {","    //    /* istanbul ignore else */","    //    if (moduleNodes.hasOwnProperty(module)) {","    //        list.push(registry.getModuleInfo(module));","    //    }","    //}","    //return list;","    return moduleConfigs;","","}","","function getModuleInfo(module) {","    if (moduleNodes[module]) {","        var nodes = moduleNodes[module];","        var m = {","            name: module,","            version: moduleConfigs[module].version,","            local: moduleConfigs[module].local,","            nodes: []","        };","        for (var i = 0; i < nodes.length; ++i) {","            var nodeInfo = filterNodeInfo(moduleConfigs[module].nodes[nodes[i]]);","            nodeInfo.version = m.version;","            m.nodes.push(nodeInfo);","        }","        return m;","    } else {","        return null;","    }","}","","function getCaller(){","    var orig = Error.prepareStackTrace;","    Error.prepareStackTrace = function(_, stack){ return stack; };","    var err = new Error();","    Error.captureStackTrace(err, arguments.callee);","    var stack = err.stack;","    Error.prepareStackTrace = orig;","    stack.shift();","    stack.shift();","    return stack[0].getFileName();","}","","function inheritNode(constructor) {","    if(Object.getPrototypeOf(constructor.prototype) === Object.prototype) {","        util.inherits(constructor,Node);","    } else {","        var proto = constructor.prototype;","        while(Object.getPrototypeOf(proto) !== Object.prototype) {","            proto = Object.getPrototypeOf(proto);","        }","        //TODO: This is a partial implementation of util.inherits >= node v5.0.0","        //      which should be changed when support for node < v5.0.0 is dropped","        //      see: https://github.com/nodejs/node/pull/3455","        proto.constructor.super_ = Node;","        if(Object.setPrototypeOf) {","            Object.setPrototypeOf(proto, Node.prototype);","        } else {","            // hack for node v0.10","            proto.__proto__ = Node.prototype;","        }","    }","}","","function registerNodeConstructor(nodeSet,type,constructor) {","    if (nodeConstructors.hasOwnProperty(type)) {","        throw new Error(type+\" already registered\");","    }","    //TODO: Ensure type is known - but doing so will break some tests","    //      that don't have a way to register a node template ahead","    //      of registering the constructor","    if(!(constructor.prototype instanceof Node)) {","        inheritNode(constructor);","    }","","    var nodeSetInfo = getFullNodeInfo(nodeSet);","    if (nodeSetInfo) {","        if (nodeSetInfo.types.indexOf(type) === -1) {","            // A type is being registered for a known set, but for some reason","            // we didn't spot it when parsing the HTML file.","            // Registered a type is the definitive action - not the presence","            // of an edit template. Ensure it is on the list of known types.","            nodeSetInfo.types.push(type);","        }","    }","","    nodeConstructors[type] = constructor;","    events.emit(\"type-registered\",type);","}","","function getAllNodeConfigs(lang) {","    if (!nodeConfigCache) {","        var result = \"\";","        var script = \"\";","        for (var i=0;i<nodeList.length;i++) {","            var id = nodeList[i];","            var config = moduleConfigs[getModule(id)].nodes[getNode(id)];","            if (config.enabled && !config.err) {","                result += config.config;","                result += loader.getNodeHelp(config,lang||\"en-US\")||\"\";","                //script += config.script;","            }","        }","        //if (script.length > 0) {","        //    result += '<script type=\"text/javascript\">';","        //    result += UglifyJS.minify(script, {fromString: true}).code;","        //    result += '</script>';","        //}","        nodeConfigCache = result;","    }","    return nodeConfigCache;","}","","function getNodeConfig(id,lang) {","    var config = moduleConfigs[getModule(id)];","    if (!config) {","        return null;","    }","    config = config.nodes[getNode(id)];","    if (config) {","        var result = config.config;","        result += loader.getNodeHelp(config,lang||\"en-US\")","","        //if (config.script) {","        //    result += '<script type=\"text/javascript\">'+config.script+'</script>';","        //}","        return result;","    } else {","        return null;","    }","}","","function getNodeConstructor(type) {","    var id = nodeTypeToId[type];","","    var config;","    if (typeof id === \"undefined\") {","        config = undefined;","    } else {","        config = moduleConfigs[getModule(id)].nodes[getNode(id)];","    }","","    if (!config || (config.enabled && !config.err)) {","        return nodeConstructors[type];","    }","    return null;","}","","function clear() {","    nodeConfigCache = null;","    moduleConfigs = {};","    nodeList = [];","    nodeConstructors = {};","    nodeTypeToId = {};","}","","function getTypeId(type) {","    if (nodeTypeToId.hasOwnProperty(type)) {","        return nodeTypeToId[type];","    } else {","        return null;","    }","}","","function enableNodeSet(typeOrId) {","    if (!settings.available()) {","        throw new Error(\"Settings unavailable\");","    }","","    var id = typeOrId;","    if (nodeTypeToId.hasOwnProperty(typeOrId)) {","        id = nodeTypeToId[typeOrId];","    }","    var config;","    try {","        config = moduleConfigs[getModule(id)].nodes[getNode(id)];","        delete config.err;","        config.enabled = true;","        nodeConfigCache = null;","        return saveNodeList().then(function() {","            return filterNodeInfo(config);","        });","    } catch (err) {","        throw new Error(\"Unrecognised id: \"+typeOrId);","    }","}","","function disableNodeSet(typeOrId) {","    if (!settings.available()) {","        throw new Error(\"Settings unavailable\");","    }","    var id = typeOrId;","    if (nodeTypeToId.hasOwnProperty(typeOrId)) {","        id = nodeTypeToId[typeOrId];","    }","    var config;","    try {","        config = moduleConfigs[getModule(id)].nodes[getNode(id)];","        // TODO: persist setting","        config.enabled = false;","        nodeConfigCache = null;","        return saveNodeList().then(function() {","            return filterNodeInfo(config);","        });","    } catch (err) {","        throw new Error(\"Unrecognised id: \"+id);","    }","}","","function cleanModuleList() {","    var removed = false;","    for (var mod in moduleConfigs) {","        /* istanbul ignore else */","        if (moduleConfigs.hasOwnProperty(mod)) {","            var nodes = moduleConfigs[mod].nodes;","            var node;","            if (mod == \"node-red\") {","                // For core nodes, look for nodes that are enabled, !loaded and !errored","                for (node in nodes) {","                    /* istanbul ignore else */","                    if (nodes.hasOwnProperty(node)) {","                        var n = nodes[node];","                        if (n.enabled && !n.err && !n.loaded) {","                            removeNode(mod+\"/\"+node);","                            removed = true;","                        }","                    }","                }","            } else {","                if (moduleConfigs[mod] && !moduleNodes[mod]) {","                    // For node modules, look for missing ones","                    for (node in nodes) {","                        /* istanbul ignore else */","                        if (nodes.hasOwnProperty(node)) {","                            removeNode(mod+\"/\"+node);","                            removed = true;","                        }","                    }","                    delete moduleConfigs[mod];","                }","            }","        }","    }","    if (removed) {","        saveNodeList();","    }","}","","var registry = module.exports = {","    init: init,","    load: load,","    clear: clear,","","    registerNodeConstructor: registerNodeConstructor,","    getNodeConstructor: getNodeConstructor,","","    addNodeSet: addNodeSet,","    enableNodeSet: enableNodeSet,","    disableNodeSet: disableNodeSet,","","    removeModule: removeModule,","","    getNodeInfo: getNodeInfo,","    getFullNodeInfo: getFullNodeInfo,","    getNodeList: getNodeList,","    getModuleList: getModuleList,","    getModuleInfo: getModuleInfo,","","    /**","     * Gets all of the node template configs","     * @return all of the node templates in a single string","     */","    getAllNodeConfigs: getAllNodeConfigs,","    getNodeConfig: getNodeConfig,","","    getTypeId: getTypeId,","","    saveNodeList: saveNodeList,","","    cleanModuleList: cleanModuleList","};",""],"l":{"18":1,"19":1,"20":1,"22":1,"24":1,"26":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"35":1,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"46":1,"47":0,"48":0,"50":0,"54":1,"55":0,"62":0,"63":0,"65":0,"66":0,"68":0,"73":1,"74":0,"75":0,"78":1,"79":0,"80":0,"83":1,"84":0,"86":0,"88":0,"89":0,"90":0,"91":0,"98":0,"99":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"114":0,"115":0,"117":0,"121":1,"122":0,"124":0,"125":0,"126":0,"127":0,"130":0,"131":0,"133":0,"134":0,"135":0,"136":0,"138":0,"139":0,"140":0,"142":0,"143":0,"146":0,"147":0,"152":0,"160":0,"161":0,"165":1,"166":0,"167":0,"168":0,"171":0,"172":0,"174":0,"175":0,"181":0,"182":0,"184":0,"186":0,"187":0,"188":0,"191":1,"192":0,"193":0,"194":0,"196":0,"197":0,"198":0,"199":0,"201":0,"202":0,"203":0,"204":0,"205":0,"208":0,"209":0,"210":0,"211":0,"214":1,"215":0,"216":0,"218":0,"219":0,"220":0,"222":0,"223":0,"224":0,"226":0,"227":0,"228":0,"229":0,"232":1,"233":0,"234":0,"235":0,"238":0,"239":0,"240":0,"241":0,"242":0,"243":0,"244":0,"245":0,"247":0,"248":0,"252":0,"255":1,"258":0,"259":0,"260":0,"263":0,"264":0,"265":0,"266":0,"269":0,"272":1,"273":0,"274":0,"276":0,"277":0,"278":0,"280":0,"281":0,"282":0,"283":0,"284":0,"290":0,"293":1,"302":0,"306":1,"307":0,"308":0,"309":0,"315":0,"316":0,"317":0,"318":0,"320":0,"322":0,"326":1,"327":0,"328":0,"329":0,"330":0,"331":0,"332":0,"333":0,"334":0,"335":0,"338":1,"339":0,"340":0,"342":0,"343":0,"344":0,"349":0,"350":0,"351":0,"354":0,"359":1,"360":0,"361":0,"366":0,"367":0,"370":0,"371":0,"372":0,"377":0,"381":0,"382":0,"385":1,"386":0,"387":0,"388":0,"389":0,"390":0,"391":0,"392":0,"393":0,"394":0,"403":0,"405":0,"408":1,"409":0,"410":0,"411":0,"413":0,"414":0,"415":0,"416":0,"421":0,"423":0,"427":1,"428":0,"430":0,"431":0,"432":0,"434":0,"437":0,"438":0,"440":0,"443":1,"444":0,"445":0,"446":0,"447":0,"448":0,"451":1,"452":0,"453":0,"455":0,"459":1,"460":0,"461":0,"464":0,"465":0,"466":0,"468":0,"469":0,"470":0,"471":0,"472":0,"473":0,"474":0,"475":0,"478":0,"482":1,"483":0,"484":0,"486":0,"487":0,"488":0,"490":0,"491":0,"492":0,"494":0,"495":0,"496":0,"497":0,"500":0,"504":1,"505":0,"506":0,"508":0,"509":0,"510":0,"511":0,"513":0,"515":0,"516":0,"517":0,"518":0,"519":0,"524":0,"526":0,"528":0,"529":0,"530":0,"533":0,"538":0,"539":0,"543":1}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/registry/loader.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/registry/loader.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":0,"11":0,"12":0,"13":1,"14":0,"15":0,"16":0,"17":1,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":1,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":1,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":1,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":1,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":0,"164":0,"165":0,"166":0,"167":0,"168":0,"169":0,"170":1,"171":0,"172":0,"173":0,"174":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":1,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"187":0,"188":0,"189":0,"190":0,"191":0,"192":1,"193":0,"194":0,"195":0,"196":0,"197":0,"198":0,"199":0,"200":1,"201":0,"202":0,"203":0,"204":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"211":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0},"fnMap":{"1":{"name":"init","line":28,"loc":{"start":{"line":28,"column":0},"end":{"line":28,"column":24}}},"2":{"name":"load","line":34,"loc":{"start":{"line":34,"column":0},"end":{"line":34,"column":51}}},"3":{"name":"copyObjectProperties","line":45,"loc":{"start":{"line":45,"column":0},"end":{"line":45,"column":58}}},"4":{"name":"(anonymous_4)","line":50,"loc":{"start":{"line":50,"column":25},"end":{"line":50,"column":37}}},"5":{"name":"createNodeApi","line":66,"loc":{"start":{"line":66,"column":0},"end":{"line":66,"column":29}}},"6":{"name":"(anonymous_6)","line":76,"loc":{"start":{"line":76,"column":29},"end":{"line":76,"column":61}}},"7":{"name":"(anonymous_7)","line":92,"loc":{"start":{"line":92,"column":21},"end":{"line":92,"column":32}}},"8":{"name":"(anonymous_8)","line":95,"loc":{"start":{"line":95,"column":22},"end":{"line":95,"column":33}}},"9":{"name":"(anonymous_9)","line":98,"loc":{"start":{"line":98,"column":29},"end":{"line":98,"column":40}}},"10":{"name":"(anonymous_10)","line":102,"loc":{"start":{"line":102,"column":15},"end":{"line":102,"column":26}}},"11":{"name":"loadNodeFiles","line":113,"loc":{"start":{"line":113,"column":0},"end":{"line":113,"column":34}}},"12":{"name":"(anonymous_12)","line":160,"loc":{"start":{"line":160,"column":38},"end":{"line":160,"column":56}}},"13":{"name":"(anonymous_13)","line":161,"loc":{"start":{"line":161,"column":32},"end":{"line":161,"column":44}}},"14":{"name":"loadNodeConfig","line":169,"loc":{"start":{"line":169,"column":0},"end":{"line":169,"column":34}}},"15":{"name":"(anonymous_15)","line":170,"loc":{"start":{"line":170,"column":24},"end":{"line":170,"column":42}}},"16":{"name":"(anonymous_16)","line":201,"loc":{"start":{"line":201,"column":42},"end":{"line":201,"column":64}}},"17":{"name":"(anonymous_17)","line":258,"loc":{"start":{"line":258,"column":64},"end":{"line":258,"column":83}}},"18":{"name":"(anonymous_18)","line":264,"loc":{"start":{"line":264,"column":34},"end":{"line":264,"column":45}}},"19":{"name":"loadNodeSet","line":285,"loc":{"start":{"line":285,"column":0},"end":{"line":285,"column":27}}},"20":{"name":"(anonymous_20)","line":300,"loc":{"start":{"line":300,"column":43},"end":{"line":300,"column":54}}},"21":{"name":"(anonymous_21)","line":304,"loc":{"start":{"line":304,"column":29},"end":{"line":304,"column":43}}},"22":{"name":"loadNodeSetList","line":322,"loc":{"start":{"line":322,"column":0},"end":{"line":322,"column":32}}},"23":{"name":"(anonymous_23)","line":324,"loc":{"start":{"line":324,"column":18},"end":{"line":324,"column":33}}},"24":{"name":"(anonymous_24)","line":332,"loc":{"start":{"line":332,"column":38},"end":{"line":332,"column":49}}},"25":{"name":"addModule","line":341,"loc":{"start":{"line":341,"column":0},"end":{"line":341,"column":27}}},"26":{"name":"loadNodeHelp","line":360,"loc":{"start":{"line":360,"column":0},"end":{"line":360,"column":33}}},"27":{"name":"getNodeHelp","line":373,"loc":{"start":{"line":373,"column":0},"end":{"line":373,"column":32}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":23}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":27}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":31}},"5":{"start":{"line":22,"column":0},"end":{"line":22,"column":51}},"6":{"start":{"line":23,"column":0},"end":{"line":23,"column":37}},"7":{"start":{"line":25,"column":0},"end":{"line":25,"column":13}},"8":{"start":{"line":26,"column":0},"end":{"line":26,"column":12}},"9":{"start":{"line":28,"column":0},"end":{"line":32,"column":1}},"10":{"start":{"line":29,"column":4},"end":{"line":29,"column":23}},"11":{"start":{"line":30,"column":4},"end":{"line":30,"column":32}},"12":{"start":{"line":31,"column":4},"end":{"line":31,"column":34}},"13":{"start":{"line":34,"column":0},"end":{"line":43,"column":1}},"14":{"start":{"line":39,"column":4},"end":{"line":39,"column":54}},"15":{"start":{"line":41,"column":4},"end":{"line":41,"column":86}},"16":{"start":{"line":42,"column":4},"end":{"line":42,"column":36}},"17":{"start":{"line":45,"column":0},"end":{"line":64,"column":1}},"18":{"start":{"line":46,"column":4},"end":{"line":48,"column":5}},"19":{"start":{"line":47,"column":8},"end":{"line":47,"column":15}},"20":{"start":{"line":49,"column":4},"end":{"line":63,"column":5}},"21":{"start":{"line":50,"column":8},"end":{"line":55,"column":11}},"22":{"start":{"line":51,"column":12},"end":{"line":54,"column":13}},"23":{"start":{"line":52,"column":16},"end":{"line":52,"column":76}},"24":{"start":{"line":53,"column":16},"end":{"line":53,"column":60}},"25":{"start":{"line":56,"column":11},"end":{"line":63,"column":5}},"26":{"start":{"line":57,"column":8},"end":{"line":62,"column":9}},"27":{"start":{"line":58,"column":12},"end":{"line":61,"column":13}},"28":{"start":{"line":59,"column":16},"end":{"line":59,"column":76}},"29":{"start":{"line":60,"column":16},"end":{"line":60,"column":60}},"30":{"start":{"line":66,"column":0},"end":{"line":110,"column":1}},"31":{"start":{"line":67,"column":4},"end":{"line":74,"column":5}},"32":{"start":{"line":75,"column":4},"end":{"line":75,"column":141}},"33":{"start":{"line":76,"column":4},"end":{"line":78,"column":5}},"34":{"start":{"line":77,"column":8},"end":{"line":77,"column":66}},"35":{"start":{"line":79,"column":4},"end":{"line":79,"column":60}},"36":{"start":{"line":80,"column":4},"end":{"line":80,"column":85}},"37":{"start":{"line":81,"column":4},"end":{"line":101,"column":5}},"38":{"start":{"line":82,"column":8},"end":{"line":82,"column":43}},"39":{"start":{"line":83,"column":8},"end":{"line":83,"column":47}},"40":{"start":{"line":84,"column":8},"end":{"line":84,"column":41}},"41":{"start":{"line":85,"column":8},"end":{"line":85,"column":50}},"42":{"start":{"line":86,"column":8},"end":{"line":86,"column":39}},"43":{"start":{"line":87,"column":8},"end":{"line":87,"column":45}},"44":{"start":{"line":91,"column":8},"end":{"line":93,"column":10}},"45":{"start":{"line":94,"column":8},"end":{"line":96,"column":10}},"46":{"start":{"line":97,"column":8},"end":{"line":99,"column":10}},"47":{"start":{"line":102,"column":4},"end":{"line":108,"column":5}},"48":{"start":{"line":103,"column":8},"end":{"line":103,"column":60}},"49":{"start":{"line":104,"column":8},"end":{"line":106,"column":9}},"50":{"start":{"line":105,"column":12},"end":{"line":105,"column":49}},"51":{"start":{"line":107,"column":8},"end":{"line":107,"column":47}},"52":{"start":{"line":109,"column":4},"end":{"line":109,"column":15}},"53":{"start":{"line":113,"column":0},"end":{"line":167,"column":1}},"54":{"start":{"line":114,"column":4},"end":{"line":114,"column":22}},"55":{"start":{"line":115,"column":4},"end":{"line":159,"column":5}},"56":{"start":{"line":117,"column":8},"end":{"line":158,"column":9}},"57":{"start":{"line":118,"column":12},"end":{"line":123,"column":13}},"58":{"start":{"line":121,"column":16},"end":{"line":121,"column":135}},"59":{"start":{"line":122,"column":16},"end":{"line":122,"column":25}},"60":{"start":{"line":124,"column":12},"end":{"line":157,"column":13}},"61":{"start":{"line":125,"column":16},"end":{"line":125,"column":33}},"62":{"start":{"line":126,"column":16},"end":{"line":156,"column":17}},"63":{"start":{"line":128,"column":20},"end":{"line":155,"column":21}},"64":{"start":{"line":129,"column":24},"end":{"line":148,"column":25}},"65":{"start":{"line":131,"column":28},"end":{"line":131,"column":42}},"66":{"start":{"line":132,"column":28},"end":{"line":132,"column":72}},"67":{"start":{"line":133,"column":28},"end":{"line":133,"column":54}},"68":{"start":{"line":134,"column":28},"end":{"line":134,"column":51}},"69":{"start":{"line":135,"column":28},"end":{"line":139,"column":29}},"70":{"start":{"line":136,"column":32},"end":{"line":138,"column":33}},"71":{"start":{"line":137,"column":36},"end":{"line":137,"column":42}},"72":{"start":{"line":140,"column":28},"end":{"line":140,"column":72}},"73":{"start":{"line":142,"column":28},"end":{"line":147,"column":29}},"74":{"start":{"line":143,"column":32},"end":{"line":143,"column":65}},"75":{"start":{"line":146,"column":32},"end":{"line":146,"column":38}},"76":{"start":{"line":150,"column":24},"end":{"line":154,"column":25}},"77":{"start":{"line":151,"column":28},"end":{"line":151,"column":88}},"78":{"start":{"line":160,"column":4},"end":{"line":166,"column":7}},"79":{"start":{"line":161,"column":8},"end":{"line":164,"column":11}},"80":{"start":{"line":162,"column":12},"end":{"line":162,"column":68}},"81":{"start":{"line":163,"column":12},"end":{"line":163,"column":27}},"82":{"start":{"line":165,"column":8},"end":{"line":165,"column":38}},"83":{"start":{"line":169,"column":0},"end":{"line":275,"column":1}},"84":{"start":{"line":170,"column":4},"end":{"line":274,"column":7}},"85":{"start":{"line":171,"column":8},"end":{"line":171,"column":33}},"86":{"start":{"line":172,"column":8},"end":{"line":172,"column":37}},"87":{"start":{"line":173,"column":8},"end":{"line":173,"column":33}},"88":{"start":{"line":174,"column":8},"end":{"line":174,"column":39}},"89":{"start":{"line":176,"column":8},"end":{"line":176,"column":37}},"90":{"start":{"line":177,"column":8},"end":{"line":177,"column":44}},"91":{"start":{"line":178,"column":8},"end":{"line":178,"column":29}},"92":{"start":{"line":179,"column":8},"end":{"line":184,"column":9}},"93":{"start":{"line":180,"column":12},"end":{"line":182,"column":13}},"94":{"start":{"line":181,"column":16},"end":{"line":181,"column":56}},"95":{"start":{"line":183,"column":12},"end":{"line":183,"column":37}},"96":{"start":{"line":186,"column":8},"end":{"line":196,"column":10}},"97":{"start":{"line":197,"column":8},"end":{"line":199,"column":9}},"98":{"start":{"line":198,"column":12},"end":{"line":198,"column":40}},"99":{"start":{"line":201,"column":8},"end":{"line":273,"column":11}},"100":{"start":{"line":202,"column":12},"end":{"line":272,"column":13}},"101":{"start":{"line":203,"column":16},"end":{"line":203,"column":32}},"102":{"start":{"line":204,"column":16},"end":{"line":212,"column":17}},"103":{"start":{"line":205,"column":20},"end":{"line":207,"column":21}},"104":{"start":{"line":206,"column":24},"end":{"line":206,"column":40}},"105":{"start":{"line":208,"column":20},"end":{"line":208,"column":73}},"106":{"start":{"line":210,"column":20},"end":{"line":210,"column":36}},"107":{"start":{"line":211,"column":20},"end":{"line":211,"column":46}},"108":{"start":{"line":213,"column":16},"end":{"line":213,"column":30}},"109":{"start":{"line":215,"column":16},"end":{"line":215,"column":31}},"110":{"start":{"line":217,"column":16},"end":{"line":217,"column":84}},"111":{"start":{"line":218,"column":16},"end":{"line":218,"column":33}},"112":{"start":{"line":220,"column":16},"end":{"line":222,"column":17}},"113":{"start":{"line":221,"column":20},"end":{"line":221,"column":41}},"114":{"start":{"line":223,"column":16},"end":{"line":223,"column":35}},"115":{"start":{"line":225,"column":16},"end":{"line":225,"column":74}},"116":{"start":{"line":226,"column":16},"end":{"line":226,"column":78}},"117":{"start":{"line":227,"column":16},"end":{"line":227,"column":29}},"118":{"start":{"line":228,"column":16},"end":{"line":228,"column":37}},"119":{"start":{"line":229,"column":16},"end":{"line":229,"column":37}},"120":{"start":{"line":230,"column":16},"end":{"line":230,"column":30}},"121":{"start":{"line":231,"column":16},"end":{"line":245,"column":17}},"122":{"start":{"line":232,"column":20},"end":{"line":232,"column":93}},"123":{"start":{"line":233,"column":20},"end":{"line":233,"column":45}},"124":{"start":{"line":234,"column":20},"end":{"line":234,"column":100}},"125":{"start":{"line":236,"column":20},"end":{"line":236,"column":56}},"126":{"start":{"line":237,"column":20},"end":{"line":239,"column":21}},"127":{"start":{"line":238,"column":24},"end":{"line":238,"column":40}},"128":{"start":{"line":240,"column":20},"end":{"line":242,"column":21}},"129":{"start":{"line":241,"column":24},"end":{"line":241,"column":47}},"130":{"start":{"line":244,"column":20},"end":{"line":244,"column":46}},"131":{"start":{"line":246,"column":16},"end":{"line":246,"column":56}},"132":{"start":{"line":248,"column":16},"end":{"line":248,"column":42}},"133":{"start":{"line":249,"column":16},"end":{"line":249,"column":40}},"134":{"start":{"line":252,"column":16},"end":{"line":257,"column":17}},"135":{"start":{"line":253,"column":20},"end":{"line":256,"column":21}},"136":{"start":{"line":254,"column":24},"end":{"line":254,"column":71}},"137":{"start":{"line":255,"column":24},"end":{"line":255,"column":30}},"138":{"start":{"line":258,"column":16},"end":{"line":271,"column":19}},"139":{"start":{"line":259,"column":20},"end":{"line":270,"column":21}},"140":{"start":{"line":260,"column":24},"end":{"line":260,"column":49}},"141":{"start":{"line":261,"column":24},"end":{"line":266,"column":31}},"142":{"start":{"line":265,"column":32},"end":{"line":265,"column":46}},"143":{"start":{"line":268,"column":24},"end":{"line":268,"column":53}},"144":{"start":{"line":269,"column":24},"end":{"line":269,"column":38}},"145":{"start":{"line":285,"column":0},"end":{"line":320,"column":1}},"146":{"start":{"line":286,"column":4},"end":{"line":286,"column":42}},"147":{"start":{"line":287,"column":4},"end":{"line":287,"column":42}},"148":{"start":{"line":288,"column":4},"end":{"line":291,"column":5}},"149":{"start":{"line":289,"column":8},"end":{"line":289,"column":34}},"150":{"start":{"line":292,"column":4},"end":{"line":319,"column":5}},"151":{"start":{"line":293,"column":8},"end":{"line":293,"column":31}},"152":{"start":{"line":294,"column":8},"end":{"line":294,"column":35}},"153":{"start":{"line":295,"column":8},"end":{"line":309,"column":9}},"154":{"start":{"line":297,"column":12},"end":{"line":297,"column":42}},"155":{"start":{"line":298,"column":12},"end":{"line":298,"column":33}},"156":{"start":{"line":299,"column":12},"end":{"line":308,"column":13}},"157":{"start":{"line":300,"column":16},"end":{"line":307,"column":19}},"158":{"start":{"line":301,"column":20},"end":{"line":301,"column":40}},"159":{"start":{"line":302,"column":20},"end":{"line":302,"column":39}},"160":{"start":{"line":303,"column":20},"end":{"line":303,"column":32}},"161":{"start":{"line":305,"column":20},"end":{"line":305,"column":35}},"162":{"start":{"line":306,"column":20},"end":{"line":306,"column":32}},"163":{"start":{"line":310,"column":8},"end":{"line":314,"column":9}},"164":{"start":{"line":311,"column":12},"end":{"line":311,"column":32}},"165":{"start":{"line":312,"column":12},"end":{"line":312,"column":31}},"166":{"start":{"line":313,"column":12},"end":{"line":313,"column":45}},"167":{"start":{"line":315,"column":8},"end":{"line":315,"column":27}},"168":{"start":{"line":317,"column":8},"end":{"line":317,"column":23}},"169":{"start":{"line":318,"column":8},"end":{"line":318,"column":34}},"170":{"start":{"line":322,"column":0},"end":{"line":339,"column":1}},"171":{"start":{"line":323,"column":4},"end":{"line":323,"column":22}},"172":{"start":{"line":324,"column":4},"end":{"line":330,"column":7}},"173":{"start":{"line":325,"column":8},"end":{"line":329,"column":9}},"174":{"start":{"line":326,"column":12},"end":{"line":326,"column":45}},"175":{"start":{"line":328,"column":12},"end":{"line":328,"column":32}},"176":{"start":{"line":332,"column":4},"end":{"line":338,"column":7}},"177":{"start":{"line":333,"column":8},"end":{"line":337,"column":9}},"178":{"start":{"line":334,"column":12},"end":{"line":334,"column":43}},"179":{"start":{"line":336,"column":12},"end":{"line":336,"column":19}},"180":{"start":{"line":341,"column":0},"end":{"line":358,"column":1}},"181":{"start":{"line":342,"column":4},"end":{"line":344,"column":5}},"182":{"start":{"line":343,"column":8},"end":{"line":343,"column":48}},"183":{"start":{"line":345,"column":4},"end":{"line":345,"column":19}},"184":{"start":{"line":346,"column":4},"end":{"line":351,"column":5}},"185":{"start":{"line":348,"column":8},"end":{"line":348,"column":51}},"186":{"start":{"line":349,"column":8},"end":{"line":349,"column":41}},"187":{"start":{"line":350,"column":8},"end":{"line":350,"column":30}},"188":{"start":{"line":352,"column":4},"end":{"line":357,"column":5}},"189":{"start":{"line":353,"column":8},"end":{"line":353,"column":65}},"190":{"start":{"line":354,"column":8},"end":{"line":354,"column":42}},"191":{"start":{"line":356,"column":8},"end":{"line":356,"column":32}},"192":{"start":{"line":360,"column":0},"end":{"line":371,"column":1}},"193":{"start":{"line":361,"column":4},"end":{"line":361,"column":42}},"194":{"start":{"line":362,"column":4},"end":{"line":362,"column":44}},"195":{"start":{"line":363,"column":4},"end":{"line":363,"column":56}},"196":{"start":{"line":364,"column":4},"end":{"line":370,"column":5}},"197":{"start":{"line":366,"column":8},"end":{"line":366,"column":57}},"198":{"start":{"line":367,"column":8},"end":{"line":367,"column":23}},"199":{"start":{"line":369,"column":8},"end":{"line":369,"column":20}},"200":{"start":{"line":373,"column":0},"end":{"line":389,"column":1}},"201":{"start":{"line":374,"column":4},"end":{"line":387,"column":5}},"202":{"start":{"line":375,"column":8},"end":{"line":375,"column":43}},"203":{"start":{"line":376,"column":8},"end":{"line":381,"column":9}},"204":{"start":{"line":377,"column":12},"end":{"line":377,"column":44}},"205":{"start":{"line":378,"column":12},"end":{"line":380,"column":13}},"206":{"start":{"line":379,"column":16},"end":{"line":379,"column":55}},"207":{"start":{"line":382,"column":8},"end":{"line":386,"column":9}},"208":{"start":{"line":383,"column":12},"end":{"line":383,"column":35}},"209":{"start":{"line":385,"column":12},"end":{"line":385,"column":66}},"210":{"start":{"line":388,"column":4},"end":{"line":388,"column":27}},"211":{"start":{"line":391,"column":0},"end":{"line":397,"column":1}}},"branchMap":{"1":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":4},"end":{"line":46,"column":4}},{"start":{"line":46,"column":4},"end":{"line":46,"column":4}}]},"2":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":4},"end":{"line":49,"column":4}},{"start":{"line":49,"column":4},"end":{"line":49,"column":4}}]},"3":{"line":49,"type":"binary-expr","locations":[{"start":{"line":49,"column":8},"end":{"line":49,"column":16}},{"start":{"line":49,"column":20},"end":{"line":49,"column":30}}]},"4":{"line":51,"type":"if","locations":[{"start":{"line":51,"column":12},"end":{"line":51,"column":12}},{"start":{"line":51,"column":12},"end":{"line":51,"column":12}}]},"5":{"line":56,"type":"if","locations":[{"start":{"line":56,"column":11},"end":{"line":56,"column":11}},{"start":{"line":56,"column":11},"end":{"line":56,"column":11}}]},"6":{"line":56,"type":"binary-expr","locations":[{"start":{"line":56,"column":15},"end":{"line":56,"column":24}},{"start":{"line":56,"column":28},"end":{"line":56,"column":37}}]},"7":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":12},"end":{"line":58,"column":12}},{"start":{"line":58,"column":12},"end":{"line":58,"column":12}}]},"8":{"line":58,"type":"binary-expr","locations":[{"start":{"line":58,"column":16},"end":{"line":58,"column":37}},{"start":{"line":58,"column":41},"end":{"line":58,"column":68}}]},"9":{"line":81,"type":"if","locations":[{"start":{"line":81,"column":4},"end":{"line":81,"column":4}},{"start":{"line":81,"column":4},"end":{"line":81,"column":4}}]},"10":{"line":104,"type":"if","locations":[{"start":{"line":104,"column":8},"end":{"line":104,"column":8}},{"start":{"line":104,"column":8},"end":{"line":104,"column":8}}]},"11":{"line":117,"type":"if","locations":[{"start":{"line":117,"column":8},"end":{"line":117,"column":8}},{"start":{"line":117,"column":8},"end":{"line":117,"column":8},"skip":true}]},"12":{"line":118,"type":"if","locations":[{"start":{"line":118,"column":12},"end":{"line":118,"column":12}},{"start":{"line":118,"column":12},"end":{"line":118,"column":12}}]},"13":{"line":118,"type":"binary-expr","locations":[{"start":{"line":118,"column":16},"end":{"line":118,"column":44}},{"start":{"line":119,"column":16},"end":{"line":119,"column":101}}]},"14":{"line":124,"type":"if","locations":[{"start":{"line":124,"column":12},"end":{"line":124,"column":12}},{"start":{"line":124,"column":12},"end":{"line":124,"column":12}}]},"15":{"line":124,"type":"binary-expr","locations":[{"start":{"line":124,"column":16},"end":{"line":124,"column":36}},{"start":{"line":124,"column":40},"end":{"line":124,"column":71}}]},"16":{"line":128,"type":"if","locations":[{"start":{"line":128,"column":20},"end":{"line":128,"column":20}},{"start":{"line":128,"column":20},"end":{"line":128,"column":20},"skip":true}]},"17":{"line":129,"type":"if","locations":[{"start":{"line":129,"column":24},"end":{"line":129,"column":24}},{"start":{"line":129,"column":24},"end":{"line":129,"column":24}}]},"18":{"line":129,"type":"binary-expr","locations":[{"start":{"line":129,"column":28},"end":{"line":129,"column":48}},{"start":{"line":129,"column":52},"end":{"line":129,"column":57}}]},"19":{"line":136,"type":"if","locations":[{"start":{"line":136,"column":32},"end":{"line":136,"column":32}},{"start":{"line":136,"column":32},"end":{"line":136,"column":32}}]},"20":{"line":179,"type":"if","locations":[{"start":{"line":179,"column":8},"end":{"line":179,"column":8}},{"start":{"line":179,"column":8},"end":{"line":179,"column":8}}]},"21":{"line":180,"type":"if","locations":[{"start":{"line":180,"column":12},"end":{"line":180,"column":12}},{"start":{"line":180,"column":12},"end":{"line":180,"column":12}}]},"22":{"line":197,"type":"if","locations":[{"start":{"line":197,"column":8},"end":{"line":197,"column":8}},{"start":{"line":197,"column":8},"end":{"line":197,"column":8}}]},"23":{"line":202,"type":"if","locations":[{"start":{"line":202,"column":12},"end":{"line":202,"column":12}},{"start":{"line":202,"column":12},"end":{"line":202,"column":12}}]},"24":{"line":204,"type":"if","locations":[{"start":{"line":204,"column":16},"end":{"line":204,"column":16}},{"start":{"line":204,"column":16},"end":{"line":204,"column":16}}]},"25":{"line":205,"type":"if","locations":[{"start":{"line":205,"column":20},"end":{"line":205,"column":20}},{"start":{"line":205,"column":20},"end":{"line":205,"column":20}}]},"26":{"line":237,"type":"if","locations":[{"start":{"line":237,"column":20},"end":{"line":237,"column":20}},{"start":{"line":237,"column":20},"end":{"line":237,"column":20}}]},"27":{"line":240,"type":"if","locations":[{"start":{"line":240,"column":20},"end":{"line":240,"column":20}},{"start":{"line":240,"column":20},"end":{"line":240,"column":20}}]},"28":{"line":253,"type":"if","locations":[{"start":{"line":253,"column":20},"end":{"line":253,"column":20}},{"start":{"line":253,"column":20},"end":{"line":253,"column":20}}]},"29":{"line":259,"type":"if","locations":[{"start":{"line":259,"column":20},"end":{"line":259,"column":20}},{"start":{"line":259,"column":20},"end":{"line":259,"column":20}}]},"30":{"line":288,"type":"if","locations":[{"start":{"line":288,"column":4},"end":{"line":288,"column":4}},{"start":{"line":288,"column":4},"end":{"line":288,"column":4}}]},"31":{"line":295,"type":"if","locations":[{"start":{"line":295,"column":8},"end":{"line":295,"column":8}},{"start":{"line":295,"column":8},"end":{"line":295,"column":8}}]},"32":{"line":299,"type":"if","locations":[{"start":{"line":299,"column":12},"end":{"line":299,"column":12}},{"start":{"line":299,"column":12},"end":{"line":299,"column":12}}]},"33":{"line":299,"type":"binary-expr","locations":[{"start":{"line":299,"column":16},"end":{"line":299,"column":31}},{"start":{"line":299,"column":35},"end":{"line":299,"column":69}}]},"34":{"line":310,"type":"if","locations":[{"start":{"line":310,"column":8},"end":{"line":310,"column":8}},{"start":{"line":310,"column":8},"end":{"line":310,"column":8}}]},"35":{"line":325,"type":"if","locations":[{"start":{"line":325,"column":8},"end":{"line":325,"column":8}},{"start":{"line":325,"column":8},"end":{"line":325,"column":8}}]},"36":{"line":333,"type":"if","locations":[{"start":{"line":333,"column":8},"end":{"line":333,"column":8}},{"start":{"line":333,"column":8},"end":{"line":333,"column":8}}]},"37":{"line":342,"type":"if","locations":[{"start":{"line":342,"column":4},"end":{"line":342,"column":4}},{"start":{"line":342,"column":4},"end":{"line":342,"column":4}}]},"38":{"line":346,"type":"if","locations":[{"start":{"line":346,"column":4},"end":{"line":346,"column":4}},{"start":{"line":346,"column":4},"end":{"line":346,"column":4}}]},"39":{"line":374,"type":"if","locations":[{"start":{"line":374,"column":4},"end":{"line":374,"column":4}},{"start":{"line":374,"column":4},"end":{"line":374,"column":4}}]},"40":{"line":376,"type":"if","locations":[{"start":{"line":376,"column":8},"end":{"line":376,"column":8}},{"start":{"line":376,"column":8},"end":{"line":376,"column":8}}]},"41":{"line":378,"type":"if","locations":[{"start":{"line":378,"column":12},"end":{"line":378,"column":12}},{"start":{"line":378,"column":12},"end":{"line":378,"column":12}}]},"42":{"line":382,"type":"if","locations":[{"start":{"line":382,"column":8},"end":{"line":382,"column":8}},{"start":{"line":382,"column":8},"end":{"line":382,"column":8}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var when = require(\"when\");","var fs = require(\"fs\");","var path = require(\"path\");","var semver = require(\"semver\");","","var localfilesystem = require(\"./localfilesystem\");","var registry = require(\"./registry\");","","var settings;","var runtime;","","function init(_runtime) {","    runtime = _runtime;","    settings = runtime.settings;","    localfilesystem.init(runtime);","}","","function load(defaultNodesDir,disableNodePathScan) {","    // To skip node scan, the following line will use the stored node list.","    // We should expose that as an option at some point, although the","    // performance gains are minimal.","    //return loadNodeFiles(registry.getModuleList());","    runtime.log.info(runtime.log._(\"server.loading\"));","","    var nodeFiles = localfilesystem.getNodeFiles(defaultNodesDir,disableNodePathScan);","    return loadNodeFiles(nodeFiles);","}","","function copyObjectProperties(src,dst,copyList,blockList) {","    if (!src) {","        return;","    }","    if (copyList && !blockList) {","        copyList.forEach(function(i) {","            if (src.hasOwnProperty(i)) {","                var propDescriptor = Object.getOwnPropertyDescriptor(src,i);","                Object.defineProperty(dst,i,propDescriptor);","            }","        });","    } else if (!copyList && blockList) {","        for (var i in src) {","            if (src.hasOwnProperty(i) && blockList.indexOf(i) === -1) {","                var propDescriptor = Object.getOwnPropertyDescriptor(src,i);","                Object.defineProperty(dst,i,propDescriptor);","            }","        }","    }","}","","function createNodeApi(node) {","    var red = {","        nodes: {},","        log: {},","        settings: {},","        events: runtime.events,","        util: runtime.util,","        version: runtime.version,","    }","    copyObjectProperties(runtime.nodes,red.nodes,[\"createNode\",\"getNode\",\"eachNode\",\"addCredentials\",\"getCredentials\",\"deleteCredentials\" ]);","    red.nodes.registerType = function(type,constructor,opts) {","        runtime.nodes.registerType(node.id,type,constructor,opts);","    }","    copyObjectProperties(runtime.log,red.log,null,[\"init\"]);","    copyObjectProperties(runtime.settings,red.settings,null,[\"init\",\"load\",\"reset\"]);","    if (runtime.adminApi) {","        red.comms = runtime.adminApi.comms;","        red.library = runtime.adminApi.library;","        red.auth = runtime.adminApi.auth;","        red.httpAdmin = runtime.adminApi.adminApp;","        red.httpNode = runtime.nodeApp;","        red.server = runtime.adminApi.server;","    } else {","        //TODO: runtime.adminApi is always stubbed if not enabled, so this block","        // is unused - but may be needed for the unit tests","        red.comms = {","            publish: function() {}","        };","        red.library = {","            register: function() {}","        };","        red.auth = {","            needsPermission: function() {}","        };","        // TODO: stub out httpAdmin/httpNode/server","    }","    red[\"_\"] = function() {","        var args = Array.prototype.slice.call(arguments, 0);","        if (args[0].indexOf(\":\") === -1) {","            args[0] = node.namespace+\":\"+args[0];","        }","        return runtime.i18n._.apply(null,args);","    }","    return red;","}","","","function loadNodeFiles(nodeFiles) {","    var promises = [];","    for (var module in nodeFiles) {","        /* istanbul ignore else */","        if (nodeFiles.hasOwnProperty(module)) {","            if (nodeFiles[module].redVersion &&","                !semver.satisfies(runtime.version().replace(\"-git\",\"\"), nodeFiles[module].redVersion)) {","                //TODO: log it","                runtime.log.warn(\"[\"+module+\"] \"+runtime.log._(\"server.node-version-mismatch\",{version:nodeFiles[module].redVersion}));","                continue;","            }","            if (module == \"node-red\" || !registry.getModuleInfo(module)) {","                var first = true;","                for (var node in nodeFiles[module].nodes) {","                    /* istanbul ignore else */","                    if (nodeFiles[module].nodes.hasOwnProperty(node)) {","                        if (module != \"node-red\" && first) {","                            // Check the module directory exists","                            first = false;","                            var fn = nodeFiles[module].nodes[node].file;","                            var parts = fn.split(\"/\");","                            var i = parts.length-1;","                            for (;i>=0;i--) {","                                if (parts[i] == \"node_modules\") {","                                    break;","                                }","                            }","                            var moduleFn = parts.slice(0,i+2).join(\"/\");","","                            try {","                                var stat = fs.statSync(moduleFn);","                            } catch(err) {","                                // Module not found, don't attempt to load its nodes","                                break;","                            }","                        }","","                        try {","                            promises.push(loadNodeConfig(nodeFiles[module].nodes[node]))","                        } catch(err) {","                            //","                        }","                    }","                }","            }","        }","    }","    return when.settle(promises).then(function(results) {","        var nodes = results.map(function(r) {","            registry.addNodeSet(r.value.id,r.value,r.value.version);","            return r.value;","        });","        return loadNodeSetList(nodes);","    });","}","","function loadNodeConfig(fileInfo) {","    return when.promise(function(resolve) {","        var file = fileInfo.file;","        var module = fileInfo.module;","        var name = fileInfo.name;","        var version = fileInfo.version;","","        var id = module + \"/\" + name;","        var info = registry.getNodeInfo(id);","        var isEnabled = true;","        if (info) {","            if (info.hasOwnProperty(\"loaded\")) {","                throw new Error(file+\" already loaded\");","            }","            isEnabled = info.enabled;","        }","","        var node = {","            id: id,","            module: module,","            name: name,","            file: file,","            template: file.replace(/\\.js$/,\".html\"),","            enabled: isEnabled,","            loaded:false,","            version: version,","            local: fileInfo.local","        };","        if (fileInfo.hasOwnProperty(\"types\")) {","            node.types = fileInfo.types;","        }","","        fs.readFile(node.template,'utf8', function(err,content) {","            if (err) {","                node.types = [];","                if (err.code === 'ENOENT') {","                    if (!node.types) {","                        node.types = [];","                    }","                    node.err = \"Error: \"+node.template+\" does not exist\";","                } else {","                    node.types = [];","                    node.err = err.toString();","                }","                resolve(node);","            } else {","                var types = [];","","                var regExp = /<script ([^>]*)data-template-name=['\"]([^'\"]*)['\"]/gi;","                var match = null;","","                while ((match = regExp.exec(content)) !== null) {","                    types.push(match[2]);","                }","                node.types = types;","","                var langRegExp = /^<script[^>]* data-lang=['\"](.+?)['\"]/i;","                regExp = /(<script[^>]* data-help-name=[\\s\\S]*?<\\/script>)/gi;","                match = null;","                var mainContent = \"\";","                var helpContent = {};","                var index = 0;","                while ((match = regExp.exec(content)) !== null) {","                    mainContent += content.substring(index,regExp.lastIndex-match[1].length);","                    index = regExp.lastIndex;","                    var help = content.substring(regExp.lastIndex-match[1].length,regExp.lastIndex);","","                    var lang = runtime.i18n.defaultLang;","                    if ((match = langRegExp.exec(help)) !== null) {","                        lang = match[1];","                    }","                    if (!helpContent.hasOwnProperty(lang)) {","                        helpContent[lang] = \"\";","                    }","","                    helpContent[lang] += help;","                }","                mainContent += content.substring(index);","","                node.config = mainContent;","                node.help = helpContent;","                // TODO: parse out the javascript portion of the template","                //node.script = \"\";","                for (var i=0;i<node.types.length;i++) {","                    if (registry.getTypeId(node.types[i])) {","                        node.err = node.types[i]+\" already registered\";","                        break;","                    }","                }","                fs.stat(path.join(path.dirname(file),\"locales\"),function(err,stat) {","                    if (!err) {","                        node.namespace = node.id;","                        runtime.i18n.registerMessageCatalog(node.id,","                                path.join(path.dirname(file),\"locales\"),","                                path.basename(file,\".js\")+\".json\")","                            .then(function() {","                                resolve(node);","                            });","                    } else {","                        node.namespace = node.module;","                        resolve(node);","                    }","                });","            }","        });","    });","}","","/**"," * Loads the specified node into the runtime"," * @param node a node info object - see loadNodeConfig"," * @return a promise that resolves to an update node info object. The object"," *         has the following properties added:"," *            err: any error encountered whilst loading the node"," *"," */","function loadNodeSet(node) {","    var nodeDir = path.dirname(node.file);","    var nodeFn = path.basename(node.file);","    if (!node.enabled) {","        return when.resolve(node);","    } else {","    }","    try {","        var loadPromise = null;","        var r = require(node.file);","        if (typeof r === \"function\") {","","            var red = createNodeApi(node);","            var promise = r(red);","            if (promise != null && typeof promise.then === \"function\") {","                loadPromise = promise.then(function() {","                    node.enabled = true;","                    node.loaded = true;","                    return node;","                }).otherwise(function(err) {","                    node.err = err;","                    return node;","                });","            }","        }","        if (loadPromise == null) {","            node.enabled = true;","            node.loaded = true;","            loadPromise = when.resolve(node);","        }","        return loadPromise;","    } catch(err) {","        node.err = err;","        return when.resolve(node);","    }","}","","function loadNodeSetList(nodes) {","    var promises = [];","    nodes.forEach(function(node) {","        if (!node.err) {","            promises.push(loadNodeSet(node));","        } else {","            promises.push(node);","        }","    });","","    return when.settle(promises).then(function() {","        if (settings.available()) {","            return registry.saveNodeList();","        } else {","            return;","        }","    });","}","","function addModule(module) {","    if (!settings.available()) {","        throw new Error(\"Settings unavailable\");","    }","    var nodes = [];","    if (registry.getModuleInfo(module)) {","        // TODO: nls","        var e = new Error(\"module_already_loaded\");","        e.code = \"module_already_loaded\";","        return when.reject(e);","    }","    try {","        var moduleFiles = localfilesystem.getModuleFiles(module);","        return loadNodeFiles(moduleFiles);","    } catch(err) {","        return when.reject(err);","    }","}","","function loadNodeHelp(node,lang) {","    var dir = path.dirname(node.template);","    var base = path.basename(node.template);","    var localePath = path.join(dir,\"locales\",lang,base);","    try {","        // TODO: make this async","        var content = fs.readFileSync(localePath, \"utf8\")","        return content;","    } catch(err) {","        return null;","    }","}","","function getNodeHelp(node,lang) {","    if (!node.help[lang]) {","        var help = loadNodeHelp(node,lang);","        if (help == null) {","            var langParts = lang.split(\"-\");","            if (langParts.length == 2) {","                help = loadNodeHelp(node,langParts[0]);","            }","        }","        if (help) {","            node.help[lang] = help;","        } else {","            node.help[lang] = node.help[runtime.i18n.defaultLang];","        }","    }","    return node.help[lang];","}","","module.exports = {","    init: init,","    load: load,","    addModule: addModule,","    loadNodeSet: loadNodeSet,","    getNodeHelp: getNodeHelp","}",""],"l":{"17":1,"18":1,"19":1,"20":1,"22":1,"23":1,"25":1,"26":1,"28":1,"29":0,"30":0,"31":0,"34":1,"39":0,"41":0,"42":0,"45":1,"46":0,"47":0,"49":0,"50":0,"51":0,"52":0,"53":0,"56":0,"57":0,"58":0,"59":0,"60":0,"66":1,"67":0,"75":0,"76":0,"77":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"91":0,"94":0,"97":0,"102":0,"103":0,"104":0,"105":0,"107":0,"109":0,"113":1,"114":0,"115":0,"117":0,"118":0,"121":0,"122":0,"124":0,"125":0,"126":0,"128":0,"129":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"140":0,"142":0,"143":0,"146":0,"150":0,"151":0,"160":0,"161":0,"162":0,"163":0,"165":0,"169":1,"170":0,"171":0,"172":0,"173":0,"174":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"183":0,"186":0,"197":0,"198":0,"201":0,"202":0,"203":0,"204":0,"205":0,"206":0,"208":0,"210":0,"211":0,"213":0,"215":0,"217":0,"218":0,"220":0,"221":0,"223":0,"225":0,"226":0,"227":0,"228":0,"229":0,"230":0,"231":0,"232":0,"233":0,"234":0,"236":0,"237":0,"238":0,"240":0,"241":0,"244":0,"246":0,"248":0,"249":0,"252":0,"253":0,"254":0,"255":0,"258":0,"259":0,"260":0,"261":0,"265":0,"268":0,"269":0,"285":1,"286":0,"287":0,"288":0,"289":0,"292":0,"293":0,"294":0,"295":0,"297":0,"298":0,"299":0,"300":0,"301":0,"302":0,"303":0,"305":0,"306":0,"310":0,"311":0,"312":0,"313":0,"315":0,"317":0,"318":0,"322":1,"323":0,"324":0,"325":0,"326":0,"328":0,"332":0,"333":0,"334":0,"336":0,"341":1,"342":0,"343":0,"345":0,"346":0,"348":0,"349":0,"350":0,"352":0,"353":0,"354":0,"356":0,"360":1,"361":0,"362":0,"363":0,"364":0,"366":0,"367":0,"369":0,"373":1,"374":0,"375":0,"376":0,"377":0,"378":0,"379":0,"382":0,"383":0,"385":0,"388":0,"391":1}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/registry/localfilesystem.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/registry/localfilesystem.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":0,"11":0,"12":0,"13":0,"14":1,"15":0,"16":0,"17":0,"18":0,"19":0,"20":1,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":1,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":1,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":1,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":1,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":1,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":1,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},"fnMap":{"1":{"name":"init","line":28,"loc":{"start":{"line":28,"column":0},"end":{"line":28,"column":23}}},"2":{"name":"isExcluded","line":35,"loc":{"start":{"line":35,"column":0},"end":{"line":35,"column":26}}},"3":{"name":"getLocalFile","line":45,"loc":{"start":{"line":45,"column":0},"end":{"line":45,"column":28}}},"4":{"name":"getLocalNodeFiles","line":69,"loc":{"start":{"line":69,"column":0},"end":{"line":69,"column":32}}},"5":{"name":"(anonymous_5)","line":78,"loc":{"start":{"line":78,"column":18},"end":{"line":78,"column":31}}},"6":{"name":"scanDirForNodesModules","line":99,"loc":{"start":{"line":99,"column":0},"end":{"line":99,"column":48}}},"7":{"name":"scanTreeForNodesModules","line":137,"loc":{"start":{"line":137,"column":0},"end":{"line":137,"column":45}}},"8":{"name":"(anonymous_8)","line":145,"loc":{"start":{"line":145,"column":24},"end":{"line":145,"column":36}}},"9":{"name":"getModuleNodeFiles","line":162,"loc":{"start":{"line":162,"column":0},"end":{"line":162,"column":36}}},"10":{"name":"getNodeFiles","line":201,"loc":{"start":{"line":201,"column":0},"end":{"line":201,"column":43}}},"11":{"name":"(anonymous_11)","line":233,"loc":{"start":{"line":233,"column":22},"end":{"line":233,"column":37}}},"12":{"name":"(anonymous_12)","line":239,"loc":{"start":{"line":239,"column":28},"end":{"line":239,"column":49}}},"13":{"name":"(anonymous_13)","line":250,"loc":{"start":{"line":250,"column":36},"end":{"line":250,"column":51}}},"14":{"name":"getModuleFiles","line":262,"loc":{"start":{"line":262,"column":0},"end":{"line":262,"column":32}}},"15":{"name":"(anonymous_15)","line":272,"loc":{"start":{"line":272,"column":24},"end":{"line":272,"column":45}}},"16":{"name":"(anonymous_16)","line":282,"loc":{"start":{"line":282,"column":32},"end":{"line":282,"column":47}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":23}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":27}},"4":{"start":{"line":21,"column":0},"end":{"line":21,"column":11}},"5":{"start":{"line":22,"column":0},"end":{"line":22,"column":8}},"6":{"start":{"line":23,"column":0},"end":{"line":23,"column":9}},"7":{"start":{"line":25,"column":0},"end":{"line":25,"column":13}},"8":{"start":{"line":26,"column":0},"end":{"line":26,"column":32}},"9":{"start":{"line":28,"column":0},"end":{"line":33,"column":1}},"10":{"start":{"line":29,"column":4},"end":{"line":29,"column":32}},"11":{"start":{"line":30,"column":4},"end":{"line":30,"column":28}},"12":{"start":{"line":31,"column":4},"end":{"line":31,"column":22}},"13":{"start":{"line":32,"column":4},"end":{"line":32,"column":24}},"14":{"start":{"line":35,"column":0},"end":{"line":44,"column":1}},"15":{"start":{"line":36,"column":5},"end":{"line":42,"column":5}},"16":{"start":{"line":37,"column":8},"end":{"line":41,"column":9}},"17":{"start":{"line":38,"column":12},"end":{"line":40,"column":13}},"18":{"start":{"line":39,"column":16},"end":{"line":39,"column":28}},"19":{"start":{"line":43,"column":4},"end":{"line":43,"column":17}},"20":{"start":{"line":45,"column":0},"end":{"line":60,"column":1}},"21":{"start":{"line":46,"column":4},"end":{"line":48,"column":5}},"22":{"start":{"line":47,"column":8},"end":{"line":47,"column":20}},"23":{"start":{"line":49,"column":4},"end":{"line":59,"column":5}},"24":{"start":{"line":50,"column":8},"end":{"line":50,"column":51}},"25":{"start":{"line":51,"column":8},"end":{"line":56,"column":10}},"26":{"start":{"line":58,"column":8},"end":{"line":58,"column":20}},"27":{"start":{"line":69,"column":0},"end":{"line":97,"column":1}},"28":{"start":{"line":70,"column":4},"end":{"line":70,"column":20}},"29":{"start":{"line":71,"column":4},"end":{"line":71,"column":19}},"30":{"start":{"line":72,"column":4},"end":{"line":76,"column":5}},"31":{"start":{"line":73,"column":8},"end":{"line":73,"column":36}},"32":{"start":{"line":75,"column":8},"end":{"line":75,"column":22}},"33":{"start":{"line":77,"column":4},"end":{"line":77,"column":17}},"34":{"start":{"line":78,"column":4},"end":{"line":95,"column":7}},"35":{"start":{"line":79,"column":8},"end":{"line":79,"column":51}},"36":{"start":{"line":80,"column":8},"end":{"line":94,"column":9}},"37":{"start":{"line":81,"column":12},"end":{"line":86,"column":13}},"38":{"start":{"line":82,"column":16},"end":{"line":82,"column":59}},"39":{"start":{"line":83,"column":16},"end":{"line":85,"column":17}},"40":{"start":{"line":84,"column":20},"end":{"line":84,"column":38}},"41":{"start":{"line":87,"column":15},"end":{"line":94,"column":9}},"42":{"start":{"line":89,"column":12},"end":{"line":93,"column":13}},"43":{"start":{"line":90,"column":16},"end":{"line":90,"column":77}},"44":{"start":{"line":91,"column":19},"end":{"line":93,"column":13}},"45":{"start":{"line":92,"column":16},"end":{"line":92,"column":63}},"46":{"start":{"line":96,"column":4},"end":{"line":96,"column":18}},"47":{"start":{"line":99,"column":0},"end":{"line":130,"column":1}},"48":{"start":{"line":100,"column":4},"end":{"line":100,"column":21}},"49":{"start":{"line":101,"column":4},"end":{"line":128,"column":5}},"50":{"start":{"line":102,"column":8},"end":{"line":102,"column":40}},"51":{"start":{"line":103,"column":8},"end":{"line":126,"column":9}},"52":{"start":{"line":104,"column":12},"end":{"line":104,"column":30}},"53":{"start":{"line":105,"column":12},"end":{"line":125,"column":13}},"54":{"start":{"line":106,"column":16},"end":{"line":106,"column":95}},"55":{"start":{"line":108,"column":16},"end":{"line":124,"column":17}},"56":{"start":{"line":109,"column":20},"end":{"line":109,"column":65}},"57":{"start":{"line":110,"column":20},"end":{"line":120,"column":21}},"58":{"start":{"line":111,"column":24},"end":{"line":111,"column":49}},"59":{"start":{"line":112,"column":24},"end":{"line":115,"column":25}},"60":{"start":{"line":113,"column":28},"end":{"line":113,"column":62}},"61":{"start":{"line":114,"column":28},"end":{"line":114,"column":70}},"62":{"start":{"line":117,"column":24},"end":{"line":119,"column":25}},"63":{"start":{"line":121,"column":20},"end":{"line":123,"column":21}},"64":{"start":{"line":122,"column":24},"end":{"line":122,"column":30}},"65":{"start":{"line":129,"column":4},"end":{"line":129,"column":19}},"66":{"start":{"line":137,"column":0},"end":{"line":160,"column":1}},"67":{"start":{"line":138,"column":4},"end":{"line":138,"column":36}},"68":{"start":{"line":139,"column":4},"end":{"line":139,"column":21}},"69":{"start":{"line":140,"column":4},"end":{"line":140,"column":16}},"70":{"start":{"line":142,"column":4},"end":{"line":146,"column":5}},"71":{"start":{"line":143,"column":8},"end":{"line":143,"column":61}},"72":{"start":{"line":144,"column":8},"end":{"line":144,"column":61}},"73":{"start":{"line":145,"column":8},"end":{"line":145,"column":57}},"74":{"start":{"line":145,"column":38},"end":{"line":145,"column":53}},"75":{"start":{"line":148,"column":4},"end":{"line":158,"column":5}},"76":{"start":{"line":149,"column":8},"end":{"line":149,"column":51}},"77":{"start":{"line":150,"column":8},"end":{"line":157,"column":9}},"78":{"start":{"line":151,"column":12},"end":{"line":151,"column":51}},"79":{"start":{"line":152,"column":12},"end":{"line":154,"column":13}},"80":{"start":{"line":153,"column":16},"end":{"line":153,"column":80}},"81":{"start":{"line":155,"column":12},"end":{"line":155,"column":21}},"82":{"start":{"line":156,"column":12},"end":{"line":156,"column":51}},"83":{"start":{"line":159,"column":4},"end":{"line":159,"column":19}},"84":{"start":{"line":162,"column":0},"end":{"line":199,"column":1}},"85":{"start":{"line":164,"column":4},"end":{"line":164,"column":31}},"86":{"start":{"line":165,"column":4},"end":{"line":165,"column":29}},"87":{"start":{"line":167,"column":4},"end":{"line":167,"column":42}},"88":{"start":{"line":168,"column":4},"end":{"line":168,"column":21}},"89":{"start":{"line":169,"column":4},"end":{"line":169,"column":22}},"90":{"start":{"line":171,"column":4},"end":{"line":191,"column":5}},"91":{"start":{"line":173,"column":8},"end":{"line":190,"column":9}},"92":{"start":{"line":174,"column":12},"end":{"line":174,"column":53}},"93":{"start":{"line":175,"column":12},"end":{"line":180,"column":15}},"94":{"start":{"line":181,"column":12},"end":{"line":181,"column":78}},"95":{"start":{"line":182,"column":12},"end":{"line":189,"column":13}},"96":{"start":{"line":183,"column":16},"end":{"line":188,"column":17}},"97":{"start":{"line":184,"column":20},"end":{"line":184,"column":41}},"98":{"start":{"line":185,"column":20},"end":{"line":185,"column":57}},"99":{"start":{"line":186,"column":20},"end":{"line":186,"column":43}},"100":{"start":{"line":192,"column":4},"end":{"line":192,"column":54}},"101":{"start":{"line":193,"column":4},"end":{"line":197,"column":5}},"102":{"start":{"line":194,"column":8},"end":{"line":194,"column":32}},"103":{"start":{"line":195,"column":8},"end":{"line":195,"column":74}},"104":{"start":{"line":198,"column":4},"end":{"line":198,"column":19}},"105":{"start":{"line":201,"column":0},"end":{"line":260,"column":1}},"106":{"start":{"line":202,"column":4},"end":{"line":202,"column":12}},"107":{"start":{"line":204,"column":4},"end":{"line":204,"column":23}},"108":{"start":{"line":206,"column":4},"end":{"line":210,"column":5}},"109":{"start":{"line":207,"column":8},"end":{"line":207,"column":75}},"110":{"start":{"line":208,"column":8},"end":{"line":208,"column":97}},"111":{"start":{"line":209,"column":8},"end":{"line":209,"column":83}},"112":{"start":{"line":212,"column":4},"end":{"line":215,"column":5}},"113":{"start":{"line":213,"column":8},"end":{"line":213,"column":50}},"114":{"start":{"line":214,"column":8},"end":{"line":214,"column":61}},"115":{"start":{"line":216,"column":4},"end":{"line":224,"column":5}},"116":{"start":{"line":217,"column":8},"end":{"line":217,"column":32}},"117":{"start":{"line":218,"column":8},"end":{"line":220,"column":9}},"118":{"start":{"line":219,"column":12},"end":{"line":219,"column":24}},"119":{"start":{"line":221,"column":8},"end":{"line":223,"column":9}},"120":{"start":{"line":222,"column":12},"end":{"line":222,"column":68}},"121":{"start":{"line":226,"column":4},"end":{"line":232,"column":5}},"122":{"start":{"line":233,"column":4},"end":{"line":235,"column":7}},"123":{"start":{"line":234,"column":8},"end":{"line":234,"column":53}},"124":{"start":{"line":237,"column":4},"end":{"line":258,"column":5}},"125":{"start":{"line":238,"column":8},"end":{"line":238,"column":52}},"126":{"start":{"line":239,"column":8},"end":{"line":255,"column":11}},"127":{"start":{"line":240,"column":12},"end":{"line":240,"column":65}},"128":{"start":{"line":241,"column":12},"end":{"line":246,"column":14}},"129":{"start":{"line":247,"column":12},"end":{"line":249,"column":13}},"130":{"start":{"line":248,"column":16},"end":{"line":248,"column":102}},"131":{"start":{"line":250,"column":12},"end":{"line":253,"column":15}},"132":{"start":{"line":251,"column":16},"end":{"line":251,"column":53}},"133":{"start":{"line":252,"column":16},"end":{"line":252,"column":74}},"134":{"start":{"line":254,"column":12},"end":{"line":254,"column":58}},"135":{"start":{"line":257,"column":8},"end":{"line":257,"column":47}},"136":{"start":{"line":259,"column":4},"end":{"line":259,"column":20}},"137":{"start":{"line":262,"column":0},"end":{"line":288,"column":1}},"138":{"start":{"line":263,"column":4},"end":{"line":263,"column":22}},"139":{"start":{"line":265,"column":4},"end":{"line":265,"column":54}},"140":{"start":{"line":266,"column":4},"end":{"line":270,"column":5}},"141":{"start":{"line":267,"column":8},"end":{"line":267,"column":103}},"142":{"start":{"line":268,"column":8},"end":{"line":268,"column":38}},"143":{"start":{"line":269,"column":8},"end":{"line":269,"column":18}},"144":{"start":{"line":272,"column":4},"end":{"line":286,"column":7}},"145":{"start":{"line":273,"column":8},"end":{"line":273,"column":61}},"146":{"start":{"line":274,"column":8},"end":{"line":278,"column":10}},"147":{"start":{"line":279,"column":8},"end":{"line":281,"column":9}},"148":{"start":{"line":280,"column":12},"end":{"line":280,"column":98}},"149":{"start":{"line":282,"column":8},"end":{"line":285,"column":11}},"150":{"start":{"line":283,"column":12},"end":{"line":283,"column":70}},"151":{"start":{"line":284,"column":12},"end":{"line":284,"column":97}},"152":{"start":{"line":287,"column":4},"end":{"line":287,"column":20}},"153":{"start":{"line":291,"column":0},"end":{"line":296,"column":1}}},"branchMap":{"1":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":5},"end":{"line":36,"column":5}},{"start":{"line":36,"column":5},"end":{"line":36,"column":5}}]},"2":{"line":38,"type":"if","locations":[{"start":{"line":38,"column":12},"end":{"line":38,"column":12}},{"start":{"line":38,"column":12},"end":{"line":38,"column":12}}]},"3":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":4},"end":{"line":46,"column":4}},{"start":{"line":46,"column":4},"end":{"line":46,"column":4}}]},"4":{"line":80,"type":"if","locations":[{"start":{"line":80,"column":8},"end":{"line":80,"column":8}},{"start":{"line":80,"column":8},"end":{"line":80,"column":8}}]},"5":{"line":81,"type":"if","locations":[{"start":{"line":81,"column":12},"end":{"line":81,"column":12}},{"start":{"line":81,"column":12},"end":{"line":81,"column":12}}]},"6":{"line":83,"type":"if","locations":[{"start":{"line":83,"column":16},"end":{"line":83,"column":16}},{"start":{"line":83,"column":16},"end":{"line":83,"column":16}}]},"7":{"line":87,"type":"if","locations":[{"start":{"line":87,"column":15},"end":{"line":87,"column":15}},{"start":{"line":87,"column":15},"end":{"line":87,"column":15}}]},"8":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":12},"end":{"line":89,"column":12}},{"start":{"line":89,"column":12},"end":{"line":89,"column":12}}]},"9":{"line":91,"type":"if","locations":[{"start":{"line":91,"column":19},"end":{"line":91,"column":19}},{"start":{"line":91,"column":19},"end":{"line":91,"column":19}}]},"10":{"line":105,"type":"if","locations":[{"start":{"line":105,"column":12},"end":{"line":105,"column":12}},{"start":{"line":105,"column":12},"end":{"line":105,"column":12}}]},"11":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":16},"end":{"line":108,"column":16}},{"start":{"line":108,"column":16},"end":{"line":108,"column":16}}]},"12":{"line":108,"type":"binary-expr","locations":[{"start":{"line":108,"column":20},"end":{"line":108,"column":35}},{"start":{"line":108,"column":40},"end":{"line":108,"column":51}},{"start":{"line":108,"column":55},"end":{"line":108,"column":71}}]},"13":{"line":112,"type":"if","locations":[{"start":{"line":112,"column":24},"end":{"line":112,"column":24}},{"start":{"line":112,"column":24},"end":{"line":112,"column":24}}]},"14":{"line":117,"type":"if","locations":[{"start":{"line":117,"column":24},"end":{"line":117,"column":24}},{"start":{"line":117,"column":24},"end":{"line":117,"column":24}}]},"15":{"line":121,"type":"if","locations":[{"start":{"line":121,"column":20},"end":{"line":121,"column":20}},{"start":{"line":121,"column":20},"end":{"line":121,"column":20}}]},"16":{"line":142,"type":"if","locations":[{"start":{"line":142,"column":4},"end":{"line":142,"column":4}},{"start":{"line":142,"column":4},"end":{"line":142,"column":4}}]},"17":{"line":148,"type":"if","locations":[{"start":{"line":148,"column":4},"end":{"line":148,"column":4}},{"start":{"line":148,"column":4},"end":{"line":148,"column":4}}]},"18":{"line":152,"type":"if","locations":[{"start":{"line":152,"column":12},"end":{"line":152,"column":12}},{"start":{"line":152,"column":12},"end":{"line":152,"column":12}}]},"19":{"line":167,"type":"binary-expr","locations":[{"start":{"line":167,"column":16},"end":{"line":167,"column":37}},{"start":{"line":167,"column":39},"end":{"line":167,"column":41}}]},"20":{"line":173,"type":"if","locations":[{"start":{"line":173,"column":8},"end":{"line":173,"column":8}},{"start":{"line":173,"column":8},"end":{"line":173,"column":8},"skip":true}]},"21":{"line":182,"type":"if","locations":[{"start":{"line":182,"column":12},"end":{"line":182,"column":12}},{"start":{"line":182,"column":12},"end":{"line":182,"column":12}}]},"22":{"line":206,"type":"if","locations":[{"start":{"line":206,"column":4},"end":{"line":206,"column":4}},{"start":{"line":206,"column":4},"end":{"line":206,"column":4}}]},"23":{"line":212,"type":"if","locations":[{"start":{"line":212,"column":4},"end":{"line":212,"column":4}},{"start":{"line":212,"column":4},"end":{"line":212,"column":4}}]},"24":{"line":216,"type":"if","locations":[{"start":{"line":216,"column":4},"end":{"line":216,"column":4}},{"start":{"line":216,"column":4},"end":{"line":216,"column":4}}]},"25":{"line":218,"type":"if","locations":[{"start":{"line":218,"column":8},"end":{"line":218,"column":8}},{"start":{"line":218,"column":8},"end":{"line":218,"column":8}}]},"26":{"line":237,"type":"if","locations":[{"start":{"line":237,"column":4},"end":{"line":237,"column":4}},{"start":{"line":237,"column":4},"end":{"line":237,"column":4}}]},"27":{"line":244,"type":"binary-expr","locations":[{"start":{"line":244,"column":23},"end":{"line":244,"column":39}},{"start":{"line":244,"column":41},"end":{"line":244,"column":46}}]},"28":{"line":247,"type":"if","locations":[{"start":{"line":247,"column":12},"end":{"line":247,"column":12}},{"start":{"line":247,"column":12},"end":{"line":247,"column":12}}]},"29":{"line":251,"type":"binary-expr","locations":[{"start":{"line":251,"column":29},"end":{"line":251,"column":45}},{"start":{"line":251,"column":47},"end":{"line":251,"column":52}}]},"30":{"line":266,"type":"if","locations":[{"start":{"line":266,"column":4},"end":{"line":266,"column":4}},{"start":{"line":266,"column":4},"end":{"line":266,"column":4}}]},"31":{"line":279,"type":"if","locations":[{"start":{"line":279,"column":8},"end":{"line":279,"column":8}},{"start":{"line":279,"column":8},"end":{"line":279,"column":8}}]},"32":{"line":284,"type":"binary-expr","locations":[{"start":{"line":284,"column":71},"end":{"line":284,"column":87}},{"start":{"line":284,"column":91},"end":{"line":284,"column":96}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var when = require(\"when\");","var fs = require(\"fs\");","var path = require(\"path\");","","var events;","var log;","var i18n;","","var settings;","var disableNodePathScan = false;","","function init(runtime) {","    settings = runtime.settings;","    events = runtime.events;","    log = runtime.log;","    i18n = runtime.i18n;","}","","function isExcluded(name) {","     if (settings.nodesExcludes) {","        for (var i=0;i<settings.nodesExcludes.length;i++) {","            if (settings.nodesExcludes[i] == name) {","                return true;","            }","        }","    }","    return false;","}","function getLocalFile(file) {","    if (isExcluded(path.basename(file))) {","        return null;","    }","    try {","        fs.statSync(file.replace(/\\.js$/,\".html\"));","        return {","            file:    file,","            module:  \"node-red\",","            name:    path.basename(file).replace(/^\\d+-/,\"\").replace(/\\.js$/,\"\"),","            version: settings.version","        };","    } catch(err) {","        return null;","    }","}","","","/**"," * Synchronously walks the directory looking for node files."," * Emits 'node-icon-dir' events for an icon dirs found"," * @param dir the directory to search"," * @return an array of fully-qualified paths to .js files"," */","function getLocalNodeFiles(dir) {","    var result = [];","    var files = [];","    try {","        files = fs.readdirSync(dir);","    } catch(err) {","        return result;","    }","    files.sort();","    files.forEach(function(fn) {","        var stats = fs.statSync(path.join(dir,fn));","        if (stats.isFile()) {","            if (/\\.js$/.test(fn)) {","                var info = getLocalFile(path.join(dir,fn));","                if (info) {","                    result.push(info);","                }","            }","        } else if (stats.isDirectory()) {","            // Ignore /.dirs/, /lib/ /node_modules/","            if (!/^(\\..*|lib|icons|node_modules|test|locales)$/.test(fn)) {","                result = result.concat(getLocalNodeFiles(path.join(dir,fn)));","            } else if (fn === \"icons\") {","                events.emit(\"node-icon-dir\",path.join(dir,fn));","            }","        }","    });","    return result;","}","","function scanDirForNodesModules(dir,moduleName) {","    var results = [];","    try {","        var files = fs.readdirSync(dir);","        for (var i=0;i<files.length;i++) {","            var fn = files[i];","            if (/^@/.test(fn)) {","                results = results.concat(scanDirForNodesModules(path.join(dir,fn),moduleName));","            } else {","                if (!isExcluded(fn) && (!moduleName || fn == moduleName)) {","                    var pkgfn = path.join(dir,fn,\"package.json\");","                    try {","                        var pkg = require(pkgfn);","                        if (pkg['node-red']) {","                            var moduleDir = path.join(dir,fn);","                            results.push({dir:moduleDir,package:pkg});","                        }","                    } catch(err) {","                        if (err.code != \"MODULE_NOT_FOUND\") {","                            // TODO: handle unexpected error","                        }","                    }","                    if (fn == moduleName) {","                        break;","                    }","                }","            }","        }","    } catch(err) {","    }","    return results;","}","","/**"," * Scans the node_modules path for nodes"," * @param moduleName the name of the module to be found"," * @return a list of node modules: {dir,package}"," */","function scanTreeForNodesModules(moduleName) {","    var dir = settings.coreNodesDir;","    var results = [];","    var userDir;","","    if (settings.userDir) {","        userDir = path.join(settings.userDir,\"node_modules\");","        results = scanDirForNodesModules(userDir,moduleName);","        results.forEach(function(r) { r.local = true; });","    }","","    if (dir) {","        var up = path.resolve(path.join(dir,\"..\"));","        while (up !== dir) {","            var pm = path.join(dir,\"node_modules\");","            if (pm != userDir) {","                results = results.concat(scanDirForNodesModules(pm,moduleName));","            }","            dir = up;","            up = path.resolve(path.join(dir,\"..\"));","        }","    }","    return results;","}","","function getModuleNodeFiles(module) {","","    var moduleDir = module.dir;","    var pkg = module.package;","","    var nodes = pkg['node-red'].nodes||{};","    var results = [];","    var iconDirs = [];","","    for (var n in nodes) {","        /* istanbul ignore else */","        if (nodes.hasOwnProperty(n)) {","            var file = path.join(moduleDir,nodes[n]);","            results.push({","                file:    file,","                module:  pkg.name,","                name:    n,","                version: pkg.version","            });","            var iconDir = path.join(moduleDir,path.dirname(nodes[n]),\"icons\");","            if (iconDirs.indexOf(iconDir) == -1) {","                try {","                    fs.statSync(iconDir);","                    events.emit(\"node-icon-dir\",iconDir);","                    iconDirs.push(iconDir);","                } catch(err) {","                }","            }","        }","    }","    var examplesDir = path.join(moduleDir,\"examples\");","    try {","        fs.statSync(examplesDir)","        events.emit(\"node-examples-dir\",{name:pkg.name,path:examplesDir});","    } catch(err) {","    }","    return results;","}","","function getNodeFiles(disableNodePathScan) {","    var dir;","    // Find all of the nodes to load","    var nodeFiles = [];","","    if (settings.coreNodesDir) {","        nodeFiles = getLocalNodeFiles(path.resolve(settings.coreNodesDir));","        var defaultLocalesPath = path.resolve(path.join(settings.coreNodesDir,\"core\",\"locales\"));","        i18n.registerMessageCatalog(\"node-red\",defaultLocalesPath,\"messages.json\");","    }","","    if (settings.userDir) {","        dir = path.join(settings.userDir,\"nodes\");","        nodeFiles = nodeFiles.concat(getLocalNodeFiles(dir));","    }","    if (settings.nodesDir) {","        dir = settings.nodesDir;","        if (typeof settings.nodesDir == \"string\") {","            dir = [dir];","        }","        for (var i=0;i<dir.length;i++) {","            nodeFiles = nodeFiles.concat(getLocalNodeFiles(dir[i]));","        }","    }","","    var nodeList = {","        \"node-red\": {","            name: \"node-red\",","            version: settings.version,","            nodes: {}","        }","    }","    nodeFiles.forEach(function(node) {","        nodeList[\"node-red\"].nodes[node.name] = node;","    });","","    if (!disableNodePathScan) {","        var moduleFiles = scanTreeForNodesModules();","        moduleFiles.forEach(function(moduleFile) {","            var nodeModuleFiles = getModuleNodeFiles(moduleFile);","            nodeList[moduleFile.package.name] = {","                name: moduleFile.package.name,","                version: moduleFile.package.version,","                local: moduleFile.local||false,","                nodes: {}","            };","            if (moduleFile.package['node-red'].version) {","                nodeList[moduleFile.package.name].redVersion = moduleFile.package['node-red'].version;","            }","            nodeModuleFiles.forEach(function(node) {","                node.local = moduleFile.local||false;","                nodeList[moduleFile.package.name].nodes[node.name] = node;","            });","            nodeFiles = nodeFiles.concat(nodeModuleFiles);","        });","    } else {","        console.log(\"node path scan disabled\");","    }","    return nodeList;","}","","function getModuleFiles(module) {","    var nodeList = {};","","    var moduleFiles = scanTreeForNodesModules(module);","    if (moduleFiles.length === 0) {","        var err = new Error(log._(\"nodes.registry.localfilesystem.module-not-found\", {module:module}));","        err.code = 'MODULE_NOT_FOUND';","        throw err;","    }","","    moduleFiles.forEach(function(moduleFile) {","        var nodeModuleFiles = getModuleNodeFiles(moduleFile);","        nodeList[moduleFile.package.name] = {","            name: moduleFile.package.name,","            version: moduleFile.package.version,","            nodes: {}","        };","        if (moduleFile.package['node-red'].version) {","            nodeList[moduleFile.package.name].redVersion = moduleFile.package['node-red'].version;","        }","        nodeModuleFiles.forEach(function(node) {","            nodeList[moduleFile.package.name].nodes[node.name] = node;","            nodeList[moduleFile.package.name].nodes[node.name].local = moduleFile.local || false;","        });","    });","    return nodeList;","}","","","module.exports = {","    init: init,","    getNodeFiles: getNodeFiles,","    getLocalFile: getLocalFile,","    getModuleFiles: getModuleFiles","}",""],"l":{"17":1,"18":1,"19":1,"21":1,"22":1,"23":1,"25":1,"26":1,"28":1,"29":0,"30":0,"31":0,"32":0,"35":1,"36":0,"37":0,"38":0,"39":0,"43":0,"45":1,"46":0,"47":0,"49":0,"50":0,"51":0,"58":0,"69":1,"70":0,"71":0,"72":0,"73":0,"75":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"87":0,"89":0,"90":0,"91":0,"92":0,"96":0,"99":1,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"117":0,"121":0,"122":0,"129":0,"137":1,"138":0,"139":0,"140":0,"142":0,"143":0,"144":0,"145":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"155":0,"156":0,"159":0,"162":1,"164":0,"165":0,"167":0,"168":0,"169":0,"171":0,"173":0,"174":0,"175":0,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"192":0,"193":0,"194":0,"195":0,"198":0,"201":1,"202":0,"204":0,"206":0,"207":0,"208":0,"209":0,"212":0,"213":0,"214":0,"216":0,"217":0,"218":0,"219":0,"221":0,"222":0,"226":0,"233":0,"234":0,"237":0,"238":0,"239":0,"240":0,"241":0,"247":0,"248":0,"250":0,"251":0,"252":0,"254":0,"257":0,"259":0,"262":1,"263":0,"265":0,"266":0,"267":0,"268":0,"269":0,"272":0,"273":0,"274":0,"279":0,"280":0,"282":0,"283":0,"284":0,"287":0,"291":1}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/registry/installer.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/registry/installer.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":0,"15":1,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":1,"32":0,"33":0,"34":0,"35":0,"36":1,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":1,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":1,"71":0,"72":0,"73":0,"74":0,"75":0,"76":1,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":1,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":1,"112":0},"b":{"1":[0,1],"2":[0,1],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0,0],"16":[0,0],"17":[0,0],"18":[0,0,0,0],"19":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},"fnMap":{"1":{"name":"init","line":36,"loc":{"start":{"line":36,"column":0},"end":{"line":36,"column":25}}},"2":{"name":"checkModulePath","line":40,"loc":{"start":{"line":40,"column":0},"end":{"line":40,"column":33}}},"3":{"name":"checkExistingModule","line":62,"loc":{"start":{"line":62,"column":0},"end":{"line":62,"column":37}}},"4":{"name":"installModule","line":71,"loc":{"start":{"line":71,"column":0},"end":{"line":71,"column":31}}},"5":{"name":"(anonymous_5)","line":73,"loc":{"start":{"line":73,"column":24},"end":{"line":73,"column":49}}},"6":{"name":"(anonymous_6)","line":95,"loc":{"start":{"line":95,"column":12},"end":{"line":95,"column":41}}},"7":{"name":"reportAddedModules","line":120,"loc":{"start":{"line":120,"column":0},"end":{"line":120,"column":34}}},"8":{"name":"reportRemovedModules","line":137,"loc":{"start":{"line":137,"column":0},"end":{"line":137,"column":44}}},"9":{"name":"uninstallModule","line":148,"loc":{"start":{"line":148,"column":0},"end":{"line":148,"column":33}}},"10":{"name":"(anonymous_10)","line":149,"loc":{"start":{"line":149,"column":24},"end":{"line":149,"column":49}}},"11":{"name":"(anonymous_11)","line":169,"loc":{"start":{"line":169,"column":12},"end":{"line":169,"column":41}}},"12":{"name":"checkPrereq","line":188,"loc":{"start":{"line":188,"column":0},"end":{"line":188,"column":23}}},"13":{"name":"(anonymous_13)","line":198,"loc":{"start":{"line":198,"column":28},"end":{"line":198,"column":46}}},"14":{"name":"(anonymous_14)","line":199,"loc":{"start":{"line":199,"column":53},"end":{"line":199,"column":67}}},"15":{"name":"(anonymous_15)","line":216,"loc":{"start":{"line":216,"column":26},"end":{"line":216,"column":37}}}},"statementMap":{"1":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"2":{"start":{"line":19,"column":0},"end":{"line":19,"column":27}},"3":{"start":{"line":20,"column":0},"end":{"line":20,"column":23}},"4":{"start":{"line":22,"column":0},"end":{"line":22,"column":37}},"5":{"start":{"line":23,"column":0},"end":{"line":23,"column":31}},"6":{"start":{"line":25,"column":0},"end":{"line":25,"column":37}},"7":{"start":{"line":27,"column":0},"end":{"line":27,"column":45}},"8":{"start":{"line":28,"column":0},"end":{"line":28,"column":66}},"9":{"start":{"line":29,"column":0},"end":{"line":29,"column":33}},"10":{"start":{"line":31,"column":0},"end":{"line":31,"column":13}},"11":{"start":{"line":33,"column":0},"end":{"line":33,"column":25}},"12":{"start":{"line":34,"column":0},"end":{"line":34,"column":62}},"13":{"start":{"line":36,"column":0},"end":{"line":38,"column":1}},"14":{"start":{"line":37,"column":4},"end":{"line":37,"column":25}},"15":{"start":{"line":40,"column":0},"end":{"line":60,"column":1}},"16":{"start":{"line":41,"column":4},"end":{"line":41,"column":19}},"17":{"start":{"line":42,"column":4},"end":{"line":42,"column":12}},"18":{"start":{"line":43,"column":4},"end":{"line":43,"column":40}},"19":{"start":{"line":44,"column":4},"end":{"line":44,"column":57}},"20":{"start":{"line":45,"column":4},"end":{"line":58,"column":5}},"21":{"start":{"line":46,"column":8},"end":{"line":46,"column":39}},"22":{"start":{"line":47,"column":8},"end":{"line":47,"column":30}},"23":{"start":{"line":48,"column":8},"end":{"line":53,"column":9}},"24":{"start":{"line":50,"column":12},"end":{"line":50,"column":55}},"25":{"start":{"line":51,"column":12},"end":{"line":51,"column":40}},"26":{"start":{"line":52,"column":12},"end":{"line":52,"column":22}},"27":{"start":{"line":55,"column":8},"end":{"line":55,"column":44}},"28":{"start":{"line":56,"column":8},"end":{"line":56,"column":23}},"29":{"start":{"line":57,"column":8},"end":{"line":57,"column":18}},"30":{"start":{"line":59,"column":4},"end":{"line":59,"column":22}},"31":{"start":{"line":62,"column":0},"end":{"line":69,"column":1}},"32":{"start":{"line":63,"column":4},"end":{"line":68,"column":5}},"33":{"start":{"line":65,"column":8},"end":{"line":65,"column":53}},"34":{"start":{"line":66,"column":8},"end":{"line":66,"column":43}},"35":{"start":{"line":67,"column":8},"end":{"line":67,"column":18}},"36":{"start":{"line":71,"column":0},"end":{"line":117,"column":1}},"37":{"start":{"line":73,"column":4},"end":{"line":116,"column":7}},"38":{"start":{"line":74,"column":8},"end":{"line":74,"column":33}},"39":{"start":{"line":76,"column":8},"end":{"line":87,"column":9}},"40":{"start":{"line":77,"column":12},"end":{"line":83,"column":13}},"41":{"start":{"line":79,"column":19},"end":{"line":83,"column":13}},"42":{"start":{"line":81,"column":16},"end":{"line":81,"column":37}},"43":{"start":{"line":82,"column":16},"end":{"line":82,"column":49}},"44":{"start":{"line":84,"column":12},"end":{"line":84,"column":40}},"45":{"start":{"line":86,"column":12},"end":{"line":86,"column":31}},"46":{"start":{"line":88,"column":8},"end":{"line":88,"column":68}},"47":{"start":{"line":90,"column":8},"end":{"line":90,"column":78}},"48":{"start":{"line":91,"column":8},"end":{"line":115,"column":10}},"49":{"start":{"line":96,"column":16},"end":{"line":113,"column":17}},"50":{"start":{"line":97,"column":20},"end":{"line":97,"column":79}},"51":{"start":{"line":98,"column":20},"end":{"line":109,"column":21}},"52":{"start":{"line":99,"column":24},"end":{"line":99,"column":97}},"53":{"start":{"line":100,"column":24},"end":{"line":100,"column":62}},"54":{"start":{"line":101,"column":24},"end":{"line":101,"column":37}},"55":{"start":{"line":102,"column":24},"end":{"line":102,"column":34}},"56":{"start":{"line":104,"column":24},"end":{"line":104,"column":92}},"57":{"start":{"line":105,"column":24},"end":{"line":105,"column":79}},"58":{"start":{"line":106,"column":24},"end":{"line":106,"column":49}},"59":{"start":{"line":107,"column":24},"end":{"line":107,"column":79}},"60":{"start":{"line":108,"column":24},"end":{"line":108,"column":82}},"61":{"start":{"line":111,"column":20},"end":{"line":111,"column":78}},"62":{"start":{"line":112,"column":20},"end":{"line":112,"column":91}},"63":{"start":{"line":120,"column":0},"end":{"line":135,"column":1}},"64":{"start":{"line":122,"column":4},"end":{"line":133,"column":5}},"65":{"start":{"line":123,"column":8},"end":{"line":123,"column":46}},"66":{"start":{"line":124,"column":8},"end":{"line":132,"column":9}},"67":{"start":{"line":125,"column":12},"end":{"line":131,"column":13}},"68":{"start":{"line":126,"column":16},"end":{"line":130,"column":18}},"69":{"start":{"line":134,"column":4},"end":{"line":134,"column":16}},"70":{"start":{"line":137,"column":0},"end":{"line":146,"column":1}},"71":{"start":{"line":139,"column":4},"end":{"line":139,"column":44}},"72":{"start":{"line":140,"column":4},"end":{"line":144,"column":5}},"73":{"start":{"line":141,"column":8},"end":{"line":143,"column":9}},"74":{"start":{"line":142,"column":12},"end":{"line":142,"column":108}},"75":{"start":{"line":145,"column":4},"end":{"line":145,"column":24}},"76":{"start":{"line":148,"column":0},"end":{"line":186,"column":1}},"77":{"start":{"line":149,"column":4},"end":{"line":185,"column":7}},"78":{"start":{"line":150,"column":8},"end":{"line":153,"column":9}},"79":{"start":{"line":151,"column":12},"end":{"line":151,"column":63}},"80":{"start":{"line":152,"column":12},"end":{"line":152,"column":19}},"81":{"start":{"line":154,"column":8},"end":{"line":154,"column":78}},"82":{"start":{"line":155,"column":8},"end":{"line":155,"column":68}},"83":{"start":{"line":157,"column":8},"end":{"line":161,"column":9}},"84":{"start":{"line":158,"column":12},"end":{"line":158,"column":35}},"85":{"start":{"line":160,"column":12},"end":{"line":160,"column":93}},"86":{"start":{"line":163,"column":8},"end":{"line":163,"column":49}},"87":{"start":{"line":164,"column":8},"end":{"line":164,"column":69}},"88":{"start":{"line":165,"column":8},"end":{"line":184,"column":10}},"89":{"start":{"line":170,"column":16},"end":{"line":182,"column":17}},"90":{"start":{"line":171,"column":20},"end":{"line":171,"column":90}},"91":{"start":{"line":172,"column":20},"end":{"line":172,"column":75}},"92":{"start":{"line":173,"column":20},"end":{"line":173,"column":45}},"93":{"start":{"line":174,"column":20},"end":{"line":174,"column":75}},"94":{"start":{"line":175,"column":20},"end":{"line":175,"column":94}},"95":{"start":{"line":177,"column":20},"end":{"line":177,"column":80}},"96":{"start":{"line":178,"column":20},"end":{"line":178,"column":47}},"97":{"start":{"line":180,"column":20},"end":{"line":180,"column":65}},"98":{"start":{"line":181,"column":20},"end":{"line":181,"column":34}},"99":{"start":{"line":188,"column":0},"end":{"line":210,"column":1}},"100":{"start":{"line":189,"column":4},"end":{"line":209,"column":5}},"101":{"start":{"line":194,"column":8},"end":{"line":194,"column":58}},"102":{"start":{"line":195,"column":8},"end":{"line":195,"column":37}},"103":{"start":{"line":196,"column":8},"end":{"line":196,"column":30}},"104":{"start":{"line":198,"column":8},"end":{"line":208,"column":10}},"105":{"start":{"line":199,"column":12},"end":{"line":207,"column":15}},"106":{"start":{"line":200,"column":16},"end":{"line":205,"column":17}},"107":{"start":{"line":201,"column":20},"end":{"line":201,"column":75}},"108":{"start":{"line":202,"column":20},"end":{"line":202,"column":49}},"109":{"start":{"line":204,"column":20},"end":{"line":204,"column":48}},"110":{"start":{"line":206,"column":16},"end":{"line":206,"column":26}},"111":{"start":{"line":211,"column":0},"end":{"line":219,"column":1}},"112":{"start":{"line":217,"column":8},"end":{"line":217,"column":35}}},"branchMap":{"1":{"line":28,"type":"cond-expr","locations":[{"start":{"line":28,"column":48},"end":{"line":28,"column":57}},{"start":{"line":28,"column":60},"end":{"line":28,"column":65}}]},"2":{"line":34,"type":"cond-expr","locations":[{"start":{"line":34,"column":45},"end":{"line":34,"column":53}},{"start":{"line":34,"column":56},"end":{"line":34,"column":61}}]},"3":{"line":48,"type":"if","locations":[{"start":{"line":48,"column":8},"end":{"line":48,"column":8}},{"start":{"line":48,"column":8},"end":{"line":48,"column":8}}]},"4":{"line":63,"type":"if","locations":[{"start":{"line":63,"column":4},"end":{"line":63,"column":4}},{"start":{"line":63,"column":4},"end":{"line":63,"column":4}}]},"5":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":12},"end":{"line":77,"column":12}},{"start":{"line":77,"column":12},"end":{"line":77,"column":12}}]},"6":{"line":79,"type":"if","locations":[{"start":{"line":79,"column":19},"end":{"line":79,"column":19}},{"start":{"line":79,"column":19},"end":{"line":79,"column":19}}]},"7":{"line":90,"type":"binary-expr","locations":[{"start":{"line":90,"column":25},"end":{"line":90,"column":41}},{"start":{"line":90,"column":45},"end":{"line":90,"column":70}},{"start":{"line":90,"column":74},"end":{"line":90,"column":77}}]},"8":{"line":96,"type":"if","locations":[{"start":{"line":96,"column":16},"end":{"line":96,"column":16}},{"start":{"line":96,"column":16},"end":{"line":96,"column":16}}]},"9":{"line":98,"type":"if","locations":[{"start":{"line":98,"column":20},"end":{"line":98,"column":20}},{"start":{"line":98,"column":20},"end":{"line":98,"column":20}}]},"10":{"line":122,"type":"if","locations":[{"start":{"line":122,"column":4},"end":{"line":122,"column":4}},{"start":{"line":122,"column":4},"end":{"line":122,"column":4}}]},"11":{"line":127,"type":"cond-expr","locations":[{"start":{"line":127,"column":42},"end":{"line":127,"column":66}},{"start":{"line":127,"column":67},"end":{"line":127,"column":69}}]},"12":{"line":129,"type":"cond-expr","locations":[{"start":{"line":129,"column":39},"end":{"line":129,"column":62}},{"start":{"line":129,"column":63},"end":{"line":129,"column":65}}]},"13":{"line":142,"type":"cond-expr","locations":[{"start":{"line":142,"column":51},"end":{"line":142,"column":77}},{"start":{"line":142,"column":78},"end":{"line":142,"column":80}}]},"14":{"line":150,"type":"if","locations":[{"start":{"line":150,"column":8},"end":{"line":150,"column":8}},{"start":{"line":150,"column":8},"end":{"line":150,"column":8}}]},"15":{"line":154,"type":"binary-expr","locations":[{"start":{"line":154,"column":25},"end":{"line":154,"column":41}},{"start":{"line":154,"column":45},"end":{"line":154,"column":70}},{"start":{"line":154,"column":74},"end":{"line":154,"column":77}}]},"16":{"line":170,"type":"if","locations":[{"start":{"line":170,"column":16},"end":{"line":170,"column":16}},{"start":{"line":170,"column":16},"end":{"line":170,"column":16}}]},"17":{"line":189,"type":"if","locations":[{"start":{"line":189,"column":4},"end":{"line":189,"column":4}},{"start":{"line":189,"column":4},"end":{"line":189,"column":4}}]},"18":{"line":189,"type":"binary-expr","locations":[{"start":{"line":189,"column":8},"end":{"line":189,"column":46}},{"start":{"line":190,"column":8},"end":{"line":190,"column":54}},{"start":{"line":191,"column":8},"end":{"line":191,"column":63}},{"start":{"line":192,"column":8},"end":{"line":192,"column":55}}]},"19":{"line":200,"type":"if","locations":[{"start":{"line":200,"column":16},"end":{"line":200,"column":16}},{"start":{"line":200,"column":16},"end":{"line":200,"column":16}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","","var when = require(\"when\");","var path = require(\"path\");","var fs = require(\"fs\");","","var registry = require(\"./registry\");","var log = require(\"../../log\");","","var events = require(\"../../events\");","","var child_process = require('child_process');","var npmCommand = process.platform === 'win32' ? 'npm.cmd' : 'npm';","var paletteEditorEnabled = false;","","var settings;","","var moduleRe = /^[^/]+$/;","var slashRe = process.platform === \"win32\" ? /\\\\|[/]/ : /[/]/;","","function init(_settings) {","    settings = _settings;","}","","function checkModulePath(folder) {","    var moduleName;","    var err;","    var fullPath = path.resolve(folder);","    var packageFile = path.join(fullPath,'package.json');","    try {","        var pkg = require(packageFile);","        moduleName = pkg.name;","        if (!pkg['node-red']) {","            // TODO: nls","            err = new Error(\"Invalid Node-RED module\");","            err.code = 'invalid_module';","            throw err;","        }","    } catch(err2) {","        err = new Error(\"Module not found\");","        err.code = 404;","        throw err;","    }","    return moduleName;","}","","function checkExistingModule(module) {","    if (registry.getModuleInfo(module)) {","        // TODO: nls","        var err = new Error(\"Module already loaded\");","        err.code = \"module_already_loaded\";","        throw err;","    }","}","","function installModule(module) {","    //TODO: ensure module is 'safe'","    return when.promise(function(resolve,reject) {","        var installName = module;","","        try {","            if (moduleRe.test(module)) {","                // Simple module name - assume it can be npm installed","            } else if (slashRe.test(module)) {","                // A path - check if there's a valid package.json","                installName = module;","                module = checkModulePath(module);","            }","            checkExistingModule(module);","        } catch(err) {","            return reject(err);","        }","        log.info(log._(\"server.install.installing\",{name: module}));","","        var installDir = settings.userDir || process.env.NODE_RED_HOME || \".\";","        var child = child_process.execFile(npmCommand,['install','--production',installName],","            {","                cwd: installDir","            },","            function(err, stdin, stdout) {","                if (err) {","                    var lookFor404 = new RegExp(\" 404 .*\"+installName+\"$\",\"m\");","                    if (lookFor404.test(stdout)) {","                        log.warn(log._(\"server.install.install-failed-not-found\",{name:module}));","                        var e = new Error(\"Module not found\");","                        e.code = 404;","                        reject(e);","                    } else {","                        log.warn(log._(\"server.install.install-failed-long\",{name:module}));","                        log.warn(\"------------------------------------------\");","                        log.warn(err.toString());","                        log.warn(\"------------------------------------------\");","                        reject(new Error(log._(\"server.install.install-failed\")));","                    }","                } else {","                    log.info(log._(\"server.install.installed\",{name:module}));","                    resolve(require(\"./index\").addModule(module).then(reportAddedModules));","                }","            }","        );","    });","}","","","function reportAddedModules(info) {","    //comms.publish(\"node/added\",info.nodes,false);","    if (info.nodes.length > 0) {","        log.info(log._(\"server.added-types\"));","        for (var i=0;i<info.nodes.length;i++) {","            for (var j=0;j<info.nodes[i].types.length;j++) {","                log.info(\" - \"+","                    (info.nodes[i].module?info.nodes[i].module+\":\":\"\")+","                    info.nodes[i].types[j]+","                    (info.nodes[i].err?\" : \"+info.nodes[i].err:\"\")","                );","            }","        }","    }","    return info;","}","","function reportRemovedModules(removedNodes) {","    //comms.publish(\"node/removed\",removedNodes,false);","    log.info(log._(\"server.removed-types\"));","    for (var j=0;j<removedNodes.length;j++) {","        for (var i=0;i<removedNodes[j].types.length;i++) {","            log.info(\" - \"+(removedNodes[j].module?removedNodes[j].module+\":\":\"\")+removedNodes[j].types[i]);","        }","    }","    return removedNodes;","}","","function uninstallModule(module) {","    return when.promise(function(resolve,reject) {","        if (/[\\s;]/.test(module)) {","            reject(new Error(log._(\"server.install.invalid\")));","            return;","        }","        var installDir = settings.userDir || process.env.NODE_RED_HOME || \".\";","        var moduleDir = path.join(installDir,\"node_modules\",module);","","        try {","            fs.statSync(moduleDir);","        } catch(err) {","            return reject(new Error(log._(\"server.install.uninstall-failed\",{name:module})));","        }","","        var list = registry.removeModule(module);","        log.info(log._(\"server.install.uninstalling\",{name:module}));","        var child = child_process.execFile(npmCommand,['remove',module],","            {","                cwd: installDir","            },","            function(err, stdin, stdout) {","                if (err) {","                    log.warn(log._(\"server.install.uninstall-failed-long\",{name:module}));","                    log.warn(\"------------------------------------------\");","                    log.warn(err.toString());","                    log.warn(\"------------------------------------------\");","                    reject(new Error(log._(\"server.install.uninstall-failed\",{name:module})));","                } else {","                    log.info(log._(\"server.install.uninstalled\",{name:module}));","                    reportRemovedModules(list);","                    // TODO: tidy up internal event names","                    events.emit(\"node-module-uninstalled\",module)","                    resolve(list);","                }","            }","        );","    });","}","","function checkPrereq() {","    if (settings.hasOwnProperty('editorTheme') &&","        settings.editorTheme.hasOwnProperty('palette') &&","        settings.editorTheme.palette.hasOwnProperty('editable') &&","        settings.editorTheme.palette.editable === false","    ) {","        log.info(log._(\"server.palette-editor.disabled\"));","        paletteEditorEnabled = false;","        return when.resolve();","    } else {","        return when.promise(function(resolve) {","            child_process.execFile(npmCommand,['-v'],function(err) {","                if (err) {","                    log.info(log._(\"server.palette-editor.npm-not-found\"));","                    paletteEditorEnabled = false;","                } else {","                    paletteEditorEnabled = true;","                }","                resolve();","            });","        })","    }","}","module.exports = {","    init: init,","    checkPrereq: checkPrereq,","    installModule: installModule,","    uninstallModule: uninstallModule,","    paletteEditorEnabled: function() {","        return paletteEditorEnabled","    }","}",""],"l":{"18":1,"19":1,"20":1,"22":1,"23":1,"25":1,"27":1,"28":1,"29":1,"31":1,"33":1,"34":1,"36":1,"37":0,"40":1,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"50":0,"51":0,"52":0,"55":0,"56":0,"57":0,"59":0,"62":1,"63":0,"65":0,"66":0,"67":0,"71":1,"73":0,"74":0,"76":0,"77":0,"79":0,"81":0,"82":0,"84":0,"86":0,"88":0,"90":0,"91":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"104":0,"105":0,"106":0,"107":0,"108":0,"111":0,"112":0,"120":1,"122":0,"123":0,"124":0,"125":0,"126":0,"134":0,"137":1,"139":0,"140":0,"141":0,"142":0,"145":0,"148":1,"149":0,"150":0,"151":0,"152":0,"154":0,"155":0,"157":0,"158":0,"160":0,"163":0,"164":0,"165":0,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"177":0,"178":0,"180":0,"181":0,"188":1,"189":0,"194":0,"195":0,"196":0,"198":0,"199":0,"200":0,"201":0,"202":0,"204":0,"206":0,"211":1,"217":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/log.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/log.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":1,"18":1,"19":0,"20":1,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":1,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0,0,0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0,0,0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},"fnMap":{"1":{"name":"(anonymous_1)","line":49,"loc":{"start":{"line":49,"column":17},"end":{"line":49,"column":36}}},"2":{"name":"(anonymous_2)","line":57,"loc":{"start":{"line":57,"column":18},"end":{"line":57,"column":32}}},"3":{"name":"(anonymous_3)","line":65,"loc":{"start":{"line":65,"column":43},"end":{"line":65,"column":62}}},"4":{"name":"(anonymous_4)","line":71,"loc":{"start":{"line":71,"column":20},"end":{"line":71,"column":34}}},"5":{"name":"(anonymous_5)","line":93,"loc":{"start":{"line":93,"column":10},"end":{"line":93,"column":29}}},"6":{"name":"(anonymous_6)","line":114,"loc":{"start":{"line":114,"column":16},"end":{"line":114,"column":31}}},"7":{"name":"(anonymous_7)","line":117,"loc":{"start":{"line":117,"column":19},"end":{"line":117,"column":34}}},"8":{"name":"(anonymous_8)","line":123,"loc":{"start":{"line":123,"column":9},"end":{"line":123,"column":23}}},"9":{"name":"(anonymous_9)","line":125,"loc":{"start":{"line":125,"column":28},"end":{"line":125,"column":46}}},"10":{"name":"(anonymous_10)","line":129,"loc":{"start":{"line":129,"column":10},"end":{"line":129,"column":24}}},"11":{"name":"(anonymous_11)","line":132,"loc":{"start":{"line":132,"column":10},"end":{"line":132,"column":24}}},"12":{"name":"(anonymous_12)","line":135,"loc":{"start":{"line":135,"column":11},"end":{"line":135,"column":25}}},"13":{"name":"(anonymous_13)","line":138,"loc":{"start":{"line":138,"column":11},"end":{"line":138,"column":25}}},"14":{"name":"(anonymous_14)","line":141,"loc":{"start":{"line":141,"column":11},"end":{"line":141,"column":25}}},"15":{"name":"(anonymous_15)","line":144,"loc":{"start":{"line":144,"column":12},"end":{"line":144,"column":23}}},"16":{"name":"(anonymous_16)","line":148,"loc":{"start":{"line":148,"column":11},"end":{"line":148,"column":29}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":50}},"3":{"start":{"line":20,"column":0},"end":{"line":20,"column":29}},"4":{"start":{"line":22,"column":0},"end":{"line":32,"column":2}},"5":{"start":{"line":34,"column":0},"end":{"line":43,"column":2}},"6":{"start":{"line":45,"column":0},"end":{"line":45,"column":21}},"7":{"start":{"line":47,"column":0},"end":{"line":47,"column":27}},"8":{"start":{"line":49,"column":0},"end":{"line":62,"column":1}},"9":{"start":{"line":50,"column":4},"end":{"line":50,"column":82}},"10":{"start":{"line":51,"column":4},"end":{"line":51,"column":64}},"11":{"start":{"line":52,"column":4},"end":{"line":52,"column":60}},"12":{"start":{"line":54,"column":4},"end":{"line":54,"column":54}},"13":{"start":{"line":56,"column":4},"end":{"line":56,"column":97}},"14":{"start":{"line":57,"column":4},"end":{"line":61,"column":7}},"15":{"start":{"line":58,"column":8},"end":{"line":60,"column":9}},"16":{"start":{"line":59,"column":12},"end":{"line":59,"column":30}},"17":{"start":{"line":63,"column":0},"end":{"line":63,"column":40}},"18":{"start":{"line":65,"column":0},"end":{"line":69,"column":1}},"19":{"start":{"line":66,"column":4},"end":{"line":68,"column":37}},"20":{"start":{"line":71,"column":0},"end":{"line":81,"column":1}},"21":{"start":{"line":72,"column":4},"end":{"line":80,"column":5}},"22":{"start":{"line":73,"column":8},"end":{"line":73,"column":69}},"23":{"start":{"line":75,"column":8},"end":{"line":75,"column":30}},"24":{"start":{"line":76,"column":8},"end":{"line":78,"column":9}},"25":{"start":{"line":77,"column":12},"end":{"line":77,"column":38}},"26":{"start":{"line":79,"column":8},"end":{"line":79,"column":112}},"27":{"start":{"line":83,"column":0},"end":{"line":157,"column":1}},"28":{"start":{"line":94,"column":8},"end":{"line":94,"column":31}},"29":{"start":{"line":95,"column":8},"end":{"line":95,"column":25}},"30":{"start":{"line":96,"column":8},"end":{"line":96,"column":32}},"31":{"start":{"line":97,"column":8},"end":{"line":112,"column":9}},"32":{"start":{"line":98,"column":12},"end":{"line":98,"column":53}},"33":{"start":{"line":99,"column":12},"end":{"line":109,"column":13}},"34":{"start":{"line":100,"column":16},"end":{"line":100,"column":49}},"35":{"start":{"line":102,"column":16},"end":{"line":108,"column":17}},"36":{"start":{"line":103,"column":20},"end":{"line":103,"column":59}},"37":{"start":{"line":104,"column":20},"end":{"line":104,"column":50}},"38":{"start":{"line":105,"column":20},"end":{"line":107,"column":21}},"39":{"start":{"line":106,"column":24},"end":{"line":106,"column":71}},"40":{"start":{"line":111,"column":12},"end":{"line":111,"column":45}},"41":{"start":{"line":115,"column":8},"end":{"line":115,"column":31}},"42":{"start":{"line":118,"column":8},"end":{"line":118,"column":46}},"43":{"start":{"line":119,"column":8},"end":{"line":121,"column":9}},"44":{"start":{"line":120,"column":12},"end":{"line":120,"column":40}},"45":{"start":{"line":124,"column":8},"end":{"line":124,"column":35}},"46":{"start":{"line":125,"column":8},"end":{"line":127,"column":11}},"47":{"start":{"line":126,"column":12},"end":{"line":126,"column":36}},"48":{"start":{"line":130,"column":8},"end":{"line":130,"column":42}},"49":{"start":{"line":133,"column":8},"end":{"line":133,"column":42}},"50":{"start":{"line":136,"column":8},"end":{"line":136,"column":43}},"51":{"start":{"line":139,"column":8},"end":{"line":139,"column":43}},"52":{"start":{"line":142,"column":8},"end":{"line":142,"column":43}},"53":{"start":{"line":145,"column":8},"end":{"line":145,"column":30}},"54":{"start":{"line":149,"column":8},"end":{"line":149,"column":30}},"55":{"start":{"line":150,"column":8},"end":{"line":154,"column":9}},"56":{"start":{"line":151,"column":12},"end":{"line":151,"column":32}},"57":{"start":{"line":152,"column":12},"end":{"line":152,"column":32}},"58":{"start":{"line":153,"column":12},"end":{"line":153,"column":134}},"59":{"start":{"line":155,"column":8},"end":{"line":155,"column":21}},"60":{"start":{"line":159,"column":0},"end":{"line":159,"column":18}}},"branchMap":{"1":{"line":50,"type":"cond-expr","locations":[{"start":{"line":50,"column":32},"end":{"line":50,"column":67}},{"start":{"line":50,"column":70},"end":{"line":50,"column":81}}]},"2":{"line":50,"type":"binary-expr","locations":[{"start":{"line":50,"column":32},"end":{"line":50,"column":54}},{"start":{"line":50,"column":56},"end":{"line":50,"column":67}}]},"3":{"line":51,"type":"cond-expr","locations":[{"start":{"line":51,"column":32},"end":{"line":51,"column":55}},{"start":{"line":51,"column":58},"end":{"line":51,"column":63}}]},"4":{"line":51,"type":"binary-expr","locations":[{"start":{"line":51,"column":32},"end":{"line":51,"column":48}},{"start":{"line":51,"column":50},"end":{"line":51,"column":55}}]},"5":{"line":52,"type":"cond-expr","locations":[{"start":{"line":52,"column":30},"end":{"line":52,"column":51}},{"start":{"line":52,"column":54},"end":{"line":52,"column":59}}]},"6":{"line":52,"type":"binary-expr","locations":[{"start":{"line":52,"column":30},"end":{"line":52,"column":44}},{"start":{"line":52,"column":46},"end":{"line":52,"column":51}}]},"7":{"line":54,"type":"binary-expr","locations":[{"start":{"line":54,"column":21},"end":{"line":54,"column":35}},{"start":{"line":54,"column":39},"end":{"line":54,"column":53}}]},"8":{"line":56,"type":"cond-expr","locations":[{"start":{"line":56,"column":54},"end":{"line":56,"column":80}},{"start":{"line":56,"column":83},"end":{"line":56,"column":96}}]},"9":{"line":56,"type":"binary-expr","locations":[{"start":{"line":56,"column":22},"end":{"line":56,"column":30}},{"start":{"line":56,"column":34},"end":{"line":56,"column":50}}]},"10":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":8},"end":{"line":58,"column":8}},{"start":{"line":58,"column":8},"end":{"line":58,"column":8}}]},"11":{"line":66,"type":"binary-expr","locations":[{"start":{"line":66,"column":12},"end":{"line":66,"column":34}},{"start":{"line":66,"column":38},"end":{"line":66,"column":52}},{"start":{"line":67,"column":12},"end":{"line":67,"column":33}},{"start":{"line":67,"column":37},"end":{"line":67,"column":49}},{"start":{"line":68,"column":11},"end":{"line":68,"column":36}}]},"12":{"line":72,"type":"if","locations":[{"start":{"line":72,"column":4},"end":{"line":72,"column":4}},{"start":{"line":72,"column":4},"end":{"line":72,"column":4}}]},"13":{"line":72,"type":"binary-expr","locations":[{"start":{"line":72,"column":8},"end":{"line":72,"column":31}},{"start":{"line":72,"column":35},"end":{"line":72,"column":57}}]},"14":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":8},"end":{"line":76,"column":8}},{"start":{"line":76,"column":8},"end":{"line":76,"column":8}}]},"15":{"line":76,"type":"binary-expr","locations":[{"start":{"line":76,"column":12},"end":{"line":76,"column":39}},{"start":{"line":76,"column":43},"end":{"line":76,"column":83}},{"start":{"line":76,"column":87},"end":{"line":76,"column":102}}]},"16":{"line":79,"type":"cond-expr","locations":[{"start":{"line":79,"column":58},"end":{"line":79,"column":98}},{"start":{"line":79,"column":99},"end":{"line":79,"column":101}}]},"17":{"line":79,"type":"binary-expr","locations":[{"start":{"line":79,"column":76},"end":{"line":79,"column":84}},{"start":{"line":79,"column":86},"end":{"line":79,"column":92}}]},"18":{"line":97,"type":"if","locations":[{"start":{"line":97,"column":8},"end":{"line":97,"column":8}},{"start":{"line":97,"column":8},"end":{"line":97,"column":8}}]},"19":{"line":99,"type":"if","locations":[{"start":{"line":99,"column":12},"end":{"line":99,"column":12}},{"start":{"line":99,"column":12},"end":{"line":99,"column":12}}]},"20":{"line":104,"type":"binary-expr","locations":[{"start":{"line":104,"column":37},"end":{"line":104,"column":43}},{"start":{"line":104,"column":47},"end":{"line":104,"column":49}}]},"21":{"line":105,"type":"if","locations":[{"start":{"line":105,"column":20},"end":{"line":105,"column":20}},{"start":{"line":105,"column":20},"end":{"line":105,"column":20}}]},"22":{"line":105,"type":"binary-expr","locations":[{"start":{"line":105,"column":25},"end":{"line":105,"column":46}},{"start":{"line":105,"column":51},"end":{"line":105,"column":65}}]},"23":{"line":119,"type":"if","locations":[{"start":{"line":119,"column":8},"end":{"line":119,"column":8}},{"start":{"line":119,"column":8},"end":{"line":119,"column":8}}]},"24":{"line":150,"type":"if","locations":[{"start":{"line":150,"column":8},"end":{"line":150,"column":8}},{"start":{"line":150,"column":8},"end":{"line":150,"column":8}}]},"25":{"line":153,"type":"binary-expr","locations":[{"start":{"line":153,"column":22},"end":{"line":153,"column":33}},{"start":{"line":153,"column":37},"end":{"line":153,"column":67}},{"start":{"line":153,"column":73},"end":{"line":153,"column":87}},{"start":{"line":153,"column":91},"end":{"line":153,"column":119}},{"start":{"line":153,"column":124},"end":{"line":153,"column":133}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var util = require(\"util\");","var EventEmitter = require(\"events\").EventEmitter;","","var i18n = require(\"./i18n\");","","var levels = {","    off:    1,","    fatal:  10,","    error:  20,","    warn:   30,","    info:   40,","    debug:  50,","    trace:  60,","    audit:  98,","    metric: 99","};","","var levelNames = {","    10: \"fatal\",","    20: \"error\",","    30: \"warn\",","    40: \"info\",","    50: \"debug\",","    60: \"trace\",","    98: \"audit\",","    99: \"metric\"","};","","var logHandlers = [];","","var metricsEnabled = false;","","var LogHandler = function(settings) {","    this.logLevel  = settings ? levels[settings.level]||levels.info : levels.info;","    this.metricsOn = settings ? settings.metrics||false : false;","    this.auditOn = settings ? settings.audit||false : false;","","    metricsEnabled = metricsEnabled || this.metricsOn;","","    this.handler   = (settings && settings.handler) ? settings.handler(settings) : consoleLogger;","    this.on(\"log\",function(msg) {","        if (this.shouldReportMessage(msg.level)) {","            this.handler(msg);","        }","    });","}","util.inherits(LogHandler, EventEmitter);","","LogHandler.prototype.shouldReportMessage = function(msglevel) {","    return (msglevel == log.METRIC && this.metricsOn) ||","           (msglevel == log.AUDIT && this.auditOn) ||","           msglevel <= this.logLevel;","}","","var consoleLogger = function(msg) {","    if (msg.level == log.METRIC || msg.level == log.AUDIT) {","        util.log(\"[\"+levelNames[msg.level]+\"] \"+JSON.stringify(msg));","    } else {","        var message = msg.msg;","        if (typeof message === 'object' && message.toString() === '[object Object]' && message.message) {","            message = message.message;","        }","        util.log(\"[\"+levelNames[msg.level]+\"] \"+(msg.type?\"[\"+msg.type+\":\"+(msg.name||msg.id)+\"] \":\"\")+message);","    }","}","","var log = module.exports = {","    FATAL:  10,","    ERROR:  20,","    WARN:   30,","    INFO:   40,","    DEBUG:  50,","    TRACE:  60,","    AUDIT:  98,","    METRIC: 99,","","    init: function(settings) {","        metricsEnabled = false;","        logHandlers = [];","        var loggerSettings = {};","        if (settings.logging) {","            var keys = Object.keys(settings.logging);","            if (keys.length === 0) {","                log.addHandler(new LogHandler());","            } else {","                for (var i=0, l=keys.length; i<l; i++) {","                    var config = settings.logging[keys[i]];","                    loggerSettings = config || {};","                    if ((keys[i] === \"console\") || config.handler) {","                        log.addHandler(new LogHandler(loggerSettings));","                    }","                }","            }","        } else {","            log.addHandler(new LogHandler());","        }","    },","    addHandler: function(func) {","        logHandlers.push(func);","    },","    removeHandler: function(func) {","        var index = logHandlers.indexOf(func);","        if (index > -1) {","            logHandlers.splice(index,1);","        }","    },","    log: function(msg) {","        msg.timestamp = Date.now();","        logHandlers.forEach(function(handler) {","            handler.emit(\"log\",msg);","        });","    },","    info: function(msg) {","        log.log({level:log.INFO,msg:msg});","    },","    warn: function(msg) {","        log.log({level:log.WARN,msg:msg});","    },","    error: function(msg) {","        log.log({level:log.ERROR,msg:msg});","    },","    trace: function(msg) {","        log.log({level:log.TRACE,msg:msg});","    },","    debug: function(msg) {","        log.log({level:log.DEBUG,msg:msg});","    },","    metric: function() {","        return metricsEnabled;","    },","","    audit: function(msg,req) {","        msg.level = log.AUDIT;","        if (req) {","            msg.user = req.user;","            msg.path = req.path;","            msg.ip = (req.headers && req.headers['x-forwarded-for']) || (req.connection && req.connection.remoteAddress) || undefined;","        }","        log.log(msg);","    }","}","","log[\"_\"] = i18n._;",""],"l":{"17":1,"18":1,"20":1,"22":1,"34":1,"45":1,"47":1,"49":1,"50":0,"51":0,"52":0,"54":0,"56":0,"57":0,"58":0,"59":0,"63":1,"65":1,"66":0,"71":1,"72":0,"73":0,"75":0,"76":0,"77":0,"79":0,"83":1,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"102":0,"103":0,"104":0,"105":0,"106":0,"111":0,"115":0,"118":0,"119":0,"120":0,"124":0,"125":0,"126":0,"130":0,"133":0,"136":0,"139":0,"142":0,"145":0,"149":0,"150":0,"151":0,"152":0,"153":0,"155":0,"159":1}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/i18n.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/i18n.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":0,"12":1,"13":0,"14":0,"15":0,"16":0,"17":1,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":1,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":1,"39":0,"40":0,"41":0,"42":0,"43":1,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":1,"55":1,"56":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"fnMap":{"1":{"name":"registerMessageCatalogs","line":27,"loc":{"start":{"line":27,"column":0},"end":{"line":27,"column":43}}},"2":{"name":"(anonymous_2)","line":28,"loc":{"start":{"line":28,"column":32},"end":{"line":28,"column":50}}},"3":{"name":"registerMessageCatalog","line":34,"loc":{"start":{"line":34,"column":0},"end":{"line":34,"column":52}}},"4":{"name":"(anonymous_4)","line":35,"loc":{"start":{"line":35,"column":24},"end":{"line":35,"column":49}}},"5":{"name":"(anonymous_5)","line":37,"loc":{"start":{"line":37,"column":37},"end":{"line":37,"column":48}}},"6":{"name":"mergeCatalog","line":43,"loc":{"start":{"line":43,"column":0},"end":{"line":43,"column":40}}},"7":{"name":"(anonymous_7)","line":56,"loc":{"start":{"line":56,"column":14},"end":{"line":56,"column":42}}},"8":{"name":"(anonymous_8)","line":60,"loc":{"start":{"line":60,"column":36},"end":{"line":60,"column":58}}},"9":{"name":"init","line":84,"loc":{"start":{"line":84,"column":0},"end":{"line":84,"column":16}}},"10":{"name":"(anonymous_10)","line":85,"loc":{"start":{"line":85,"column":24},"end":{"line":85,"column":49}}},"11":{"name":"(anonymous_11)","line":93,"loc":{"start":{"line":93,"column":10},"end":{"line":93,"column":21}}},"12":{"name":"getCatalog","line":99,"loc":{"start":{"line":99,"column":0},"end":{"line":99,"column":36}}},"13":{"name":"(anonymous_13)","line":125,"loc":{"start":{"line":125,"column":11},"end":{"line":125,"column":22}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":30}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":27}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":23}},"5":{"start":{"line":22,"column":0},"end":{"line":22,"column":26}},"6":{"start":{"line":24,"column":0},"end":{"line":24,"column":21}},"7":{"start":{"line":25,"column":0},"end":{"line":25,"column":23}},"8":{"start":{"line":27,"column":0},"end":{"line":32,"column":1}},"9":{"start":{"line":28,"column":4},"end":{"line":30,"column":7}},"10":{"start":{"line":29,"column":8},"end":{"line":29,"column":82}},"11":{"start":{"line":31,"column":4},"end":{"line":31,"column":33}},"12":{"start":{"line":34,"column":0},"end":{"line":41,"column":1}},"13":{"start":{"line":35,"column":4},"end":{"line":40,"column":7}},"14":{"start":{"line":36,"column":8},"end":{"line":36,"column":59}},"15":{"start":{"line":37,"column":8},"end":{"line":39,"column":11}},"16":{"start":{"line":38,"column":12},"end":{"line":38,"column":22}},"17":{"start":{"line":43,"column":0},"end":{"line":53,"column":1}},"18":{"start":{"line":44,"column":4},"end":{"line":52,"column":5}},"19":{"start":{"line":45,"column":8},"end":{"line":51,"column":9}},"20":{"start":{"line":46,"column":12},"end":{"line":50,"column":13}},"21":{"start":{"line":47,"column":16},"end":{"line":47,"column":41}},"22":{"start":{"line":48,"column":19},"end":{"line":50,"column":13}},"23":{"start":{"line":49,"column":16},"end":{"line":49,"column":53}},"24":{"start":{"line":55,"column":0},"end":{"line":82,"column":1}},"25":{"start":{"line":57,"column":8},"end":{"line":79,"column":9}},"26":{"start":{"line":58,"column":12},"end":{"line":58,"column":83}},"27":{"start":{"line":60,"column":12},"end":{"line":76,"column":15}},"28":{"start":{"line":61,"column":16},"end":{"line":75,"column":17}},"29":{"start":{"line":62,"column":20},"end":{"line":62,"column":34}},"30":{"start":{"line":64,"column":20},"end":{"line":74,"column":21}},"31":{"start":{"line":65,"column":24},"end":{"line":65,"column":66}},"32":{"start":{"line":66,"column":24},"end":{"line":66,"column":92}},"33":{"start":{"line":68,"column":24},"end":{"line":70,"column":25}},"34":{"start":{"line":69,"column":28},"end":{"line":69,"column":96}},"35":{"start":{"line":71,"column":24},"end":{"line":71,"column":63}},"36":{"start":{"line":73,"column":24},"end":{"line":73,"column":36}},"37":{"start":{"line":78,"column":12},"end":{"line":78,"column":58}},"38":{"start":{"line":84,"column":0},"end":{"line":97,"column":1}},"39":{"start":{"line":85,"column":4},"end":{"line":96,"column":7}},"40":{"start":{"line":86,"column":8},"end":{"line":86,"column":40}},"41":{"start":{"line":87,"column":8},"end":{"line":95,"column":11}},"42":{"start":{"line":94,"column":12},"end":{"line":94,"column":22}},"43":{"start":{"line":99,"column":0},"end":{"line":114,"column":1}},"44":{"start":{"line":100,"column":4},"end":{"line":100,"column":22}},"45":{"start":{"line":101,"column":4},"end":{"line":112,"column":5}},"46":{"start":{"line":102,"column":8},"end":{"line":102,"column":48}},"47":{"start":{"line":103,"column":8},"end":{"line":111,"column":9}},"48":{"start":{"line":104,"column":12},"end":{"line":104,"column":44}},"49":{"start":{"line":105,"column":12},"end":{"line":107,"column":13}},"50":{"start":{"line":106,"column":16},"end":{"line":106,"column":64}},"51":{"start":{"line":108,"column":12},"end":{"line":110,"column":13}},"52":{"start":{"line":109,"column":16},"end":{"line":109,"column":61}},"53":{"start":{"line":113,"column":4},"end":{"line":113,"column":18}},"54":{"start":{"line":116,"column":0},"end":{"line":123,"column":1}},"55":{"start":{"line":125,"column":0},"end":{"line":132,"column":1}},"56":{"start":{"line":131,"column":4},"end":{"line":131,"column":40}}},"branchMap":{"1":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":45,"column":8}},{"start":{"line":45,"column":8},"end":{"line":45,"column":8}}]},"2":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":12},"end":{"line":46,"column":12}},{"start":{"line":46,"column":12},"end":{"line":46,"column":12}}]},"3":{"line":48,"type":"if","locations":[{"start":{"line":48,"column":19},"end":{"line":48,"column":19}},{"start":{"line":48,"column":19},"end":{"line":48,"column":19}}]},"4":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":8},"end":{"line":57,"column":8}},{"start":{"line":57,"column":8},"end":{"line":57,"column":8}}]},"5":{"line":61,"type":"if","locations":[{"start":{"line":61,"column":16},"end":{"line":61,"column":16}},{"start":{"line":61,"column":16},"end":{"line":61,"column":16}}]},"6":{"line":65,"type":"binary-expr","locations":[{"start":{"line":65,"column":44},"end":{"line":65,"column":61}},{"start":{"line":65,"column":63},"end":{"line":65,"column":65}}]},"7":{"line":68,"type":"if","locations":[{"start":{"line":68,"column":24},"end":{"line":68,"column":24}},{"start":{"line":68,"column":24},"end":{"line":68,"column":24}}]},"8":{"line":101,"type":"if","locations":[{"start":{"line":101,"column":4},"end":{"line":101,"column":4}},{"start":{"line":101,"column":4},"end":{"line":101,"column":4}}]},"9":{"line":103,"type":"if","locations":[{"start":{"line":103,"column":8},"end":{"line":103,"column":8}},{"start":{"line":103,"column":8},"end":{"line":103,"column":8}}]},"10":{"line":105,"type":"if","locations":[{"start":{"line":105,"column":12},"end":{"line":105,"column":12}},{"start":{"line":105,"column":12},"end":{"line":105,"column":12}}]},"11":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":12},"end":{"line":108,"column":12}},{"start":{"line":108,"column":12},"end":{"line":108,"column":12}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var i18n = require(\"i18next\");","var when = require(\"when\");","var path = require(\"path\");","var fs = require(\"fs\");","","var defaultLang = \"en-US\";","","var resourceMap = {};","var resourceCache = {};","","function registerMessageCatalogs(catalogs) {","    var promises = catalogs.map(function(catalog) {","        return registerMessageCatalog(catalog.namespace,catalog.dir,catalog.file);","    });","    return when.settle(promises);","}","","function registerMessageCatalog(namespace,dir,file) {","    return when.promise(function(resolve,reject) {","        resourceMap[namespace] = { basedir:dir, file:file};","        i18n.loadNamespace(namespace,function() {","            resolve();","        });","    });","}","","function mergeCatalog(fallback,catalog) {","    for (var k in fallback) {","        if (fallback.hasOwnProperty(k)) {","            if (!catalog[k]) {","                catalog[k] = fallback[k];","            } else if (typeof fallback[k] === 'object') {","                mergeCatalog(fallback[k],catalog[k]);","            }","        }","    }","}","","var MessageFileLoader = {","    fetchOne: function(lng, ns, callback) {","        if (resourceMap[ns]) {","            var file = path.join(resourceMap[ns].basedir,lng,resourceMap[ns].file);","            //console.log(file);","            fs.readFile(file,\"utf8\",function(err,content) {","                if (err) {","                    callback(err);","                } else {","                    try {","                        resourceCache[ns] = resourceCache[ns]||{};","                        resourceCache[ns][lng] = JSON.parse(content.replace(/^\\uFEFF/, ''));","                        //console.log(resourceCache[ns][lng]);","                        if (lng !== defaultLang) {","                            mergeCatalog(resourceCache[ns][defaultLang],resourceCache[ns][lng]);","                        }","                        callback(null, resourceCache[ns][lng]);","                    } catch(e) {","                        callback(e);","                    }","                }","            });","        } else {","            callback(new Error(\"Unrecognised namespace\"));","        }","    }","","}","","function init() {","    return when.promise(function(resolve,reject) {","        i18n.backend(MessageFileLoader);","        i18n.init({","            ns: {","                namespaces: [],","                defaultNs: \"runtime\"","            },","            fallbackLng: [defaultLang]","        },function() {","            resolve();","        });","    });","}","","function getCatalog(namespace,lang) {","    var result = null;","    if (resourceCache.hasOwnProperty(namespace)) {","        result = resourceCache[namespace][lang];","        if (!result) {","            var langParts = lang.split(\"-\");","            if (langParts.length == 2) {","                result = resourceCache[namespace][langParts[0]];","            }","            if (!result) {","                return resourceCache[namespace][defaultLang];","            }","        }","    }","    return result;","}","","var obj = module.exports = {","    init: init,","    registerMessageCatalog: registerMessageCatalog,","    registerMessageCatalogs: registerMessageCatalogs,","    catalog: getCatalog,","    i: i18n,","    defaultLang: defaultLang","}","","obj['_'] = function() {","    //var opts = {};","    //if (def) {","    //    opts.defaultValue = def;","    //}","    //console.log(arguments);","    return i18n.t.apply(null,arguments);","}",""],"l":{"17":1,"18":1,"19":1,"20":1,"22":1,"24":1,"25":1,"27":1,"28":0,"29":0,"31":0,"34":1,"35":0,"36":0,"37":0,"38":0,"43":1,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"55":1,"57":0,"58":0,"60":0,"61":0,"62":0,"64":0,"65":0,"66":0,"68":0,"69":0,"71":0,"73":0,"78":0,"84":1,"85":0,"86":0,"87":0,"94":0,"99":1,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"108":0,"109":0,"113":0,"116":1,"125":1,"131":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/credentials.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/credentials.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":1,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},"fnMap":{"1":{"name":"decryptCredentials","line":32,"loc":{"start":{"line":32,"column":0},"end":{"line":32,"column":45}}},"2":{"name":"(anonymous_2)","line":42,"loc":{"start":{"line":42,"column":10},"end":{"line":42,"column":28}}},"3":{"name":"(anonymous_3)","line":54,"loc":{"start":{"line":54,"column":10},"end":{"line":54,"column":33}}},"4":{"name":"(anonymous_4)","line":143,"loc":{"start":{"line":143,"column":43},"end":{"line":143,"column":54}}},"5":{"name":"(anonymous_5)","line":165,"loc":{"start":{"line":165,"column":9},"end":{"line":165,"column":30}}},"6":{"name":"(anonymous_6)","line":178,"loc":{"start":{"line":178,"column":9},"end":{"line":178,"column":23}}},"7":{"name":"(anonymous_7)","line":187,"loc":{"start":{"line":187,"column":12},"end":{"line":187,"column":26}}},"8":{"name":"(anonymous_8)","line":197,"loc":{"start":{"line":197,"column":11},"end":{"line":197,"column":29}}},"9":{"name":"(anonymous_9)","line":199,"loc":{"start":{"line":199,"column":23},"end":{"line":199,"column":35}}},"10":{"name":"(anonymous_10)","line":225,"loc":{"start":{"line":225,"column":14},"end":{"line":225,"column":42}}},"11":{"name":"(anonymous_11)","line":242,"loc":{"start":{"line":242,"column":13},"end":{"line":242,"column":28}}},"12":{"name":"(anonymous_12)","line":284,"loc":{"start":{"line":284,"column":19},"end":{"line":284,"column":35}}},"13":{"name":"(anonymous_13)","line":288,"loc":{"start":{"line":288,"column":11},"end":{"line":288,"column":22}}},"14":{"name":"(anonymous_14)","line":292,"loc":{"start":{"line":292,"column":12},"end":{"line":292,"column":23}}},"15":{"name":"(anonymous_15)","line":311,"loc":{"start":{"line":311,"column":61},"end":{"line":311,"column":72}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":31}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":13}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":8}},"5":{"start":{"line":22,"column":0},"end":{"line":22,"column":32}},"6":{"start":{"line":23,"column":0},"end":{"line":23,"column":25}},"7":{"start":{"line":24,"column":0},"end":{"line":24,"column":24}},"8":{"start":{"line":25,"column":0},"end":{"line":25,"column":18}},"9":{"start":{"line":27,"column":0},"end":{"line":27,"column":29}},"10":{"start":{"line":28,"column":0},"end":{"line":28,"column":29}},"11":{"start":{"line":29,"column":0},"end":{"line":29,"column":40}},"12":{"start":{"line":30,"column":0},"end":{"line":30,"column":18}},"13":{"start":{"line":32,"column":0},"end":{"line":39,"column":1}},"14":{"start":{"line":33,"column":4},"end":{"line":33,"column":33}},"15":{"start":{"line":34,"column":4},"end":{"line":34,"column":62}},"16":{"start":{"line":35,"column":4},"end":{"line":35,"column":32}},"17":{"start":{"line":36,"column":4},"end":{"line":36,"column":81}},"18":{"start":{"line":37,"column":4},"end":{"line":37,"column":86}},"19":{"start":{"line":38,"column":4},"end":{"line":38,"column":33}},"20":{"start":{"line":41,"column":0},"end":{"line":319,"column":1}},"21":{"start":{"line":43,"column":8},"end":{"line":43,"column":26}},"22":{"start":{"line":44,"column":8},"end":{"line":44,"column":36}},"23":{"start":{"line":45,"column":8},"end":{"line":45,"column":22}},"24":{"start":{"line":46,"column":8},"end":{"line":46,"column":29}},"25":{"start":{"line":47,"column":8},"end":{"line":47,"column":28}},"26":{"start":{"line":48,"column":8},"end":{"line":48,"column":33}},"27":{"start":{"line":55,"column":8},"end":{"line":55,"column":22}},"28":{"start":{"line":59,"column":8},"end":{"line":59,"column":108}},"29":{"start":{"line":60,"column":8},"end":{"line":60,"column":52}},"30":{"start":{"line":61,"column":8},"end":{"line":139,"column":9}},"31":{"start":{"line":62,"column":12},"end":{"line":62,"column":27}},"32":{"start":{"line":63,"column":12},"end":{"line":66,"column":13}},"33":{"start":{"line":64,"column":16},"end":{"line":64,"column":63}},"34":{"start":{"line":67,"column":12},"end":{"line":69,"column":13}},"35":{"start":{"line":68,"column":16},"end":{"line":68,"column":85}},"36":{"start":{"line":70,"column":12},"end":{"line":70,"column":24}},"37":{"start":{"line":71,"column":12},"end":{"line":75,"column":13}},"38":{"start":{"line":72,"column":16},"end":{"line":72,"column":59}},"39":{"start":{"line":74,"column":16},"end":{"line":74,"column":32}},"40":{"start":{"line":76,"column":12},"end":{"line":138,"column":13}},"41":{"start":{"line":77,"column":16},"end":{"line":77,"column":91}},"42":{"start":{"line":79,"column":16},"end":{"line":79,"column":42}},"43":{"start":{"line":81,"column":16},"end":{"line":93,"column":17}},"44":{"start":{"line":82,"column":20},"end":{"line":82,"column":104}},"45":{"start":{"line":83,"column":20},"end":{"line":90,"column":21}},"46":{"start":{"line":84,"column":24},"end":{"line":89,"column":25}},"47":{"start":{"line":85,"column":28},"end":{"line":85,"column":84}},"48":{"start":{"line":87,"column":28},"end":{"line":87,"column":45}},"49":{"start":{"line":88,"column":28},"end":{"line":88,"column":95}},"50":{"start":{"line":91,"column":20},"end":{"line":91,"column":33}},"51":{"start":{"line":92,"column":20},"end":{"line":92,"column":44}},"52":{"start":{"line":94,"column":19},"end":{"line":138,"column":13}},"53":{"start":{"line":95,"column":16},"end":{"line":95,"column":84}},"54":{"start":{"line":97,"column":16},"end":{"line":97,"column":85}},"55":{"start":{"line":98,"column":16},"end":{"line":98,"column":41}},"56":{"start":{"line":100,"column":16},"end":{"line":114,"column":17}},"57":{"start":{"line":101,"column":20},"end":{"line":101,"column":104}},"58":{"start":{"line":104,"column":20},"end":{"line":111,"column":21}},"59":{"start":{"line":105,"column":24},"end":{"line":110,"column":25}},"60":{"start":{"line":106,"column":28},"end":{"line":106,"column":84}},"61":{"start":{"line":108,"column":28},"end":{"line":108,"column":45}},"62":{"start":{"line":109,"column":28},"end":{"line":109,"column":95}},"63":{"start":{"line":112,"column":20},"end":{"line":112,"column":33}},"64":{"start":{"line":113,"column":20},"end":{"line":113,"column":44}},"65":{"start":{"line":116,"column":16},"end":{"line":116,"column":86}},"66":{"start":{"line":118,"column":16},"end":{"line":118,"column":43}},"67":{"start":{"line":119,"column":16},"end":{"line":119,"column":41}},"68":{"start":{"line":120,"column":16},"end":{"line":137,"column":17}},"69":{"start":{"line":121,"column":20},"end":{"line":121,"column":110}},"70":{"start":{"line":124,"column":20},"end":{"line":124,"column":72}},"71":{"start":{"line":125,"column":20},"end":{"line":133,"column":21}},"72":{"start":{"line":126,"column":24},"end":{"line":126,"column":94}},"73":{"start":{"line":127,"column":24},"end":{"line":127,"column":96}},"74":{"start":{"line":129,"column":24},"end":{"line":129,"column":118}},"75":{"start":{"line":131,"column":24},"end":{"line":131,"column":50}},"76":{"start":{"line":132,"column":24},"end":{"line":132,"column":45}},"77":{"start":{"line":134,"column":20},"end":{"line":134,"column":33}},"78":{"start":{"line":136,"column":20},"end":{"line":136,"column":88}},"79":{"start":{"line":140,"column":8},"end":{"line":142,"column":9}},"80":{"start":{"line":141,"column":12},"end":{"line":141,"column":47}},"81":{"start":{"line":143,"column":8},"end":{"line":156,"column":11}},"82":{"start":{"line":144,"column":12},"end":{"line":155,"column":13}},"83":{"start":{"line":146,"column":16},"end":{"line":152,"column":17}},"84":{"start":{"line":147,"column":20},"end":{"line":147,"column":83}},"85":{"start":{"line":149,"column":20},"end":{"line":149,"column":41}},"86":{"start":{"line":150,"column":20},"end":{"line":150,"column":33}},"87":{"start":{"line":151,"column":20},"end":{"line":151,"column":87}},"88":{"start":{"line":154,"column":16},"end":{"line":154,"column":46}},"89":{"start":{"line":166,"column":8},"end":{"line":169,"column":9}},"90":{"start":{"line":167,"column":12},"end":{"line":167,"column":40}},"91":{"start":{"line":168,"column":12},"end":{"line":168,"column":25}},"92":{"start":{"line":170,"column":8},"end":{"line":170,"column":30}},"93":{"start":{"line":179,"column":8},"end":{"line":179,"column":35}},"94":{"start":{"line":188,"column":8},"end":{"line":188,"column":35}},"95":{"start":{"line":189,"column":8},"end":{"line":189,"column":21}},"96":{"start":{"line":198,"column":8},"end":{"line":198,"column":29}},"97":{"start":{"line":199,"column":8},"end":{"line":204,"column":11}},"98":{"start":{"line":200,"column":12},"end":{"line":200,"column":37}},"99":{"start":{"line":201,"column":12},"end":{"line":203,"column":13}},"100":{"start":{"line":202,"column":16},"end":{"line":202,"column":31}},"101":{"start":{"line":205,"column":8},"end":{"line":205,"column":39}},"102":{"start":{"line":206,"column":8},"end":{"line":213,"column":9}},"103":{"start":{"line":207,"column":12},"end":{"line":212,"column":13}},"104":{"start":{"line":208,"column":16},"end":{"line":211,"column":17}},"105":{"start":{"line":209,"column":20},"end":{"line":209,"column":46}},"106":{"start":{"line":210,"column":20},"end":{"line":210,"column":46}},"107":{"start":{"line":214,"column":8},"end":{"line":216,"column":9}},"108":{"start":{"line":215,"column":12},"end":{"line":215,"column":25}},"109":{"start":{"line":217,"column":8},"end":{"line":217,"column":30}},"110":{"start":{"line":226,"column":8},"end":{"line":226,"column":51}},"111":{"start":{"line":227,"column":8},"end":{"line":227,"column":48}},"112":{"start":{"line":243,"column":8},"end":{"line":243,"column":29}},"113":{"start":{"line":244,"column":8},"end":{"line":244,"column":33}},"114":{"start":{"line":245,"column":8},"end":{"line":245,"column":40}},"115":{"start":{"line":246,"column":8},"end":{"line":276,"column":9}},"116":{"start":{"line":247,"column":12},"end":{"line":247,"column":36}},"117":{"start":{"line":248,"column":12},"end":{"line":248,"column":65}},"118":{"start":{"line":249,"column":12},"end":{"line":249,"column":59}},"119":{"start":{"line":250,"column":12},"end":{"line":250,"column":56}},"120":{"start":{"line":251,"column":12},"end":{"line":254,"column":13}},"121":{"start":{"line":252,"column":16},"end":{"line":252,"column":84}},"122":{"start":{"line":253,"column":16},"end":{"line":253,"column":23}},"123":{"start":{"line":256,"column":12},"end":{"line":274,"column":13}},"124":{"start":{"line":257,"column":16},"end":{"line":273,"column":17}},"125":{"start":{"line":258,"column":20},"end":{"line":260,"column":21}},"126":{"start":{"line":259,"column":24},"end":{"line":259,"column":33}},"127":{"start":{"line":261,"column":20},"end":{"line":263,"column":21}},"128":{"start":{"line":262,"column":24},"end":{"line":262,"column":33}},"129":{"start":{"line":264,"column":20},"end":{"line":268,"column":21}},"130":{"start":{"line":265,"column":24},"end":{"line":265,"column":54}},"131":{"start":{"line":266,"column":24},"end":{"line":266,"column":37}},"132":{"start":{"line":267,"column":24},"end":{"line":267,"column":33}},"133":{"start":{"line":269,"column":20},"end":{"line":272,"column":21}},"134":{"start":{"line":270,"column":24},"end":{"line":270,"column":64}},"135":{"start":{"line":271,"column":24},"end":{"line":271,"column":37}},"136":{"start":{"line":275,"column":12},"end":{"line":275,"column":55}},"137":{"start":{"line":285,"column":8},"end":{"line":285,"column":36}},"138":{"start":{"line":289,"column":8},"end":{"line":289,"column":21}},"139":{"start":{"line":293,"column":8},"end":{"line":293,"column":37}},"140":{"start":{"line":294,"column":8},"end":{"line":307,"column":9}},"141":{"start":{"line":295,"column":12},"end":{"line":306,"column":13}},"142":{"start":{"line":296,"column":16},"end":{"line":303,"column":17}},"143":{"start":{"line":297,"column":20},"end":{"line":297,"column":83}},"144":{"start":{"line":298,"column":20},"end":{"line":298,"column":60}},"145":{"start":{"line":299,"column":20},"end":{"line":299,"column":103}},"146":{"start":{"line":300,"column":20},"end":{"line":300,"column":154}},"147":{"start":{"line":302,"column":20},"end":{"line":302,"column":94}},"148":{"start":{"line":305,"column":16},"end":{"line":305,"column":46}},"149":{"start":{"line":308,"column":8},"end":{"line":308,"column":22}},"150":{"start":{"line":309,"column":8},"end":{"line":317,"column":9}},"151":{"start":{"line":310,"column":12},"end":{"line":310,"column":92}},"152":{"start":{"line":311,"column":12},"end":{"line":314,"column":14}},"153":{"start":{"line":312,"column":16},"end":{"line":312,"column":41}},"154":{"start":{"line":313,"column":16},"end":{"line":313,"column":30}},"155":{"start":{"line":316,"column":12},"end":{"line":316,"column":40}}},"branchMap":{"1":{"line":59,"type":"binary-expr","locations":[{"start":{"line":59,"column":35},"end":{"line":59,"column":66}},{"start":{"line":59,"column":70},"end":{"line":59,"column":107}}]},"2":{"line":61,"type":"if","locations":[{"start":{"line":61,"column":8},"end":{"line":61,"column":8}},{"start":{"line":61,"column":8},"end":{"line":61,"column":8}}]},"3":{"line":67,"type":"if","locations":[{"start":{"line":67,"column":12},"end":{"line":67,"column":12}},{"start":{"line":67,"column":12},"end":{"line":67,"column":12}}]},"4":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":12},"end":{"line":76,"column":12}},{"start":{"line":76,"column":12},"end":{"line":76,"column":12}}]},"5":{"line":81,"type":"if","locations":[{"start":{"line":81,"column":16},"end":{"line":81,"column":16}},{"start":{"line":81,"column":16},"end":{"line":81,"column":16}}]},"6":{"line":83,"type":"if","locations":[{"start":{"line":83,"column":20},"end":{"line":83,"column":20}},{"start":{"line":83,"column":20},"end":{"line":83,"column":20}}]},"7":{"line":94,"type":"if","locations":[{"start":{"line":94,"column":19},"end":{"line":94,"column":19}},{"start":{"line":94,"column":19},"end":{"line":94,"column":19}}]},"8":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":16},"end":{"line":100,"column":16}},{"start":{"line":100,"column":16},"end":{"line":100,"column":16}}]},"9":{"line":104,"type":"if","locations":[{"start":{"line":104,"column":20},"end":{"line":104,"column":20}},{"start":{"line":104,"column":20},"end":{"line":104,"column":20}}]},"10":{"line":120,"type":"if","locations":[{"start":{"line":120,"column":16},"end":{"line":120,"column":16}},{"start":{"line":120,"column":16},"end":{"line":120,"column":16}}]},"11":{"line":140,"type":"if","locations":[{"start":{"line":140,"column":8},"end":{"line":140,"column":8}},{"start":{"line":140,"column":8},"end":{"line":140,"column":8}}]},"12":{"line":140,"type":"binary-expr","locations":[{"start":{"line":140,"column":12},"end":{"line":140,"column":29}},{"start":{"line":140,"column":33},"end":{"line":140,"column":39}}]},"13":{"line":144,"type":"if","locations":[{"start":{"line":144,"column":12},"end":{"line":144,"column":12}},{"start":{"line":144,"column":12},"end":{"line":144,"column":12}}]},"14":{"line":166,"type":"if","locations":[{"start":{"line":166,"column":8},"end":{"line":166,"column":8}},{"start":{"line":166,"column":8},"end":{"line":166,"column":8}}]},"15":{"line":166,"type":"binary-expr","locations":[{"start":{"line":166,"column":12},"end":{"line":166,"column":47}},{"start":{"line":166,"column":51},"end":{"line":166,"column":112}}]},"16":{"line":201,"type":"if","locations":[{"start":{"line":201,"column":12},"end":{"line":201,"column":12}},{"start":{"line":201,"column":12},"end":{"line":201,"column":12}}]},"17":{"line":207,"type":"if","locations":[{"start":{"line":207,"column":12},"end":{"line":207,"column":12}},{"start":{"line":207,"column":12},"end":{"line":207,"column":12}}]},"18":{"line":208,"type":"if","locations":[{"start":{"line":208,"column":16},"end":{"line":208,"column":16}},{"start":{"line":208,"column":16},"end":{"line":208,"column":16}}]},"19":{"line":214,"type":"if","locations":[{"start":{"line":214,"column":8},"end":{"line":214,"column":8}},{"start":{"line":214,"column":8},"end":{"line":214,"column":8}}]},"20":{"line":246,"type":"if","locations":[{"start":{"line":246,"column":8},"end":{"line":246,"column":8}},{"start":{"line":246,"column":8},"end":{"line":246,"column":8}}]},"21":{"line":248,"type":"binary-expr","locations":[{"start":{"line":248,"column":35},"end":{"line":248,"column":58}},{"start":{"line":248,"column":62},"end":{"line":248,"column":64}}]},"22":{"line":251,"type":"if","locations":[{"start":{"line":251,"column":12},"end":{"line":251,"column":12}},{"start":{"line":251,"column":12},"end":{"line":251,"column":12}}]},"23":{"line":257,"type":"if","locations":[{"start":{"line":257,"column":16},"end":{"line":257,"column":16}},{"start":{"line":257,"column":16},"end":{"line":257,"column":16}}]},"24":{"line":258,"type":"if","locations":[{"start":{"line":258,"column":20},"end":{"line":258,"column":20}},{"start":{"line":258,"column":20},"end":{"line":258,"column":20}}]},"25":{"line":261,"type":"if","locations":[{"start":{"line":261,"column":20},"end":{"line":261,"column":20}},{"start":{"line":261,"column":20},"end":{"line":261,"column":20}}]},"26":{"line":261,"type":"binary-expr","locations":[{"start":{"line":261,"column":24},"end":{"line":261,"column":59}},{"start":{"line":261,"column":63},"end":{"line":261,"column":91}}]},"27":{"line":264,"type":"if","locations":[{"start":{"line":264,"column":20},"end":{"line":264,"column":20}},{"start":{"line":264,"column":20},"end":{"line":264,"column":20}}]},"28":{"line":264,"type":"binary-expr","locations":[{"start":{"line":264,"column":24},"end":{"line":264,"column":51}},{"start":{"line":264,"column":55},"end":{"line":264,"column":83}}]},"29":{"line":269,"type":"if","locations":[{"start":{"line":269,"column":20},"end":{"line":269,"column":20}},{"start":{"line":269,"column":20},"end":{"line":269,"column":20}}]},"30":{"line":269,"type":"binary-expr","locations":[{"start":{"line":269,"column":24},"end":{"line":269,"column":62}},{"start":{"line":269,"column":66},"end":{"line":269,"column":139}}]},"31":{"line":294,"type":"if","locations":[{"start":{"line":294,"column":8},"end":{"line":294,"column":8}},{"start":{"line":294,"column":8},"end":{"line":294,"column":8}}]},"32":{"line":295,"type":"if","locations":[{"start":{"line":295,"column":12},"end":{"line":295,"column":12}},{"start":{"line":295,"column":12},"end":{"line":295,"column":12}}]},"33":{"line":309,"type":"if","locations":[{"start":{"line":309,"column":8},"end":{"line":309,"column":8}},{"start":{"line":309,"column":8},"end":{"line":309,"column":8}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var when = require(\"when\");","var crypto = require('crypto');","var settings;","var log;","","var encryptedCredentials = null;","var credentialCache = {};","var credentialsDef = {};","var dirty = false;","","var removeDefaultKey = false;","var encryptionEnabled = null;","var encryptionAlgorithm = \"aes-256-ctr\";","var encryptionKey;","","function decryptCredentials(key,credentials) {","    var creds = credentials[\"$\"];","    var initVector = new Buffer(creds.substring(0, 32),'hex');","    creds = creds.substring(32);","    var decipher = crypto.createDecipheriv(encryptionAlgorithm, key, initVector);","    var decrypted = decipher.update(creds, 'base64', 'utf8') + decipher.final('utf8');","    return JSON.parse(decrypted);","}","","var api = module.exports = {","    init: function(runtime) {","        log = runtime.log;","        settings = runtime.settings;","        dirty = false;","        credentialCache = {};","        credentialsDef = {};","        encryptionEnabled = null;","    },","","    /**","     * Sets the credentials from storage.","     */","    load: function (credentials) {","        dirty = false;","        /*","          - if encryptionEnabled === null, check the current configuration","        */","        var credentialsEncrypted = credentials.hasOwnProperty(\"$\") && Object.keys(credentials).length === 1;","        var setupEncryptionPromise = when.resolve();","        if (encryptionEnabled === null) {","            var defaultKey;","            try {","                defaultKey = settings.get('_credentialSecret');","            } catch(err) {","            }","            if (defaultKey) {","                defaultKey = crypto.createHash('sha256').update(defaultKey).digest();","            }","            var userKey;","            try {","                userKey = settings.get('credentialSecret');","            } catch(err) {","                userKey = false;","            }","            if (userKey === false) {","                log.debug(\"red/runtime/nodes/credentials.load : user disabled encryption\");","                // User has disabled encryption","                encryptionEnabled = false;","                // Check if we have a generated _credSecret to decrypt with and remove","                if (defaultKey) {","                    log.debug(\"red/runtime/nodes/credentials.load : default key present. Will migrate\");","                    if (credentialsEncrypted) {","                        try {","                            credentials = decryptCredentials(defaultKey,credentials)","                        } catch(err) {","                            credentials = {};","                            log.warn(log._(\"nodes.credentials.error\",{message:err.toString()}))","                        }","                    }","                    dirty = true;","                    removeDefaultKey = true;","                }","            } else if (typeof userKey === 'string') {","                log.debug(\"red/runtime/nodes/credentials.load : user provided key\");","                // User has provided own encryption key, get the 32-byte hash of it","                encryptionKey = crypto.createHash('sha256').update(userKey).digest();","                encryptionEnabled = true;","","                if (defaultKey) {","                    log.debug(\"red/runtime/nodes/credentials.load : default key present. Will migrate\");","                    // User has provided their own key, but we already have a default key","                    // Decrypt using default key","                    if (credentialsEncrypted) {","                        try {","                            credentials = decryptCredentials(defaultKey,credentials)","                        } catch(err) {","                            credentials = {};","                            log.warn(log._(\"nodes.credentials.error\",{message:err.toString()}))","                        }","                    }","                    dirty = true;","                    removeDefaultKey = true;","                }","            } else {","                log.debug(\"red/runtime/nodes/credentials.load : no user key present\");","                // User has not provide their own key","                encryptionKey = defaultKey;","                encryptionEnabled = true;","                if (encryptionKey === undefined) {","                    log.debug(\"red/runtime/nodes/credentials.load : no default key present - generating one\");","                    // No user-provided key, no generated key","                    // Generate a new key","                    defaultKey = crypto.randomBytes(32).toString('hex');","                    try {","                        setupEncryptionPromise = settings.set('_credentialSecret',defaultKey);","                        encryptionKey = crypto.createHash('sha256').update(defaultKey).digest();","                    } catch(err) {","                        log.debug(\"red/runtime/nodes/credentials.load : settings unavailable - disabling encryption\");","                        // Settings unavailable","                        encryptionEnabled = false;","                        encryptionKey = null;","                    }","                    dirty = true;","                } else {","                    log.debug(\"red/runtime/nodes/credentials.load : using default key\");","                }","            }","        }","        if (encryptionEnabled && !dirty) {","            encryptedCredentials = credentials;","        }","        return setupEncryptionPromise.then(function() {","            if (credentials.hasOwnProperty(\"$\")) {","                // These are encrypted credentials","                try {","                    credentialCache = decryptCredentials(encryptionKey,credentials)","                } catch(err) {","                    credentialCache = {};","                    dirty = true;","                    log.warn(log._(\"nodes.credentials.error\",{message:err.toString()}))","                }","            } else {","                credentialCache = credentials;","            }","        });","    },","","    /**","     * Adds a set of credentials for the given node id.","     * @param id the node id for the credentials","     * @param creds an object of credential key/value pairs","     * @return a promise for backwards compatibility TODO: can this be removed?","     */","    add: function (id, creds) {","        if (!credentialCache.hasOwnProperty(id) || JSON.stringify(creds) !== JSON.stringify(credentialCache[id])) {","            credentialCache[id] = creds;","            dirty = true;","        }","        return when.resolve();","    },","","    /**","     * Gets the credentials for the given node id.","     * @param id the node id for the credentials","     * @return the credentials","     */","    get: function (id) {","        return credentialCache[id];","    },","","    /**","     * Deletes the credentials for the given node id.","     * @param id the node id for the credentials","     * @return a promise for the saving of credentials to storage","     */","    delete: function (id) {","        delete credentialCache[id];","        dirty = true;","    },","","    /**","     * Deletes any credentials for nodes that no longer exist","     * @param config a flow config","     * @return a promise for the saving of credentials to storage","     */","    clean: function (config) {","        var existingIds = {};","        config.forEach(function(n) {","            existingIds[n.id] = true;","            if (n.credentials) {","                api.extract(n);","            }","        });","        var deletedCredentials = false;","        for (var c in credentialCache) {","            if (credentialCache.hasOwnProperty(c)) {","                if (!existingIds[c]) {","                    deletedCredentials = true;","                    delete credentialCache[c];","                }","            }","        }","        if (deletedCredentials) {","            dirty = true;","        }","        return when.resolve();","    },","","    /**","     * Registers a node credential definition.","     * @param type the node type","     * @param definition the credential definition","     */","    register: function (type, definition) {","        var dashedType = type.replace(/\\s+/g, '-');","        credentialsDef[dashedType] = definition;","    },","","    /**","     * Extracts and stores any credential updates in the provided node.","     * The provided node may have a .credentials property that contains","     * new credentials for the node.","     * This function loops through the credentials in the definition for","     * the node-type and applies any of the updates provided in the node.","     *","     * This function does not save the credentials to disk as it is expected","     * to be called multiple times when a new flow is deployed.","     *","     * @param node the node to extract credentials from","     */","    extract: function(node) {","        var nodeID = node.id;","        var nodeType = node.type;","        var newCreds = node.credentials;","        if (newCreds) {","            delete node.credentials;","            var savedCredentials = credentialCache[nodeID] || {};","            var dashedType = nodeType.replace(/\\s+/g, '-');","            var definition = credentialsDef[dashedType];","            if (!definition) {","                log.warn(log._(\"nodes.credentials.not-registered\",{type:nodeType}));","                return;","            }","","            for (var cred in definition) {","                if (definition.hasOwnProperty(cred)) {","                    if (newCreds[cred] === undefined) {","                        continue;","                    }","                    if (definition[cred].type == \"password\" && newCreds[cred] == '__PWRD__') {","                        continue;","                    }","                    if (0 === newCreds[cred].length || /^\\s*$/.test(newCreds[cred])) {","                        delete savedCredentials[cred];","                        dirty = true;","                        continue;","                    }","                    if (!savedCredentials.hasOwnProperty(cred) || JSON.stringify(savedCredentials[cred]) !== JSON.stringify(newCreds[cred])) {","                        savedCredentials[cred] = newCreds[cred];","                        dirty = true;","                    }","                }","            }","            credentialCache[nodeID] = savedCredentials;","        }","    },","","    /**","     * Gets the credential definition for the given node type","     * @param type the node type","     * @return the credential definition","     */","    getDefinition: function (type) {","        return credentialsDef[type];","    },","","    dirty: function() {","        return dirty;","    },","","    export: function() {","        var result = credentialCache;","        if (encryptionEnabled) {","            if (dirty) {","                try {","                    log.debug(\"red/runtime/nodes/credentials.export : encrypting\");","                    var initVector = crypto.randomBytes(16);","                    var cipher = crypto.createCipheriv(encryptionAlgorithm, encryptionKey, initVector);","                    result = {\"$\":initVector.toString('hex') + cipher.update(JSON.stringify(credentialCache), 'utf8', 'base64') + cipher.final('base64')};","                } catch(err) {","                    log.warn(log._(\"nodes.credentials.error-saving\",{message:err.toString()}))","                }","            } else {","                result = encryptedCredentials;","            }","        }","        dirty = false;","        if (removeDefaultKey) {","            log.debug(\"red/runtime/nodes/credentials.export : removing unused default key\");","            return settings.delete('_credentialSecret').then(function() {","                removeDefaultKey = false;","                return result;","            })","        } else {","            return when.resolve(result);","        }","    }","}",""],"l":{"17":1,"18":1,"19":1,"20":1,"22":1,"23":1,"24":1,"25":1,"27":1,"28":1,"29":1,"30":1,"32":1,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"41":1,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"55":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"67":0,"68":0,"70":0,"71":0,"72":0,"74":0,"76":0,"77":0,"79":0,"81":0,"82":0,"83":0,"84":0,"85":0,"87":0,"88":0,"91":0,"92":0,"94":0,"95":0,"97":0,"98":0,"100":0,"101":0,"104":0,"105":0,"106":0,"108":0,"109":0,"112":0,"113":0,"116":0,"118":0,"119":0,"120":0,"121":0,"124":0,"125":0,"126":0,"127":0,"129":0,"131":0,"132":0,"134":0,"136":0,"140":0,"141":0,"143":0,"144":0,"146":0,"147":0,"149":0,"150":0,"151":0,"154":0,"166":0,"167":0,"168":0,"170":0,"179":0,"188":0,"189":0,"198":0,"199":0,"200":0,"201":0,"202":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"214":0,"215":0,"217":0,"226":0,"227":0,"243":0,"244":0,"245":0,"246":0,"247":0,"248":0,"249":0,"250":0,"251":0,"252":0,"253":0,"256":0,"257":0,"258":0,"259":0,"261":0,"262":0,"264":0,"265":0,"266":0,"267":0,"269":0,"270":0,"271":0,"275":0,"285":0,"289":0,"293":0,"294":0,"295":0,"296":0,"297":0,"298":0,"299":0,"300":0,"302":0,"305":0,"308":0,"309":0,"310":0,"311":0,"312":0,"313":0,"316":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/flows/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/flows/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":1,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":1,"46":0,"47":1,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":1,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":1,"91":0,"92":0,"93":0,"94":1,"95":0,"96":1,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":1,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":1,"112":0,"113":0,"114":0,"115":0,"116":1,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":1,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":0,"164":0,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"176":0,"177":0,"178":0,"179":1,"180":0,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"187":0,"188":0,"189":0,"190":0,"191":0,"192":0,"193":0,"194":0,"195":0,"196":0,"197":0,"198":0,"199":0,"200":0,"201":0,"202":0,"203":0,"204":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"211":0,"212":1,"213":0,"214":0,"215":0,"216":0,"217":0,"218":0,"219":0,"220":0,"221":0,"222":0,"223":0,"224":0,"225":0,"226":0,"227":0,"228":0,"229":1,"230":0,"231":0,"232":0,"233":0,"234":0,"235":0,"236":0,"237":0,"238":0,"239":0,"240":1,"241":0,"242":0,"243":0,"244":0,"245":0,"246":0,"247":0,"248":0,"249":0,"250":0,"251":0,"252":0,"253":0,"254":0,"255":0,"256":0,"257":0,"258":0,"259":0,"260":0,"261":0,"262":0,"263":0,"264":0,"265":0,"266":0,"267":0,"268":1,"269":0,"270":0,"271":0,"272":0,"273":0,"274":0,"275":0,"276":0,"277":0,"278":0,"279":0,"280":0,"281":0,"282":0,"283":0,"284":0,"285":0,"286":0,"287":0,"288":0,"289":0,"290":0,"291":0,"292":0,"293":0,"294":0,"295":0,"296":0,"297":0,"298":0,"299":0,"300":0,"301":0,"302":0,"303":0,"304":0,"305":0,"306":0,"307":0,"308":0,"309":0,"310":1,"311":0,"312":0,"313":0,"314":0,"315":0,"316":0,"317":0,"318":0,"319":0,"320":0,"321":0,"322":0,"323":0,"324":0,"325":0,"326":0,"327":0,"328":0,"329":0,"330":0,"331":0,"332":0,"333":0,"334":0,"335":0,"336":0,"337":0,"338":0,"339":1,"340":0,"341":0,"342":0,"343":0,"344":0,"345":0,"346":0,"347":0,"348":0,"349":0,"350":0,"351":0,"352":1,"353":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0],"56":[0,0],"57":[0,0],"58":[0,0],"59":[0,0],"60":[0,0],"61":[0,0],"62":[0,0],"63":[0,0],"64":[0,0],"65":[0,0],"66":[0,0],"67":[0,0],"68":[0,0,0,0],"69":[0,0],"70":[0,0],"71":[0,0],"72":[0,0],"73":[0,0],"74":[0,0],"75":[0,0],"76":[0,0],"77":[0,0],"78":[0,0],"79":[0,0],"80":[0,0],"81":[0,0],"82":[0,0],"83":[0,0],"84":[0,0],"85":[0,0],"86":[0,0],"87":[0,0],"88":[0,0],"89":[0,0],"90":[0,0],"91":[0,0],"92":[0,0],"93":[0,0],"94":[0,0,0],"95":[0,0],"96":[0,0],"97":[0,0],"98":[0,0],"99":[0,0],"100":[0,0],"101":[0,0],"102":[0,0],"103":[0,0],"104":[0,0],"105":[0,0],"106":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0},"fnMap":{"1":{"name":"init","line":46,"loc":{"start":{"line":46,"column":0},"end":{"line":46,"column":23}}},"2":{"name":"(anonymous_2)","line":54,"loc":{"start":{"line":54,"column":36},"end":{"line":54,"column":51}}},"3":{"name":"loadFlows","line":71,"loc":{"start":{"line":71,"column":0},"end":{"line":71,"column":21}}},"4":{"name":"(anonymous_4)","line":72,"loc":{"start":{"line":72,"column":35},"end":{"line":72,"column":52}}},"5":{"name":"(anonymous_5)","line":74,"loc":{"start":{"line":74,"column":57},"end":{"line":74,"column":68}}},"6":{"name":"(anonymous_6)","line":77,"loc":{"start":{"line":77,"column":17},"end":{"line":77,"column":31}}},"7":{"name":"load","line":82,"loc":{"start":{"line":82,"column":0},"end":{"line":82,"column":16}}},"8":{"name":"setFlows","line":91,"loc":{"start":{"line":91,"column":0},"end":{"line":91,"column":40}}},"9":{"name":"(anonymous_9)","line":101,"loc":{"start":{"line":101,"column":45},"end":{"line":101,"column":63}}},"10":{"name":"(anonymous_10)","line":115,"loc":{"start":{"line":115,"column":54},"end":{"line":115,"column":70}}},"11":{"name":"(anonymous_11)","line":126,"loc":{"start":{"line":126,"column":14},"end":{"line":126,"column":37}}},"12":{"name":"(anonymous_12)","line":136,"loc":{"start":{"line":136,"column":52},"end":{"line":136,"column":63}}},"13":{"name":"(anonymous_13)","line":140,"loc":{"start":{"line":140,"column":29},"end":{"line":140,"column":43}}},"14":{"name":"getNode","line":146,"loc":{"start":{"line":146,"column":0},"end":{"line":146,"column":21}}},"15":{"name":"eachNode","line":162,"loc":{"start":{"line":162,"column":0},"end":{"line":162,"column":22}}},"16":{"name":"getFlows","line":170,"loc":{"start":{"line":170,"column":0},"end":{"line":170,"column":20}}},"17":{"name":"delegateError","line":174,"loc":{"start":{"line":174,"column":0},"end":{"line":174,"column":44}}},"18":{"name":"(anonymous_18)","line":180,"loc":{"start":{"line":180,"column":48},"end":{"line":180,"column":60}}},"19":{"name":"handleError","line":185,"loc":{"start":{"line":185,"column":0},"end":{"line":185,"column":42}}},"20":{"name":"(anonymous_20)","line":190,"loc":{"start":{"line":190,"column":61},"end":{"line":190,"column":74}}},"21":{"name":"delegateStatus","line":198,"loc":{"start":{"line":198,"column":0},"end":{"line":198,"column":44}}},"22":{"name":"handleStatus","line":205,"loc":{"start":{"line":205,"column":0},"end":{"line":205,"column":42}}},"23":{"name":"(anonymous_23)","line":214,"loc":{"start":{"line":214,"column":61},"end":{"line":214,"column":74}}},"24":{"name":"start","line":223,"loc":{"start":{"line":223,"column":0},"end":{"line":223,"column":34}}},"25":{"name":"(anonymous_25)","line":286,"loc":{"start":{"line":286,"column":45},"end":{"line":286,"column":59}}},"26":{"name":"stop","line":309,"loc":{"start":{"line":309,"column":0},"end":{"line":309,"column":33}}},"27":{"name":"(anonymous_27)","line":335,"loc":{"start":{"line":335,"column":24},"end":{"line":335,"column":49}}},"28":{"name":"(anonymous_28)","line":336,"loc":{"start":{"line":336,"column":35},"end":{"line":336,"column":46}}},"29":{"name":"(anonymous_29)","line":345,"loc":{"start":{"line":345,"column":33},"end":{"line":345,"column":46}}},"30":{"name":"checkTypeInUse","line":367,"loc":{"start":{"line":367,"column":0},"end":{"line":367,"column":28}}},"31":{"name":"(anonymous_31)","line":374,"loc":{"start":{"line":374,"column":29},"end":{"line":374,"column":41}}},"32":{"name":"(anonymous_32)","line":378,"loc":{"start":{"line":378,"column":31},"end":{"line":378,"column":43}}},"33":{"name":"updateMissingTypes","line":392,"loc":{"start":{"line":392,"column":0},"end":{"line":392,"column":30}}},"34":{"name":"addFlow","line":411,"loc":{"start":{"line":411,"column":0},"end":{"line":411,"column":23}}},"35":{"name":"(anonymous_35)","line":453,"loc":{"start":{"line":453,"column":49},"end":{"line":453,"column":60}}},"36":{"name":"getFlow","line":459,"loc":{"start":{"line":459,"column":0},"end":{"line":459,"column":21}}},"37":{"name":"(anonymous_37)","line":481,"loc":{"start":{"line":481,"column":39},"end":{"line":481,"column":56}}},"38":{"name":"(anonymous_38)","line":492,"loc":{"start":{"line":492,"column":39},"end":{"line":492,"column":58}}},"39":{"name":"(anonymous_39)","line":501,"loc":{"start":{"line":501,"column":41},"end":{"line":501,"column":61}}},"40":{"name":"(anonymous_40)","line":504,"loc":{"start":{"line":504,"column":40},"end":{"line":504,"column":53}}},"41":{"name":"(anonymous_41)","line":509,"loc":{"start":{"line":509,"column":48},"end":{"line":509,"column":61}}},"42":{"name":"updateFlow","line":523,"loc":{"start":{"line":523,"column":0},"end":{"line":523,"column":32}}},"43":{"name":"(anonymous_43)","line":540,"loc":{"start":{"line":540,"column":37},"end":{"line":540,"column":52}}},"44":{"name":"(anonymous_44)","line":548,"loc":{"start":{"line":548,"column":37},"end":{"line":548,"column":50}}},"45":{"name":"(anonymous_45)","line":556,"loc":{"start":{"line":556,"column":37},"end":{"line":556,"column":52}}},"46":{"name":"(anonymous_46)","line":565,"loc":{"start":{"line":565,"column":22},"end":{"line":565,"column":34}}},"47":{"name":"(anonymous_47)","line":571,"loc":{"start":{"line":571,"column":49},"end":{"line":571,"column":60}}},"48":{"name":"removeFlow","line":576,"loc":{"start":{"line":576,"column":0},"end":{"line":576,"column":24}}},"49":{"name":"(anonymous_49)","line":589,"loc":{"start":{"line":589,"column":33},"end":{"line":589,"column":48}}},"50":{"name":"(anonymous_50)","line":593,"loc":{"start":{"line":593,"column":49},"end":{"line":593,"column":60}}},"51":{"name":"(anonymous_51)","line":634,"loc":{"start":{"line":634,"column":15},"end":{"line":634,"column":18}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":29}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"3":{"start":{"line":20,"column":0},"end":{"line":20,"column":29}},"4":{"start":{"line":22,"column":0},"end":{"line":22,"column":42}},"5":{"start":{"line":23,"column":0},"end":{"line":23,"column":35}},"6":{"start":{"line":24,"column":0},"end":{"line":24,"column":44}},"7":{"start":{"line":26,"column":0},"end":{"line":26,"column":33}},"8":{"start":{"line":27,"column":0},"end":{"line":27,"column":31}},"9":{"start":{"line":28,"column":0},"end":{"line":28,"column":37}},"10":{"start":{"line":29,"column":0},"end":{"line":29,"column":36}},"11":{"start":{"line":30,"column":0},"end":{"line":30,"column":51}},"12":{"start":{"line":32,"column":0},"end":{"line":32,"column":19}},"13":{"start":{"line":33,"column":0},"end":{"line":33,"column":20}},"14":{"start":{"line":35,"column":0},"end":{"line":35,"column":24}},"15":{"start":{"line":36,"column":0},"end":{"line":36,"column":28}},"16":{"start":{"line":38,"column":0},"end":{"line":38,"column":21}},"17":{"start":{"line":39,"column":0},"end":{"line":39,"column":20}},"18":{"start":{"line":41,"column":0},"end":{"line":41,"column":27}},"19":{"start":{"line":42,"column":0},"end":{"line":42,"column":32}},"20":{"start":{"line":44,"column":0},"end":{"line":44,"column":32}},"21":{"start":{"line":46,"column":0},"end":{"line":69,"column":1}},"22":{"start":{"line":47,"column":4},"end":{"line":49,"column":5}},"23":{"start":{"line":48,"column":8},"end":{"line":48,"column":54}},"24":{"start":{"line":50,"column":4},"end":{"line":50,"column":32}},"25":{"start":{"line":51,"column":4},"end":{"line":51,"column":30}},"26":{"start":{"line":52,"column":4},"end":{"line":52,"column":20}},"27":{"start":{"line":53,"column":4},"end":{"line":68,"column":5}},"28":{"start":{"line":54,"column":8},"end":{"line":66,"column":11}},"29":{"start":{"line":55,"column":12},"end":{"line":65,"column":13}},"30":{"start":{"line":56,"column":16},"end":{"line":56,"column":68}},"31":{"start":{"line":57,"column":16},"end":{"line":64,"column":17}},"32":{"start":{"line":58,"column":20},"end":{"line":58,"column":83}},"33":{"start":{"line":59,"column":20},"end":{"line":59,"column":62}},"34":{"start":{"line":60,"column":20},"end":{"line":63,"column":21}},"35":{"start":{"line":61,"column":24},"end":{"line":61,"column":74}},"36":{"start":{"line":62,"column":24},"end":{"line":62,"column":32}},"37":{"start":{"line":67,"column":8},"end":{"line":67,"column":35}},"38":{"start":{"line":71,"column":0},"end":{"line":81,"column":1}},"39":{"start":{"line":72,"column":4},"end":{"line":80,"column":7}},"40":{"start":{"line":73,"column":8},"end":{"line":73,"column":55}},"41":{"start":{"line":74,"column":8},"end":{"line":76,"column":11}},"42":{"start":{"line":75,"column":12},"end":{"line":75,"column":26}},"43":{"start":{"line":78,"column":8},"end":{"line":78,"column":70}},"44":{"start":{"line":79,"column":8},"end":{"line":79,"column":31}},"45":{"start":{"line":82,"column":0},"end":{"line":84,"column":1}},"46":{"start":{"line":83,"column":4},"end":{"line":83,"column":39}},"47":{"start":{"line":91,"column":0},"end":{"line":144,"column":1}},"48":{"start":{"line":92,"column":4},"end":{"line":92,"column":24}},"49":{"start":{"line":94,"column":4},"end":{"line":94,"column":33}},"50":{"start":{"line":95,"column":4},"end":{"line":95,"column":22}},"51":{"start":{"line":96,"column":4},"end":{"line":96,"column":13}},"52":{"start":{"line":97,"column":4},"end":{"line":97,"column":22}},"53":{"start":{"line":98,"column":4},"end":{"line":98,"column":23}},"54":{"start":{"line":99,"column":4},"end":{"line":123,"column":5}},"55":{"start":{"line":100,"column":8},"end":{"line":100,"column":22}},"56":{"start":{"line":101,"column":8},"end":{"line":106,"column":11}},"57":{"start":{"line":102,"column":12},"end":{"line":102,"column":42}},"58":{"start":{"line":103,"column":12},"end":{"line":103,"column":64}},"59":{"start":{"line":104,"column":12},"end":{"line":104,"column":26}},"60":{"start":{"line":105,"column":12},"end":{"line":105,"column":31}},"61":{"start":{"line":108,"column":8},"end":{"line":108,"column":32}},"62":{"start":{"line":109,"column":8},"end":{"line":109,"column":60}},"63":{"start":{"line":110,"column":8},"end":{"line":112,"column":9}},"64":{"start":{"line":111,"column":12},"end":{"line":111,"column":72}},"65":{"start":{"line":113,"column":8},"end":{"line":113,"column":34}},"66":{"start":{"line":114,"column":8},"end":{"line":114,"column":45}},"67":{"start":{"line":115,"column":8},"end":{"line":122,"column":11}},"68":{"start":{"line":116,"column":12},"end":{"line":120,"column":13}},"69":{"start":{"line":121,"column":12},"end":{"line":121,"column":49}},"70":{"start":{"line":125,"column":4},"end":{"line":143,"column":11}},"71":{"start":{"line":127,"column":12},"end":{"line":129,"column":13}},"72":{"start":{"line":128,"column":16},"end":{"line":128,"column":64}},"73":{"start":{"line":130,"column":12},"end":{"line":133,"column":14}},"74":{"start":{"line":134,"column":12},"end":{"line":134,"column":45}},"75":{"start":{"line":135,"column":12},"end":{"line":142,"column":13}},"76":{"start":{"line":136,"column":16},"end":{"line":141,"column":18}},"77":{"start":{"line":137,"column":20},"end":{"line":137,"column":52}},"78":{"start":{"line":138,"column":20},"end":{"line":138,"column":45}},"79":{"start":{"line":139,"column":20},"end":{"line":139,"column":40}},"80":{"start":{"line":146,"column":0},"end":{"line":160,"column":1}},"81":{"start":{"line":147,"column":4},"end":{"line":147,"column":13}},"82":{"start":{"line":148,"column":4},"end":{"line":150,"column":5}},"83":{"start":{"line":149,"column":8},"end":{"line":149,"column":62}},"84":{"start":{"line":151,"column":4},"end":{"line":158,"column":5}},"85":{"start":{"line":152,"column":8},"end":{"line":157,"column":9}},"86":{"start":{"line":153,"column":12},"end":{"line":153,"column":51}},"87":{"start":{"line":154,"column":12},"end":{"line":156,"column":13}},"88":{"start":{"line":155,"column":16},"end":{"line":155,"column":28}},"89":{"start":{"line":159,"column":4},"end":{"line":159,"column":16}},"90":{"start":{"line":162,"column":0},"end":{"line":168,"column":1}},"91":{"start":{"line":163,"column":4},"end":{"line":167,"column":5}},"92":{"start":{"line":164,"column":8},"end":{"line":166,"column":9}},"93":{"start":{"line":165,"column":12},"end":{"line":165,"column":46}},"94":{"start":{"line":170,"column":0},"end":{"line":172,"column":1}},"95":{"start":{"line":171,"column":4},"end":{"line":171,"column":24}},"96":{"start":{"line":174,"column":0},"end":{"line":184,"column":1}},"97":{"start":{"line":175,"column":4},"end":{"line":183,"column":5}},"98":{"start":{"line":176,"column":8},"end":{"line":176,"column":61}},"99":{"start":{"line":177,"column":11},"end":{"line":183,"column":5}},"100":{"start":{"line":178,"column":8},"end":{"line":178,"column":80}},"101":{"start":{"line":179,"column":11},"end":{"line":183,"column":5}},"102":{"start":{"line":180,"column":8},"end":{"line":182,"column":11}},"103":{"start":{"line":181,"column":12},"end":{"line":181,"column":53}},"104":{"start":{"line":185,"column":0},"end":{"line":196,"column":1}},"105":{"start":{"line":186,"column":4},"end":{"line":195,"column":5}},"106":{"start":{"line":187,"column":8},"end":{"line":187,"column":43}},"107":{"start":{"line":189,"column":8},"end":{"line":194,"column":9}},"108":{"start":{"line":190,"column":12},"end":{"line":193,"column":14}},"109":{"start":{"line":191,"column":16},"end":{"line":191,"column":61}},"110":{"start":{"line":192,"column":16},"end":{"line":192,"column":55}},"111":{"start":{"line":198,"column":0},"end":{"line":204,"column":1}},"112":{"start":{"line":199,"column":4},"end":{"line":203,"column":5}},"113":{"start":{"line":200,"column":8},"end":{"line":200,"column":61}},"114":{"start":{"line":201,"column":11},"end":{"line":203,"column":5}},"115":{"start":{"line":202,"column":8},"end":{"line":202,"column":80}},"116":{"start":{"line":205,"column":0},"end":{"line":220,"column":1}},"117":{"start":{"line":206,"column":4},"end":{"line":209,"column":7}},"118":{"start":{"line":210,"column":4},"end":{"line":219,"column":5}},"119":{"start":{"line":211,"column":8},"end":{"line":211,"column":43}},"120":{"start":{"line":213,"column":8},"end":{"line":218,"column":9}},"121":{"start":{"line":214,"column":12},"end":{"line":217,"column":14}},"122":{"start":{"line":215,"column":16},"end":{"line":215,"column":61}},"123":{"start":{"line":216,"column":16},"end":{"line":216,"column":55}},"124":{"start":{"line":223,"column":0},"end":{"line":307,"column":1}},"125":{"start":{"line":225,"column":4},"end":{"line":225,"column":24}},"126":{"start":{"line":226,"column":4},"end":{"line":226,"column":19}},"127":{"start":{"line":227,"column":4},"end":{"line":227,"column":10}},"128":{"start":{"line":228,"column":4},"end":{"line":249,"column":5}},"129":{"start":{"line":229,"column":8},"end":{"line":229,"column":53}},"130":{"start":{"line":230,"column":8},"end":{"line":230,"column":30}},"131":{"start":{"line":231,"column":8},"end":{"line":240,"column":9}},"132":{"start":{"line":232,"column":12},"end":{"line":232,"column":60}},"133":{"start":{"line":233,"column":12},"end":{"line":233,"column":48}},"134":{"start":{"line":234,"column":12},"end":{"line":239,"column":13}},"135":{"start":{"line":235,"column":16},"end":{"line":235,"column":128}},"136":{"start":{"line":236,"column":16},"end":{"line":236,"column":35}},"137":{"start":{"line":238,"column":16},"end":{"line":238,"column":65}},"138":{"start":{"line":241,"column":8},"end":{"line":246,"column":9}},"139":{"start":{"line":242,"column":12},"end":{"line":242,"column":66}},"140":{"start":{"line":243,"column":12},"end":{"line":243,"column":52}},"141":{"start":{"line":244,"column":12},"end":{"line":244,"column":66}},"142":{"start":{"line":245,"column":12},"end":{"line":245,"column":44}},"143":{"start":{"line":247,"column":8},"end":{"line":247,"column":116}},"144":{"start":{"line":248,"column":8},"end":{"line":248,"column":30}},"145":{"start":{"line":250,"column":4},"end":{"line":256,"column":5}},"146":{"start":{"line":251,"column":8},"end":{"line":255,"column":9}},"147":{"start":{"line":252,"column":12},"end":{"line":252,"column":67}},"148":{"start":{"line":254,"column":12},"end":{"line":254,"column":58}},"149":{"start":{"line":257,"column":4},"end":{"line":257,"column":11}},"150":{"start":{"line":258,"column":4},"end":{"line":280,"column":5}},"151":{"start":{"line":259,"column":8},"end":{"line":261,"column":9}},"152":{"start":{"line":260,"column":12},"end":{"line":260,"column":66}},"153":{"start":{"line":262,"column":8},"end":{"line":268,"column":9}},"154":{"start":{"line":263,"column":12},"end":{"line":267,"column":13}},"155":{"start":{"line":264,"column":16},"end":{"line":266,"column":17}},"156":{"start":{"line":265,"column":20},"end":{"line":265,"column":95}},"157":{"start":{"line":270,"column":8},"end":{"line":270,"column":72}},"158":{"start":{"line":271,"column":8},"end":{"line":279,"column":9}},"159":{"start":{"line":272,"column":12},"end":{"line":278,"column":13}},"160":{"start":{"line":273,"column":16},"end":{"line":277,"column":17}},"161":{"start":{"line":274,"column":20},"end":{"line":274,"column":88}},"162":{"start":{"line":276,"column":20},"end":{"line":276,"column":95}},"163":{"start":{"line":282,"column":4},"end":{"line":295,"column":5}},"164":{"start":{"line":283,"column":8},"end":{"line":294,"column":9}},"165":{"start":{"line":284,"column":12},"end":{"line":284,"column":40}},"166":{"start":{"line":285,"column":12},"end":{"line":285,"column":63}},"167":{"start":{"line":286,"column":12},"end":{"line":292,"column":15}},"168":{"start":{"line":287,"column":16},"end":{"line":287,"column":44}},"169":{"start":{"line":288,"column":16},"end":{"line":291,"column":17}},"170":{"start":{"line":289,"column":20},"end":{"line":289,"column":124}},"171":{"start":{"line":290,"column":20},"end":{"line":290,"column":78}},"172":{"start":{"line":296,"column":4},"end":{"line":296,"column":33}},"173":{"start":{"line":297,"column":4},"end":{"line":297,"column":54}},"174":{"start":{"line":299,"column":4},"end":{"line":305,"column":5}},"175":{"start":{"line":300,"column":8},"end":{"line":304,"column":9}},"176":{"start":{"line":301,"column":12},"end":{"line":301,"column":66}},"177":{"start":{"line":303,"column":12},"end":{"line":303,"column":57}},"178":{"start":{"line":306,"column":4},"end":{"line":306,"column":26}},"179":{"start":{"line":309,"column":0},"end":{"line":364,"column":1}},"180":{"start":{"line":310,"column":4},"end":{"line":310,"column":24}},"181":{"start":{"line":311,"column":4},"end":{"line":317,"column":5}},"182":{"start":{"line":312,"column":8},"end":{"line":316,"column":9}},"183":{"start":{"line":313,"column":12},"end":{"line":313,"column":67}},"184":{"start":{"line":315,"column":12},"end":{"line":315,"column":58}},"185":{"start":{"line":318,"column":4},"end":{"line":318,"column":20}},"186":{"start":{"line":319,"column":4},"end":{"line":319,"column":22}},"187":{"start":{"line":320,"column":4},"end":{"line":320,"column":17}},"188":{"start":{"line":321,"column":4},"end":{"line":325,"column":5}},"189":{"start":{"line":322,"column":8},"end":{"line":322,"column":53}},"190":{"start":{"line":323,"column":11},"end":{"line":325,"column":5}},"191":{"start":{"line":324,"column":8},"end":{"line":324,"column":73}},"192":{"start":{"line":326,"column":4},"end":{"line":333,"column":5}},"193":{"start":{"line":327,"column":8},"end":{"line":332,"column":9}},"194":{"start":{"line":328,"column":12},"end":{"line":328,"column":71}},"195":{"start":{"line":329,"column":12},"end":{"line":331,"column":13}},"196":{"start":{"line":330,"column":16},"end":{"line":330,"column":39}},"197":{"start":{"line":335,"column":4},"end":{"line":363,"column":7}},"198":{"start":{"line":336,"column":8},"end":{"line":362,"column":11}},"199":{"start":{"line":337,"column":12},"end":{"line":343,"column":13}},"200":{"start":{"line":338,"column":16},"end":{"line":342,"column":17}},"201":{"start":{"line":339,"column":20},"end":{"line":341,"column":21}},"202":{"start":{"line":340,"column":24},"end":{"line":340,"column":53}},"203":{"start":{"line":344,"column":12},"end":{"line":348,"column":13}},"204":{"start":{"line":345,"column":16},"end":{"line":347,"column":19}},"205":{"start":{"line":346,"column":20},"end":{"line":346,"column":49}},"206":{"start":{"line":353,"column":12},"end":{"line":353,"column":40}},"207":{"start":{"line":354,"column":12},"end":{"line":360,"column":13}},"208":{"start":{"line":355,"column":16},"end":{"line":359,"column":17}},"209":{"start":{"line":356,"column":20},"end":{"line":356,"column":74}},"210":{"start":{"line":358,"column":20},"end":{"line":358,"column":65}},"211":{"start":{"line":361,"column":12},"end":{"line":361,"column":22}},"212":{"start":{"line":367,"column":0},"end":{"line":390,"column":1}},"213":{"start":{"line":368,"column":4},"end":{"line":368,"column":48}},"214":{"start":{"line":369,"column":4},"end":{"line":389,"column":5}},"215":{"start":{"line":370,"column":8},"end":{"line":370,"column":71}},"216":{"start":{"line":372,"column":8},"end":{"line":372,"column":23}},"217":{"start":{"line":373,"column":8},"end":{"line":373,"column":32}},"218":{"start":{"line":374,"column":8},"end":{"line":376,"column":11}},"219":{"start":{"line":375,"column":12},"end":{"line":375,"column":49}},"220":{"start":{"line":377,"column":8},"end":{"line":377,"column":28}},"221":{"start":{"line":378,"column":8},"end":{"line":382,"column":11}},"222":{"start":{"line":379,"column":12},"end":{"line":381,"column":13}},"223":{"start":{"line":380,"column":16},"end":{"line":380,"column":35}},"224":{"start":{"line":383,"column":8},"end":{"line":388,"column":9}},"225":{"start":{"line":384,"column":12},"end":{"line":384,"column":44}},"226":{"start":{"line":385,"column":12},"end":{"line":385,"column":77}},"227":{"start":{"line":386,"column":12},"end":{"line":386,"column":37}},"228":{"start":{"line":387,"column":12},"end":{"line":387,"column":22}},"229":{"start":{"line":392,"column":0},"end":{"line":409,"column":1}},"230":{"start":{"line":393,"column":4},"end":{"line":393,"column":45}},"231":{"start":{"line":394,"column":4},"end":{"line":394,"column":39}},"232":{"start":{"line":396,"column":4},"end":{"line":408,"column":5}},"233":{"start":{"line":397,"column":8},"end":{"line":407,"column":9}},"234":{"start":{"line":398,"column":12},"end":{"line":398,"column":53}},"235":{"start":{"line":399,"column":12},"end":{"line":406,"column":13}},"236":{"start":{"line":400,"column":16},"end":{"line":400,"column":71}},"237":{"start":{"line":401,"column":16},"end":{"line":405,"column":17}},"238":{"start":{"line":402,"column":20},"end":{"line":404,"column":21}},"239":{"start":{"line":403,"column":24},"end":{"line":403,"column":70}},"240":{"start":{"line":411,"column":0},"end":{"line":457,"column":1}},"241":{"start":{"line":412,"column":4},"end":{"line":412,"column":15}},"242":{"start":{"line":413,"column":4},"end":{"line":415,"column":5}},"243":{"start":{"line":414,"column":8},"end":{"line":414,"column":50}},"244":{"start":{"line":416,"column":4},"end":{"line":416,"column":35}},"245":{"start":{"line":418,"column":4},"end":{"line":422,"column":7}},"246":{"start":{"line":424,"column":4},"end":{"line":435,"column":5}},"247":{"start":{"line":425,"column":8},"end":{"line":425,"column":29}},"248":{"start":{"line":426,"column":8},"end":{"line":429,"column":9}},"249":{"start":{"line":428,"column":12},"end":{"line":428,"column":58}},"250":{"start":{"line":430,"column":8},"end":{"line":432,"column":9}},"251":{"start":{"line":431,"column":12},"end":{"line":431,"column":75}},"252":{"start":{"line":433,"column":8},"end":{"line":433,"column":25}},"253":{"start":{"line":434,"column":8},"end":{"line":434,"column":25}},"254":{"start":{"line":436,"column":4},"end":{"line":449,"column":5}},"255":{"start":{"line":437,"column":8},"end":{"line":448,"column":9}},"256":{"start":{"line":438,"column":12},"end":{"line":438,"column":35}},"257":{"start":{"line":439,"column":12},"end":{"line":442,"column":13}},"258":{"start":{"line":441,"column":16},"end":{"line":441,"column":62}},"259":{"start":{"line":443,"column":12},"end":{"line":445,"column":13}},"260":{"start":{"line":444,"column":16},"end":{"line":444,"column":79}},"261":{"start":{"line":446,"column":12},"end":{"line":446,"column":29}},"262":{"start":{"line":447,"column":12},"end":{"line":447,"column":29}},"263":{"start":{"line":450,"column":4},"end":{"line":450,"column":46}},"264":{"start":{"line":451,"column":4},"end":{"line":451,"column":40}},"265":{"start":{"line":453,"column":4},"end":{"line":456,"column":7}},"266":{"start":{"line":454,"column":8},"end":{"line":454,"column":105}},"267":{"start":{"line":455,"column":8},"end":{"line":455,"column":23}},"268":{"start":{"line":459,"column":0},"end":{"line":521,"column":1}},"269":{"start":{"line":460,"column":4},"end":{"line":460,"column":13}},"270":{"start":{"line":461,"column":4},"end":{"line":465,"column":5}},"271":{"start":{"line":462,"column":8},"end":{"line":462,"column":32}},"272":{"start":{"line":464,"column":8},"end":{"line":464,"column":42}},"273":{"start":{"line":466,"column":4},"end":{"line":468,"column":5}},"274":{"start":{"line":467,"column":8},"end":{"line":467,"column":20}},"275":{"start":{"line":469,"column":4},"end":{"line":471,"column":6}},"276":{"start":{"line":472,"column":4},"end":{"line":474,"column":5}},"277":{"start":{"line":473,"column":8},"end":{"line":473,"column":34}},"278":{"start":{"line":475,"column":4},"end":{"line":477,"column":5}},"279":{"start":{"line":476,"column":8},"end":{"line":476,"column":26}},"280":{"start":{"line":478,"column":4},"end":{"line":489,"column":5}},"281":{"start":{"line":479,"column":8},"end":{"line":479,"column":46}},"282":{"start":{"line":480,"column":8},"end":{"line":488,"column":9}},"283":{"start":{"line":481,"column":12},"end":{"line":487,"column":14}},"284":{"start":{"line":482,"column":16},"end":{"line":482,"column":53}},"285":{"start":{"line":483,"column":16},"end":{"line":485,"column":17}},"286":{"start":{"line":484,"column":20},"end":{"line":484,"column":38}},"287":{"start":{"line":486,"column":16},"end":{"line":486,"column":28}},"288":{"start":{"line":490,"column":4},"end":{"line":498,"column":5}},"289":{"start":{"line":491,"column":8},"end":{"line":491,"column":50}},"290":{"start":{"line":492,"column":8},"end":{"line":494,"column":10}},"291":{"start":{"line":493,"column":12},"end":{"line":493,"column":49}},"292":{"start":{"line":495,"column":8},"end":{"line":497,"column":9}},"293":{"start":{"line":496,"column":12},"end":{"line":496,"column":34}},"294":{"start":{"line":499,"column":4},"end":{"line":519,"column":5}},"295":{"start":{"line":500,"column":8},"end":{"line":500,"column":52}},"296":{"start":{"line":501,"column":8},"end":{"line":515,"column":11}},"297":{"start":{"line":502,"column":12},"end":{"line":502,"column":58}},"298":{"start":{"line":503,"column":12},"end":{"line":503,"column":53}},"299":{"start":{"line":504,"column":12},"end":{"line":506,"column":15}},"300":{"start":{"line":505,"column":16},"end":{"line":505,"column":41}},"301":{"start":{"line":507,"column":12},"end":{"line":512,"column":13}},"302":{"start":{"line":508,"column":16},"end":{"line":508,"column":61}},"303":{"start":{"line":509,"column":16},"end":{"line":511,"column":18}},"304":{"start":{"line":510,"column":20},"end":{"line":510,"column":47}},"305":{"start":{"line":513,"column":12},"end":{"line":513,"column":37}},"306":{"start":{"line":514,"column":12},"end":{"line":514,"column":27}},"307":{"start":{"line":516,"column":8},"end":{"line":518,"column":9}},"308":{"start":{"line":517,"column":12},"end":{"line":517,"column":35}},"309":{"start":{"line":520,"column":4},"end":{"line":520,"column":18}},"310":{"start":{"line":523,"column":0},"end":{"line":574,"column":1}},"311":{"start":{"line":524,"column":4},"end":{"line":524,"column":19}},"312":{"start":{"line":525,"column":4},"end":{"line":532,"column":5}},"313":{"start":{"line":526,"column":8},"end":{"line":530,"column":9}},"314":{"start":{"line":527,"column":12},"end":{"line":527,"column":32}},"315":{"start":{"line":528,"column":12},"end":{"line":528,"column":25}},"316":{"start":{"line":529,"column":12},"end":{"line":529,"column":20}},"317":{"start":{"line":531,"column":8},"end":{"line":531,"column":49}},"318":{"start":{"line":533,"column":4},"end":{"line":533,"column":46}},"319":{"start":{"line":534,"column":4},"end":{"line":534,"column":14}},"320":{"start":{"line":536,"column":4},"end":{"line":568,"column":5}},"321":{"start":{"line":540,"column":8},"end":{"line":542,"column":10}},"322":{"start":{"line":541,"column":12},"end":{"line":541,"column":118}},"323":{"start":{"line":545,"column":8},"end":{"line":545,"column":36}},"324":{"start":{"line":546,"column":8},"end":{"line":554,"column":9}},"325":{"start":{"line":548,"column":12},"end":{"line":553,"column":15}},"326":{"start":{"line":549,"column":16},"end":{"line":549,"column":74}},"327":{"start":{"line":550,"column":16},"end":{"line":550,"column":32}},"328":{"start":{"line":551,"column":16},"end":{"line":551,"column":34}},"329":{"start":{"line":552,"column":16},"end":{"line":552,"column":31}},"330":{"start":{"line":556,"column":8},"end":{"line":558,"column":11}},"331":{"start":{"line":557,"column":12},"end":{"line":557,"column":51}},"332":{"start":{"line":559,"column":8},"end":{"line":563,"column":9}},"333":{"start":{"line":564,"column":8},"end":{"line":564,"column":80}},"334":{"start":{"line":565,"column":8},"end":{"line":567,"column":11}},"335":{"start":{"line":566,"column":12},"end":{"line":566,"column":21}},"336":{"start":{"line":570,"column":4},"end":{"line":570,"column":40}},"337":{"start":{"line":571,"column":4},"end":{"line":573,"column":6}},"338":{"start":{"line":572,"column":8},"end":{"line":572,"column":92}},"339":{"start":{"line":576,"column":0},"end":{"line":596,"column":1}},"340":{"start":{"line":577,"column":4},"end":{"line":580,"column":5}},"341":{"start":{"line":579,"column":8},"end":{"line":579,"column":56}},"342":{"start":{"line":581,"column":4},"end":{"line":581,"column":42}},"343":{"start":{"line":582,"column":4},"end":{"line":586,"column":5}},"344":{"start":{"line":583,"column":8},"end":{"line":583,"column":28}},"345":{"start":{"line":584,"column":8},"end":{"line":584,"column":21}},"346":{"start":{"line":585,"column":8},"end":{"line":585,"column":16}},"347":{"start":{"line":588,"column":4},"end":{"line":588,"column":46}},"348":{"start":{"line":589,"column":4},"end":{"line":591,"column":7}},"349":{"start":{"line":590,"column":8},"end":{"line":590,"column":47}},"350":{"start":{"line":593,"column":4},"end":{"line":595,"column":7}},"351":{"start":{"line":594,"column":8},"end":{"line":594,"column":107}},"352":{"start":{"line":598,"column":0},"end":{"line":648,"column":2}},"353":{"start":{"line":634,"column":20},"end":{"line":634,"column":35}}},"branchMap":{"1":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":4},"end":{"line":47,"column":4}},{"start":{"line":47,"column":4},"end":{"line":47,"column":4}}]},"2":{"line":53,"type":"if","locations":[{"start":{"line":53,"column":4},"end":{"line":53,"column":4}},{"start":{"line":53,"column":4},"end":{"line":53,"column":4}}]},"3":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":12},"end":{"line":55,"column":12}},{"start":{"line":55,"column":12},"end":{"line":55,"column":12}}]},"4":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":16},"end":{"line":55,"column":32}},{"start":{"line":55,"column":36},"end":{"line":55,"column":76}}]},"5":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":16},"end":{"line":57,"column":16}},{"start":{"line":57,"column":16},"end":{"line":57,"column":16}}]},"6":{"line":60,"type":"if","locations":[{"start":{"line":60,"column":20},"end":{"line":60,"column":20}},{"start":{"line":60,"column":20},"end":{"line":60,"column":20}}]},"7":{"line":60,"type":"binary-expr","locations":[{"start":{"line":60,"column":24},"end":{"line":60,"column":66}},{"start":{"line":60,"column":70},"end":{"line":60,"column":77}}]},"8":{"line":92,"type":"binary-expr","locations":[{"start":{"line":92,"column":11},"end":{"line":92,"column":15}},{"start":{"line":92,"column":17},"end":{"line":92,"column":23}}]},"9":{"line":99,"type":"if","locations":[{"start":{"line":99,"column":4},"end":{"line":99,"column":4}},{"start":{"line":99,"column":4},"end":{"line":99,"column":4}}]},"10":{"line":110,"type":"if","locations":[{"start":{"line":110,"column":8},"end":{"line":110,"column":8}},{"start":{"line":110,"column":8},"end":{"line":110,"column":8}}]},"11":{"line":127,"type":"if","locations":[{"start":{"line":127,"column":12},"end":{"line":127,"column":12}},{"start":{"line":127,"column":12},"end":{"line":127,"column":12}}]},"12":{"line":135,"type":"if","locations":[{"start":{"line":135,"column":12},"end":{"line":135,"column":12}},{"start":{"line":135,"column":12},"end":{"line":135,"column":12}}]},"13":{"line":148,"type":"if","locations":[{"start":{"line":148,"column":4},"end":{"line":148,"column":4}},{"start":{"line":148,"column":4},"end":{"line":148,"column":4}}]},"14":{"line":148,"type":"binary-expr","locations":[{"start":{"line":148,"column":8},"end":{"line":148,"column":29}},{"start":{"line":148,"column":33},"end":{"line":148,"column":67}}]},"15":{"line":152,"type":"if","locations":[{"start":{"line":152,"column":8},"end":{"line":152,"column":8}},{"start":{"line":152,"column":8},"end":{"line":152,"column":8}}]},"16":{"line":154,"type":"if","locations":[{"start":{"line":154,"column":12},"end":{"line":154,"column":12}},{"start":{"line":154,"column":12},"end":{"line":154,"column":12}}]},"17":{"line":164,"type":"if","locations":[{"start":{"line":164,"column":8},"end":{"line":164,"column":8}},{"start":{"line":164,"column":8},"end":{"line":164,"column":8}}]},"18":{"line":175,"type":"if","locations":[{"start":{"line":175,"column":4},"end":{"line":175,"column":4}},{"start":{"line":175,"column":4},"end":{"line":175,"column":4}}]},"19":{"line":177,"type":"if","locations":[{"start":{"line":177,"column":11},"end":{"line":177,"column":11}},{"start":{"line":177,"column":11},"end":{"line":177,"column":11}}]},"20":{"line":177,"type":"binary-expr","locations":[{"start":{"line":177,"column":15},"end":{"line":177,"column":40}},{"start":{"line":177,"column":44},"end":{"line":177,"column":82}}]},"21":{"line":179,"type":"if","locations":[{"start":{"line":179,"column":11},"end":{"line":179,"column":11}},{"start":{"line":179,"column":11},"end":{"line":179,"column":11}}]},"22":{"line":179,"type":"binary-expr","locations":[{"start":{"line":179,"column":15},"end":{"line":179,"column":48}},{"start":{"line":179,"column":52},"end":{"line":179,"column":83}}]},"23":{"line":186,"type":"if","locations":[{"start":{"line":186,"column":4},"end":{"line":186,"column":4}},{"start":{"line":186,"column":4},"end":{"line":186,"column":4}}]},"24":{"line":189,"type":"if","locations":[{"start":{"line":189,"column":8},"end":{"line":189,"column":8}},{"start":{"line":189,"column":8},"end":{"line":189,"column":8}}]},"25":{"line":199,"type":"if","locations":[{"start":{"line":199,"column":4},"end":{"line":199,"column":4}},{"start":{"line":199,"column":4},"end":{"line":199,"column":4}}]},"26":{"line":201,"type":"if","locations":[{"start":{"line":201,"column":11},"end":{"line":201,"column":11}},{"start":{"line":201,"column":11},"end":{"line":201,"column":11}}]},"27":{"line":201,"type":"binary-expr","locations":[{"start":{"line":201,"column":15},"end":{"line":201,"column":40}},{"start":{"line":201,"column":44},"end":{"line":201,"column":82}}]},"28":{"line":210,"type":"if","locations":[{"start":{"line":210,"column":4},"end":{"line":210,"column":4}},{"start":{"line":210,"column":4},"end":{"line":210,"column":4}}]},"29":{"line":213,"type":"if","locations":[{"start":{"line":213,"column":8},"end":{"line":213,"column":8}},{"start":{"line":213,"column":8},"end":{"line":213,"column":8}}]},"30":{"line":225,"type":"binary-expr","locations":[{"start":{"line":225,"column":11},"end":{"line":225,"column":15}},{"start":{"line":225,"column":17},"end":{"line":225,"column":23}}]},"31":{"line":228,"type":"if","locations":[{"start":{"line":228,"column":4},"end":{"line":228,"column":4}},{"start":{"line":228,"column":4},"end":{"line":228,"column":4}}]},"32":{"line":234,"type":"if","locations":[{"start":{"line":234,"column":12},"end":{"line":234,"column":12}},{"start":{"line":234,"column":12},"end":{"line":234,"column":12}}]},"33":{"line":241,"type":"if","locations":[{"start":{"line":241,"column":8},"end":{"line":241,"column":8}},{"start":{"line":241,"column":8},"end":{"line":241,"column":8}}]},"34":{"line":250,"type":"if","locations":[{"start":{"line":250,"column":4},"end":{"line":250,"column":4}},{"start":{"line":250,"column":4},"end":{"line":250,"column":4}}]},"35":{"line":251,"type":"if","locations":[{"start":{"line":251,"column":8},"end":{"line":251,"column":8}},{"start":{"line":251,"column":8},"end":{"line":251,"column":8}}]},"36":{"line":258,"type":"if","locations":[{"start":{"line":258,"column":4},"end":{"line":258,"column":4}},{"start":{"line":258,"column":4},"end":{"line":258,"column":4}}]},"37":{"line":259,"type":"if","locations":[{"start":{"line":259,"column":8},"end":{"line":259,"column":8}},{"start":{"line":259,"column":8},"end":{"line":259,"column":8}}]},"38":{"line":263,"type":"if","locations":[{"start":{"line":263,"column":12},"end":{"line":263,"column":12}},{"start":{"line":263,"column":12},"end":{"line":263,"column":12}}]},"39":{"line":264,"type":"if","locations":[{"start":{"line":264,"column":16},"end":{"line":264,"column":16}},{"start":{"line":264,"column":16},"end":{"line":264,"column":16}}]},"40":{"line":272,"type":"if","locations":[{"start":{"line":272,"column":12},"end":{"line":272,"column":12}},{"start":{"line":272,"column":12},"end":{"line":272,"column":12}}]},"41":{"line":273,"type":"if","locations":[{"start":{"line":273,"column":16},"end":{"line":273,"column":16}},{"start":{"line":273,"column":16},"end":{"line":273,"column":16}}]},"42":{"line":283,"type":"if","locations":[{"start":{"line":283,"column":8},"end":{"line":283,"column":8}},{"start":{"line":283,"column":8},"end":{"line":283,"column":8}}]},"43":{"line":288,"type":"if","locations":[{"start":{"line":288,"column":16},"end":{"line":288,"column":16}},{"start":{"line":288,"column":16},"end":{"line":288,"column":16}}]},"44":{"line":289,"type":"binary-expr","locations":[{"start":{"line":289,"column":70},"end":{"line":289,"column":117}},{"start":{"line":289,"column":121},"end":{"line":289,"column":123}}]},"45":{"line":299,"type":"if","locations":[{"start":{"line":299,"column":4},"end":{"line":299,"column":4}},{"start":{"line":299,"column":4},"end":{"line":299,"column":4}}]},"46":{"line":300,"type":"if","locations":[{"start":{"line":300,"column":8},"end":{"line":300,"column":8}},{"start":{"line":300,"column":8},"end":{"line":300,"column":8}}]},"47":{"line":310,"type":"binary-expr","locations":[{"start":{"line":310,"column":11},"end":{"line":310,"column":15}},{"start":{"line":310,"column":17},"end":{"line":310,"column":23}}]},"48":{"line":311,"type":"if","locations":[{"start":{"line":311,"column":4},"end":{"line":311,"column":4}},{"start":{"line":311,"column":4},"end":{"line":311,"column":4}}]},"49":{"line":312,"type":"if","locations":[{"start":{"line":312,"column":8},"end":{"line":312,"column":8}},{"start":{"line":312,"column":8},"end":{"line":312,"column":8}}]},"50":{"line":321,"type":"if","locations":[{"start":{"line":321,"column":4},"end":{"line":321,"column":4}},{"start":{"line":321,"column":4},"end":{"line":321,"column":4}}]},"51":{"line":323,"type":"if","locations":[{"start":{"line":323,"column":11},"end":{"line":323,"column":11}},{"start":{"line":323,"column":11},"end":{"line":323,"column":11}}]},"52":{"line":327,"type":"if","locations":[{"start":{"line":327,"column":8},"end":{"line":327,"column":8}},{"start":{"line":327,"column":8},"end":{"line":327,"column":8}}]},"53":{"line":329,"type":"if","locations":[{"start":{"line":329,"column":12},"end":{"line":329,"column":12}},{"start":{"line":329,"column":12},"end":{"line":329,"column":12}}]},"54":{"line":329,"type":"binary-expr","locations":[{"start":{"line":329,"column":16},"end":{"line":329,"column":21}},{"start":{"line":329,"column":25},"end":{"line":329,"column":54}}]},"55":{"line":338,"type":"if","locations":[{"start":{"line":338,"column":16},"end":{"line":338,"column":16}},{"start":{"line":338,"column":16},"end":{"line":338,"column":16}}]},"56":{"line":339,"type":"if","locations":[{"start":{"line":339,"column":20},"end":{"line":339,"column":20}},{"start":{"line":339,"column":20},"end":{"line":339,"column":20}}]},"57":{"line":344,"type":"if","locations":[{"start":{"line":344,"column":12},"end":{"line":344,"column":12}},{"start":{"line":344,"column":12},"end":{"line":344,"column":12}}]},"58":{"line":354,"type":"if","locations":[{"start":{"line":354,"column":12},"end":{"line":354,"column":12}},{"start":{"line":354,"column":12},"end":{"line":354,"column":12}}]},"59":{"line":355,"type":"if","locations":[{"start":{"line":355,"column":16},"end":{"line":355,"column":16}},{"start":{"line":355,"column":16},"end":{"line":355,"column":16}}]},"60":{"line":369,"type":"if","locations":[{"start":{"line":369,"column":4},"end":{"line":369,"column":4}},{"start":{"line":369,"column":4},"end":{"line":369,"column":4}}]},"61":{"line":375,"type":"binary-expr","locations":[{"start":{"line":375,"column":29},"end":{"line":375,"column":42}},{"start":{"line":375,"column":44},"end":{"line":375,"column":45}}]},"62":{"line":379,"type":"if","locations":[{"start":{"line":379,"column":12},"end":{"line":379,"column":12}},{"start":{"line":379,"column":12},"end":{"line":379,"column":12}}]},"63":{"line":383,"type":"if","locations":[{"start":{"line":383,"column":8},"end":{"line":383,"column":8}},{"start":{"line":383,"column":8},"end":{"line":383,"column":8}}]},"64":{"line":397,"type":"if","locations":[{"start":{"line":397,"column":8},"end":{"line":397,"column":8}},{"start":{"line":397,"column":8},"end":{"line":397,"column":8}}]},"65":{"line":399,"type":"if","locations":[{"start":{"line":399,"column":12},"end":{"line":399,"column":12}},{"start":{"line":399,"column":12},"end":{"line":399,"column":12}}]},"66":{"line":399,"type":"binary-expr","locations":[{"start":{"line":399,"column":16},"end":{"line":399,"column":35}},{"start":{"line":399,"column":39},"end":{"line":399,"column":62}}]},"67":{"line":401,"type":"if","locations":[{"start":{"line":401,"column":16},"end":{"line":401,"column":16}},{"start":{"line":401,"column":16},"end":{"line":401,"column":16}}]},"68":{"line":401,"type":"binary-expr","locations":[{"start":{"line":401,"column":22},"end":{"line":401,"column":36}},{"start":{"line":401,"column":40},"end":{"line":401,"column":85}},{"start":{"line":401,"column":91},"end":{"line":401,"column":106}},{"start":{"line":401,"column":110},"end":{"line":401,"column":138}}]},"69":{"line":402,"type":"if","locations":[{"start":{"line":402,"column":20},"end":{"line":402,"column":20}},{"start":{"line":402,"column":20},"end":{"line":402,"column":20}}]},"70":{"line":413,"type":"if","locations":[{"start":{"line":413,"column":4},"end":{"line":413,"column":4}},{"start":{"line":413,"column":4},"end":{"line":413,"column":4}}]},"71":{"line":426,"type":"if","locations":[{"start":{"line":426,"column":8},"end":{"line":426,"column":8}},{"start":{"line":426,"column":8},"end":{"line":426,"column":8}}]},"72":{"line":430,"type":"if","locations":[{"start":{"line":430,"column":8},"end":{"line":430,"column":8}},{"start":{"line":430,"column":8},"end":{"line":430,"column":8}}]},"73":{"line":430,"type":"binary-expr","locations":[{"start":{"line":430,"column":12},"end":{"line":430,"column":31}},{"start":{"line":430,"column":35},"end":{"line":430,"column":58}}]},"74":{"line":436,"type":"if","locations":[{"start":{"line":436,"column":4},"end":{"line":436,"column":4}},{"start":{"line":436,"column":4},"end":{"line":436,"column":4}}]},"75":{"line":439,"type":"if","locations":[{"start":{"line":439,"column":12},"end":{"line":439,"column":12}},{"start":{"line":439,"column":12},"end":{"line":439,"column":12}}]},"76":{"line":443,"type":"if","locations":[{"start":{"line":443,"column":12},"end":{"line":443,"column":12}},{"start":{"line":443,"column":12},"end":{"line":443,"column":12}}]},"77":{"line":443,"type":"binary-expr","locations":[{"start":{"line":443,"column":16},"end":{"line":443,"column":35}},{"start":{"line":443,"column":39},"end":{"line":443,"column":62}}]},"78":{"line":454,"type":"cond-expr","locations":[{"start":{"line":454,"column":67},"end":{"line":454,"column":81}},{"start":{"line":454,"column":82},"end":{"line":454,"column":84}}]},"79":{"line":461,"type":"if","locations":[{"start":{"line":461,"column":4},"end":{"line":461,"column":4}},{"start":{"line":461,"column":4},"end":{"line":461,"column":4}}]},"80":{"line":466,"type":"if","locations":[{"start":{"line":466,"column":4},"end":{"line":466,"column":4}},{"start":{"line":466,"column":4},"end":{"line":466,"column":4}}]},"81":{"line":472,"type":"if","locations":[{"start":{"line":472,"column":4},"end":{"line":472,"column":4}},{"start":{"line":472,"column":4},"end":{"line":472,"column":4}}]},"82":{"line":475,"type":"if","locations":[{"start":{"line":475,"column":4},"end":{"line":475,"column":4}},{"start":{"line":475,"column":4},"end":{"line":475,"column":4}}]},"83":{"line":478,"type":"if","locations":[{"start":{"line":478,"column":4},"end":{"line":478,"column":4}},{"start":{"line":478,"column":4},"end":{"line":478,"column":4}}]},"84":{"line":480,"type":"if","locations":[{"start":{"line":480,"column":8},"end":{"line":480,"column":8}},{"start":{"line":480,"column":8},"end":{"line":480,"column":8}}]},"85":{"line":483,"type":"if","locations":[{"start":{"line":483,"column":16},"end":{"line":483,"column":16}},{"start":{"line":483,"column":16},"end":{"line":483,"column":16}}]},"86":{"line":490,"type":"if","locations":[{"start":{"line":490,"column":4},"end":{"line":490,"column":4}},{"start":{"line":490,"column":4},"end":{"line":490,"column":4}}]},"87":{"line":495,"type":"if","locations":[{"start":{"line":495,"column":8},"end":{"line":495,"column":8}},{"start":{"line":495,"column":8},"end":{"line":495,"column":8}}]},"88":{"line":499,"type":"if","locations":[{"start":{"line":499,"column":4},"end":{"line":499,"column":4}},{"start":{"line":499,"column":4},"end":{"line":499,"column":4}}]},"89":{"line":507,"type":"if","locations":[{"start":{"line":507,"column":12},"end":{"line":507,"column":12}},{"start":{"line":507,"column":12},"end":{"line":507,"column":12}}]},"90":{"line":516,"type":"if","locations":[{"start":{"line":516,"column":8},"end":{"line":516,"column":8}},{"start":{"line":516,"column":8},"end":{"line":516,"column":8}}]},"91":{"line":525,"type":"if","locations":[{"start":{"line":525,"column":4},"end":{"line":525,"column":4}},{"start":{"line":525,"column":4},"end":{"line":525,"column":4}}]},"92":{"line":526,"type":"if","locations":[{"start":{"line":526,"column":8},"end":{"line":526,"column":8}},{"start":{"line":526,"column":8},"end":{"line":526,"column":8}}]},"93":{"line":536,"type":"if","locations":[{"start":{"line":536,"column":4},"end":{"line":536,"column":4}},{"start":{"line":536,"column":4},"end":{"line":536,"column":4}}]},"94":{"line":541,"type":"binary-expr","locations":[{"start":{"line":541,"column":19},"end":{"line":541,"column":38}},{"start":{"line":541,"column":43},"end":{"line":541,"column":67}},{"start":{"line":541,"column":71},"end":{"line":541,"column":116}}]},"95":{"line":545,"type":"binary-expr","locations":[{"start":{"line":545,"column":16},"end":{"line":545,"column":31}},{"start":{"line":545,"column":33},"end":{"line":545,"column":35}}]},"96":{"line":546,"type":"if","locations":[{"start":{"line":546,"column":8},"end":{"line":546,"column":8}},{"start":{"line":546,"column":8},"end":{"line":546,"column":8}}]},"97":{"line":549,"type":"binary-expr","locations":[{"start":{"line":549,"column":37},"end":{"line":549,"column":45}},{"start":{"line":549,"column":47},"end":{"line":549,"column":49}}]},"98":{"line":549,"type":"binary-expr","locations":[{"start":{"line":549,"column":58},"end":{"line":549,"column":68}},{"start":{"line":549,"column":70},"end":{"line":549,"column":72}}]},"99":{"line":557,"type":"binary-expr","locations":[{"start":{"line":557,"column":19},"end":{"line":557,"column":32}},{"start":{"line":557,"column":36},"end":{"line":557,"column":50}}]},"100":{"line":564,"type":"binary-expr","locations":[{"start":{"line":564,"column":33},"end":{"line":564,"column":46}},{"start":{"line":564,"column":48},"end":{"line":564,"column":50}}]},"101":{"line":564,"type":"binary-expr","locations":[{"start":{"line":564,"column":59},"end":{"line":564,"column":74}},{"start":{"line":564,"column":76},"end":{"line":564,"column":78}}]},"102":{"line":572,"type":"cond-expr","locations":[{"start":{"line":572,"column":64},"end":{"line":572,"column":73}},{"start":{"line":572,"column":74},"end":{"line":572,"column":76}}]},"103":{"line":577,"type":"if","locations":[{"start":{"line":577,"column":4},"end":{"line":577,"column":4}},{"start":{"line":577,"column":4},"end":{"line":577,"column":4}}]},"104":{"line":582,"type":"if","locations":[{"start":{"line":582,"column":4},"end":{"line":582,"column":4}},{"start":{"line":582,"column":4},"end":{"line":582,"column":4}}]},"105":{"line":590,"type":"binary-expr","locations":[{"start":{"line":590,"column":15},"end":{"line":590,"column":28}},{"start":{"line":590,"column":32},"end":{"line":590,"column":46}}]},"106":{"line":594,"type":"cond-expr","locations":[{"start":{"line":594,"column":69},"end":{"line":594,"column":83}},{"start":{"line":594,"column":84},"end":{"line":594,"column":86}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var clone = require(\"clone\");","var when = require(\"when\");","","var Flow = require('./Flow');","","var typeRegistry = require(\"../registry\");","var context = require(\"../context\")","var credentials = require(\"../credentials\");","","var flowUtil = require(\"./util\");","var log = require(\"../../log\");","var events = require(\"../../events\");","var redUtil = require(\"../../util\");","var deprecated = require(\"../registry/deprecated\");","","var storage = null;","var settings = null;","","var activeConfig = null;","var activeFlowConfig = null;","","var activeFlows = {};","var started = false;","","var activeNodesToFlow = {};","var subflowInstanceNodeMap = {};","","var typeEventRegistered = false;","","function init(runtime) {","    if (started) {","        throw new Error(\"Cannot init without a stop\");","    }","    settings = runtime.settings;","    storage = runtime.storage;","    started = false;","    if (!typeEventRegistered) {","        events.on('type-registered',function(type) {","            if (activeFlowConfig && activeFlowConfig.missingTypes.length > 0) {","                var i = activeFlowConfig.missingTypes.indexOf(type);","                if (i != -1) {","                    log.info(log._(\"nodes.flows.registered-missing\", {type:type}));","                    activeFlowConfig.missingTypes.splice(i,1);","                    if (activeFlowConfig.missingTypes.length === 0 && started) {","                        events.emit(\"runtime-event\",{id:\"runtime-state\"});","                        start();","                    }","                }","            }","        });","        typeEventRegistered = true;","    }","}","","function loadFlows() {","    return storage.getFlows().then(function(config) {","        log.debug(\"loaded flow revision: \"+config.rev);","        return credentials.load(config.credentials).then(function() {","            return config;","        });","    }).otherwise(function(err) {","        log.warn(log._(\"nodes.flows.error\",{message:err.toString()}));","        console.log(err.stack);","    });","}","function load() {","    return setFlows(null,\"load\",false);","}","","/*"," * _config - new node array configuration"," * type - full/nodes/flows/load (default full)"," * muteLog - don't emit the standard log messages (used for individual flow api)"," */","function setFlows(_config,type,muteLog) {","    type = type||\"full\";","","    var configSavePromise = null;","    var config = null;","    var diff;","    var newFlowConfig;","    var isLoad = false;","    if (type === \"load\") {","        isLoad = true;","        configSavePromise = loadFlows().then(function(_config) {","            config = clone(_config.flows);","            newFlowConfig = flowUtil.parseConfig(clone(config));","            type = \"full\";","            return _config.rev;","        });","    } else {","        config = clone(_config);","        newFlowConfig = flowUtil.parseConfig(clone(config));","        if (type !== 'full') {","            diff = flowUtil.diffConfigs(activeFlowConfig,newFlowConfig);","        }","        credentials.clean(config);","        var credsDirty = credentials.dirty();","        configSavePromise = credentials.export().then(function(creds) {","            var saveConfig = {","                flows: config,","                credentialsDirty:credsDirty,","                credentials: creds","            }","            return storage.saveFlows(saveConfig);","        });","    }","","    return configSavePromise","        .then(function(flowRevision) {","            if (!isLoad) {","                log.debug(\"saved flow revision: \"+flowRevision);","            }","            activeConfig = {","                flows:config,","                rev:flowRevision","            };","            activeFlowConfig = newFlowConfig;","            if (started) {","                return stop(type,diff,muteLog).then(function() {","                    context.clean(activeFlowConfig);","                    start(type,diff,muteLog);","                    return flowRevision;","                }).otherwise(function(err) {","                })","            }","        });","}","","function getNode(id) {","    var node;","    if (activeNodesToFlow[id] && activeFlows[activeNodesToFlow[id]]) {","        return activeFlows[activeNodesToFlow[id]].getNode(id);","    }","    for (var flowId in activeFlows) {","        if (activeFlows.hasOwnProperty(flowId)) {","            node = activeFlows[flowId].getNode(id);","            if (node) {","                return node;","            }","        }","    }","    return null;","}","","function eachNode(cb) {","    for (var id in activeFlowConfig.allNodes) {","        if (activeFlowConfig.allNodes.hasOwnProperty(id)) {","            cb(activeFlowConfig.allNodes[id]);","        }","    }","}","","function getFlows() {","    return activeConfig;","}","","function delegateError(node,logMessage,msg) {","    if (activeFlows[node.z]) {","        activeFlows[node.z].handleError(node,logMessage,msg);","    } else if (activeNodesToFlow[node.z] && activeFlows[activeNodesToFlow[node.z]]) {","        activeFlows[activeNodesToFlow[node.z]].handleError(node,logMessage,msg);","    } else if (activeFlowConfig.subflows[node.z] && subflowInstanceNodeMap[node.id]) {","        subflowInstanceNodeMap[node.id].forEach(function(n) {","            delegateError(getNode(n),logMessage,msg);","        });","    }","}","function handleError(node,logMessage,msg) {","    if (node.z) {","        delegateError(node,logMessage,msg);","    } else {","        if (activeFlowConfig.configs[node.id]) {","            activeFlowConfig.configs[node.id]._users.forEach(function(id) {","                var userNode = activeFlowConfig.allNodes[id];","                delegateError(userNode,logMessage,msg);","            })","        }","    }","}","","function delegateStatus(node,statusMessage) {","    if (activeFlows[node.z]) {","        activeFlows[node.z].handleStatus(node,statusMessage);","    } else if (activeNodesToFlow[node.z] && activeFlows[activeNodesToFlow[node.z]]) {","        activeFlows[activeNodesToFlow[node.z]].handleStatus(node,statusMessage);","    }","}","function handleStatus(node,statusMessage) {","    events.emit(\"node-status\",{","        id: node.id,","        status:statusMessage","    });","    if (node.z) {","        delegateStatus(node,statusMessage);","    } else {","        if (activeFlowConfig.configs[node.id]) {","            activeFlowConfig.configs[node.id]._users.forEach(function(id) {","                var userNode = activeFlowConfig.allNodes[id];","                delegateStatus(userNode,statusMessage);","            })","        }","    }","}","","","function start(type,diff,muteLog) {","    //dumpActiveNodes();","    type = type||\"full\";","    started = true;","    var i;","    if (activeFlowConfig.missingTypes.length > 0) {","        log.info(log._(\"nodes.flows.missing-types\"));","        var knownUnknowns = 0;","        for (i=0;i<activeFlowConfig.missingTypes.length;i++) {","            var nodeType = activeFlowConfig.missingTypes[i];","            var info = deprecated.get(nodeType);","            if (info) {","                log.info(log._(\"nodes.flows.missing-type-provided\",{type:activeFlowConfig.missingTypes[i],module:info.module}));","                knownUnknowns += 1;","            } else {","                log.info(\" - \"+activeFlowConfig.missingTypes[i]);","            }","        }","        if (knownUnknowns > 0) {","            log.info(log._(\"nodes.flows.missing-type-install-1\"));","            log.info(\"  npm install <module name>\");","            log.info(log._(\"nodes.flows.missing-type-install-2\"));","            log.info(\"  \"+settings.userDir);","        }","        events.emit(\"runtime-event\",{id:\"runtime-state\",type:\"warning\",text:\"notification.warnings.missing-types\"});","        return when.resolve();","    }","    if (!muteLog) {","        if (diff) {","            log.info(log._(\"nodes.flows.starting-modified-\"+type));","        } else {","            log.info(log._(\"nodes.flows.starting-flows\"));","        }","    }","    var id;","    if (!diff) {","        if (!activeFlows['global']) {","            activeFlows['global'] = Flow.create(activeFlowConfig);","        }","        for (id in activeFlowConfig.flows) {","            if (activeFlowConfig.flows.hasOwnProperty(id)) {","                if (!activeFlows[id]) {","                    activeFlows[id] = Flow.create(activeFlowConfig,activeFlowConfig.flows[id]);","                }","            }","        }","    } else {","        activeFlows['global'].update(activeFlowConfig,activeFlowConfig);","        for (id in activeFlowConfig.flows) {","            if (activeFlowConfig.flows.hasOwnProperty(id)) {","                if (activeFlows[id]) {","                    activeFlows[id].update(activeFlowConfig,activeFlowConfig.flows[id]);","                } else {","                    activeFlows[id] = Flow.create(activeFlowConfig,activeFlowConfig.flows[id]);","                }","            }","        }","    }","","    for (id in activeFlows) {","        if (activeFlows.hasOwnProperty(id)) {","            activeFlows[id].start(diff);","            var activeNodes = activeFlows[id].getActiveNodes();","            Object.keys(activeNodes).forEach(function(nid) {","                activeNodesToFlow[nid] = id;","                if (activeNodes[nid]._alias) {","                    subflowInstanceNodeMap[activeNodes[nid]._alias] = subflowInstanceNodeMap[activeNodes[nid]._alias] || [];","                    subflowInstanceNodeMap[activeNodes[nid]._alias].push(nid);","                }","            });","","        }","    }","    events.emit(\"nodes-started\");","    events.emit(\"runtime-event\",{id:\"runtime-state\"});","","    if (!muteLog) {","        if (diff) {","            log.info(log._(\"nodes.flows.started-modified-\"+type));","        } else {","            log.info(log._(\"nodes.flows.started-flows\"));","        }","    }","    return when.resolve();","}","","function stop(type,diff,muteLog) {","    type = type||\"full\";","    if (!muteLog) {","        if (diff) {","            log.info(log._(\"nodes.flows.stopping-modified-\"+type));","        } else {","            log.info(log._(\"nodes.flows.stopping-flows\"));","        }","    }","    started = false;","    var promises = [];","    var stopList;","    if (type === 'nodes') {","        stopList = diff.changed.concat(diff.removed);","    } else if (type === 'flows') {","        stopList = diff.changed.concat(diff.removed).concat(diff.linked);","    }","    for (var id in activeFlows) {","        if (activeFlows.hasOwnProperty(id)) {","            promises = promises.concat(activeFlows[id].stop(stopList));","            if (!diff || diff.removed.indexOf(id)!==-1) {","                delete activeFlows[id];","            }","        }","    }","","    return when.promise(function(resolve,reject) {","        when.settle(promises).then(function() {","            for (id in activeNodesToFlow) {","                if (activeNodesToFlow.hasOwnProperty(id)) {","                    if (!activeFlows[activeNodesToFlow[id]]) {","                        delete activeNodesToFlow[id];","                    }","                }","            }","            if (stopList) {","                stopList.forEach(function(id) {","                    delete activeNodesToFlow[id];","                });","            }","            // Ideally we'd prune just what got stopped - but mapping stopList","            // id to the list of subflow instance nodes is something only Flow","            // can do... so cheat by wiping the map knowing it'll be rebuilt","            // in start()","            subflowInstanceNodeMap = {};","            if (!muteLog) {","                if (diff) {","                    log.info(log._(\"nodes.flows.stopped-modified-\"+type));","                } else {","                    log.info(log._(\"nodes.flows.stopped-flows\"));","                }","            }","            resolve();","        });","    });","}","","","function checkTypeInUse(id) {","    var nodeInfo = typeRegistry.getNodeInfo(id);","    if (!nodeInfo) {","        throw new Error(log._(\"nodes.index.unrecognised-id\", {id:id}));","    } else {","        var inUse = {};","        var config = getFlows();","        config.flows.forEach(function(n) {","            inUse[n.type] = (inUse[n.type]||0)+1;","        });","        var nodesInUse = [];","        nodeInfo.types.forEach(function(t) {","            if (inUse[t]) {","                nodesInUse.push(t);","            }","        });","        if (nodesInUse.length > 0) {","            var msg = nodesInUse.join(\", \");","            var err = new Error(log._(\"nodes.index.type-in-use\", {msg:msg}));","            err.code = \"type_in_use\";","            throw err;","        }","    }","}","","function updateMissingTypes() {","    var subflowInstanceRE = /^subflow:(.+)$/;","    activeFlowConfig.missingTypes = [];","","    for (var id in activeFlowConfig.allNodes) {","        if (activeFlowConfig.allNodes.hasOwnProperty(id)) {","            var node = activeFlowConfig.allNodes[id];","            if (node.type !== 'tab' && node.type !== 'subflow') {","                var subflowDetails = subflowInstanceRE.exec(node.type);","                if ( (subflowDetails && !activeFlowConfig.subflows[subflowDetails[1]]) || (!subflowDetails && !typeRegistry.get(node.type)) ) {","                    if (activeFlowConfig.missingTypes.indexOf(node.type) === -1) {","                        activeFlowConfig.missingTypes.push(node.type);","                    }","                }","            }","        }","    }","}","","function addFlow(flow) {","    var i,node;","    if (!flow.hasOwnProperty('nodes')) {","        throw new Error('missing nodes property');","    }","    flow.id = redUtil.generateId();","","    var nodes = [{","        type:'tab',","        label:flow.label,","        id:flow.id","    }];","","    for (i=0;i<flow.nodes.length;i++) {","        node = flow.nodes[i];","        if (activeFlowConfig.allNodes[node.id]) {","            // TODO nls","            return when.reject(new Error('duplicate id'));","        }","        if (node.type === 'tab' || node.type === 'subflow') {","            return when.reject(new Error('invalid node type: '+node.type));","        }","        node.z = flow.id;","        nodes.push(node);","    }","    if (flow.configs) {","        for (i=0;i<flow.configs.length;i++) {","            node = flow.configs[i];","            if (activeFlowConfig.allNodes[node.id]) {","                // TODO nls","                return when.reject(new Error('duplicate id'));","            }","            if (node.type === 'tab' || node.type === 'subflow') {","                return when.reject(new Error('invalid node type: '+node.type));","            }","            node.z = flow.id;","            nodes.push(node);","        }","    }","    var newConfig = clone(activeConfig.flows);","    newConfig = newConfig.concat(nodes);","","    return setFlows(newConfig,'flows',true).then(function() {","        log.info(log._(\"nodes.flows.added-flow\",{label:(flow.label?flow.label+\" \":\"\")+\"[\"+flow.id+\"]\"}));","        return flow.id;","    });","}","","function getFlow(id) {","    var flow;","    if (id === 'global') {","        flow = activeFlowConfig;","    } else {","        flow = activeFlowConfig.flows[id];","    }","    if (!flow) {","        return null;","    }","    var result = {","        id: id","    };","    if (flow.label) {","        result.label = flow.label;","    }","    if (id !== 'global') {","        result.nodes = [];","    }","    if (flow.nodes) {","        var nodeIds = Object.keys(flow.nodes);","        if (nodeIds.length > 0) {","            result.nodes = nodeIds.map(function(nodeId) {","                var node = clone(flow.nodes[nodeId]);","                if (node.type === 'link out') {","                    delete node.wires;","                }","                return node;","            })","        }","    }","    if (flow.configs) {","        var configIds = Object.keys(flow.configs);","        result.configs = configIds.map(function(configId) {","            return clone(flow.configs[configId]);","        })","        if (result.configs.length === 0) {","            delete result.configs;","        }","    }","    if (flow.subflows) {","        var subflowIds = Object.keys(flow.subflows);","        result.subflows = subflowIds.map(function(subflowId) {","            var subflow = clone(flow.subflows[subflowId]);","            var nodeIds = Object.keys(subflow.nodes);","            subflow.nodes = nodeIds.map(function(id) {","                return subflow.nodes[id];","            });","            if (subflow.configs) {","                var configIds = Object.keys(subflow.configs);","                subflow.configs = configIds.map(function(id) {","                    return subflow.configs[id];","                })","            }","            delete subflow.instances;","            return subflow;","        });","        if (result.subflows.length === 0) {","            delete result.subflows;","        }","    }","    return result;","}","","function updateFlow(id,newFlow) {","    var label = id;","    if (id !== 'global') {","        if (!activeFlowConfig.flows[id]) {","            var e = new Error();","            e.code = 404;","            throw e;","        }","        label = activeFlowConfig.flows[id].label;","    }","    var newConfig = clone(activeConfig.flows);","    var nodes;","","    if (id === 'global') {","        // Remove all nodes whose z is not a known flow","        // When subflows can be owned by a flow, this logic will have to take","        // that into account","        newConfig = newConfig.filter(function(node) {","            return node.type === 'tab' || (node.hasOwnProperty('z') && activeFlowConfig.flows.hasOwnProperty(node.z));","        })","","        // Add in the new config nodes","        nodes = newFlow.configs||[];","        if (newFlow.subflows) {","            // Add in the new subflows","            newFlow.subflows.forEach(function(sf) {","                nodes = nodes.concat(sf.nodes||[]).concat(sf.configs||[]);","                delete sf.nodes;","                delete sf.configs;","                nodes.push(sf);","            });","        }","    } else {","        newConfig = newConfig.filter(function(node) {","            return node.z !== id && node.id !== id;","        });","        var tabNode = {","            type:'tab',","            label:newFlow.label,","            id:id","        }","        nodes = [tabNode].concat(newFlow.nodes||[]).concat(newFlow.configs||[]);","        nodes.forEach(function(n) {","            n.z = id;","        });","    }","","    newConfig = newConfig.concat(nodes);","    return setFlows(newConfig,'flows',true).then(function() {","        log.info(log._(\"nodes.flows.updated-flow\",{label:(label?label+\" \":\"\")+\"[\"+id+\"]\"}));","    })","}","","function removeFlow(id) {","    if (id === 'global') {","        // TODO: nls + error code","        throw new Error('not allowed to remove global');","    }","    var flow = activeFlowConfig.flows[id];","    if (!flow) {","        var e = new Error();","        e.code = 404;","        throw e;","    }","","    var newConfig = clone(activeConfig.flows);","    newConfig = newConfig.filter(function(node) {","        return node.z !== id && node.id !== id;","    });","","    return setFlows(newConfig,'flows',true).then(function() {","        log.info(log._(\"nodes.flows.removed-flow\",{label:(flow.label?flow.label+\" \":\"\")+\"[\"+flow.id+\"]\"}));","    });","}","","module.exports = {","    init: init,","","    /**","     * Load the current flow configuration from storage","     * @return a promise for the loading of the config","     */","    load: load,","","    get:getNode,","    eachNode: eachNode,","","    /**","     * Gets the current flow configuration","     */","    getFlows: getFlows,","","    /**","     * Sets the current active config.","     * @param config the configuration to enable","     * @param type the type of deployment to do: full (default), nodes, flows, load","     * @return a promise for the saving/starting of the new flow","     */","    setFlows: setFlows,","","    /**","     * Starts the current flow configuration","     */","    startFlows: start,","","    /**","     * Stops the current flow configuration","     * @return a promise for the stopping of the flow","     */","    stopFlows: stop,","","    get started() { return started },","","    handleError: handleError,","    handleStatus: handleStatus,","","    checkTypeInUse: checkTypeInUse,","","    addFlow: addFlow,","    getFlow: getFlow,","    updateFlow: updateFlow,","    removeFlow: removeFlow,","    disableFlow:null,","    enableFlow:null","","};",""],"l":{"17":1,"18":1,"20":1,"22":1,"23":1,"24":1,"26":1,"27":1,"28":1,"29":1,"30":1,"32":1,"33":1,"35":1,"36":1,"38":1,"39":1,"41":1,"42":1,"44":1,"46":1,"47":0,"48":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"67":0,"71":1,"72":0,"73":0,"74":0,"75":0,"78":0,"79":0,"82":1,"83":0,"91":1,"92":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"108":0,"109":0,"110":0,"111":0,"113":0,"114":0,"115":0,"116":0,"121":0,"125":0,"127":0,"128":0,"130":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"146":1,"147":0,"148":0,"149":0,"151":0,"152":0,"153":0,"154":0,"155":0,"159":0,"162":1,"163":0,"164":0,"165":0,"170":1,"171":0,"174":1,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"185":1,"186":0,"187":0,"189":0,"190":0,"191":0,"192":0,"198":1,"199":0,"200":0,"201":0,"202":0,"205":1,"206":0,"210":0,"211":0,"213":0,"214":0,"215":0,"216":0,"223":1,"225":0,"226":0,"227":0,"228":0,"229":0,"230":0,"231":0,"232":0,"233":0,"234":0,"235":0,"236":0,"238":0,"241":0,"242":0,"243":0,"244":0,"245":0,"247":0,"248":0,"250":0,"251":0,"252":0,"254":0,"257":0,"258":0,"259":0,"260":0,"262":0,"263":0,"264":0,"265":0,"270":0,"271":0,"272":0,"273":0,"274":0,"276":0,"282":0,"283":0,"284":0,"285":0,"286":0,"287":0,"288":0,"289":0,"290":0,"296":0,"297":0,"299":0,"300":0,"301":0,"303":0,"306":0,"309":1,"310":0,"311":0,"312":0,"313":0,"315":0,"318":0,"319":0,"320":0,"321":0,"322":0,"323":0,"324":0,"326":0,"327":0,"328":0,"329":0,"330":0,"335":0,"336":0,"337":0,"338":0,"339":0,"340":0,"344":0,"345":0,"346":0,"353":0,"354":0,"355":0,"356":0,"358":0,"361":0,"367":1,"368":0,"369":0,"370":0,"372":0,"373":0,"374":0,"375":0,"377":0,"378":0,"379":0,"380":0,"383":0,"384":0,"385":0,"386":0,"387":0,"392":1,"393":0,"394":0,"396":0,"397":0,"398":0,"399":0,"400":0,"401":0,"402":0,"403":0,"411":1,"412":0,"413":0,"414":0,"416":0,"418":0,"424":0,"425":0,"426":0,"428":0,"430":0,"431":0,"433":0,"434":0,"436":0,"437":0,"438":0,"439":0,"441":0,"443":0,"444":0,"446":0,"447":0,"450":0,"451":0,"453":0,"454":0,"455":0,"459":1,"460":0,"461":0,"462":0,"464":0,"466":0,"467":0,"469":0,"472":0,"473":0,"475":0,"476":0,"478":0,"479":0,"480":0,"481":0,"482":0,"483":0,"484":0,"486":0,"490":0,"491":0,"492":0,"493":0,"495":0,"496":0,"499":0,"500":0,"501":0,"502":0,"503":0,"504":0,"505":0,"507":0,"508":0,"509":0,"510":0,"513":0,"514":0,"516":0,"517":0,"520":0,"523":1,"524":0,"525":0,"526":0,"527":0,"528":0,"529":0,"531":0,"533":0,"534":0,"536":0,"540":0,"541":0,"545":0,"546":0,"548":0,"549":0,"550":0,"551":0,"552":0,"556":0,"557":0,"559":0,"564":0,"565":0,"566":0,"570":0,"571":0,"572":0,"576":1,"577":0,"579":0,"581":0,"582":0,"583":0,"584":0,"585":0,"588":0,"589":0,"590":0,"593":0,"594":0,"598":1,"634":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/flows/Flow.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/flows/Flow.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":1,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":1,"163":0,"164":0,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"187":0,"188":0,"189":0,"190":0,"191":0,"192":0,"193":0,"194":0,"195":0,"196":0,"197":0,"198":0,"199":0,"200":0,"201":0,"202":0,"203":0,"204":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"211":0,"212":0,"213":0,"214":0,"215":0,"216":0,"217":0,"218":0,"219":0,"220":0,"221":0,"222":0,"223":0,"224":0,"225":0,"226":0,"227":0,"228":0,"229":0,"230":0,"231":0,"232":0,"233":0,"234":0,"235":0,"236":0,"237":0,"238":0,"239":0,"240":0,"241":0,"242":0,"243":0,"244":0,"245":0,"246":0,"247":0,"248":0,"249":0,"250":0,"251":0,"252":0,"253":0,"254":0,"255":0,"256":0,"257":0,"258":0,"259":0,"260":0,"261":0,"262":0,"263":0,"264":0,"265":1,"266":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0,0,0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0,0],"56":[0,0],"57":[0,0],"58":[0,0],"59":[0,0],"60":[0,0],"61":[0,0],"62":[0,0],"63":[0,0],"64":[0,0],"65":[0,0],"66":[0,0],"67":[0,0],"68":[0,0],"69":[0,0],"70":[0,0],"71":[0,0],"72":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},"fnMap":{"1":{"name":"Flow","line":24,"loc":{"start":{"line":24,"column":0},"end":{"line":24,"column":27}}},"2":{"name":"(anonymous_2)","line":33,"loc":{"start":{"line":33,"column":17},"end":{"line":33,"column":32}}},"3":{"name":"(anonymous_3)","line":96,"loc":{"start":{"line":96,"column":65},"end":{"line":96,"column":77}}},"4":{"name":"(anonymous_4)","line":124,"loc":{"start":{"line":124,"column":16},"end":{"line":124,"column":35}}},"5":{"name":"(anonymous_5)","line":125,"loc":{"start":{"line":125,"column":28},"end":{"line":125,"column":46}}},"6":{"name":"(anonymous_6)","line":156,"loc":{"start":{"line":156,"column":39},"end":{"line":156,"column":50}}},"7":{"name":"(anonymous_7)","line":162,"loc":{"start":{"line":162,"column":18},"end":{"line":162,"column":42}}},"8":{"name":"(anonymous_8)","line":167,"loc":{"start":{"line":167,"column":19},"end":{"line":167,"column":32}}},"9":{"name":"(anonymous_9)","line":171,"loc":{"start":{"line":171,"column":26},"end":{"line":171,"column":37}}},"10":{"name":"(anonymous_10)","line":175,"loc":{"start":{"line":175,"column":24},"end":{"line":175,"column":53}}},"11":{"name":"(anonymous_11)","line":182,"loc":{"start":{"line":182,"column":42},"end":{"line":182,"column":69}}},"12":{"name":"(anonymous_12)","line":209,"loc":{"start":{"line":209,"column":23},"end":{"line":209,"column":53}}},"13":{"name":"(anonymous_13)","line":228,"loc":{"start":{"line":228,"column":41},"end":{"line":228,"column":67}}},"14":{"name":"createNode","line":264,"loc":{"start":{"line":264,"column":0},"end":{"line":264,"column":33}}},"15":{"name":"createSubflow","line":292,"loc":{"start":{"line":292,"column":0},"end":{"line":292,"column":67}}},"16":{"name":"(anonymous_16)","line":301,"loc":{"start":{"line":301,"column":30},"end":{"line":301,"column":44}}},"17":{"name":"(anonymous_17)","line":337,"loc":{"start":{"line":337,"column":44},"end":{"line":337,"column":57}}},"18":{"name":"(anonymous_18)","line":363,"loc":{"start":{"line":363,"column":42},"end":{"line":363,"column":54}}},"19":{"name":"(anonymous_19)","line":363,"loc":{"start":{"line":363,"column":75},"end":{"line":363,"column":87}}},"20":{"name":"(anonymous_20)","line":368,"loc":{"start":{"line":368,"column":28},"end":{"line":368,"column":42}}},"21":{"name":"(anonymous_21)","line":373,"loc":{"start":{"line":373,"column":30},"end":{"line":373,"column":49}}},"22":{"name":"(anonymous_22)","line":407,"loc":{"start":{"line":407,"column":47},"end":{"line":407,"column":60}}},"23":{"name":"(anonymous_23)","line":461,"loc":{"start":{"line":461,"column":18},"end":{"line":461,"column":33}}},"24":{"name":"(anonymous_24)","line":468,"loc":{"start":{"line":468,"column":12},"end":{"line":468,"column":34}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":29}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":42}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":31}},"5":{"start":{"line":21,"column":0},"end":{"line":21,"column":36}},"6":{"start":{"line":22,"column":0},"end":{"line":22,"column":33}},"7":{"start":{"line":24,"column":0},"end":{"line":262,"column":1}},"8":{"start":{"line":25,"column":4},"end":{"line":27,"column":5}},"9":{"start":{"line":26,"column":8},"end":{"line":26,"column":22}},"10":{"start":{"line":28,"column":4},"end":{"line":28,"column":25}},"11":{"start":{"line":29,"column":4},"end":{"line":29,"column":34}},"12":{"start":{"line":30,"column":4},"end":{"line":30,"column":26}},"13":{"start":{"line":31,"column":4},"end":{"line":31,"column":27}},"14":{"start":{"line":33,"column":4},"end":{"line":122,"column":5}},"15":{"start":{"line":34,"column":8},"end":{"line":34,"column":17}},"16":{"start":{"line":35,"column":8},"end":{"line":35,"column":20}},"17":{"start":{"line":36,"column":8},"end":{"line":36,"column":15}},"18":{"start":{"line":37,"column":8},"end":{"line":37,"column":26}},"19":{"start":{"line":38,"column":8},"end":{"line":38,"column":27}},"20":{"start":{"line":40,"column":8},"end":{"line":40,"column":52}},"21":{"start":{"line":41,"column":8},"end":{"line":41,"column":36}},"22":{"start":{"line":42,"column":8},"end":{"line":71,"column":9}},"23":{"start":{"line":43,"column":12},"end":{"line":43,"column":37}},"24":{"start":{"line":44,"column":12},"end":{"line":44,"column":36}},"25":{"start":{"line":45,"column":12},"end":{"line":70,"column":13}},"26":{"start":{"line":46,"column":16},"end":{"line":46,"column":41}},"27":{"start":{"line":49,"column":16},"end":{"line":63,"column":17}},"28":{"start":{"line":50,"column":20},"end":{"line":62,"column":21}},"29":{"start":{"line":51,"column":24},"end":{"line":61,"column":25}},"30":{"start":{"line":54,"column":28},"end":{"line":54,"column":49}},"31":{"start":{"line":55,"column":28},"end":{"line":55,"column":83}},"32":{"start":{"line":56,"column":28},"end":{"line":58,"column":29}},"33":{"start":{"line":57,"column":32},"end":{"line":57,"column":97}},"34":{"start":{"line":59,"column":28},"end":{"line":59,"column":50}},"35":{"start":{"line":60,"column":28},"end":{"line":60,"column":34}},"36":{"start":{"line":64,"column":16},"end":{"line":69,"column":17}},"37":{"start":{"line":65,"column":20},"end":{"line":65,"column":57}},"38":{"start":{"line":66,"column":20},"end":{"line":68,"column":21}},"39":{"start":{"line":67,"column":24},"end":{"line":67,"column":50}},"40":{"start":{"line":73,"column":8},"end":{"line":80,"column":9}},"41":{"start":{"line":74,"column":12},"end":{"line":79,"column":13}},"42":{"start":{"line":75,"column":16},"end":{"line":75,"column":62}},"43":{"start":{"line":76,"column":16},"end":{"line":78,"column":17}},"44":{"start":{"line":77,"column":20},"end":{"line":77,"column":76}},"45":{"start":{"line":82,"column":8},"end":{"line":108,"column":9}},"46":{"start":{"line":83,"column":12},"end":{"line":107,"column":13}},"47":{"start":{"line":84,"column":16},"end":{"line":84,"column":38}},"48":{"start":{"line":85,"column":16},"end":{"line":106,"column":17}},"49":{"start":{"line":86,"column":20},"end":{"line":91,"column":21}},"50":{"start":{"line":87,"column":24},"end":{"line":87,"column":61}},"51":{"start":{"line":88,"column":24},"end":{"line":90,"column":25}},"52":{"start":{"line":89,"column":28},"end":{"line":89,"column":54}},"53":{"start":{"line":93,"column":20},"end":{"line":105,"column":21}},"54":{"start":{"line":94,"column":24},"end":{"line":104,"column":25}},"55":{"start":{"line":95,"column":28},"end":{"line":95,"column":161}},"56":{"start":{"line":96,"column":28},"end":{"line":96,"column":93}},"57":{"start":{"line":96,"column":79},"end":{"line":96,"column":90}},"58":{"start":{"line":97,"column":28},"end":{"line":101,"column":29}},"59":{"start":{"line":98,"column":32},"end":{"line":100,"column":33}},"60":{"start":{"line":99,"column":36},"end":{"line":99,"column":72}},"61":{"start":{"line":103,"column":28},"end":{"line":103,"column":50}},"62":{"start":{"line":110,"column":8},"end":{"line":121,"column":9}},"63":{"start":{"line":111,"column":12},"end":{"line":120,"column":13}},"64":{"start":{"line":112,"column":16},"end":{"line":112,"column":39}},"65":{"start":{"line":113,"column":16},"end":{"line":119,"column":17}},"66":{"start":{"line":114,"column":20},"end":{"line":114,"column":70}},"67":{"start":{"line":115,"column":20},"end":{"line":115,"column":52}},"68":{"start":{"line":116,"column":23},"end":{"line":119,"column":17}},"69":{"start":{"line":117,"column":20},"end":{"line":117,"column":72}},"70":{"start":{"line":118,"column":20},"end":{"line":118,"column":53}},"71":{"start":{"line":124,"column":4},"end":{"line":160,"column":5}},"72":{"start":{"line":125,"column":8},"end":{"line":159,"column":11}},"73":{"start":{"line":126,"column":12},"end":{"line":126,"column":18}},"74":{"start":{"line":127,"column":12},"end":{"line":137,"column":13}},"75":{"start":{"line":128,"column":16},"end":{"line":134,"column":17}},"76":{"start":{"line":129,"column":20},"end":{"line":133,"column":21}},"77":{"start":{"line":132,"column":24},"end":{"line":132,"column":94}},"78":{"start":{"line":136,"column":16},"end":{"line":136,"column":52}},"79":{"start":{"line":138,"column":12},"end":{"line":138,"column":30}},"80":{"start":{"line":139,"column":12},"end":{"line":155,"column":13}},"81":{"start":{"line":140,"column":16},"end":{"line":140,"column":52}},"82":{"start":{"line":141,"column":16},"end":{"line":154,"column":17}},"83":{"start":{"line":142,"column":20},"end":{"line":142,"column":52}},"84":{"start":{"line":143,"column":20},"end":{"line":145,"column":21}},"85":{"start":{"line":144,"column":24},"end":{"line":144,"column":65}},"86":{"start":{"line":146,"column":20},"end":{"line":153,"column":21}},"87":{"start":{"line":147,"column":24},"end":{"line":147,"column":45}},"88":{"start":{"line":148,"column":24},"end":{"line":150,"column":25}},"89":{"start":{"line":149,"column":28},"end":{"line":149,"column":45}},"90":{"start":{"line":152,"column":24},"end":{"line":152,"column":40}},"91":{"start":{"line":156,"column":12},"end":{"line":158,"column":15}},"92":{"start":{"line":157,"column":16},"end":{"line":157,"column":26}},"93":{"start":{"line":162,"column":4},"end":{"line":165,"column":5}},"94":{"start":{"line":163,"column":8},"end":{"line":163,"column":25}},"95":{"start":{"line":164,"column":8},"end":{"line":164,"column":21}},"96":{"start":{"line":167,"column":4},"end":{"line":169,"column":5}},"97":{"start":{"line":168,"column":8},"end":{"line":168,"column":31}},"98":{"start":{"line":171,"column":4},"end":{"line":173,"column":5}},"99":{"start":{"line":172,"column":8},"end":{"line":172,"column":27}},"100":{"start":{"line":175,"column":4},"end":{"line":207,"column":5}},"101":{"start":{"line":176,"column":8},"end":{"line":176,"column":37}},"102":{"start":{"line":177,"column":8},"end":{"line":177,"column":33}},"103":{"start":{"line":178,"column":8},"end":{"line":178,"column":28}},"104":{"start":{"line":179,"column":8},"end":{"line":206,"column":9}},"105":{"start":{"line":180,"column":12},"end":{"line":180,"column":63}},"106":{"start":{"line":181,"column":12},"end":{"line":202,"column":13}},"107":{"start":{"line":182,"column":16},"end":{"line":201,"column":19}},"108":{"start":{"line":183,"column":20},"end":{"line":185,"column":21}},"109":{"start":{"line":184,"column":24},"end":{"line":184,"column":31}},"110":{"start":{"line":186,"column":20},"end":{"line":195,"column":22}},"111":{"start":{"line":196,"column":20},"end":{"line":198,"column":21}},"112":{"start":{"line":197,"column":24},"end":{"line":197,"column":76}},"113":{"start":{"line":199,"column":20},"end":{"line":199,"column":54}},"114":{"start":{"line":200,"column":20},"end":{"line":200,"column":35}},"115":{"start":{"line":203,"column":12},"end":{"line":205,"column":13}},"116":{"start":{"line":204,"column":16},"end":{"line":204,"column":61}},"117":{"start":{"line":209,"column":4},"end":{"line":261,"column":5}},"118":{"start":{"line":210,"column":8},"end":{"line":210,"column":22}},"119":{"start":{"line":211,"column":8},"end":{"line":221,"column":9}},"120":{"start":{"line":212,"column":12},"end":{"line":220,"column":13}},"121":{"start":{"line":213,"column":16},"end":{"line":219,"column":17}},"122":{"start":{"line":214,"column":20},"end":{"line":214,"column":53}},"123":{"start":{"line":215,"column":20},"end":{"line":218,"column":21}},"124":{"start":{"line":216,"column":24},"end":{"line":216,"column":66}},"125":{"start":{"line":217,"column":24},"end":{"line":217,"column":31}},"126":{"start":{"line":222,"column":8},"end":{"line":222,"column":36}},"127":{"start":{"line":223,"column":8},"end":{"line":223,"column":32}},"128":{"start":{"line":224,"column":8},"end":{"line":224,"column":28}},"129":{"start":{"line":225,"column":8},"end":{"line":260,"column":9}},"130":{"start":{"line":226,"column":12},"end":{"line":226,"column":60}},"131":{"start":{"line":227,"column":12},"end":{"line":256,"column":13}},"132":{"start":{"line":228,"column":16},"end":{"line":255,"column":19}},"133":{"start":{"line":229,"column":20},"end":{"line":231,"column":21}},"134":{"start":{"line":230,"column":24},"end":{"line":230,"column":31}},"135":{"start":{"line":232,"column":20},"end":{"line":232,"column":37}},"136":{"start":{"line":233,"column":20},"end":{"line":237,"column":21}},"137":{"start":{"line":234,"column":24},"end":{"line":234,"column":65}},"138":{"start":{"line":236,"column":24},"end":{"line":236,"column":42}},"139":{"start":{"line":238,"column":20},"end":{"line":240,"column":21}},"140":{"start":{"line":239,"column":24},"end":{"line":239,"column":65}},"141":{"start":{"line":241,"column":20},"end":{"line":249,"column":22}},"142":{"start":{"line":250,"column":20},"end":{"line":252,"column":21}},"143":{"start":{"line":251,"column":24},"end":{"line":251,"column":68}},"144":{"start":{"line":253,"column":20},"end":{"line":253,"column":58}},"145":{"start":{"line":254,"column":20},"end":{"line":254,"column":35}},"146":{"start":{"line":257,"column":12},"end":{"line":259,"column":13}},"147":{"start":{"line":258,"column":16},"end":{"line":258,"column":59}},"148":{"start":{"line":264,"column":0},"end":{"line":290,"column":1}},"149":{"start":{"line":265,"column":4},"end":{"line":265,"column":18}},"150":{"start":{"line":266,"column":4},"end":{"line":266,"column":36}},"151":{"start":{"line":267,"column":4},"end":{"line":288,"column":5}},"152":{"start":{"line":268,"column":8},"end":{"line":268,"column":33}},"153":{"start":{"line":269,"column":8},"end":{"line":269,"column":32}},"154":{"start":{"line":270,"column":8},"end":{"line":274,"column":9}},"155":{"start":{"line":271,"column":12},"end":{"line":273,"column":13}},"156":{"start":{"line":272,"column":16},"end":{"line":272,"column":53}},"157":{"start":{"line":275,"column":8},"end":{"line":285,"column":9}},"158":{"start":{"line":276,"column":12},"end":{"line":276,"column":30}},"159":{"start":{"line":279,"column":12},"end":{"line":284,"column":15}},"160":{"start":{"line":287,"column":8},"end":{"line":287,"column":65}},"161":{"start":{"line":289,"column":4},"end":{"line":289,"column":14}},"162":{"start":{"line":292,"column":0},"end":{"line":465,"column":1}},"163":{"start":{"line":294,"column":4},"end":{"line":294,"column":19}},"164":{"start":{"line":295,"column":4},"end":{"line":295,"column":22}},"165":{"start":{"line":296,"column":4},"end":{"line":296,"column":22}},"166":{"start":{"line":297,"column":4},"end":{"line":297,"column":13}},"167":{"start":{"line":298,"column":4},"end":{"line":298,"column":14}},"168":{"start":{"line":299,"column":4},"end":{"line":299,"column":14}},"169":{"start":{"line":301,"column":4},"end":{"line":309,"column":5}},"170":{"start":{"line":302,"column":8},"end":{"line":302,"column":26}},"171":{"start":{"line":303,"column":8},"end":{"line":303,"column":39}},"172":{"start":{"line":304,"column":8},"end":{"line":304,"column":33}},"173":{"start":{"line":305,"column":8},"end":{"line":305,"column":30}},"174":{"start":{"line":306,"column":8},"end":{"line":306,"column":22}},"175":{"start":{"line":307,"column":8},"end":{"line":307,"column":24}},"176":{"start":{"line":308,"column":8},"end":{"line":308,"column":28}},"177":{"start":{"line":312,"column":4},"end":{"line":316,"column":5}},"178":{"start":{"line":313,"column":8},"end":{"line":315,"column":9}},"179":{"start":{"line":314,"column":12},"end":{"line":314,"column":47}},"180":{"start":{"line":318,"column":4},"end":{"line":322,"column":5}},"181":{"start":{"line":319,"column":8},"end":{"line":321,"column":9}},"182":{"start":{"line":320,"column":12},"end":{"line":320,"column":45}},"183":{"start":{"line":326,"column":4},"end":{"line":351,"column":5}},"184":{"start":{"line":327,"column":8},"end":{"line":327,"column":27}},"185":{"start":{"line":328,"column":8},"end":{"line":350,"column":9}},"186":{"start":{"line":329,"column":12},"end":{"line":329,"column":37}},"187":{"start":{"line":330,"column":12},"end":{"line":335,"column":13}},"188":{"start":{"line":331,"column":16},"end":{"line":331,"column":35}},"189":{"start":{"line":332,"column":16},"end":{"line":334,"column":17}},"190":{"start":{"line":333,"column":20},"end":{"line":333,"column":62}},"191":{"start":{"line":336,"column":12},"end":{"line":349,"column":13}},"192":{"start":{"line":337,"column":16},"end":{"line":339,"column":18}},"193":{"start":{"line":338,"column":20},"end":{"line":338,"column":58}},"194":{"start":{"line":341,"column":16},"end":{"line":348,"column":17}},"195":{"start":{"line":342,"column":20},"end":{"line":347,"column":21}},"196":{"start":{"line":343,"column":24},"end":{"line":346,"column":25}},"197":{"start":{"line":345,"column":28},"end":{"line":345,"column":65}},"198":{"start":{"line":354,"column":4},"end":{"line":354,"column":34}},"199":{"start":{"line":355,"column":4},"end":{"line":361,"column":5}},"200":{"start":{"line":362,"column":4},"end":{"line":365,"column":5}},"201":{"start":{"line":363,"column":8},"end":{"line":363,"column":118}},"202":{"start":{"line":363,"column":56},"end":{"line":363,"column":116}},"203":{"start":{"line":363,"column":89},"end":{"line":363,"column":114}},"204":{"start":{"line":364,"column":8},"end":{"line":364,"column":70}},"205":{"start":{"line":366,"column":4},"end":{"line":366,"column":48}},"206":{"start":{"line":368,"column":4},"end":{"line":368,"column":62}},"207":{"start":{"line":368,"column":44},"end":{"line":368,"column":59}},"208":{"start":{"line":371,"column":4},"end":{"line":371,"column":55}},"209":{"start":{"line":373,"column":4},"end":{"line":415,"column":5}},"210":{"start":{"line":375,"column":8},"end":{"line":414,"column":9}},"211":{"start":{"line":376,"column":12},"end":{"line":376,"column":31}},"212":{"start":{"line":378,"column":12},"end":{"line":378,"column":74}},"213":{"start":{"line":379,"column":12},"end":{"line":389,"column":13}},"214":{"start":{"line":380,"column":16},"end":{"line":380,"column":40}},"215":{"start":{"line":381,"column":16},"end":{"line":388,"column":17}},"216":{"start":{"line":382,"column":20},"end":{"line":387,"column":21}},"217":{"start":{"line":383,"column":24},"end":{"line":383,"column":53}},"218":{"start":{"line":384,"column":24},"end":{"line":386,"column":25}},"219":{"start":{"line":385,"column":28},"end":{"line":385,"column":68}},"220":{"start":{"line":391,"column":12},"end":{"line":391,"column":35}},"221":{"start":{"line":392,"column":12},"end":{"line":392,"column":48}},"222":{"start":{"line":394,"column":12},"end":{"line":406,"column":13}},"223":{"start":{"line":395,"column":16},"end":{"line":395,"column":40}},"224":{"start":{"line":396,"column":16},"end":{"line":405,"column":17}},"225":{"start":{"line":397,"column":20},"end":{"line":404,"column":21}},"226":{"start":{"line":398,"column":24},"end":{"line":398,"column":120}},"227":{"start":{"line":399,"column":24},"end":{"line":399,"column":55}},"228":{"start":{"line":401,"column":24},"end":{"line":401,"column":53}},"229":{"start":{"line":402,"column":24},"end":{"line":402,"column":98}},"230":{"start":{"line":403,"column":24},"end":{"line":403,"column":54}},"231":{"start":{"line":407,"column":12},"end":{"line":410,"column":15}},"232":{"start":{"line":408,"column":16},"end":{"line":408,"column":45}},"233":{"start":{"line":409,"column":16},"end":{"line":409,"column":70}},"234":{"start":{"line":411,"column":12},"end":{"line":413,"column":13}},"235":{"start":{"line":412,"column":16},"end":{"line":412,"column":64}},"236":{"start":{"line":417,"column":4},"end":{"line":417,"column":28}},"237":{"start":{"line":420,"column":4},"end":{"line":439,"column":5}},"238":{"start":{"line":421,"column":8},"end":{"line":421,"column":31}},"239":{"start":{"line":422,"column":8},"end":{"line":438,"column":9}},"240":{"start":{"line":423,"column":12},"end":{"line":423,"column":36}},"241":{"start":{"line":424,"column":12},"end":{"line":437,"column":13}},"242":{"start":{"line":425,"column":16},"end":{"line":436,"column":17}},"243":{"start":{"line":427,"column":20},"end":{"line":427,"column":116}},"244":{"start":{"line":428,"column":20},"end":{"line":428,"column":68}},"245":{"start":{"line":430,"column":20},"end":{"line":430,"column":49}},"246":{"start":{"line":431,"column":20},"end":{"line":431,"column":50}},"247":{"start":{"line":432,"column":20},"end":{"line":434,"column":21}},"248":{"start":{"line":433,"column":24},"end":{"line":433,"column":64}},"249":{"start":{"line":435,"column":20},"end":{"line":435,"column":101}},"250":{"start":{"line":442,"column":4},"end":{"line":457,"column":5}},"251":{"start":{"line":443,"column":8},"end":{"line":443,"column":27}},"252":{"start":{"line":444,"column":8},"end":{"line":444,"column":29}},"253":{"start":{"line":446,"column":8},"end":{"line":446,"column":44}},"254":{"start":{"line":447,"column":8},"end":{"line":456,"column":9}},"255":{"start":{"line":448,"column":12},"end":{"line":448,"column":48}},"256":{"start":{"line":449,"column":12},"end":{"line":452,"column":13}},"257":{"start":{"line":450,"column":16},"end":{"line":450,"column":47}},"258":{"start":{"line":451,"column":16},"end":{"line":451,"column":36}},"259":{"start":{"line":454,"column":12},"end":{"line":454,"column":33}},"260":{"start":{"line":455,"column":12},"end":{"line":455,"column":137}},"261":{"start":{"line":459,"column":4},"end":{"line":459,"column":35}},"262":{"start":{"line":461,"column":4},"end":{"line":463,"column":7}},"263":{"start":{"line":462,"column":8},"end":{"line":462,"column":50}},"264":{"start":{"line":464,"column":4},"end":{"line":464,"column":17}},"265":{"start":{"line":467,"column":0},"end":{"line":471,"column":1}},"266":{"start":{"line":469,"column":8},"end":{"line":469,"column":37}}},"branchMap":{"1":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":4},"end":{"line":25,"column":4}},{"start":{"line":25,"column":4},"end":{"line":25,"column":4}}]},"2":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":12},"end":{"line":45,"column":12}},{"start":{"line":45,"column":12},"end":{"line":45,"column":12}}]},"3":{"line":50,"type":"if","locations":[{"start":{"line":50,"column":20},"end":{"line":50,"column":20}},{"start":{"line":50,"column":20},"end":{"line":50,"column":20}}]},"4":{"line":50,"type":"binary-expr","locations":[{"start":{"line":50,"column":24},"end":{"line":50,"column":49}},{"start":{"line":50,"column":53},"end":{"line":50,"column":66}},{"start":{"line":50,"column":70},"end":{"line":50,"column":86}},{"start":{"line":50,"column":90},"end":{"line":50,"column":107}},{"start":{"line":50,"column":111},"end":{"line":50,"column":135}}]},"5":{"line":51,"type":"if","locations":[{"start":{"line":51,"column":24},"end":{"line":51,"column":24}},{"start":{"line":51,"column":24},"end":{"line":51,"column":24}}]},"6":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":54},"end":{"line":55,"column":76}},{"start":{"line":55,"column":78},"end":{"line":55,"column":79}}]},"7":{"line":56,"type":"if","locations":[{"start":{"line":56,"column":28},"end":{"line":56,"column":28}},{"start":{"line":56,"column":28},"end":{"line":56,"column":28}}]},"8":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":16},"end":{"line":64,"column":16}},{"start":{"line":64,"column":16},"end":{"line":64,"column":16}}]},"9":{"line":66,"type":"if","locations":[{"start":{"line":66,"column":20},"end":{"line":66,"column":20}},{"start":{"line":66,"column":20},"end":{"line":66,"column":20}}]},"10":{"line":73,"type":"if","locations":[{"start":{"line":73,"column":8},"end":{"line":73,"column":8}},{"start":{"line":73,"column":8},"end":{"line":73,"column":8}}]},"11":{"line":73,"type":"binary-expr","locations":[{"start":{"line":73,"column":12},"end":{"line":73,"column":16}},{"start":{"line":73,"column":20},"end":{"line":73,"column":32}}]},"12":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":16},"end":{"line":76,"column":16}},{"start":{"line":76,"column":16},"end":{"line":76,"column":16}}]},"13":{"line":83,"type":"if","locations":[{"start":{"line":83,"column":12},"end":{"line":83,"column":12}},{"start":{"line":83,"column":12},"end":{"line":83,"column":12}}]},"14":{"line":85,"type":"if","locations":[{"start":{"line":85,"column":16},"end":{"line":85,"column":16}},{"start":{"line":85,"column":16},"end":{"line":85,"column":16}}]},"15":{"line":86,"type":"if","locations":[{"start":{"line":86,"column":20},"end":{"line":86,"column":20}},{"start":{"line":86,"column":20},"end":{"line":86,"column":20}}]},"16":{"line":88,"type":"if","locations":[{"start":{"line":88,"column":24},"end":{"line":88,"column":24}},{"start":{"line":88,"column":24},"end":{"line":88,"column":24}}]},"17":{"line":93,"type":"if","locations":[{"start":{"line":93,"column":20},"end":{"line":93,"column":20}},{"start":{"line":93,"column":20},"end":{"line":93,"column":20}}]},"18":{"line":95,"type":"binary-expr","locations":[{"start":{"line":95,"column":54},"end":{"line":95,"column":81}},{"start":{"line":95,"column":83},"end":{"line":95,"column":112}}]},"19":{"line":98,"type":"if","locations":[{"start":{"line":98,"column":32},"end":{"line":98,"column":32}},{"start":{"line":98,"column":32},"end":{"line":98,"column":32}}]},"20":{"line":111,"type":"if","locations":[{"start":{"line":111,"column":12},"end":{"line":111,"column":12}},{"start":{"line":111,"column":12},"end":{"line":111,"column":12}}]},"21":{"line":113,"type":"if","locations":[{"start":{"line":113,"column":16},"end":{"line":113,"column":16}},{"start":{"line":113,"column":16},"end":{"line":113,"column":16}}]},"22":{"line":114,"type":"binary-expr","locations":[{"start":{"line":114,"column":43},"end":{"line":114,"column":63}},{"start":{"line":114,"column":67},"end":{"line":114,"column":69}}]},"23":{"line":116,"type":"if","locations":[{"start":{"line":116,"column":23},"end":{"line":116,"column":23}},{"start":{"line":116,"column":23},"end":{"line":116,"column":23}}]},"24":{"line":117,"type":"binary-expr","locations":[{"start":{"line":117,"column":44},"end":{"line":117,"column":65}},{"start":{"line":117,"column":69},"end":{"line":117,"column":71}}]},"25":{"line":127,"type":"if","locations":[{"start":{"line":127,"column":12},"end":{"line":127,"column":12}},{"start":{"line":127,"column":12},"end":{"line":127,"column":12}}]},"26":{"line":129,"type":"if","locations":[{"start":{"line":129,"column":20},"end":{"line":129,"column":20}},{"start":{"line":129,"column":20},"end":{"line":129,"column":20}}]},"27":{"line":141,"type":"if","locations":[{"start":{"line":141,"column":16},"end":{"line":141,"column":16}},{"start":{"line":141,"column":16},"end":{"line":141,"column":16}}]},"28":{"line":143,"type":"if","locations":[{"start":{"line":143,"column":20},"end":{"line":143,"column":20}},{"start":{"line":143,"column":20},"end":{"line":143,"column":20}}]},"29":{"line":148,"type":"if","locations":[{"start":{"line":148,"column":24},"end":{"line":148,"column":24}},{"start":{"line":148,"column":24},"end":{"line":148,"column":24}}]},"30":{"line":179,"type":"binary-expr","locations":[{"start":{"line":179,"column":15},"end":{"line":179,"column":28}},{"start":{"line":179,"column":32},"end":{"line":179,"column":40}}]},"31":{"line":181,"type":"if","locations":[{"start":{"line":181,"column":12},"end":{"line":181,"column":12}},{"start":{"line":181,"column":12},"end":{"line":181,"column":12}}]},"32":{"line":183,"type":"if","locations":[{"start":{"line":183,"column":20},"end":{"line":183,"column":20}},{"start":{"line":183,"column":20},"end":{"line":183,"column":20}}]},"33":{"line":183,"type":"binary-expr","locations":[{"start":{"line":183,"column":24},"end":{"line":183,"column":46}},{"start":{"line":183,"column":50},"end":{"line":183,"column":96}}]},"34":{"line":196,"type":"if","locations":[{"start":{"line":196,"column":20},"end":{"line":196,"column":20}},{"start":{"line":196,"column":20},"end":{"line":196,"column":20}}]},"35":{"line":203,"type":"if","locations":[{"start":{"line":203,"column":12},"end":{"line":203,"column":12}},{"start":{"line":203,"column":12},"end":{"line":203,"column":12}}]},"36":{"line":211,"type":"if","locations":[{"start":{"line":211,"column":8},"end":{"line":211,"column":8}},{"start":{"line":211,"column":8},"end":{"line":211,"column":8}}]},"37":{"line":211,"type":"binary-expr","locations":[{"start":{"line":211,"column":12},"end":{"line":211,"column":15}},{"start":{"line":211,"column":19},"end":{"line":211,"column":46}}]},"38":{"line":212,"type":"if","locations":[{"start":{"line":212,"column":12},"end":{"line":212,"column":12}},{"start":{"line":212,"column":12},"end":{"line":212,"column":12}}]},"39":{"line":213,"type":"if","locations":[{"start":{"line":213,"column":16},"end":{"line":213,"column":16}},{"start":{"line":213,"column":16},"end":{"line":213,"column":16}}]},"40":{"line":215,"type":"if","locations":[{"start":{"line":215,"column":20},"end":{"line":215,"column":20}},{"start":{"line":215,"column":20},"end":{"line":215,"column":20}}]},"41":{"line":225,"type":"binary-expr","locations":[{"start":{"line":225,"column":15},"end":{"line":225,"column":27}},{"start":{"line":225,"column":31},"end":{"line":225,"column":39}}]},"42":{"line":227,"type":"if","locations":[{"start":{"line":227,"column":12},"end":{"line":227,"column":12}},{"start":{"line":227,"column":12},"end":{"line":227,"column":12}}]},"43":{"line":229,"type":"if","locations":[{"start":{"line":229,"column":20},"end":{"line":229,"column":20}},{"start":{"line":229,"column":20},"end":{"line":229,"column":20}}]},"44":{"line":229,"type":"binary-expr","locations":[{"start":{"line":229,"column":24},"end":{"line":229,"column":45}},{"start":{"line":229,"column":49},"end":{"line":229,"column":102}}]},"45":{"line":233,"type":"if","locations":[{"start":{"line":233,"column":20},"end":{"line":233,"column":20}},{"start":{"line":233,"column":20},"end":{"line":233,"column":20}}]},"46":{"line":238,"type":"if","locations":[{"start":{"line":238,"column":20},"end":{"line":238,"column":20}},{"start":{"line":238,"column":20},"end":{"line":238,"column":20}}]},"47":{"line":250,"type":"if","locations":[{"start":{"line":250,"column":20},"end":{"line":250,"column":20}},{"start":{"line":250,"column":20},"end":{"line":250,"column":20}}]},"48":{"line":257,"type":"if","locations":[{"start":{"line":257,"column":12},"end":{"line":257,"column":12}},{"start":{"line":257,"column":12},"end":{"line":257,"column":12}}]},"49":{"line":267,"type":"if","locations":[{"start":{"line":267,"column":4},"end":{"line":267,"column":4}},{"start":{"line":267,"column":4},"end":{"line":267,"column":4}}]},"50":{"line":271,"type":"if","locations":[{"start":{"line":271,"column":12},"end":{"line":271,"column":12}},{"start":{"line":271,"column":12},"end":{"line":271,"column":12}}]},"51":{"line":313,"type":"if","locations":[{"start":{"line":313,"column":8},"end":{"line":313,"column":8}},{"start":{"line":313,"column":8},"end":{"line":313,"column":8}}]},"52":{"line":319,"type":"if","locations":[{"start":{"line":319,"column":8},"end":{"line":319,"column":8}},{"start":{"line":319,"column":8},"end":{"line":319,"column":8}}]},"53":{"line":328,"type":"if","locations":[{"start":{"line":328,"column":8},"end":{"line":328,"column":8}},{"start":{"line":328,"column":8},"end":{"line":328,"column":8}}]},"54":{"line":336,"type":"if","locations":[{"start":{"line":336,"column":12},"end":{"line":336,"column":12}},{"start":{"line":336,"column":12},"end":{"line":336,"column":12}}]},"55":{"line":336,"type":"binary-expr","locations":[{"start":{"line":336,"column":17},"end":{"line":336,"column":38}},{"start":{"line":336,"column":42},"end":{"line":336,"column":64}},{"start":{"line":336,"column":69},"end":{"line":336,"column":79}}]},"56":{"line":338,"type":"cond-expr","locations":[{"start":{"line":338,"column":40},"end":{"line":338,"column":55}},{"start":{"line":338,"column":56},"end":{"line":338,"column":58}}]},"57":{"line":342,"type":"if","locations":[{"start":{"line":342,"column":20},"end":{"line":342,"column":20}},{"start":{"line":342,"column":20},"end":{"line":342,"column":20}}]},"58":{"line":342,"type":"binary-expr","locations":[{"start":{"line":342,"column":24},"end":{"line":342,"column":49}},{"start":{"line":342,"column":53},"end":{"line":342,"column":70}}]},"59":{"line":343,"type":"if","locations":[{"start":{"line":343,"column":24},"end":{"line":343,"column":24}},{"start":{"line":343,"column":24},"end":{"line":343,"column":24}}]},"60":{"line":362,"type":"if","locations":[{"start":{"line":362,"column":4},"end":{"line":362,"column":4}},{"start":{"line":362,"column":4},"end":{"line":362,"column":4}}]},"61":{"line":375,"type":"if","locations":[{"start":{"line":375,"column":8},"end":{"line":375,"column":8}},{"start":{"line":375,"column":8},"end":{"line":375,"column":8}}]},"62":{"line":382,"type":"if","locations":[{"start":{"line":382,"column":20},"end":{"line":382,"column":20}},{"start":{"line":382,"column":20},"end":{"line":382,"column":20}}]},"63":{"line":384,"type":"if","locations":[{"start":{"line":384,"column":24},"end":{"line":384,"column":24}},{"start":{"line":384,"column":24},"end":{"line":384,"column":24}}]},"64":{"line":397,"type":"if","locations":[{"start":{"line":397,"column":20},"end":{"line":397,"column":20}},{"start":{"line":397,"column":20},"end":{"line":397,"column":20}}]},"65":{"line":411,"type":"if","locations":[{"start":{"line":411,"column":12},"end":{"line":411,"column":12}},{"start":{"line":411,"column":12},"end":{"line":411,"column":12}}]},"66":{"line":420,"type":"if","locations":[{"start":{"line":420,"column":4},"end":{"line":420,"column":4}},{"start":{"line":420,"column":4},"end":{"line":420,"column":4}}]},"67":{"line":425,"type":"if","locations":[{"start":{"line":425,"column":16},"end":{"line":425,"column":16}},{"start":{"line":425,"column":16},"end":{"line":425,"column":16}}]},"68":{"line":432,"type":"if","locations":[{"start":{"line":432,"column":20},"end":{"line":432,"column":20}},{"start":{"line":432,"column":20},"end":{"line":432,"column":20}}]},"69":{"line":435,"type":"binary-expr","locations":[{"start":{"line":435,"column":49},"end":{"line":435,"column":74}},{"start":{"line":435,"column":76},"end":{"line":435,"column":78}}]},"70":{"line":447,"type":"if","locations":[{"start":{"line":447,"column":8},"end":{"line":447,"column":8}},{"start":{"line":447,"column":8},"end":{"line":447,"column":8}}]},"71":{"line":449,"type":"if","locations":[{"start":{"line":449,"column":12},"end":{"line":449,"column":12}},{"start":{"line":449,"column":12},"end":{"line":449,"column":12}}]},"72":{"line":455,"type":"binary-expr","locations":[{"start":{"line":455,"column":47},"end":{"line":455,"column":66}},{"start":{"line":455,"column":68},"end":{"line":455,"column":93}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var when = require(\"when\");","var clone = require(\"clone\");","var typeRegistry = require(\"../registry\");","var Log = require(\"../../log\");","var redUtil = require(\"../../util\");","var flowUtil = require(\"./util\");","","function Flow(global,flow) {","    if (typeof flow === 'undefined') {","        flow = global;","    }","    var activeNodes = {};","    var subflowInstanceNodes = {};","    var catchNodeMap = {};","    var statusNodeMap = {};","","    this.start = function(diff) {","        var node;","        var newNode;","        var id;","        catchNodeMap = {};","        statusNodeMap = {};","","        var configNodes = Object.keys(flow.configs);","        var configNodeAttempts = {};","        while (configNodes.length > 0) {","            id = configNodes.shift();","            node = flow.configs[id];","            if (!activeNodes[id]) {","                var readyToCreate = true;","                // This node doesn't exist.","                // Check it doesn't reference another non-existent config node","                for (var prop in node) {","                    if (node.hasOwnProperty(prop) && prop !== 'id' && prop !== 'wires' && prop !== '_users' && flow.configs[node[prop]]) {","                        if (!activeNodes[node[prop]]) {","                            // References a non-existent config node","                            // Add it to the back of the list to try again later","                            configNodes.push(id);","                            configNodeAttempts[id] = (configNodeAttempts[id]||0)+1;","                            if (configNodeAttempts[id] === 100) {","                                throw new Error(\"Circular config node dependency detected: \"+id);","                            }","                            readyToCreate = false;","                            break;","                        }","                    }","                }","                if (readyToCreate) {","                    newNode = createNode(node.type,node);","                    if (newNode) {","                        activeNodes[id] = newNode;","                    }","                }","            }","        }","","        if (diff && diff.rewired) {","            for (var j=0;j<diff.rewired.length;j++) {","                var rewireNode = activeNodes[diff.rewired[j]];","                if (rewireNode) {","                    rewireNode.updateWires(flow.nodes[rewireNode.id].wires);","                }","            }","        }","","        for (id in flow.nodes) {","            if (flow.nodes.hasOwnProperty(id)) {","                node = flow.nodes[id];","                if (!node.subflow) {","                    if (!activeNodes[id]) {","                        newNode = createNode(node.type,node);","                        if (newNode) {","                            activeNodes[id] = newNode;","                        }","                    }","                } else {","                    if (!subflowInstanceNodes[id]) {","                        try {","                            var nodes = createSubflow(flow.subflows[node.subflow]||global.subflows[node.subflow],node,flow.subflows,global.subflows,activeNodes);","                            subflowInstanceNodes[id] = nodes.map(function(n) { return n.id});","                            for (var i=0;i<nodes.length;i++) {","                                if (nodes[i]) {","                                    activeNodes[nodes[i].id] = nodes[i];","                                }","                            }","                        } catch(err) {","                            console.log(err.stack)","                        }","                    }","                }","            }","        }","","        for (id in activeNodes) {","            if (activeNodes.hasOwnProperty(id)) {","                node = activeNodes[id];","                if (node.type === \"catch\") {","                    catchNodeMap[node.z] = catchNodeMap[node.z] || [];","                    catchNodeMap[node.z].push(node);","                } else if (node.type === \"status\") {","                    statusNodeMap[node.z] = statusNodeMap[node.z] || [];","                    statusNodeMap[node.z].push(node);","                }","            }","        }","    }","","    this.stop = function(stopList) {","        return when.promise(function(resolve) {","            var i;","            if (stopList) {","                for (i=0;i<stopList.length;i++) {","                    if (subflowInstanceNodes[stopList[i]]) {","                        // The first in the list is the instance node we already","                        // know about","                        stopList = stopList.concat(subflowInstanceNodes[stopList[i]].slice(1))","                    }","                }","            } else {","                stopList = Object.keys(activeNodes);","            }","            var promises = [];","            for (i=0;i<stopList.length;i++) {","                var node = activeNodes[stopList[i]];","                if (node) {","                    delete activeNodes[stopList[i]];","                    if (subflowInstanceNodes[stopList[i]]) {","                        delete subflowInstanceNodes[stopList[i]];","                    }","                    try {","                        var p = node.close();","                        if (p) {","                            promises.push(p);","                        }","                    } catch(err) {","                        node.error(err);","                    }","                }","            }","            when.settle(promises).then(function() {","                resolve();","            });","        });","    }","","    this.update = function(_global,_flow) {","        global = _global;","        flow = _flow;","    }","","    this.getNode = function(id) {","        return activeNodes[id];","    }","","    this.getActiveNodes = function() {","        return activeNodes;","    }","","    this.handleStatus = function(node,statusMessage) {","        var targetStatusNodes = null;","        var reportingNode = node;","        var handled = false;","        while (reportingNode && !handled) {","            targetStatusNodes = statusNodeMap[reportingNode.z];","            if (targetStatusNodes) {","                targetStatusNodes.forEach(function(targetStatusNode) {","                    if (targetStatusNode.scope && targetStatusNode.scope.indexOf(node.id) === -1) {","                        return;","                    }","                    var message = {","                        status: {","                            text: \"\",","                            source: {","                                id: node.id,","                                type: node.type,","                                name: node.name","                            }","                        }","                    };","                    if (statusMessage.hasOwnProperty(\"text\")) {","                        message.status.text = statusMessage.text.toString();","                    }","                    targetStatusNode.receive(message);","                    handled = true;","                });","            }","            if (!handled) {","                reportingNode = activeNodes[reportingNode.z];","            }","        }","    }","","    this.handleError = function(node,logMessage,msg) {","        var count = 1;","        if (msg && msg.hasOwnProperty(\"error\")) {","            if (msg.error.hasOwnProperty(\"source\")) {","                if (msg.error.source.id === node.id) {","                    count = msg.error.source.count+1;","                    if (count === 10) {","                        node.warn(Log._(\"nodes.flow.error-loop\"));","                        return;","                    }","                }","            }","        }","        var targetCatchNodes = null;","        var throwingNode = node;","        var handled = false;","        while (throwingNode && !handled) {","            targetCatchNodes = catchNodeMap[throwingNode.z];","            if (targetCatchNodes) {","                targetCatchNodes.forEach(function(targetCatchNode) {","                    if (targetCatchNode.scope && targetCatchNode.scope.indexOf(throwingNode.id) === -1) {","                        return;","                    }","                    var errorMessage;","                    if (msg) {","                        errorMessage = redUtil.cloneMessage(msg);","                    } else {","                        errorMessage = {};","                    }","                    if (errorMessage.hasOwnProperty(\"error\")) {","                        errorMessage._error = errorMessage.error;","                    }","                    errorMessage.error = {","                        message: logMessage.toString(),","                        source: {","                            id: node.id,","                            type: node.type,","                            name: node.name,","                            count: count","                        }","                    };","                    if (logMessage.hasOwnProperty('stack')) {","                        errorMessage.error.stack = logMessage.stack;","                    }","                    targetCatchNode.receive(errorMessage);","                    handled = true;","                });","            }","            if (!handled) {","                throwingNode = activeNodes[throwingNode.z];","            }","        }","    }","}","","function createNode(type,config) {","    var nn = null;","    var nt = typeRegistry.get(type);","    if (nt) {","        var conf = clone(config);","        delete conf.credentials;","        for (var p in conf) {","            if (conf.hasOwnProperty(p)) {","                flowUtil.mapEnvVarProperties(conf,p);","            }","        }","        try {","            nn = new nt(conf);","        }","        catch (err) {","            Log.log({","                level: Log.ERROR,","                id:conf.id,","                type: type,","                msg: err","            });","        }","    } else {","        Log.error(Log._(\"nodes.flow.unknown-type\", {type:type}));","    }","    return nn;","}","","function createSubflow(sf,sfn,subflows,globalSubflows,activeNodes) {","    //console.log(\"CREATE SUBFLOW\",sf.id,sfn.id);","    var nodes = [];","    var node_map = {};","    var newNodes = [];","    var node;","    var wires;","    var i,j,k;","","    var createNodeInSubflow = function(def) {","        node = clone(def);","        var nid = redUtil.generateId();","        node_map[node.id] = node;","        node._alias = node.id;","        node.id = nid;","        node.z = sfn.id;","        newNodes.push(node);","    }","","    // Clone all of the subflow node definitions and give them new IDs","    for (i in sf.configs) {","        if (sf.configs.hasOwnProperty(i)) {","            createNodeInSubflow(sf.configs[i]);","        }","    }","    // Clone all of the subflow node definitions and give them new IDs","    for (i in sf.nodes) {","        if (sf.nodes.hasOwnProperty(i)) {","            createNodeInSubflow(sf.nodes[i]);","        }","    }","","    // Look for any catch/status nodes and update their scope ids","    // Update all subflow interior wiring to reflect new node IDs","    for (i=0;i<newNodes.length;i++) {","        node = newNodes[i];","        if (node.wires) {","            var outputs = node.wires;","            for (j=0;j<outputs.length;j++) {","                wires = outputs[j];","                for (k=0;k<wires.length;k++) {","                    outputs[j][k] = node_map[outputs[j][k]].id","                }","            }","            if ((node.type === 'catch' || node.type === 'status') && node.scope) {","                node.scope = node.scope.map(function(id) {","                    return node_map[id]?node_map[id].id:\"\"","                })","            } else {","                for (var prop in node) {","                    if (node.hasOwnProperty(prop) && prop !== '_alias') {","                        if (node_map[node[prop]]) {","                            //console.log(\"Mapped\",node.type,node.id,prop,node_map[node[prop]].id);","                            node[prop] = node_map[node[prop]].id;","                        }","                    }","                }","            }","        }","    }","","    // Create a subflow node to accept inbound messages and route appropriately","    var Node = require(\"../Node\");","    var subflowInstance = {","        id: sfn.id,","        type: sfn.type,","        z: sfn.z,","        name: sfn.name,","        wires: []","    }","    if (sf.in) {","        subflowInstance.wires = sf.in.map(function(n) { return n.wires.map(function(w) { return node_map[w.id].id;})})","        subflowInstance._originalWires = clone(subflowInstance.wires);","    }","    var subflowNode = new Node(subflowInstance);","","    subflowNode.on(\"input\", function(msg) { this.send(msg);});","","","    subflowNode._updateWires = subflowNode.updateWires;","","    subflowNode.updateWires = function(newWires) {","        // Wire the subflow outputs","        if (sf.out) {","            var node,wires,i,j;","            // Restore the original wiring to the internal nodes","            subflowInstance.wires = clone(subflowInstance._originalWires);","            for (i=0;i<sf.out.length;i++) {","                wires = sf.out[i].wires;","                for (j=0;j<wires.length;j++) {","                    if (wires[j].id != sf.id) {","                        node = node_map[wires[j].id];","                        if (node._originalWires) {","                            node.wires = clone(node._originalWires);","                        }","                    }","                }","            }","","            var modifiedNodes = {};","            var subflowInstanceModified = false;","","            for (i=0;i<sf.out.length;i++) {","                wires = sf.out[i].wires;","                for (j=0;j<wires.length;j++) {","                    if (wires[j].id === sf.id) {","                        subflowInstance.wires[wires[j].port] = subflowInstance.wires[wires[j].port].concat(newWires[i]);","                        subflowInstanceModified = true;","                    } else {","                        node = node_map[wires[j].id];","                        node.wires[wires[j].port] = node.wires[wires[j].port].concat(newWires[i]);","                        modifiedNodes[node.id] = node;","                    }","                }","            }","            Object.keys(modifiedNodes).forEach(function(id) {","                var node = modifiedNodes[id];","                subflowNode.instanceNodes[id].updateWires(node.wires);","            });","            if (subflowInstanceModified) {","                subflowNode._updateWires(subflowInstance.wires);","            }","        }","    }","","    nodes.push(subflowNode);","","    // Wire the subflow outputs","    if (sf.out) {","        var modifiedNodes = {};","        for (i=0;i<sf.out.length;i++) {","            wires = sf.out[i].wires;","            for (j=0;j<wires.length;j++) {","                if (wires[j].id === sf.id) {","                    // A subflow input wired straight to a subflow output","                    subflowInstance.wires[wires[j].port] = subflowInstance.wires[wires[j].port].concat(sfn.wires[i])","                    subflowNode._updateWires(subflowInstance.wires);","                } else {","                    node = node_map[wires[j].id];","                    modifiedNodes[node.id] = node;","                    if (!node._originalWires) {","                        node._originalWires = clone(node.wires);","                    }","                    node.wires[wires[j].port] = (node.wires[wires[j].port]||[]).concat(sfn.wires[i]);","                }","            }","        }","    }","","    // Instantiate the nodes","    for (i=0;i<newNodes.length;i++) {","        node = newNodes[i];","        var type = node.type;","","        var m = /^subflow:(.+)$/.exec(type);","        if (!m) {","            var newNode = createNode(type,node);","            if (newNode) {","                activeNodes[node.id] = newNode;","                nodes.push(newNode);","            }","        } else {","            var subflowId = m[1];","            nodes = nodes.concat(createSubflow(subflows[subflowId]||globalSubflows[subflowId],node,subflows,globalSubflows,activeNodes));","        }","    }","","    subflowNode.instanceNodes = {};","","    nodes.forEach(function(node) {","        subflowNode.instanceNodes[node.id] = node;","    });","    return nodes;","}","","module.exports = {","    create: function(global,conf) {","        return new Flow(global,conf);","    }","}",""],"l":{"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"24":1,"25":0,"26":0,"28":0,"29":0,"30":0,"31":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"49":0,"50":0,"51":0,"54":0,"55":0,"56":0,"57":0,"59":0,"60":0,"64":0,"65":0,"66":0,"67":0,"73":0,"74":0,"75":0,"76":0,"77":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"103":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"132":0,"136":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"146":0,"147":0,"148":0,"149":0,"152":0,"156":0,"157":0,"162":0,"163":0,"164":0,"167":0,"168":0,"171":0,"172":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"182":0,"183":0,"184":0,"186":0,"196":0,"197":0,"199":0,"200":0,"203":0,"204":0,"209":0,"210":0,"211":0,"212":0,"213":0,"214":0,"215":0,"216":0,"217":0,"222":0,"223":0,"224":0,"225":0,"226":0,"227":0,"228":0,"229":0,"230":0,"232":0,"233":0,"234":0,"236":0,"238":0,"239":0,"241":0,"250":0,"251":0,"253":0,"254":0,"257":0,"258":0,"264":1,"265":0,"266":0,"267":0,"268":0,"269":0,"270":0,"271":0,"272":0,"275":0,"276":0,"279":0,"287":0,"289":0,"292":1,"294":0,"295":0,"296":0,"297":0,"298":0,"299":0,"301":0,"302":0,"303":0,"304":0,"305":0,"306":0,"307":0,"308":0,"312":0,"313":0,"314":0,"318":0,"319":0,"320":0,"326":0,"327":0,"328":0,"329":0,"330":0,"331":0,"332":0,"333":0,"336":0,"337":0,"338":0,"341":0,"342":0,"343":0,"345":0,"354":0,"355":0,"362":0,"363":0,"364":0,"366":0,"368":0,"371":0,"373":0,"375":0,"376":0,"378":0,"379":0,"380":0,"381":0,"382":0,"383":0,"384":0,"385":0,"391":0,"392":0,"394":0,"395":0,"396":0,"397":0,"398":0,"399":0,"401":0,"402":0,"403":0,"407":0,"408":0,"409":0,"411":0,"412":0,"417":0,"420":0,"421":0,"422":0,"423":0,"424":0,"425":0,"427":0,"428":0,"430":0,"431":0,"432":0,"433":0,"435":0,"442":0,"443":0,"444":0,"446":0,"447":0,"448":0,"449":0,"450":0,"451":0,"454":0,"455":0,"459":0,"461":0,"462":0,"464":0,"467":1,"469":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/util.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/util.js","s":{"1":1,"2":1,"3":1,"4":0,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":1,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":1,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":1,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":1,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":1,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":1,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":0,"164":0,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"187":0,"188":0,"189":0,"190":0,"191":1,"192":0,"193":0,"194":0,"195":0,"196":0,"197":0,"198":0,"199":0,"200":0,"201":0,"202":0,"203":0,"204":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"211":0,"212":0,"213":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0,0],"55":[0,0],"56":[0,0],"57":[0,0],"58":[0,0],"59":[0,0],"60":[0,0],"61":[0,0],"62":[0,0],"63":[0,0,0],"64":[0,0],"65":[0,0],"66":[0,0],"67":[0,0],"68":[0,0],"69":[0,0],"70":[0,0],"71":[0,0],"72":[0,0],"73":[0,0],"74":[0,0],"75":[0,0],"76":[0,0],"77":[0,0],"78":[0,0],"79":[0,0],"80":[0,0],"81":[0,0],"82":[0,0],"83":[0,0],"84":[0,0],"85":[0,0],"86":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"fnMap":{"1":{"name":"generateId","line":20,"loc":{"start":{"line":20,"column":0},"end":{"line":20,"column":22}}},"2":{"name":"ensureString","line":24,"loc":{"start":{"line":24,"column":0},"end":{"line":24,"column":25}}},"3":{"name":"ensureBuffer","line":35,"loc":{"start":{"line":35,"column":0},"end":{"line":35,"column":25}}},"4":{"name":"cloneMessage","line":46,"loc":{"start":{"line":46,"column":0},"end":{"line":46,"column":27}}},"5":{"name":"compareObjects","line":65,"loc":{"start":{"line":65,"column":0},"end":{"line":65,"column":35}}},"6":{"name":"normalisePropertyExpression","line":131,"loc":{"start":{"line":131,"column":0},"end":{"line":131,"column":42}}},"7":{"name":"getMessageProperty","line":235,"loc":{"start":{"line":235,"column":0},"end":{"line":235,"column":38}}},"8":{"name":"(anonymous_8)","line":242,"loc":{"start":{"line":242,"column":24},"end":{"line":242,"column":43}}},"9":{"name":"setMessageProperty","line":249,"loc":{"start":{"line":249,"column":0},"end":{"line":249,"column":58}}},"10":{"name":"evaluateNodeProperty","line":306,"loc":{"start":{"line":306,"column":0},"end":{"line":306,"column":54}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":29}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":33}},"3":{"start":{"line":20,"column":0},"end":{"line":22,"column":1}},"4":{"start":{"line":21,"column":4},"end":{"line":21,"column":53}},"5":{"start":{"line":24,"column":0},"end":{"line":33,"column":1}},"6":{"start":{"line":25,"column":4},"end":{"line":31,"column":5}},"7":{"start":{"line":26,"column":8},"end":{"line":26,"column":28}},"8":{"start":{"line":27,"column":11},"end":{"line":31,"column":5}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":33}},"10":{"start":{"line":29,"column":11},"end":{"line":31,"column":5}},"11":{"start":{"line":30,"column":8},"end":{"line":30,"column":17}},"12":{"start":{"line":32,"column":4},"end":{"line":32,"column":16}},"13":{"start":{"line":35,"column":0},"end":{"line":44,"column":1}},"14":{"start":{"line":36,"column":4},"end":{"line":42,"column":5}},"15":{"start":{"line":37,"column":8},"end":{"line":37,"column":17}},"16":{"start":{"line":38,"column":11},"end":{"line":42,"column":5}},"17":{"start":{"line":39,"column":8},"end":{"line":39,"column":30}},"18":{"start":{"line":40,"column":11},"end":{"line":42,"column":5}},"19":{"start":{"line":41,"column":8},"end":{"line":41,"column":17}},"20":{"start":{"line":43,"column":4},"end":{"line":43,"column":25}},"21":{"start":{"line":46,"column":0},"end":{"line":63,"column":1}},"22":{"start":{"line":49,"column":4},"end":{"line":49,"column":22}},"23":{"start":{"line":50,"column":4},"end":{"line":50,"column":22}},"24":{"start":{"line":51,"column":4},"end":{"line":51,"column":19}},"25":{"start":{"line":52,"column":4},"end":{"line":52,"column":19}},"26":{"start":{"line":53,"column":4},"end":{"line":53,"column":23}},"27":{"start":{"line":54,"column":4},"end":{"line":57,"column":5}},"28":{"start":{"line":55,"column":8},"end":{"line":55,"column":20}},"29":{"start":{"line":56,"column":8},"end":{"line":56,"column":22}},"30":{"start":{"line":58,"column":4},"end":{"line":61,"column":5}},"31":{"start":{"line":59,"column":8},"end":{"line":59,"column":20}},"32":{"start":{"line":60,"column":8},"end":{"line":60,"column":22}},"33":{"start":{"line":62,"column":4},"end":{"line":62,"column":13}},"34":{"start":{"line":65,"column":0},"end":{"line":129,"column":1}},"35":{"start":{"line":66,"column":4},"end":{"line":66,"column":10}},"36":{"start":{"line":67,"column":4},"end":{"line":69,"column":5}},"37":{"start":{"line":68,"column":8},"end":{"line":68,"column":20}},"38":{"start":{"line":70,"column":4},"end":{"line":72,"column":5}},"39":{"start":{"line":71,"column":8},"end":{"line":71,"column":21}},"40":{"start":{"line":74,"column":4},"end":{"line":74,"column":39}},"41":{"start":{"line":75,"column":4},"end":{"line":75,"column":39}},"42":{"start":{"line":76,"column":4},"end":{"line":78,"column":5}},"43":{"start":{"line":77,"column":8},"end":{"line":77,"column":21}},"44":{"start":{"line":79,"column":4},"end":{"line":89,"column":5}},"45":{"start":{"line":80,"column":8},"end":{"line":82,"column":9}},"46":{"start":{"line":81,"column":12},"end":{"line":81,"column":25}},"47":{"start":{"line":83,"column":8},"end":{"line":87,"column":9}},"48":{"start":{"line":84,"column":12},"end":{"line":86,"column":13}},"49":{"start":{"line":85,"column":16},"end":{"line":85,"column":29}},"50":{"start":{"line":88,"column":8},"end":{"line":88,"column":20}},"51":{"start":{"line":90,"column":4},"end":{"line":90,"column":42}},"52":{"start":{"line":91,"column":4},"end":{"line":91,"column":42}},"53":{"start":{"line":92,"column":4},"end":{"line":94,"column":5}},"54":{"start":{"line":93,"column":8},"end":{"line":93,"column":21}},"55":{"start":{"line":95,"column":4},"end":{"line":110,"column":5}},"56":{"start":{"line":96,"column":8},"end":{"line":109,"column":9}},"57":{"start":{"line":98,"column":12},"end":{"line":98,"column":37}},"58":{"start":{"line":100,"column":12},"end":{"line":102,"column":13}},"59":{"start":{"line":101,"column":16},"end":{"line":101,"column":29}},"60":{"start":{"line":103,"column":12},"end":{"line":107,"column":13}},"61":{"start":{"line":104,"column":16},"end":{"line":106,"column":17}},"62":{"start":{"line":105,"column":20},"end":{"line":105,"column":33}},"63":{"start":{"line":108,"column":12},"end":{"line":108,"column":24}},"64":{"start":{"line":112,"column":4},"end":{"line":114,"column":5}},"65":{"start":{"line":113,"column":8},"end":{"line":113,"column":21}},"66":{"start":{"line":115,"column":4},"end":{"line":115,"column":34}},"67":{"start":{"line":116,"column":4},"end":{"line":116,"column":34}},"68":{"start":{"line":117,"column":4},"end":{"line":119,"column":5}},"69":{"start":{"line":118,"column":8},"end":{"line":118,"column":21}},"70":{"start":{"line":120,"column":4},"end":{"line":127,"column":5}},"71":{"start":{"line":122,"column":8},"end":{"line":126,"column":9}},"72":{"start":{"line":123,"column":12},"end":{"line":125,"column":13}},"73":{"start":{"line":124,"column":16},"end":{"line":124,"column":29}},"74":{"start":{"line":128,"column":4},"end":{"line":128,"column":16}},"75":{"start":{"line":131,"column":0},"end":{"line":233,"column":1}},"76":{"start":{"line":135,"column":4},"end":{"line":135,"column":28}},"77":{"start":{"line":136,"column":4},"end":{"line":138,"column":5}},"78":{"start":{"line":137,"column":8},"end":{"line":137,"column":68}},"79":{"start":{"line":139,"column":4},"end":{"line":139,"column":19}},"80":{"start":{"line":140,"column":4},"end":{"line":140,"column":18}},"81":{"start":{"line":141,"column":4},"end":{"line":141,"column":25}},"82":{"start":{"line":142,"column":4},"end":{"line":142,"column":22}},"83":{"start":{"line":143,"column":4},"end":{"line":143,"column":18}},"84":{"start":{"line":144,"column":4},"end":{"line":144,"column":10}},"85":{"start":{"line":145,"column":4},"end":{"line":225,"column":5}},"86":{"start":{"line":146,"column":8},"end":{"line":146,"column":23}},"87":{"start":{"line":147,"column":8},"end":{"line":223,"column":9}},"88":{"start":{"line":148,"column":12},"end":{"line":207,"column":13}},"89":{"start":{"line":149,"column":16},"end":{"line":151,"column":17}},"90":{"start":{"line":150,"column":20},"end":{"line":150,"column":100}},"91":{"start":{"line":152,"column":16},"end":{"line":152,"column":32}},"92":{"start":{"line":153,"column":16},"end":{"line":153,"column":30}},"93":{"start":{"line":154,"column":16},"end":{"line":154,"column":28}},"94":{"start":{"line":155,"column":19},"end":{"line":207,"column":13}},"95":{"start":{"line":156,"column":16},"end":{"line":158,"column":17}},"96":{"start":{"line":157,"column":20},"end":{"line":157,"column":95}},"97":{"start":{"line":159,"column":16},"end":{"line":166,"column":17}},"98":{"start":{"line":160,"column":20},"end":{"line":160,"column":47}},"99":{"start":{"line":161,"column":20},"end":{"line":165,"column":21}},"100":{"start":{"line":162,"column":24},"end":{"line":162,"column":48}},"101":{"start":{"line":164,"column":24},"end":{"line":164,"column":38}},"102":{"start":{"line":167,"column":16},"end":{"line":169,"column":17}},"103":{"start":{"line":168,"column":20},"end":{"line":168,"column":92}},"104":{"start":{"line":171,"column":16},"end":{"line":173,"column":17}},"105":{"start":{"line":172,"column":20},"end":{"line":172,"column":111}},"106":{"start":{"line":174,"column":16},"end":{"line":174,"column":28}},"107":{"start":{"line":175,"column":19},"end":{"line":207,"column":13}},"108":{"start":{"line":176,"column":16},"end":{"line":178,"column":17}},"109":{"start":{"line":177,"column":20},"end":{"line":177,"column":100}},"110":{"start":{"line":179,"column":16},"end":{"line":181,"column":17}},"111":{"start":{"line":180,"column":20},"end":{"line":180,"column":55}},"112":{"start":{"line":182,"column":16},"end":{"line":184,"column":17}},"113":{"start":{"line":183,"column":20},"end":{"line":183,"column":92}},"114":{"start":{"line":186,"column":16},"end":{"line":188,"column":17}},"115":{"start":{"line":187,"column":20},"end":{"line":187,"column":111}},"116":{"start":{"line":189,"column":16},"end":{"line":189,"column":28}},"117":{"start":{"line":190,"column":16},"end":{"line":190,"column":29}},"118":{"start":{"line":191,"column":19},"end":{"line":207,"column":13}},"119":{"start":{"line":192,"column":16},"end":{"line":194,"column":17}},"120":{"start":{"line":193,"column":20},"end":{"line":193,"column":100}},"121":{"start":{"line":195,"column":16},"end":{"line":202,"column":17}},"122":{"start":{"line":196,"column":20},"end":{"line":196,"column":47}},"123":{"start":{"line":197,"column":20},"end":{"line":201,"column":21}},"124":{"start":{"line":198,"column":24},"end":{"line":198,"column":48}},"125":{"start":{"line":200,"column":24},"end":{"line":200,"column":119}},"126":{"start":{"line":203,"column":16},"end":{"line":203,"column":28}},"127":{"start":{"line":204,"column":16},"end":{"line":204,"column":30}},"128":{"start":{"line":205,"column":19},"end":{"line":207,"column":13}},"129":{"start":{"line":206,"column":16},"end":{"line":206,"column":94}},"130":{"start":{"line":209,"column":12},"end":{"line":222,"column":13}},"131":{"start":{"line":210,"column":16},"end":{"line":212,"column":17}},"132":{"start":{"line":211,"column":20},"end":{"line":211,"column":106}},"133":{"start":{"line":213,"column":16},"end":{"line":213,"column":51}},"134":{"start":{"line":215,"column":16},"end":{"line":219,"column":17}},"135":{"start":{"line":216,"column":20},"end":{"line":216,"column":115}},"136":{"start":{"line":217,"column":23},"end":{"line":219,"column":17}},"137":{"start":{"line":218,"column":20},"end":{"line":218,"column":122}},"138":{"start":{"line":220,"column":16},"end":{"line":220,"column":28}},"139":{"start":{"line":221,"column":16},"end":{"line":221,"column":33}},"140":{"start":{"line":226,"column":4},"end":{"line":228,"column":5}},"141":{"start":{"line":227,"column":8},"end":{"line":227,"column":80}},"142":{"start":{"line":229,"column":4},"end":{"line":231,"column":5}},"143":{"start":{"line":230,"column":8},"end":{"line":230,"column":41}},"144":{"start":{"line":232,"column":4},"end":{"line":232,"column":17}},"145":{"start":{"line":235,"column":0},"end":{"line":247,"column":1}},"146":{"start":{"line":236,"column":4},"end":{"line":236,"column":22}},"147":{"start":{"line":237,"column":4},"end":{"line":239,"column":5}},"148":{"start":{"line":238,"column":8},"end":{"line":238,"column":33}},"149":{"start":{"line":240,"column":4},"end":{"line":240,"column":57}},"150":{"start":{"line":241,"column":4},"end":{"line":241,"column":10}},"151":{"start":{"line":242,"column":4},"end":{"line":245,"column":12}},"152":{"start":{"line":243,"column":8},"end":{"line":243,"column":74}},"153":{"start":{"line":244,"column":8},"end":{"line":244,"column":22}},"154":{"start":{"line":246,"column":4},"end":{"line":246,"column":18}},"155":{"start":{"line":249,"column":0},"end":{"line":304,"column":1}},"156":{"start":{"line":250,"column":4},"end":{"line":252,"column":5}},"157":{"start":{"line":251,"column":8},"end":{"line":251,"column":55}},"158":{"start":{"line":253,"column":4},"end":{"line":255,"column":5}},"159":{"start":{"line":254,"column":8},"end":{"line":254,"column":33}},"160":{"start":{"line":256,"column":4},"end":{"line":256,"column":57}},"161":{"start":{"line":257,"column":4},"end":{"line":257,"column":18}},"162":{"start":{"line":258,"column":4},"end":{"line":258,"column":37}},"163":{"start":{"line":259,"column":4},"end":{"line":259,"column":18}},"164":{"start":{"line":260,"column":4},"end":{"line":260,"column":12}},"165":{"start":{"line":261,"column":4},"end":{"line":293,"column":5}},"166":{"start":{"line":262,"column":8},"end":{"line":262,"column":30}},"167":{"start":{"line":263,"column":8},"end":{"line":292,"column":9}},"168":{"start":{"line":264,"column":12},"end":{"line":275,"column":13}},"169":{"start":{"line":265,"column":16},"end":{"line":265,"column":31}},"170":{"start":{"line":266,"column":19},"end":{"line":275,"column":13}},"171":{"start":{"line":267,"column":16},"end":{"line":271,"column":17}},"172":{"start":{"line":268,"column":20},"end":{"line":268,"column":34}},"173":{"start":{"line":270,"column":20},"end":{"line":270,"column":34}},"174":{"start":{"line":272,"column":16},"end":{"line":272,"column":31}},"175":{"start":{"line":274,"column":16},"end":{"line":274,"column":28}},"176":{"start":{"line":276,"column":15},"end":{"line":292,"column":9}},"177":{"start":{"line":278,"column":12},"end":{"line":291,"column":13}},"178":{"start":{"line":279,"column":16},"end":{"line":288,"column":17}},"179":{"start":{"line":280,"column":20},"end":{"line":284,"column":21}},"180":{"start":{"line":281,"column":24},"end":{"line":281,"column":38}},"181":{"start":{"line":283,"column":24},"end":{"line":283,"column":38}},"182":{"start":{"line":285,"column":20},"end":{"line":285,"column":35}},"183":{"start":{"line":287,"column":20},"end":{"line":287,"column":31}},"184":{"start":{"line":290,"column":16},"end":{"line":290,"column":31}},"185":{"start":{"line":294,"column":4},"end":{"line":294,"column":33}},"186":{"start":{"line":295,"column":4},"end":{"line":303,"column":5}},"187":{"start":{"line":296,"column":8},"end":{"line":300,"column":9}},"188":{"start":{"line":297,"column":12},"end":{"line":297,"column":30}},"189":{"start":{"line":299,"column":12},"end":{"line":299,"column":27}},"190":{"start":{"line":302,"column":8},"end":{"line":302,"column":25}},"191":{"start":{"line":306,"column":0},"end":{"line":329,"column":1}},"192":{"start":{"line":307,"column":4},"end":{"line":327,"column":5}},"193":{"start":{"line":308,"column":8},"end":{"line":308,"column":24}},"194":{"start":{"line":309,"column":11},"end":{"line":327,"column":5}},"195":{"start":{"line":310,"column":8},"end":{"line":310,"column":29}},"196":{"start":{"line":311,"column":11},"end":{"line":327,"column":5}},"197":{"start":{"line":312,"column":8},"end":{"line":312,"column":33}},"198":{"start":{"line":313,"column":11},"end":{"line":327,"column":5}},"199":{"start":{"line":314,"column":8},"end":{"line":314,"column":33}},"200":{"start":{"line":315,"column":11},"end":{"line":327,"column":5}},"201":{"start":{"line":316,"column":8},"end":{"line":316,"column":26}},"202":{"start":{"line":317,"column":11},"end":{"line":327,"column":5}},"203":{"start":{"line":318,"column":8},"end":{"line":318,"column":45}},"204":{"start":{"line":319,"column":11},"end":{"line":327,"column":5}},"205":{"start":{"line":320,"column":8},"end":{"line":320,"column":46}},"206":{"start":{"line":321,"column":11},"end":{"line":327,"column":5}},"207":{"start":{"line":322,"column":8},"end":{"line":322,"column":48}},"208":{"start":{"line":323,"column":11},"end":{"line":327,"column":5}},"209":{"start":{"line":324,"column":8},"end":{"line":324,"column":37}},"210":{"start":{"line":325,"column":11},"end":{"line":327,"column":5}},"211":{"start":{"line":326,"column":8},"end":{"line":326,"column":50}},"212":{"start":{"line":328,"column":4},"end":{"line":328,"column":17}},"213":{"start":{"line":332,"column":0},"end":{"line":342,"column":2}}},"branchMap":{"1":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":4},"end":{"line":25,"column":4}},{"start":{"line":25,"column":4},"end":{"line":25,"column":4}}]},"2":{"line":27,"type":"if","locations":[{"start":{"line":27,"column":11},"end":{"line":27,"column":11}},{"start":{"line":27,"column":11},"end":{"line":27,"column":11}}]},"3":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":11},"end":{"line":29,"column":11}},{"start":{"line":29,"column":11},"end":{"line":29,"column":11}}]},"4":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":36,"column":4}},{"start":{"line":36,"column":4},"end":{"line":36,"column":4}}]},"5":{"line":38,"type":"if","locations":[{"start":{"line":38,"column":11},"end":{"line":38,"column":11}},{"start":{"line":38,"column":11},"end":{"line":38,"column":11}}]},"6":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":11},"end":{"line":40,"column":11}},{"start":{"line":40,"column":11},"end":{"line":40,"column":11}}]},"7":{"line":54,"type":"if","locations":[{"start":{"line":54,"column":4},"end":{"line":54,"column":4}},{"start":{"line":54,"column":4},"end":{"line":54,"column":4}}]},"8":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":4},"end":{"line":58,"column":4}},{"start":{"line":58,"column":4},"end":{"line":58,"column":4}}]},"9":{"line":67,"type":"if","locations":[{"start":{"line":67,"column":4},"end":{"line":67,"column":4}},{"start":{"line":67,"column":4},"end":{"line":67,"column":4}}]},"10":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":4},"end":{"line":70,"column":4}},{"start":{"line":70,"column":4},"end":{"line":70,"column":4}}]},"11":{"line":70,"type":"binary-expr","locations":[{"start":{"line":70,"column":8},"end":{"line":70,"column":20}},{"start":{"line":70,"column":24},"end":{"line":70,"column":36}}]},"12":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":4},"end":{"line":76,"column":4}},{"start":{"line":76,"column":4},"end":{"line":76,"column":4}}]},"13":{"line":79,"type":"if","locations":[{"start":{"line":79,"column":4},"end":{"line":79,"column":4}},{"start":{"line":79,"column":4},"end":{"line":79,"column":4}}]},"14":{"line":79,"type":"binary-expr","locations":[{"start":{"line":79,"column":8},"end":{"line":79,"column":16}},{"start":{"line":79,"column":20},"end":{"line":79,"column":28}}]},"15":{"line":80,"type":"if","locations":[{"start":{"line":80,"column":8},"end":{"line":80,"column":8}},{"start":{"line":80,"column":8},"end":{"line":80,"column":8}}]},"16":{"line":84,"type":"if","locations":[{"start":{"line":84,"column":12},"end":{"line":84,"column":12}},{"start":{"line":84,"column":12},"end":{"line":84,"column":12}}]},"17":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":4},"end":{"line":92,"column":4}},{"start":{"line":92,"column":4},"end":{"line":92,"column":4}}]},"18":{"line":95,"type":"if","locations":[{"start":{"line":95,"column":4},"end":{"line":95,"column":4}},{"start":{"line":95,"column":4},"end":{"line":95,"column":4}}]},"19":{"line":95,"type":"binary-expr","locations":[{"start":{"line":95,"column":8},"end":{"line":95,"column":17}},{"start":{"line":95,"column":21},"end":{"line":95,"column":30}}]},"20":{"line":96,"type":"if","locations":[{"start":{"line":96,"column":8},"end":{"line":96,"column":8}},{"start":{"line":96,"column":8},"end":{"line":96,"column":8}}]},"21":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":12},"end":{"line":100,"column":12}},{"start":{"line":100,"column":12},"end":{"line":100,"column":12}}]},"22":{"line":104,"type":"if","locations":[{"start":{"line":104,"column":16},"end":{"line":104,"column":16}},{"start":{"line":104,"column":16},"end":{"line":104,"column":16}}]},"23":{"line":112,"type":"if","locations":[{"start":{"line":112,"column":4},"end":{"line":112,"column":4}},{"start":{"line":112,"column":4},"end":{"line":112,"column":4}}]},"24":{"line":112,"type":"binary-expr","locations":[{"start":{"line":112,"column":8},"end":{"line":112,"column":32}},{"start":{"line":112,"column":36},"end":{"line":112,"column":60}}]},"25":{"line":117,"type":"if","locations":[{"start":{"line":117,"column":4},"end":{"line":117,"column":4}},{"start":{"line":117,"column":4},"end":{"line":117,"column":4}}]},"26":{"line":122,"type":"if","locations":[{"start":{"line":122,"column":8},"end":{"line":122,"column":8}},{"start":{"line":122,"column":8},"end":{"line":122,"column":8},"skip":true}]},"27":{"line":123,"type":"if","locations":[{"start":{"line":123,"column":12},"end":{"line":123,"column":12}},{"start":{"line":123,"column":12},"end":{"line":123,"column":12}}]},"28":{"line":136,"type":"if","locations":[{"start":{"line":136,"column":4},"end":{"line":136,"column":4}},{"start":{"line":136,"column":4},"end":{"line":136,"column":4}}]},"29":{"line":147,"type":"if","locations":[{"start":{"line":147,"column":8},"end":{"line":147,"column":8}},{"start":{"line":147,"column":8},"end":{"line":147,"column":8}}]},"30":{"line":148,"type":"if","locations":[{"start":{"line":148,"column":12},"end":{"line":148,"column":12}},{"start":{"line":148,"column":12},"end":{"line":148,"column":12}}]},"31":{"line":148,"type":"binary-expr","locations":[{"start":{"line":148,"column":16},"end":{"line":148,"column":25}},{"start":{"line":148,"column":29},"end":{"line":148,"column":38}}]},"32":{"line":149,"type":"if","locations":[{"start":{"line":149,"column":16},"end":{"line":149,"column":16}},{"start":{"line":149,"column":16},"end":{"line":149,"column":16}}]},"33":{"line":155,"type":"if","locations":[{"start":{"line":155,"column":19},"end":{"line":155,"column":19}},{"start":{"line":155,"column":19},"end":{"line":155,"column":19}}]},"34":{"line":156,"type":"if","locations":[{"start":{"line":156,"column":16},"end":{"line":156,"column":16}},{"start":{"line":156,"column":16},"end":{"line":156,"column":16}}]},"35":{"line":159,"type":"if","locations":[{"start":{"line":159,"column":16},"end":{"line":159,"column":16}},{"start":{"line":159,"column":16},"end":{"line":159,"column":16}}]},"36":{"line":161,"type":"if","locations":[{"start":{"line":161,"column":20},"end":{"line":161,"column":20}},{"start":{"line":161,"column":20},"end":{"line":161,"column":20}}]},"37":{"line":167,"type":"if","locations":[{"start":{"line":167,"column":16},"end":{"line":167,"column":16}},{"start":{"line":167,"column":16},"end":{"line":167,"column":16}}]},"38":{"line":171,"type":"if","locations":[{"start":{"line":171,"column":16},"end":{"line":171,"column":16}},{"start":{"line":171,"column":16},"end":{"line":171,"column":16}}]},"39":{"line":175,"type":"if","locations":[{"start":{"line":175,"column":19},"end":{"line":175,"column":19}},{"start":{"line":175,"column":19},"end":{"line":175,"column":19}}]},"40":{"line":176,"type":"if","locations":[{"start":{"line":176,"column":16},"end":{"line":176,"column":16}},{"start":{"line":176,"column":16},"end":{"line":176,"column":16}}]},"41":{"line":179,"type":"if","locations":[{"start":{"line":179,"column":16},"end":{"line":179,"column":16}},{"start":{"line":179,"column":16},"end":{"line":179,"column":16}}]},"42":{"line":182,"type":"if","locations":[{"start":{"line":182,"column":16},"end":{"line":182,"column":16}},{"start":{"line":182,"column":16},"end":{"line":182,"column":16}}]},"43":{"line":186,"type":"if","locations":[{"start":{"line":186,"column":16},"end":{"line":186,"column":16}},{"start":{"line":186,"column":16},"end":{"line":186,"column":16}}]},"44":{"line":191,"type":"if","locations":[{"start":{"line":191,"column":19},"end":{"line":191,"column":19}},{"start":{"line":191,"column":19},"end":{"line":191,"column":19}}]},"45":{"line":192,"type":"if","locations":[{"start":{"line":192,"column":16},"end":{"line":192,"column":16}},{"start":{"line":192,"column":16},"end":{"line":192,"column":16}}]},"46":{"line":195,"type":"if","locations":[{"start":{"line":195,"column":16},"end":{"line":195,"column":16}},{"start":{"line":195,"column":16},"end":{"line":195,"column":16}}]},"47":{"line":197,"type":"if","locations":[{"start":{"line":197,"column":20},"end":{"line":197,"column":20}},{"start":{"line":197,"column":20},"end":{"line":197,"column":20}}]},"48":{"line":205,"type":"if","locations":[{"start":{"line":205,"column":19},"end":{"line":205,"column":19}},{"start":{"line":205,"column":19},"end":{"line":205,"column":19}}]},"49":{"line":209,"type":"if","locations":[{"start":{"line":209,"column":12},"end":{"line":209,"column":12}},{"start":{"line":209,"column":12},"end":{"line":209,"column":12}}]},"50":{"line":210,"type":"if","locations":[{"start":{"line":210,"column":16},"end":{"line":210,"column":16}},{"start":{"line":210,"column":16},"end":{"line":210,"column":16}}]},"51":{"line":215,"type":"if","locations":[{"start":{"line":215,"column":16},"end":{"line":215,"column":16}},{"start":{"line":215,"column":16},"end":{"line":215,"column":16}}]},"52":{"line":215,"type":"binary-expr","locations":[{"start":{"line":215,"column":20},"end":{"line":215,"column":25}},{"start":{"line":215,"column":29},"end":{"line":215,"column":49}}]},"53":{"line":217,"type":"if","locations":[{"start":{"line":217,"column":23},"end":{"line":217,"column":23}},{"start":{"line":217,"column":23},"end":{"line":217,"column":23}}]},"54":{"line":217,"type":"binary-expr","locations":[{"start":{"line":217,"column":27},"end":{"line":217,"column":33}},{"start":{"line":217,"column":37},"end":{"line":217,"column":49}},{"start":{"line":217,"column":53},"end":{"line":217,"column":77}}]},"55":{"line":226,"type":"if","locations":[{"start":{"line":226,"column":4},"end":{"line":226,"column":4}},{"start":{"line":226,"column":4},"end":{"line":226,"column":4}}]},"56":{"line":226,"type":"binary-expr","locations":[{"start":{"line":226,"column":8},"end":{"line":226,"column":13}},{"start":{"line":226,"column":17},"end":{"line":226,"column":25}}]},"57":{"line":229,"type":"if","locations":[{"start":{"line":229,"column":4},"end":{"line":229,"column":4}},{"start":{"line":229,"column":4},"end":{"line":229,"column":4}}]},"58":{"line":237,"type":"if","locations":[{"start":{"line":237,"column":4},"end":{"line":237,"column":4}},{"start":{"line":237,"column":4},"end":{"line":237,"column":4}}]},"59":{"line":243,"type":"cond-expr","locations":[{"start":{"line":243,"column":52},"end":{"line":243,"column":60}},{"start":{"line":243,"column":63},"end":{"line":243,"column":72}}]},"60":{"line":250,"type":"if","locations":[{"start":{"line":250,"column":4},"end":{"line":250,"column":4}},{"start":{"line":250,"column":4},"end":{"line":250,"column":4}}]},"61":{"line":253,"type":"if","locations":[{"start":{"line":253,"column":4},"end":{"line":253,"column":4}},{"start":{"line":253,"column":4},"end":{"line":253,"column":4}}]},"62":{"line":263,"type":"if","locations":[{"start":{"line":263,"column":8},"end":{"line":263,"column":8}},{"start":{"line":263,"column":8},"end":{"line":263,"column":8}}]},"63":{"line":263,"type":"binary-expr","locations":[{"start":{"line":263,"column":12},"end":{"line":263,"column":35}},{"start":{"line":263,"column":40},"end":{"line":263,"column":63}},{"start":{"line":263,"column":67},"end":{"line":263,"column":86}}]},"64":{"line":264,"type":"if","locations":[{"start":{"line":264,"column":12},"end":{"line":264,"column":12}},{"start":{"line":264,"column":12},"end":{"line":264,"column":12}}]},"65":{"line":266,"type":"if","locations":[{"start":{"line":266,"column":19},"end":{"line":266,"column":19}},{"start":{"line":266,"column":19},"end":{"line":266,"column":19}}]},"66":{"line":267,"type":"if","locations":[{"start":{"line":267,"column":16},"end":{"line":267,"column":16}},{"start":{"line":267,"column":16},"end":{"line":267,"column":16}}]},"67":{"line":276,"type":"if","locations":[{"start":{"line":276,"column":15},"end":{"line":276,"column":15}},{"start":{"line":276,"column":15},"end":{"line":276,"column":15}}]},"68":{"line":278,"type":"if","locations":[{"start":{"line":278,"column":12},"end":{"line":278,"column":12}},{"start":{"line":278,"column":12},"end":{"line":278,"column":12}}]},"69":{"line":279,"type":"if","locations":[{"start":{"line":279,"column":16},"end":{"line":279,"column":16}},{"start":{"line":279,"column":16},"end":{"line":279,"column":16}}]},"70":{"line":280,"type":"if","locations":[{"start":{"line":280,"column":20},"end":{"line":280,"column":20}},{"start":{"line":280,"column":20},"end":{"line":280,"column":20}}]},"71":{"line":295,"type":"if","locations":[{"start":{"line":295,"column":4},"end":{"line":295,"column":4}},{"start":{"line":295,"column":4},"end":{"line":295,"column":4}}]},"72":{"line":296,"type":"if","locations":[{"start":{"line":296,"column":8},"end":{"line":296,"column":8}},{"start":{"line":296,"column":8},"end":{"line":296,"column":8}}]},"73":{"line":296,"type":"binary-expr","locations":[{"start":{"line":296,"column":12},"end":{"line":296,"column":35}},{"start":{"line":296,"column":39},"end":{"line":296,"column":57}}]},"74":{"line":307,"type":"if","locations":[{"start":{"line":307,"column":4},"end":{"line":307,"column":4}},{"start":{"line":307,"column":4},"end":{"line":307,"column":4}}]},"75":{"line":309,"type":"if","locations":[{"start":{"line":309,"column":11},"end":{"line":309,"column":11}},{"start":{"line":309,"column":11},"end":{"line":309,"column":11}}]},"76":{"line":311,"type":"if","locations":[{"start":{"line":311,"column":11},"end":{"line":311,"column":11}},{"start":{"line":311,"column":11},"end":{"line":311,"column":11}}]},"77":{"line":313,"type":"if","locations":[{"start":{"line":313,"column":11},"end":{"line":313,"column":11}},{"start":{"line":313,"column":11},"end":{"line":313,"column":11}}]},"78":{"line":315,"type":"if","locations":[{"start":{"line":315,"column":11},"end":{"line":315,"column":11}},{"start":{"line":315,"column":11},"end":{"line":315,"column":11}}]},"79":{"line":317,"type":"if","locations":[{"start":{"line":317,"column":11},"end":{"line":317,"column":11}},{"start":{"line":317,"column":11},"end":{"line":317,"column":11}}]},"80":{"line":317,"type":"binary-expr","locations":[{"start":{"line":317,"column":15},"end":{"line":317,"column":29}},{"start":{"line":317,"column":33},"end":{"line":317,"column":36}}]},"81":{"line":319,"type":"if","locations":[{"start":{"line":319,"column":11},"end":{"line":319,"column":11}},{"start":{"line":319,"column":11},"end":{"line":319,"column":11}}]},"82":{"line":319,"type":"binary-expr","locations":[{"start":{"line":319,"column":15},"end":{"line":319,"column":30}},{"start":{"line":319,"column":34},"end":{"line":319,"column":38}}]},"83":{"line":321,"type":"if","locations":[{"start":{"line":321,"column":11},"end":{"line":321,"column":11}},{"start":{"line":321,"column":11},"end":{"line":321,"column":11}}]},"84":{"line":321,"type":"binary-expr","locations":[{"start":{"line":321,"column":15},"end":{"line":321,"column":32}},{"start":{"line":321,"column":36},"end":{"line":321,"column":40}}]},"85":{"line":323,"type":"if","locations":[{"start":{"line":323,"column":11},"end":{"line":323,"column":11}},{"start":{"line":323,"column":11},"end":{"line":323,"column":11}}]},"86":{"line":325,"type":"if","locations":[{"start":{"line":325,"column":11},"end":{"line":325,"column":11}},{"start":{"line":325,"column":11},"end":{"line":325,"column":11}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var clone = require(\"clone\");","var jsonata = require(\"jsonata\");","","function generateId() {","    return (1+Math.random()*4294967295).toString(16);","}","","function ensureString(o) {","    if (Buffer.isBuffer(o)) {","        return o.toString();","    } else if (typeof o === \"object\") {","        return JSON.stringify(o);","    } else if (typeof o === \"string\") {","        return o;","    }","    return \"\"+o;","}","","function ensureBuffer(o) {","    if (Buffer.isBuffer(o)) {","        return o;","    } else if (typeof o === \"object\") {","        o = JSON.stringify(o);","    } else if (typeof o !== \"string\") {","        o = \"\"+o;","    }","    return new Buffer(o);","}","","function cloneMessage(msg) {","    // Temporary fix for #97","    // TODO: remove this http-node-specific fix somehow","    var req = msg.req;","    var res = msg.res;","    delete msg.req;","    delete msg.res;","    var m = clone(msg);","    if (req) {","        m.req = req;","        msg.req = req;","    }","    if (res) {","        m.res = res;","        msg.res = res;","    }","    return m;","}","","function compareObjects(obj1,obj2) {","    var i;","    if (obj1 === obj2) {","        return true;","    }","    if (obj1 == null || obj2 == null) {","        return false;","    }","","    var isArray1 = Array.isArray(obj1);","    var isArray2 = Array.isArray(obj2);","    if (isArray1 != isArray2) {","        return false;","    }","    if (isArray1 && isArray2) {","        if (obj1.length !== obj2.length) {","            return false;","        }","        for (i=0;i<obj1.length;i++) {","            if (!compareObjects(obj1[i],obj2[i])) {","                return false;","            }","        }","        return true;","    }","    var isBuffer1 = Buffer.isBuffer(obj1);","    var isBuffer2 = Buffer.isBuffer(obj2);","    if (isBuffer1 != isBuffer2) {","        return false;","    }","    if (isBuffer1 && isBuffer2) {","        if (obj1.equals) {","            // For node 0.12+ - use the native equals","            return obj1.equals(obj2);","        } else {","            if (obj1.length !== obj2.length) {","                return false;","            }","            for (i=0;i<obj1.length;i++) {","                if (obj1.readUInt8(i) !== obj2.readUInt8(i)) {","                    return false;","                }","            }","            return true;","        }","    }","","    if (typeof obj1 !== 'object' || typeof obj2 !== 'object') {","        return false;","    }","    var keys1 = Object.keys(obj1);","    var keys2 = Object.keys(obj2);","    if (keys1.length != keys2.length) {","        return false;","    }","    for (var k in obj1) {","        /* istanbul ignore else */","        if (obj1.hasOwnProperty(k)) {","            if (!compareObjects(obj1[k],obj2[k])) {","                return false;","            }","        }","    }","    return true;","}","","function normalisePropertyExpression(str) {","    // This must be kept in sync with validatePropertyExpression","    // in editor/js/ui/utils.js","","    var length = str.length;","    if (length === 0) {","        throw new Error(\"Invalid property expression: zero-length\");","    }","    var parts = [];","    var start = 0;","    var inString = false;","    var inBox = false;","    var quoteChar;","    var v;","    for (var i=0;i<length;i++) {","        var c = str[i];","        if (!inString) {","            if (c === \"'\" || c === '\"') {","                if (i != start) {","                    throw new Error(\"Invalid property expression: unexpected \"+c+\" at position \"+i);","                }","                inString = true;","                quoteChar = c;","                start = i+1;","            } else if (c === '.') {","                if (i===0) {","                    throw new Error(\"Invalid property expression: unexpected . at position 0\");","                }","                if (start != i) {","                    v = str.substring(start,i);","                    if (/^\\d+$/.test(v)) {","                        parts.push(parseInt(v));","                    } else {","                        parts.push(v);","                    }","                }","                if (i===length-1) {","                    throw new Error(\"Invalid property expression: unterminated expression\");","                }","                // Next char is first char of an identifier: a-z 0-9 $ _","                if (!/[a-z0-9\\$\\_]/i.test(str[i+1])) {","                    throw new Error(\"Invalid property expression: unexpected \"+str[i+1]+\" at position \"+(i+1));","                }","                start = i+1;","            } else if (c === '[') {","                if (i === 0) {","                    throw new Error(\"Invalid property expression: unexpected \"+c+\" at position \"+i);","                }","                if (start != i) {","                    parts.push(str.substring(start,i));","                }","                if (i===length-1) {","                    throw new Error(\"Invalid property expression: unterminated expression\");","                }","                // Next char is either a quote or a number","                if (!/[\"'\\d]/.test(str[i+1])) {","                    throw new Error(\"Invalid property expression: unexpected \"+str[i+1]+\" at position \"+(i+1));","                }","                start = i+1;","                inBox = true;","            } else if (c === ']') {","                if (!inBox) {","                    throw new Error(\"Invalid property expression: unexpected \"+c+\" at position \"+i);","                }","                if (start != i) {","                    v = str.substring(start,i);","                    if (/^\\d+$/.test(v)) {","                        parts.push(parseInt(v));","                    } else {","                        throw new Error(\"Invalid property expression: unexpected array expression at position \"+start);","                    }","                }","                start = i+1;","                inBox = false;","            } else if (c === ' ') {","                throw new Error(\"Invalid property expression: unexpected ' ' at position \"+i);","            }","        } else {","            if (c === quoteChar) {","                if (i-start === 0) {","                    throw new Error(\"Invalid property expression: zero-length string at position \"+start);","                }","                parts.push(str.substring(start,i));","                // If inBox, next char must be a ]. Otherwise it may be [ or .","                if (inBox && !/\\]/.test(str[i+1])) {","                    throw new Error(\"Invalid property expression: unexpected array expression at position \"+start);","                } else if (!inBox && i+1!==length && !/[\\[\\.]/.test(str[i+1])) {","                    throw new Error(\"Invalid property expression: unexpected \"+str[i+1]+\" expression at position \"+(i+1));","                }","                start = i+1;","                inString = false;","            }","        }","","    }","    if (inBox || inString) {","        throw new Error(\"Invalid property expression: unterminated expression\");","    }","    if (start < length) {","        parts.push(str.substring(start));","    }","    return parts;","}","","function getMessageProperty(msg,expr) {","    var result = null;","    if (expr.indexOf('msg.')===0) {","        expr = expr.substring(4);","    }","    var msgPropParts = normalisePropertyExpression(expr);","    var m;","    msgPropParts.reduce(function(obj, key) {","        result = (typeof obj[key] !== \"undefined\" ? obj[key] : undefined);","        return result;","    }, msg);","    return result;","}","","function setMessageProperty(msg,prop,value,createMissing) {","    if (typeof createMissing === 'undefined') {","        createMissing = (typeof value !== 'undefined');","    }","    if (prop.indexOf('msg.')===0) {","        prop = prop.substring(4);","    }","    var msgPropParts = normalisePropertyExpression(prop);","    var depth = 0;","    var length = msgPropParts.length;","    var obj = msg;","    var key;","    for (var i=0;i<length-1;i++) {","        key = msgPropParts[i];","        if (typeof key === 'string' || (typeof key === 'number' && !Array.isArray(obj))) {","            if (obj.hasOwnProperty(key)) {","                obj = obj[key];","            } else if (createMissing) {","                if (typeof msgPropParts[i+1] === 'string') {","                    obj[key] = {};","                } else {","                    obj[key] = [];","                }","                obj = obj[key];","            } else {","                return null;","            }","        } else if (typeof key === 'number') {","            // obj is an array","            if (obj[key] === undefined) {","                if (createMissing) {","                    if (typeof msgPropParts[i+1] === 'string') {","                        obj[key] = {};","                    } else {","                        obj[key] = [];","                    }","                    obj = obj[key];","                } else {","                    return null","                }","            } else {","                obj = obj[key];","            }","        }","    }","    key = msgPropParts[length-1];","    if (typeof value === \"undefined\") {","        if (typeof key === 'number' && Array.isArray(obj)) {","            obj.splice(key,1);","        } else {","            delete obj[key]","        }","    } else {","        obj[key] = value;","    }","}","","function evaluateNodeProperty(value, type, node, msg) {","    if (type === 'str') {","        return \"\"+value;","    } else if (type === 'num') {","        return Number(value);","    } else if (type === 'json') {","        return JSON.parse(value);","    } else if (type === 're') {","        return new RegExp(value);","    } else if (type === 'date') {","        return Date.now();","    } else if (type === 'msg' && msg) {","        return getMessageProperty(msg,value);","    } else if (type === 'flow' && node) {","        return node.context().flow.get(value);","    } else if (type === 'global' && node) {","        return node.context().global.get(value);","    } else if (type === 'bool') {","        return /^true$/i.test(value);","    } else if (type === 'jsonata') {","        return jsonata(value).evaluate({msg:msg});","    }","    return value;","}","","","module.exports = {","    ensureString: ensureString,","    ensureBuffer: ensureBuffer,","    cloneMessage: cloneMessage,","    compareObjects: compareObjects,","    generateId: generateId,","    getMessageProperty: getMessageProperty,","    setMessageProperty: setMessageProperty,","    evaluateNodeProperty: evaluateNodeProperty,","    normalisePropertyExpression: normalisePropertyExpression","};",""],"l":{"17":1,"18":1,"20":1,"21":0,"24":1,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"32":0,"35":1,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"43":0,"46":1,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"58":0,"59":0,"60":0,"62":0,"65":1,"66":0,"67":0,"68":0,"70":0,"71":0,"74":0,"75":0,"76":0,"77":0,"79":0,"80":0,"81":0,"83":0,"84":0,"85":0,"88":0,"90":0,"91":0,"92":0,"93":0,"95":0,"96":0,"98":0,"100":0,"101":0,"103":0,"104":0,"105":0,"108":0,"112":0,"113":0,"115":0,"116":0,"117":0,"118":0,"120":0,"122":0,"123":0,"124":0,"128":0,"131":1,"135":0,"136":0,"137":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"159":0,"160":0,"161":0,"162":0,"164":0,"167":0,"168":0,"171":0,"172":0,"174":0,"175":0,"176":0,"177":0,"179":0,"180":0,"182":0,"183":0,"186":0,"187":0,"189":0,"190":0,"191":0,"192":0,"193":0,"195":0,"196":0,"197":0,"198":0,"200":0,"203":0,"204":0,"205":0,"206":0,"209":0,"210":0,"211":0,"213":0,"215":0,"216":0,"217":0,"218":0,"220":0,"221":0,"226":0,"227":0,"229":0,"230":0,"232":0,"235":1,"236":0,"237":0,"238":0,"240":0,"241":0,"242":0,"243":0,"244":0,"246":0,"249":1,"250":0,"251":0,"253":0,"254":0,"256":0,"257":0,"258":0,"259":0,"260":0,"261":0,"262":0,"263":0,"264":0,"265":0,"266":0,"267":0,"268":0,"270":0,"272":0,"274":0,"276":0,"278":0,"279":0,"280":0,"281":0,"283":0,"285":0,"287":0,"290":0,"294":0,"295":0,"296":0,"297":0,"299":0,"302":0,"306":1,"307":0,"308":0,"309":0,"310":0,"311":0,"312":0,"313":0,"314":0,"315":0,"316":0,"317":0,"318":0,"319":0,"320":0,"321":0,"322":0,"323":0,"324":0,"325":0,"326":0,"328":0,"332":1}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/flows/util.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/flows/util.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":1,"20":1,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":1,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":0,"164":0,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"187":0,"188":0,"189":0,"190":0,"191":0,"192":0,"193":0,"194":0,"195":0,"196":0,"197":0,"198":0,"199":0,"200":0,"201":0,"202":0,"203":0,"204":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"211":0,"212":0,"213":0,"214":0,"215":0,"216":0,"217":0,"218":0,"219":0,"220":0,"221":0,"222":0,"223":0},"b":{"1":[0,0],"2":[0,0,0],"3":[0,0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0,0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0,0,0,0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0],"56":[0,0],"57":[0,0],"58":[0,0],"59":[0,0],"60":[0,0],"61":[0,0],"62":[0,0],"63":[0,0],"64":[0,0],"65":[0,0],"66":[0,0],"67":[0,0],"68":[0,0],"69":[0,0],"70":[0,0,0,0],"71":[0,0],"72":[0,0],"73":[0,0],"74":[0,0],"75":[0,0],"76":[0,0],"77":[0,0],"78":[0,0],"79":[0,0],"80":[0,0],"81":[0,0],"82":[0,0],"83":[0,0],"84":[0,0],"85":[0,0],"86":[0,0],"87":[0,0],"88":[0,0,0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"fnMap":{"1":{"name":"diffNodes","line":21,"loc":{"start":{"line":21,"column":0},"end":{"line":21,"column":36}}},"2":{"name":"(anonymous_2)","line":25,"loc":{"start":{"line":25,"column":46},"end":{"line":25,"column":58}}},"3":{"name":"(anonymous_3)","line":26,"loc":{"start":{"line":26,"column":46},"end":{"line":26,"column":58}}},"4":{"name":"mapEnvVarProperties","line":42,"loc":{"start":{"line":42,"column":0},"end":{"line":42,"column":39}}},"5":{"name":"(anonymous_5)","line":70,"loc":{"start":{"line":70,"column":17},"end":{"line":70,"column":34}}},"6":{"name":"(anonymous_6)","line":78,"loc":{"start":{"line":78,"column":23},"end":{"line":78,"column":35}}},"7":{"name":"(anonymous_7)","line":88,"loc":{"start":{"line":88,"column":23},"end":{"line":88,"column":35}}},"8":{"name":"(anonymous_8)","line":98,"loc":{"start":{"line":98,"column":23},"end":{"line":98,"column":35}}},"9":{"name":"(anonymous_9)","line":132,"loc":{"start":{"line":132,"column":36},"end":{"line":132,"column":49}}},"10":{"name":"(anonymous_10)","line":138,"loc":{"start":{"line":138,"column":36},"end":{"line":138,"column":49}}},"11":{"name":"(anonymous_11)","line":145,"loc":{"start":{"line":145,"column":29},"end":{"line":145,"column":41}}},"12":{"name":"(anonymous_12)","line":153,"loc":{"start":{"line":153,"column":23},"end":{"line":153,"column":35}}},"13":{"name":"(anonymous_13)","line":183,"loc":{"start":{"line":183,"column":17},"end":{"line":183,"column":48}}}},"statementMap":{"1":{"start":{"line":16,"column":0},"end":{"line":16,"column":29}},"2":{"start":{"line":17,"column":0},"end":{"line":17,"column":36}},"3":{"start":{"line":18,"column":0},"end":{"line":18,"column":41}},"4":{"start":{"line":19,"column":0},"end":{"line":19,"column":42}},"5":{"start":{"line":21,"column":0},"end":{"line":38,"column":1}},"6":{"start":{"line":22,"column":4},"end":{"line":24,"column":5}},"7":{"start":{"line":23,"column":8},"end":{"line":23,"column":20}},"8":{"start":{"line":25,"column":4},"end":{"line":25,"column":107}},"9":{"start":{"line":25,"column":60},"end":{"line":25,"column":104}},"10":{"start":{"line":26,"column":4},"end":{"line":26,"column":107}},"11":{"start":{"line":26,"column":60},"end":{"line":26,"column":104}},"12":{"start":{"line":27,"column":4},"end":{"line":29,"column":5}},"13":{"start":{"line":28,"column":8},"end":{"line":28,"column":20}},"14":{"start":{"line":30,"column":4},"end":{"line":35,"column":5}},"15":{"start":{"line":31,"column":8},"end":{"line":31,"column":27}},"16":{"start":{"line":32,"column":8},"end":{"line":34,"column":9}},"17":{"start":{"line":33,"column":12},"end":{"line":33,"column":24}},"18":{"start":{"line":37,"column":4},"end":{"line":37,"column":17}},"19":{"start":{"line":40,"column":0},"end":{"line":40,"column":39}},"20":{"start":{"line":42,"column":0},"end":{"line":63,"column":1}},"21":{"start":{"line":43,"column":4},"end":{"line":62,"column":5}},"22":{"start":{"line":44,"column":8},"end":{"line":44,"column":15}},"23":{"start":{"line":45,"column":11},"end":{"line":62,"column":5}},"24":{"start":{"line":46,"column":8},"end":{"line":48,"column":9}},"25":{"start":{"line":47,"column":12},"end":{"line":47,"column":45}},"26":{"start":{"line":49,"column":11},"end":{"line":62,"column":5}},"27":{"start":{"line":50,"column":8},"end":{"line":50,"column":14}},"28":{"start":{"line":51,"column":8},"end":{"line":55,"column":9}},"29":{"start":{"line":52,"column":12},"end":{"line":54,"column":13}},"30":{"start":{"line":53,"column":16},"end":{"line":53,"column":46}},"31":{"start":{"line":57,"column":8},"end":{"line":61,"column":9}},"32":{"start":{"line":58,"column":12},"end":{"line":60,"column":13}},"33":{"start":{"line":59,"column":16},"end":{"line":59,"column":49}},"34":{"start":{"line":65,"column":0},"end":{"line":410,"column":1}},"35":{"start":{"line":71,"column":8},"end":{"line":71,"column":22}},"36":{"start":{"line":72,"column":8},"end":{"line":72,"column":27}},"37":{"start":{"line":73,"column":8},"end":{"line":73,"column":27}},"38":{"start":{"line":74,"column":8},"end":{"line":74,"column":26}},"39":{"start":{"line":75,"column":8},"end":{"line":75,"column":24}},"40":{"start":{"line":76,"column":8},"end":{"line":76,"column":31}},"41":{"start":{"line":78,"column":8},"end":{"line":86,"column":11}},"42":{"start":{"line":79,"column":12},"end":{"line":79,"column":43}},"43":{"start":{"line":80,"column":12},"end":{"line":85,"column":13}},"44":{"start":{"line":81,"column":16},"end":{"line":81,"column":37}},"45":{"start":{"line":82,"column":16},"end":{"line":82,"column":47}},"46":{"start":{"line":83,"column":16},"end":{"line":83,"column":46}},"47":{"start":{"line":84,"column":16},"end":{"line":84,"column":44}},"48":{"start":{"line":88,"column":8},"end":{"line":95,"column":11}},"49":{"start":{"line":89,"column":12},"end":{"line":94,"column":13}},"50":{"start":{"line":90,"column":16},"end":{"line":90,"column":40}},"51":{"start":{"line":91,"column":16},"end":{"line":91,"column":49}},"52":{"start":{"line":92,"column":16},"end":{"line":92,"column":47}},"53":{"start":{"line":93,"column":16},"end":{"line":93,"column":51}},"54":{"start":{"line":96,"column":8},"end":{"line":96,"column":27}},"55":{"start":{"line":97,"column":8},"end":{"line":97,"column":30}},"56":{"start":{"line":98,"column":8},"end":{"line":144,"column":11}},"57":{"start":{"line":99,"column":12},"end":{"line":143,"column":13}},"58":{"start":{"line":100,"column":16},"end":{"line":100,"column":68}},"59":{"start":{"line":102,"column":16},"end":{"line":106,"column":17}},"60":{"start":{"line":103,"column":20},"end":{"line":105,"column":21}},"61":{"start":{"line":104,"column":24},"end":{"line":104,"column":55}},"62":{"start":{"line":107,"column":16},"end":{"line":107,"column":37}},"63":{"start":{"line":108,"column":16},"end":{"line":112,"column":17}},"64":{"start":{"line":109,"column":20},"end":{"line":109,"column":48}},"65":{"start":{"line":110,"column":23},"end":{"line":112,"column":17}},"66":{"start":{"line":111,"column":20},"end":{"line":111,"column":51}},"67":{"start":{"line":113,"column":16},"end":{"line":129,"column":17}},"68":{"start":{"line":114,"column":20},"end":{"line":118,"column":21}},"69":{"start":{"line":115,"column":24},"end":{"line":115,"column":59}},"70":{"start":{"line":116,"column":24},"end":{"line":116,"column":48}},"71":{"start":{"line":117,"column":24},"end":{"line":117,"column":68}},"72":{"start":{"line":119,"column":20},"end":{"line":121,"column":21}},"73":{"start":{"line":120,"column":24},"end":{"line":120,"column":50}},"74":{"start":{"line":123,"column":20},"end":{"line":128,"column":21}},"75":{"start":{"line":124,"column":24},"end":{"line":124,"column":52}},"76":{"start":{"line":126,"column":24},"end":{"line":126,"column":47}},"77":{"start":{"line":127,"column":24},"end":{"line":127,"column":55}},"78":{"start":{"line":130,"column":16},"end":{"line":142,"column":17}},"79":{"start":{"line":132,"column":20},"end":{"line":135,"column":22}},"80":{"start":{"line":133,"column":24},"end":{"line":133,"column":58}},"81":{"start":{"line":134,"column":24},"end":{"line":134,"column":51}},"82":{"start":{"line":136,"column":23},"end":{"line":142,"column":17}},"83":{"start":{"line":137,"column":20},"end":{"line":137,"column":58}},"84":{"start":{"line":138,"column":20},"end":{"line":140,"column":22}},"85":{"start":{"line":139,"column":24},"end":{"line":139,"column":51}},"86":{"start":{"line":141,"column":20},"end":{"line":141,"column":41}},"87":{"start":{"line":145,"column":8},"end":{"line":149,"column":11}},"88":{"start":{"line":146,"column":12},"end":{"line":146,"column":40}},"89":{"start":{"line":147,"column":12},"end":{"line":147,"column":45}},"90":{"start":{"line":148,"column":12},"end":{"line":148,"column":32}},"91":{"start":{"line":152,"column":8},"end":{"line":152,"column":27}},"92":{"start":{"line":153,"column":8},"end":{"line":179,"column":11}},"93":{"start":{"line":154,"column":12},"end":{"line":178,"column":13}},"94":{"start":{"line":155,"column":16},"end":{"line":160,"column":17}},"95":{"start":{"line":156,"column":20},"end":{"line":159,"column":21}},"96":{"start":{"line":158,"column":24},"end":{"line":158,"column":63}},"97":{"start":{"line":161,"column":16},"end":{"line":177,"column":17}},"98":{"start":{"line":163,"column":20},"end":{"line":169,"column":21}},"99":{"start":{"line":164,"column":24},"end":{"line":164,"column":62}},"100":{"start":{"line":165,"column":24},"end":{"line":165,"column":54}},"101":{"start":{"line":166,"column":24},"end":{"line":166,"column":53}},"102":{"start":{"line":167,"column":24},"end":{"line":167,"column":51}},"103":{"start":{"line":168,"column":24},"end":{"line":168,"column":57}},"104":{"start":{"line":170,"column":20},"end":{"line":176,"column":21}},"105":{"start":{"line":171,"column":24},"end":{"line":175,"column":25}},"106":{"start":{"line":172,"column":28},"end":{"line":172,"column":59}},"107":{"start":{"line":174,"column":28},"end":{"line":174,"column":61}},"108":{"start":{"line":180,"column":8},"end":{"line":180,"column":20}},"109":{"start":{"line":184,"column":8},"end":{"line":184,"column":15}},"110":{"start":{"line":185,"column":8},"end":{"line":185,"column":17}},"111":{"start":{"line":186,"column":8},"end":{"line":186,"column":15}},"112":{"start":{"line":187,"column":8},"end":{"line":187,"column":18}},"113":{"start":{"line":188,"column":8},"end":{"line":188,"column":16}},"114":{"start":{"line":190,"column":8},"end":{"line":190,"column":33}},"115":{"start":{"line":192,"column":8},"end":{"line":192,"column":23}},"116":{"start":{"line":193,"column":8},"end":{"line":193,"column":25}},"117":{"start":{"line":194,"column":8},"end":{"line":194,"column":25}},"118":{"start":{"line":195,"column":8},"end":{"line":195,"column":31}},"119":{"start":{"line":197,"column":8},"end":{"line":197,"column":25}},"120":{"start":{"line":199,"column":8},"end":{"line":258,"column":9}},"121":{"start":{"line":200,"column":12},"end":{"line":257,"column":13}},"122":{"start":{"line":201,"column":16},"end":{"line":201,"column":46}},"123":{"start":{"line":203,"column":16},"end":{"line":216,"column":17}},"124":{"start":{"line":204,"column":20},"end":{"line":204,"column":62}},"125":{"start":{"line":205,"column":20},"end":{"line":215,"column":21}},"126":{"start":{"line":206,"column":24},"end":{"line":206,"column":46}},"127":{"start":{"line":207,"column":24},"end":{"line":214,"column":25}},"128":{"start":{"line":208,"column":28},"end":{"line":208,"column":60}},"129":{"start":{"line":209,"column":28},"end":{"line":209,"column":62}},"130":{"start":{"line":210,"column":28},"end":{"line":213,"column":29}},"131":{"start":{"line":211,"column":32},"end":{"line":211,"column":70}},"132":{"start":{"line":212,"column":32},"end":{"line":212,"column":61}},"133":{"start":{"line":218,"column":16},"end":{"line":256,"column":17}},"134":{"start":{"line":219,"column":20},"end":{"line":219,"column":39}},"135":{"start":{"line":221,"column":20},"end":{"line":227,"column":21}},"136":{"start":{"line":222,"column":24},"end":{"line":222,"column":83}},"137":{"start":{"line":223,"column":24},"end":{"line":226,"column":25}},"138":{"start":{"line":224,"column":28},"end":{"line":224,"column":84}},"139":{"start":{"line":230,"column":20},"end":{"line":243,"column":21}},"140":{"start":{"line":231,"column":24},"end":{"line":231,"column":61}},"141":{"start":{"line":232,"column":24},"end":{"line":234,"column":25}},"142":{"start":{"line":233,"column":28},"end":{"line":233,"column":62}},"143":{"start":{"line":236,"column":24},"end":{"line":242,"column":25}},"144":{"start":{"line":237,"column":28},"end":{"line":237,"column":87}},"145":{"start":{"line":238,"column":28},"end":{"line":241,"column":29}},"146":{"start":{"line":239,"column":32},"end":{"line":239,"column":88}},"147":{"start":{"line":240,"column":32},"end":{"line":240,"column":51}},"148":{"start":{"line":245,"column":20},"end":{"line":255,"column":21}},"149":{"start":{"line":246,"column":24},"end":{"line":246,"column":67}},"150":{"start":{"line":248,"column":24},"end":{"line":254,"column":25}},"151":{"start":{"line":249,"column":28},"end":{"line":249,"column":99}},"152":{"start":{"line":250,"column":28},"end":{"line":253,"column":29}},"153":{"start":{"line":251,"column":32},"end":{"line":251,"column":100}},"154":{"start":{"line":252,"column":32},"end":{"line":252,"column":57}},"155":{"start":{"line":260,"column":8},"end":{"line":295,"column":9}},"156":{"start":{"line":261,"column":12},"end":{"line":294,"column":13}},"157":{"start":{"line":262,"column":16},"end":{"line":262,"column":46}},"158":{"start":{"line":264,"column":16},"end":{"line":281,"column":17}},"159":{"start":{"line":265,"column":20},"end":{"line":265,"column":62}},"160":{"start":{"line":266,"column":20},"end":{"line":280,"column":21}},"161":{"start":{"line":267,"column":24},"end":{"line":267,"column":46}},"162":{"start":{"line":268,"column":24},"end":{"line":279,"column":25}},"163":{"start":{"line":269,"column":28},"end":{"line":271,"column":29}},"164":{"start":{"line":270,"column":32},"end":{"line":270,"column":64}},"165":{"start":{"line":272,"column":28},"end":{"line":272,"column":62}},"166":{"start":{"line":273,"column":28},"end":{"line":278,"column":29}},"167":{"start":{"line":274,"column":32},"end":{"line":274,"column":70}},"168":{"start":{"line":275,"column":32},"end":{"line":277,"column":33}},"169":{"start":{"line":276,"column":36},"end":{"line":276,"column":65}},"170":{"start":{"line":283,"column":16},"end":{"line":293,"column":17}},"171":{"start":{"line":284,"column":20},"end":{"line":284,"column":37}},"172":{"start":{"line":286,"column":20},"end":{"line":292,"column":21}},"173":{"start":{"line":287,"column":24},"end":{"line":287,"column":79}},"174":{"start":{"line":288,"column":24},"end":{"line":291,"column":25}},"175":{"start":{"line":289,"column":28},"end":{"line":289,"column":80}},"176":{"start":{"line":290,"column":28},"end":{"line":290,"column":45}},"177":{"start":{"line":297,"column":8},"end":{"line":297,"column":23}},"178":{"start":{"line":302,"column":8},"end":{"line":330,"column":35}},"179":{"start":{"line":303,"column":12},"end":{"line":303,"column":31}},"180":{"start":{"line":304,"column":12},"end":{"line":329,"column":13}},"181":{"start":{"line":305,"column":16},"end":{"line":328,"column":17}},"182":{"start":{"line":306,"column":20},"end":{"line":306,"column":50}},"183":{"start":{"line":307,"column":20},"end":{"line":327,"column":21}},"184":{"start":{"line":308,"column":24},"end":{"line":326,"column":25}},"185":{"start":{"line":312,"column":28},"end":{"line":325,"column":29}},"186":{"start":{"line":313,"column":32},"end":{"line":324,"column":33}},"187":{"start":{"line":314,"column":36},"end":{"line":314,"column":54}},"188":{"start":{"line":315,"column":36},"end":{"line":315,"column":60}},"189":{"start":{"line":318,"column":36},"end":{"line":323,"column":37}},"190":{"start":{"line":319,"column":40},"end":{"line":319,"column":85}},"191":{"start":{"line":320,"column":40},"end":{"line":322,"column":41}},"192":{"start":{"line":321,"column":44},"end":{"line":321,"column":86}},"193":{"start":{"line":334,"column":8},"end":{"line":341,"column":9}},"194":{"start":{"line":335,"column":12},"end":{"line":340,"column":13}},"195":{"start":{"line":336,"column":16},"end":{"line":336,"column":46}},"196":{"start":{"line":337,"column":16},"end":{"line":339,"column":17}},"197":{"start":{"line":338,"column":20},"end":{"line":338,"column":44}},"198":{"start":{"line":344,"column":8},"end":{"line":344,"column":63}},"199":{"start":{"line":345,"column":8},"end":{"line":366,"column":9}},"200":{"start":{"line":346,"column":12},"end":{"line":346,"column":54}},"201":{"start":{"line":347,"column":12},"end":{"line":365,"column":13}},"202":{"start":{"line":348,"column":16},"end":{"line":364,"column":17}},"203":{"start":{"line":349,"column":20},"end":{"line":349,"column":50}},"204":{"start":{"line":350,"column":20},"end":{"line":363,"column":21}},"205":{"start":{"line":351,"column":24},"end":{"line":362,"column":25}},"206":{"start":{"line":352,"column":28},"end":{"line":352,"column":52}},"207":{"start":{"line":353,"column":28},"end":{"line":361,"column":29}},"208":{"start":{"line":354,"column":32},"end":{"line":354,"column":101}},"209":{"start":{"line":355,"column":32},"end":{"line":360,"column":33}},"210":{"start":{"line":358,"column":36},"end":{"line":358,"column":81}},"211":{"start":{"line":359,"column":36},"end":{"line":359,"column":60}},"212":{"start":{"line":368,"column":8},"end":{"line":374,"column":9}},"213":{"start":{"line":377,"column":8},"end":{"line":377,"column":102}},"214":{"start":{"line":378,"column":8},"end":{"line":378,"column":25}},"215":{"start":{"line":379,"column":8},"end":{"line":390,"column":9}},"216":{"start":{"line":380,"column":12},"end":{"line":380,"column":39}},"217":{"start":{"line":381,"column":12},"end":{"line":389,"column":13}},"218":{"start":{"line":382,"column":16},"end":{"line":382,"column":37}},"219":{"start":{"line":383,"column":16},"end":{"line":388,"column":17}},"220":{"start":{"line":384,"column":20},"end":{"line":386,"column":21}},"221":{"start":{"line":385,"column":24},"end":{"line":385,"column":47}},"222":{"start":{"line":387,"column":20},"end":{"line":387,"column":72}},"223":{"start":{"line":408,"column":8},"end":{"line":408,"column":20}}},"branchMap":{"1":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":4},"end":{"line":22,"column":4}},{"start":{"line":22,"column":4},"end":{"line":22,"column":4}}]},"2":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":67},"end":{"line":25,"column":75}},{"start":{"line":25,"column":79},"end":{"line":25,"column":87}},{"start":{"line":25,"column":91},"end":{"line":25,"column":103}}]},"3":{"line":26,"type":"binary-expr","locations":[{"start":{"line":26,"column":67},"end":{"line":26,"column":75}},{"start":{"line":26,"column":79},"end":{"line":26,"column":87}},{"start":{"line":26,"column":91},"end":{"line":26,"column":103}}]},"4":{"line":27,"type":"if","locations":[{"start":{"line":27,"column":4},"end":{"line":27,"column":4}},{"start":{"line":27,"column":4},"end":{"line":27,"column":4}}]},"5":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":8},"end":{"line":32,"column":8}},{"start":{"line":32,"column":8},"end":{"line":32,"column":8}}]},"6":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":4},"end":{"line":43,"column":4}},{"start":{"line":43,"column":4},"end":{"line":43,"column":4}}]},"7":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":11},"end":{"line":45,"column":11}},{"start":{"line":45,"column":11},"end":{"line":45,"column":11}}]},"8":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":11},"end":{"line":49,"column":11}},{"start":{"line":49,"column":11},"end":{"line":49,"column":11}}]},"9":{"line":51,"type":"if","locations":[{"start":{"line":51,"column":8},"end":{"line":51,"column":8}},{"start":{"line":51,"column":8},"end":{"line":51,"column":8}}]},"10":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":12},"end":{"line":52,"column":12}},{"start":{"line":52,"column":12},"end":{"line":52,"column":12}}]},"11":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":12},"end":{"line":58,"column":12}},{"start":{"line":58,"column":12},"end":{"line":58,"column":12}}]},"12":{"line":80,"type":"if","locations":[{"start":{"line":80,"column":12},"end":{"line":80,"column":12}},{"start":{"line":80,"column":12},"end":{"line":80,"column":12}}]},"13":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":12},"end":{"line":89,"column":12}},{"start":{"line":89,"column":12},"end":{"line":89,"column":12}}]},"14":{"line":99,"type":"if","locations":[{"start":{"line":99,"column":12},"end":{"line":99,"column":12}},{"start":{"line":99,"column":12},"end":{"line":99,"column":12}}]},"15":{"line":99,"type":"binary-expr","locations":[{"start":{"line":99,"column":16},"end":{"line":99,"column":36}},{"start":{"line":99,"column":40},"end":{"line":99,"column":56}}]},"16":{"line":102,"type":"if","locations":[{"start":{"line":102,"column":16},"end":{"line":102,"column":16}},{"start":{"line":102,"column":16},"end":{"line":102,"column":16}}]},"17":{"line":102,"type":"binary-expr","locations":[{"start":{"line":102,"column":22},"end":{"line":102,"column":36}},{"start":{"line":102,"column":40},"end":{"line":102,"column":73}},{"start":{"line":102,"column":79},"end":{"line":102,"column":94}},{"start":{"line":102,"column":98},"end":{"line":102,"column":123}}]},"18":{"line":103,"type":"if","locations":[{"start":{"line":103,"column":20},"end":{"line":103,"column":20}},{"start":{"line":103,"column":20},"end":{"line":103,"column":20}}]},"19":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":16},"end":{"line":108,"column":16}},{"start":{"line":108,"column":16},"end":{"line":108,"column":16}}]},"20":{"line":110,"type":"if","locations":[{"start":{"line":110,"column":23},"end":{"line":110,"column":23}},{"start":{"line":110,"column":23},"end":{"line":110,"column":23}}]},"21":{"line":113,"type":"if","locations":[{"start":{"line":113,"column":16},"end":{"line":113,"column":16}},{"start":{"line":113,"column":16},"end":{"line":113,"column":16}}]},"22":{"line":113,"type":"binary-expr","locations":[{"start":{"line":113,"column":20},"end":{"line":113,"column":41}},{"start":{"line":113,"column":45},"end":{"line":113,"column":66}}]},"23":{"line":114,"type":"if","locations":[{"start":{"line":114,"column":20},"end":{"line":114,"column":20}},{"start":{"line":114,"column":20},"end":{"line":114,"column":20}}]},"24":{"line":119,"type":"if","locations":[{"start":{"line":119,"column":20},"end":{"line":119,"column":20}},{"start":{"line":119,"column":20},"end":{"line":119,"column":20}}]},"25":{"line":123,"type":"if","locations":[{"start":{"line":123,"column":20},"end":{"line":123,"column":20}},{"start":{"line":123,"column":20},"end":{"line":123,"column":20}}]},"26":{"line":130,"type":"if","locations":[{"start":{"line":130,"column":16},"end":{"line":130,"column":16}},{"start":{"line":130,"column":16},"end":{"line":130,"column":16}}]},"27":{"line":130,"type":"binary-expr","locations":[{"start":{"line":130,"column":20},"end":{"line":130,"column":40}},{"start":{"line":130,"column":44},"end":{"line":130,"column":51}}]},"28":{"line":133,"type":"binary-expr","locations":[{"start":{"line":133,"column":40},"end":{"line":133,"column":53}},{"start":{"line":133,"column":55},"end":{"line":133,"column":57}}]},"29":{"line":136,"type":"if","locations":[{"start":{"line":136,"column":23},"end":{"line":136,"column":23}},{"start":{"line":136,"column":23},"end":{"line":136,"column":23}}]},"30":{"line":136,"type":"binary-expr","locations":[{"start":{"line":136,"column":27},"end":{"line":136,"column":48}},{"start":{"line":136,"column":52},"end":{"line":136,"column":59}}]},"31":{"line":137,"type":"binary-expr","locations":[{"start":{"line":137,"column":38},"end":{"line":137,"column":53}},{"start":{"line":137,"column":55},"end":{"line":137,"column":57}}]},"32":{"line":154,"type":"if","locations":[{"start":{"line":154,"column":12},"end":{"line":154,"column":12}},{"start":{"line":154,"column":12},"end":{"line":154,"column":12}}]},"33":{"line":154,"type":"binary-expr","locations":[{"start":{"line":154,"column":16},"end":{"line":154,"column":36}},{"start":{"line":154,"column":40},"end":{"line":154,"column":56}}]},"34":{"line":156,"type":"if","locations":[{"start":{"line":156,"column":20},"end":{"line":156,"column":20}},{"start":{"line":156,"column":20},"end":{"line":156,"column":20}}]},"35":{"line":156,"type":"binary-expr","locations":[{"start":{"line":156,"column":24},"end":{"line":156,"column":46}},{"start":{"line":156,"column":50},"end":{"line":156,"column":63}},{"start":{"line":156,"column":67},"end":{"line":156,"column":83}},{"start":{"line":156,"column":87},"end":{"line":156,"column":102}},{"start":{"line":156,"column":106},"end":{"line":156,"column":123}},{"start":{"line":156,"column":127},"end":{"line":156,"column":163}}]},"36":{"line":161,"type":"if","locations":[{"start":{"line":161,"column":16},"end":{"line":161,"column":16}},{"start":{"line":161,"column":16},"end":{"line":161,"column":16}}]},"37":{"line":161,"type":"binary-expr","locations":[{"start":{"line":161,"column":20},"end":{"line":161,"column":23}},{"start":{"line":161,"column":27},"end":{"line":161,"column":46}}]},"38":{"line":163,"type":"if","locations":[{"start":{"line":163,"column":20},"end":{"line":163,"column":20}},{"start":{"line":163,"column":20},"end":{"line":163,"column":20}}]},"39":{"line":170,"type":"if","locations":[{"start":{"line":170,"column":20},"end":{"line":170,"column":20}},{"start":{"line":170,"column":20},"end":{"line":170,"column":20}}]},"40":{"line":171,"type":"if","locations":[{"start":{"line":171,"column":24},"end":{"line":171,"column":24}},{"start":{"line":171,"column":24},"end":{"line":171,"column":24}}]},"41":{"line":171,"type":"binary-expr","locations":[{"start":{"line":171,"column":28},"end":{"line":171,"column":49}},{"start":{"line":171,"column":53},"end":{"line":171,"column":74}}]},"42":{"line":200,"type":"if","locations":[{"start":{"line":200,"column":12},"end":{"line":200,"column":12}},{"start":{"line":200,"column":12},"end":{"line":200,"column":12}}]},"43":{"line":203,"type":"if","locations":[{"start":{"line":203,"column":16},"end":{"line":203,"column":16}},{"start":{"line":203,"column":16},"end":{"line":203,"column":16}}]},"44":{"line":204,"type":"binary-expr","locations":[{"start":{"line":204,"column":39},"end":{"line":204,"column":55}},{"start":{"line":204,"column":59},"end":{"line":204,"column":61}}]},"45":{"line":210,"type":"if","locations":[{"start":{"line":210,"column":28},"end":{"line":210,"column":28}},{"start":{"line":210,"column":28},"end":{"line":210,"column":28}}]},"46":{"line":211,"type":"binary-expr","locations":[{"start":{"line":211,"column":49},"end":{"line":211,"column":63}},{"start":{"line":211,"column":67},"end":{"line":211,"column":69}}]},"47":{"line":218,"type":"if","locations":[{"start":{"line":218,"column":16},"end":{"line":218,"column":16}},{"start":{"line":218,"column":16},"end":{"line":218,"column":16}}]},"48":{"line":221,"type":"if","locations":[{"start":{"line":221,"column":20},"end":{"line":221,"column":20}},{"start":{"line":221,"column":20},"end":{"line":221,"column":20}}]},"49":{"line":223,"type":"if","locations":[{"start":{"line":223,"column":24},"end":{"line":223,"column":24}},{"start":{"line":223,"column":24},"end":{"line":223,"column":24}}]},"50":{"line":230,"type":"if","locations":[{"start":{"line":230,"column":20},"end":{"line":230,"column":20}},{"start":{"line":230,"column":20},"end":{"line":230,"column":20}}]},"51":{"line":230,"type":"binary-expr","locations":[{"start":{"line":230,"column":24},"end":{"line":230,"column":62}},{"start":{"line":230,"column":66},"end":{"line":230,"column":100}}]},"52":{"line":232,"type":"if","locations":[{"start":{"line":232,"column":24},"end":{"line":232,"column":24}},{"start":{"line":232,"column":24},"end":{"line":232,"column":24}}]},"53":{"line":236,"type":"if","locations":[{"start":{"line":236,"column":24},"end":{"line":236,"column":24}},{"start":{"line":236,"column":24},"end":{"line":236,"column":24}}]},"54":{"line":238,"type":"if","locations":[{"start":{"line":238,"column":28},"end":{"line":238,"column":28}},{"start":{"line":238,"column":28},"end":{"line":238,"column":28}}]},"55":{"line":245,"type":"if","locations":[{"start":{"line":245,"column":20},"end":{"line":245,"column":20}},{"start":{"line":245,"column":20},"end":{"line":245,"column":20}}]},"56":{"line":248,"type":"if","locations":[{"start":{"line":248,"column":24},"end":{"line":248,"column":24}},{"start":{"line":248,"column":24},"end":{"line":248,"column":24}}]},"57":{"line":250,"type":"if","locations":[{"start":{"line":250,"column":28},"end":{"line":250,"column":28}},{"start":{"line":250,"column":28},"end":{"line":250,"column":28}}]},"58":{"line":261,"type":"if","locations":[{"start":{"line":261,"column":12},"end":{"line":261,"column":12}},{"start":{"line":261,"column":12},"end":{"line":261,"column":12}}]},"59":{"line":264,"type":"if","locations":[{"start":{"line":264,"column":16},"end":{"line":264,"column":16}},{"start":{"line":264,"column":16},"end":{"line":264,"column":16}}]},"60":{"line":265,"type":"binary-expr","locations":[{"start":{"line":265,"column":39},"end":{"line":265,"column":55}},{"start":{"line":265,"column":59},"end":{"line":265,"column":61}}]},"61":{"line":269,"type":"if","locations":[{"start":{"line":269,"column":28},"end":{"line":269,"column":28}},{"start":{"line":269,"column":28},"end":{"line":269,"column":28}}]},"62":{"line":273,"type":"if","locations":[{"start":{"line":273,"column":28},"end":{"line":273,"column":28}},{"start":{"line":273,"column":28},"end":{"line":273,"column":28}}]},"63":{"line":274,"type":"binary-expr","locations":[{"start":{"line":274,"column":49},"end":{"line":274,"column":63}},{"start":{"line":274,"column":67},"end":{"line":274,"column":69}}]},"64":{"line":275,"type":"if","locations":[{"start":{"line":275,"column":32},"end":{"line":275,"column":32}},{"start":{"line":275,"column":32},"end":{"line":275,"column":32}}]},"65":{"line":283,"type":"if","locations":[{"start":{"line":283,"column":16},"end":{"line":283,"column":16}},{"start":{"line":283,"column":16},"end":{"line":283,"column":16}}]},"66":{"line":286,"type":"if","locations":[{"start":{"line":286,"column":20},"end":{"line":286,"column":20}},{"start":{"line":286,"column":20},"end":{"line":286,"column":20}}]},"67":{"line":288,"type":"if","locations":[{"start":{"line":288,"column":24},"end":{"line":288,"column":24}},{"start":{"line":288,"column":24},"end":{"line":288,"column":24}}]},"68":{"line":305,"type":"if","locations":[{"start":{"line":305,"column":16},"end":{"line":305,"column":16}},{"start":{"line":305,"column":16},"end":{"line":305,"column":16}}]},"69":{"line":308,"type":"if","locations":[{"start":{"line":308,"column":24},"end":{"line":308,"column":24}},{"start":{"line":308,"column":24},"end":{"line":308,"column":24}}]},"70":{"line":308,"type":"binary-expr","locations":[{"start":{"line":308,"column":28},"end":{"line":308,"column":53}},{"start":{"line":308,"column":57},"end":{"line":308,"column":68}},{"start":{"line":308,"column":72},"end":{"line":308,"column":84}},{"start":{"line":308,"column":88},"end":{"line":308,"column":103}}]},"71":{"line":312,"type":"if","locations":[{"start":{"line":312,"column":28},"end":{"line":312,"column":28}},{"start":{"line":312,"column":28},"end":{"line":312,"column":28}}]},"72":{"line":312,"type":"binary-expr","locations":[{"start":{"line":312,"column":32},"end":{"line":312,"column":51}},{"start":{"line":312,"column":55},"end":{"line":312,"column":74}}]},"73":{"line":313,"type":"if","locations":[{"start":{"line":313,"column":32},"end":{"line":313,"column":32}},{"start":{"line":313,"column":32},"end":{"line":313,"column":32}}]},"74":{"line":318,"type":"if","locations":[{"start":{"line":318,"column":36},"end":{"line":318,"column":36}},{"start":{"line":318,"column":36},"end":{"line":318,"column":36}}]},"75":{"line":320,"type":"if","locations":[{"start":{"line":320,"column":40},"end":{"line":320,"column":40}},{"start":{"line":320,"column":40},"end":{"line":320,"column":40}}]},"76":{"line":335,"type":"if","locations":[{"start":{"line":335,"column":12},"end":{"line":335,"column":12}},{"start":{"line":335,"column":12},"end":{"line":335,"column":12}}]},"77":{"line":337,"type":"if","locations":[{"start":{"line":337,"column":16},"end":{"line":337,"column":16}},{"start":{"line":337,"column":16},"end":{"line":337,"column":16}}]},"78":{"line":337,"type":"binary-expr","locations":[{"start":{"line":337,"column":20},"end":{"line":337,"column":46}},{"start":{"line":337,"column":50},"end":{"line":337,"column":95}}]},"79":{"line":348,"type":"if","locations":[{"start":{"line":348,"column":16},"end":{"line":348,"column":16}},{"start":{"line":348,"column":16},"end":{"line":348,"column":16}}]},"80":{"line":350,"type":"if","locations":[{"start":{"line":350,"column":20},"end":{"line":350,"column":20}},{"start":{"line":350,"column":20},"end":{"line":350,"column":20}}]},"81":{"line":351,"type":"if","locations":[{"start":{"line":351,"column":24},"end":{"line":351,"column":24}},{"start":{"line":351,"column":24},"end":{"line":351,"column":24}}]},"82":{"line":353,"type":"if","locations":[{"start":{"line":353,"column":28},"end":{"line":353,"column":28}},{"start":{"line":353,"column":28},"end":{"line":353,"column":28}}]},"83":{"line":353,"type":"binary-expr","locations":[{"start":{"line":353,"column":32},"end":{"line":353,"column":60}},{"start":{"line":353,"column":64},"end":{"line":353,"column":102}}]},"84":{"line":355,"type":"if","locations":[{"start":{"line":355,"column":32},"end":{"line":355,"column":32}},{"start":{"line":355,"column":32},"end":{"line":355,"column":32}}]},"85":{"line":381,"type":"if","locations":[{"start":{"line":381,"column":12},"end":{"line":381,"column":12}},{"start":{"line":381,"column":12},"end":{"line":381,"column":12}}]},"86":{"line":383,"type":"if","locations":[{"start":{"line":383,"column":16},"end":{"line":383,"column":16}},{"start":{"line":383,"column":16},"end":{"line":383,"column":16}}]},"87":{"line":384,"type":"if","locations":[{"start":{"line":384,"column":20},"end":{"line":384,"column":20}},{"start":{"line":384,"column":20},"end":{"line":384,"column":20}}]},"88":{"line":384,"type":"binary-expr","locations":[{"start":{"line":384,"column":24},"end":{"line":384,"column":38}},{"start":{"line":384,"column":42},"end":{"line":384,"column":54}},{"start":{"line":384,"column":58},"end":{"line":384,"column":72}},{"start":{"line":384,"column":76},"end":{"line":384,"column":96}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","var clone = require(\"clone\");","var redUtil = require(\"../../util\");","var subflowInstanceRE = /^subflow:(.+)$/;","var typeRegistry = require(\"../registry\");","","function diffNodes(oldNode,newNode) {","    if (oldNode == null) {","        return true;","    }","    var oldKeys = Object.keys(oldNode).filter(function(p) { return p != \"x\" && p != \"y\" && p != \"wires\" });","    var newKeys = Object.keys(newNode).filter(function(p) { return p != \"x\" && p != \"y\" && p != \"wires\" });","    if (oldKeys.length != newKeys.length) {","        return true;","    }","    for (var i=0;i<newKeys.length;i++) {","        var p = newKeys[i];","        if (!redUtil.compareObjects(oldNode[p],newNode[p])) {","            return true;","        }","    }","","    return false;","}","","var EnvVarPropertyRE = /^\\$\\((\\S+)\\)$/;","","function mapEnvVarProperties(obj,prop) {","    if (Buffer.isBuffer(obj[prop])) {","        return;","    } else if (Array.isArray(obj[prop])) {","        for (var i=0;i<obj[prop].length;i++) {","            mapEnvVarProperties(obj[prop],i);","        }","    } else if (typeof obj[prop] === 'string') {","        var m;","        if ( (m = EnvVarPropertyRE.exec(obj[prop])) !== null) {","            if (process.env.hasOwnProperty(m[1])) {","                obj[prop] = process.env[m[1]];","            }","        }","    } else {","        for (var p in obj[prop]) {","            if (obj[prop].hasOwnProperty(p)) {","                mapEnvVarProperties(obj[prop],p);","            }","        }","    }","}","","module.exports = {","","    diffNodes: diffNodes,","    mapEnvVarProperties: mapEnvVarProperties,","","    parseConfig: function(config) {","        var flow = {};","        flow.allNodes = {};","        flow.subflows = {};","        flow.configs = {};","        flow.flows = {};","        flow.missingTypes = [];","","        config.forEach(function(n) {","            flow.allNodes[n.id] = clone(n);","            if (n.type === 'tab') {","                flow.flows[n.id] = n;","                flow.flows[n.id].subflows = {};","                flow.flows[n.id].configs = {};","                flow.flows[n.id].nodes = {};","            }","        });","","        config.forEach(function(n) {","            if (n.type === 'subflow') {","                flow.subflows[n.id] = n;","                flow.subflows[n.id].configs = {};","                flow.subflows[n.id].nodes = {};","                flow.subflows[n.id].instances = [];","            }","        });","        var linkWires = {};","        var linkOutNodes = [];","        config.forEach(function(n) {","            if (n.type !== 'subflow' && n.type !== 'tab') {","                var subflowDetails = subflowInstanceRE.exec(n.type);","","                if ( (subflowDetails && !flow.subflows[subflowDetails[1]]) || (!subflowDetails && !typeRegistry.get(n.type)) ) {","                    if (flow.missingTypes.indexOf(n.type) === -1) {","                        flow.missingTypes.push(n.type);","                    }","                }","                var container = null;","                if (flow.flows[n.z]) {","                    container = flow.flows[n.z];","                } else if (flow.subflows[n.z]) {","                    container = flow.subflows[n.z];","                }","                if (n.hasOwnProperty('x') && n.hasOwnProperty('y')) {","                    if (subflowDetails) {","                        var subflowType = subflowDetails[1]","                        n.subflow = subflowType;","                        flow.subflows[subflowType].instances.push(n)","                    }","                    if (container) {","                        container.nodes[n.id] = n;","                    }","                } else {","                    if (container) {","                        container.configs[n.id] = n;","                    } else {","                        flow.configs[n.id] = n;","                        flow.configs[n.id]._users = [];","                    }","                }","                if (n.type === 'link in' && n.links) {","                    // Ensure wires are present in corresponding link out nodes","                    n.links.forEach(function(id) {","                        linkWires[id] = linkWires[id]||{};","                        linkWires[id][n.id] = true;","                    })","                } else if (n.type === 'link out' && n.links) {","                    linkWires[n.id] = linkWires[n.id]||{};","                    n.links.forEach(function(id) {","                        linkWires[n.id][id] = true;","                    })","                    linkOutNodes.push(n);","                }","            }","        });","        linkOutNodes.forEach(function(n) {","            var links = linkWires[n.id];","            var targets = Object.keys(links);","            n.wires = [targets];","        });","","","        var addedTabs = {};","        config.forEach(function(n) {","            if (n.type !== 'subflow' && n.type !== 'tab') {","                for (var prop in n) {","                    if (n.hasOwnProperty(prop) && prop !== 'id' && prop !== 'wires' && prop !== 'type' && prop !== '_users' && flow.configs.hasOwnProperty(n[prop])) {","                        // This property references a global config node","                        flow.configs[n[prop]]._users.push(n.id)","                    }","                }","                if (n.z && !flow.subflows[n.z]) {","","                    if (!flow.flows[n.z]) {","                        flow.flows[n.z] = {type:'tab',id:n.z};","                        flow.flows[n.z].subflows = {};","                        flow.flows[n.z].configs = {};","                        flow.flows[n.z].nodes = {};","                        addedTabs[n.z] = flow.flows[n.z];","                    }","                    if (addedTabs[n.z]) {","                        if (n.hasOwnProperty('x') && n.hasOwnProperty('y')) {","                            addedTabs[n.z].nodes[n.id] = n;","                        } else {","                            addedTabs[n.z].configs[n.id] = n;","                        }","                    }","                }","            }","        });","        return flow;","    },","","    diffConfigs: function(oldConfig, newConfig) {","        var id;","        var node;","        var nn;","        var wires;","        var j,k;","","        var changedSubflows = {};","","        var added = {};","        var removed = {};","        var changed = {};","        var wiringChanged = {};","","        var linkMap = {};","","        for (id in oldConfig.allNodes) {","            if (oldConfig.allNodes.hasOwnProperty(id)) {","                node = oldConfig.allNodes[id];","                // build the map of what this node was previously wired to","                if (node.wires) {","                    linkMap[node.id] = linkMap[node.id] || [];","                    for (j=0;j<node.wires.length;j++) {","                        wires = node.wires[j];","                        for (k=0;k<wires.length;k++) {","                            linkMap[node.id].push(wires[k]);","                            nn = oldConfig.allNodes[wires[k]];","                            if (nn) {","                                linkMap[nn.id] = linkMap[nn.id] || [];","                                linkMap[nn.id].push(node.id);","                            }","                        }","                    }","                }","                // This node has been removed","                if (!newConfig.allNodes.hasOwnProperty(id)) {","                    removed[id] = node;","                    // Mark the container as changed","                    if (newConfig.allNodes[removed[id].z]) {","                        changed[removed[id].z] = newConfig.allNodes[removed[id].z];","                        if (changed[removed[id].z].type === \"subflow\") {","                            changedSubflows[removed[id].z] = changed[removed[id].z];","                            //delete removed[id];","                        }","                    }","                } else {","                    // This node has a material configuration change","                    if (diffNodes(node,newConfig.allNodes[id]) || newConfig.allNodes[id].credentials) {","                        changed[id] = newConfig.allNodes[id];","                        if (changed[id].type === \"subflow\") {","                            changedSubflows[id] = changed[id];","                        }","                        // Mark the container as changed","                        if (newConfig.allNodes[changed[id].z]) {","                            changed[changed[id].z] = newConfig.allNodes[changed[id].z];","                            if (changed[changed[id].z].type === \"subflow\") {","                                changedSubflows[changed[id].z] = changed[changed[id].z];","                                delete changed[id];","                            }","                        }","                    }","                    // This node's wiring has changed","                    if (!redUtil.compareObjects(node.wires,newConfig.allNodes[id].wires)) {","                        wiringChanged[id] = newConfig.allNodes[id];","                        // Mark the container as changed","                        if (newConfig.allNodes[wiringChanged[id].z]) {","                            changed[wiringChanged[id].z] = newConfig.allNodes[wiringChanged[id].z];","                            if (changed[wiringChanged[id].z].type === \"subflow\") {","                                changedSubflows[wiringChanged[id].z] = changed[wiringChanged[id].z];","                                delete wiringChanged[id];","                            }","                        }","                    }","                }","            }","        }","        // Look for added nodes","        for (id in newConfig.allNodes) {","            if (newConfig.allNodes.hasOwnProperty(id)) {","                node = newConfig.allNodes[id];","                // build the map of what this node is now wired to","                if (node.wires) {","                    linkMap[node.id] = linkMap[node.id] || [];","                    for (j=0;j<node.wires.length;j++) {","                        wires = node.wires[j];","                        for (k=0;k<wires.length;k++) {","                            if (linkMap[node.id].indexOf(wires[k]) === -1) {","                                linkMap[node.id].push(wires[k]);","                            }","                            nn = newConfig.allNodes[wires[k]];","                            if (nn) {","                                linkMap[nn.id] = linkMap[nn.id] || [];","                                if (linkMap[nn.id].indexOf(node.id) === -1) {","                                    linkMap[nn.id].push(node.id);","                                }","                            }","                        }","                    }","                }","                // This node has been added","                if (!oldConfig.allNodes.hasOwnProperty(id)) {","                    added[id] = node;","                    // Mark the container as changed","                    if (newConfig.allNodes[added[id].z]) {","                        changed[added[id].z] = newConfig.allNodes[added[id].z];","                        if (changed[added[id].z].type === \"subflow\") {","                            changedSubflows[added[id].z] = changed[added[id].z];","                            delete added[id];","                        }","                    }","                }","            }","        }","","        var madeChange;","        // Loop through the nodes looking for references to changed config nodes","        // Repeat the loop if anything is marked as changed as it may need to be","        // propagated to parent nodes.","        // TODO: looping through all nodes every time is a bit inefficient - could be more targeted","        do {","            madeChange = false;","            for (id in newConfig.allNodes) {","                if (newConfig.allNodes.hasOwnProperty(id)) {","                    node = newConfig.allNodes[id];","                    for (var prop in node) {","                        if (node.hasOwnProperty(prop) && prop != \"z\" && prop != \"id\" && prop != \"wires\") {","                            // This node has a property that references a changed/removed node","                            // Assume it is a config node change and mark this node as","                            // changed.","                            if (changed[node[prop]] || removed[node[prop]]) {","                                if (!changed[node.id]) {","                                    madeChange = true;","                                    changed[node.id] = node;","                                    // This node exists within subflow template","                                    // Mark the template as having changed","                                    if (newConfig.allNodes[node.z]) {","                                        changed[node.z] = newConfig.allNodes[node.z];","                                        if (changed[node.z].type === \"subflow\") {","                                            changedSubflows[node.z] = changed[node.z];","                                        }","                                    }","                                }","                            }","                        }","                    }","                }","            }","        } while (madeChange===true)","","        // Find any nodes that exist on a subflow template and remove from changed","        // list as the parent subflow will now be marked as containing a change","        for (id in newConfig.allNodes) {","            if (newConfig.allNodes.hasOwnProperty(id)) {","                node = newConfig.allNodes[id];","                if (newConfig.allNodes[node.z] && newConfig.allNodes[node.z].type === \"subflow\") {","                    delete changed[node.id];","                }","            }","        }","","        // Recursively mark all instances of changed subflows as changed","        var changedSubflowStack = Object.keys(changedSubflows);","        while (changedSubflowStack.length > 0) {","            var subflowId = changedSubflowStack.pop();","            for (id in newConfig.allNodes) {","                if (newConfig.allNodes.hasOwnProperty(id)) {","                    node = newConfig.allNodes[id];","                    if (node.type === 'subflow:'+subflowId) {","                        if (!changed[node.id]) {","                            changed[node.id] = node;","                            if (!changed[changed[node.id].z] && newConfig.allNodes[changed[node.id].z]) {","                                changed[changed[node.id].z] = newConfig.allNodes[changed[node.id].z];","                                if (newConfig.allNodes[changed[node.id].z].type === \"subflow\") {","                                    // This subflow instance is inside a subflow. Add the","                                    // containing subflow to the stack to mark","                                    changedSubflowStack.push(changed[node.id].z);","                                    delete changed[node.id];","                                }","                            }","                        }","                    }","                }","            }","        }","","        var diff = {","            added:Object.keys(added),","            changed:Object.keys(changed),","            removed:Object.keys(removed),","            rewired:Object.keys(wiringChanged),","            linked:[]","        }","","        // Traverse the links of all modified nodes to mark the connected nodes","        var modifiedNodes = diff.added.concat(diff.changed).concat(diff.removed).concat(diff.rewired);","        var visited = {};","        while (modifiedNodes.length > 0) {","            node = modifiedNodes.pop();","            if (!visited[node]) {","                visited[node] = true;","                if (linkMap[node]) {","                    if (!changed[node] && !added[node] && !removed[node] && !wiringChanged[node]) {","                        diff.linked.push(node);","                    }","                    modifiedNodes = modifiedNodes.concat(linkMap[node]);","                }","            }","        }","        // for (id in newConfig.allNodes) {","        //     console.log(","        //         (added[id]?\"+\":(changed[id]?\"!\":\" \"))+(wiringChanged[id]?\"w\":\" \")+(diff.linked.indexOf(id)!==-1?\"~\":\" \"),","        //         id,","        //         newConfig.allNodes[id].type,","        //         newConfig.allNodes[id].name||newConfig.allNodes[id].label||\"\"","        //     );","        // }","        // for (id in removed) {","        //     console.log(","        //         \"- \"+(diff.linked.indexOf(id)!==-1?\"~\":\" \"),","        //         id,","        //         oldConfig.allNodes[id].type,","        //         oldConfig.allNodes[id].name||oldConfig.allNodes[id].label||\"\"","        //     );","        // }","","        return diff;","    }","}",""],"l":{"16":1,"17":1,"18":1,"19":1,"21":1,"22":0,"23":0,"25":0,"26":0,"27":0,"28":0,"30":0,"31":0,"32":0,"33":0,"37":0,"40":1,"42":1,"43":0,"44":0,"45":0,"46":0,"47":0,"49":0,"50":0,"51":0,"52":0,"53":0,"57":0,"58":0,"59":0,"65":1,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"96":0,"97":0,"98":0,"99":0,"100":0,"102":0,"103":0,"104":0,"107":0,"108":0,"109":0,"110":0,"111":0,"113":0,"114":0,"115":0,"116":0,"117":0,"119":0,"120":0,"123":0,"124":0,"126":0,"127":0,"130":0,"132":0,"133":0,"134":0,"136":0,"137":0,"138":0,"139":0,"141":0,"145":0,"146":0,"147":0,"148":0,"152":0,"153":0,"154":0,"155":0,"156":0,"158":0,"161":0,"163":0,"164":0,"165":0,"166":0,"167":0,"168":0,"170":0,"171":0,"172":0,"174":0,"180":0,"184":0,"185":0,"186":0,"187":0,"188":0,"190":0,"192":0,"193":0,"194":0,"195":0,"197":0,"199":0,"200":0,"201":0,"203":0,"204":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"211":0,"212":0,"218":0,"219":0,"221":0,"222":0,"223":0,"224":0,"230":0,"231":0,"232":0,"233":0,"236":0,"237":0,"238":0,"239":0,"240":0,"245":0,"246":0,"248":0,"249":0,"250":0,"251":0,"252":0,"260":0,"261":0,"262":0,"264":0,"265":0,"266":0,"267":0,"268":0,"269":0,"270":0,"272":0,"273":0,"274":0,"275":0,"276":0,"283":0,"284":0,"286":0,"287":0,"288":0,"289":0,"290":0,"297":0,"302":0,"303":0,"304":0,"305":0,"306":0,"307":0,"308":0,"312":0,"313":0,"314":0,"315":0,"318":0,"319":0,"320":0,"321":0,"334":0,"335":0,"336":0,"337":0,"338":0,"344":0,"345":0,"346":0,"347":0,"348":0,"349":0,"350":0,"351":0,"352":0,"353":0,"354":0,"355":0,"358":0,"359":0,"368":0,"377":0,"378":0,"379":0,"380":0,"381":0,"382":0,"383":0,"384":0,"385":0,"387":0,"408":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/context.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/context.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":1,"13":1,"14":1,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":1,"28":0,"29":0,"30":0,"31":0,"32":1,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":1,"42":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"createContext","line":21,"loc":{"start":{"line":21,"column":0},"end":{"line":21,"column":32}}},"2":{"name":"get","line":24,"loc":{"start":{"line":24,"column":14},"end":{"line":24,"column":32}}},"3":{"name":"set","line":27,"loc":{"start":{"line":27,"column":14},"end":{"line":27,"column":39}}},"4":{"name":"getContext","line":36,"loc":{"start":{"line":36,"column":0},"end":{"line":36,"column":36}}},"5":{"name":"deleteContext","line":54,"loc":{"start":{"line":54,"column":0},"end":{"line":54,"column":34}}},"6":{"name":"clean","line":61,"loc":{"start":{"line":61,"column":0},"end":{"line":61,"column":27}}},"7":{"name":"(anonymous_7)","line":75,"loc":{"start":{"line":75,"column":10},"end":{"line":75,"column":29}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":29}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":30}},"4":{"start":{"line":21,"column":0},"end":{"line":31,"column":1}},"5":{"start":{"line":22,"column":4},"end":{"line":22,"column":26}},"6":{"start":{"line":23,"column":4},"end":{"line":23,"column":25}},"7":{"start":{"line":24,"column":4},"end":{"line":26,"column":6}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":49}},"9":{"start":{"line":27,"column":4},"end":{"line":29,"column":5}},"10":{"start":{"line":28,"column":8},"end":{"line":28,"column":48}},"11":{"start":{"line":30,"column":4},"end":{"line":30,"column":15}},"12":{"start":{"line":33,"column":0},"end":{"line":33,"column":18}},"13":{"start":{"line":34,"column":0},"end":{"line":34,"column":25}},"14":{"start":{"line":36,"column":0},"end":{"line":53,"column":1}},"15":{"start":{"line":37,"column":4},"end":{"line":37,"column":28}},"16":{"start":{"line":38,"column":4},"end":{"line":40,"column":5}},"17":{"start":{"line":39,"column":8},"end":{"line":39,"column":39}},"18":{"start":{"line":41,"column":4},"end":{"line":43,"column":5}},"19":{"start":{"line":42,"column":8},"end":{"line":42,"column":35}},"20":{"start":{"line":44,"column":4},"end":{"line":44,"column":46}},"21":{"start":{"line":45,"column":4},"end":{"line":50,"column":5}},"22":{"start":{"line":46,"column":8},"end":{"line":46,"column":45}},"23":{"start":{"line":47,"column":8},"end":{"line":49,"column":9}},"24":{"start":{"line":48,"column":12},"end":{"line":48,"column":46}},"25":{"start":{"line":51,"column":4},"end":{"line":51,"column":37}},"26":{"start":{"line":52,"column":4},"end":{"line":52,"column":22}},"27":{"start":{"line":54,"column":0},"end":{"line":60,"column":1}},"28":{"start":{"line":55,"column":4},"end":{"line":55,"column":23}},"29":{"start":{"line":56,"column":4},"end":{"line":58,"column":5}},"30":{"start":{"line":57,"column":8},"end":{"line":57,"column":34}},"31":{"start":{"line":59,"column":4},"end":{"line":59,"column":31}},"32":{"start":{"line":61,"column":0},"end":{"line":73,"column":1}},"33":{"start":{"line":62,"column":4},"end":{"line":62,"column":23}},"34":{"start":{"line":63,"column":4},"end":{"line":63,"column":18}},"35":{"start":{"line":64,"column":4},"end":{"line":64,"column":13}},"36":{"start":{"line":65,"column":4},"end":{"line":72,"column":5}},"37":{"start":{"line":66,"column":8},"end":{"line":71,"column":9}},"38":{"start":{"line":67,"column":12},"end":{"line":67,"column":40}},"39":{"start":{"line":68,"column":12},"end":{"line":70,"column":13}},"40":{"start":{"line":69,"column":16},"end":{"line":69,"column":36}},"41":{"start":{"line":74,"column":0},"end":{"line":81,"column":2}},"42":{"start":{"line":76,"column":8},"end":{"line":76,"column":85}}},"branchMap":{"1":{"line":22,"type":"binary-expr","locations":[{"start":{"line":22,"column":15},"end":{"line":22,"column":19}},{"start":{"line":22,"column":23},"end":{"line":22,"column":25}}]},"2":{"line":23,"type":"binary-expr","locations":[{"start":{"line":23,"column":14},"end":{"line":23,"column":18}},{"start":{"line":23,"column":22},"end":{"line":23,"column":24}}]},"3":{"line":38,"type":"if","locations":[{"start":{"line":38,"column":4},"end":{"line":38,"column":4}},{"start":{"line":38,"column":4},"end":{"line":38,"column":4}}]},"4":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":4},"end":{"line":41,"column":4}},{"start":{"line":41,"column":4},"end":{"line":41,"column":4}}]},"5":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":4},"end":{"line":45,"column":4}},{"start":{"line":45,"column":4},"end":{"line":45,"column":4}}]},"6":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":8},"end":{"line":47,"column":8}},{"start":{"line":47,"column":8},"end":{"line":47,"column":8}}]},"7":{"line":56,"type":"if","locations":[{"start":{"line":56,"column":4},"end":{"line":56,"column":4}},{"start":{"line":56,"column":4},"end":{"line":56,"column":4}}]},"8":{"line":66,"type":"if","locations":[{"start":{"line":66,"column":8},"end":{"line":66,"column":8}},{"start":{"line":66,"column":8},"end":{"line":66,"column":8}}]},"9":{"line":68,"type":"if","locations":[{"start":{"line":68,"column":12},"end":{"line":68,"column":12}},{"start":{"line":68,"column":12},"end":{"line":68,"column":12}}]},"10":{"line":76,"type":"binary-expr","locations":[{"start":{"line":76,"column":47},"end":{"line":76,"column":77}},{"start":{"line":76,"column":81},"end":{"line":76,"column":83}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var clone = require(\"clone\");","var when = require(\"when\");","var util = require(\"../util\");","","function createContext(id,seed) {","    var data = seed || {};","    var obj = seed || {};","    obj.get = function get(key) {","        return util.getMessageProperty(data,key);","    };","    obj.set = function set(key, value) {","        util.setMessageProperty(data,key,value);","    }","    return obj;","}","","var contexts = {};","var globalContext = null;","","function getContext(localId,flowId) {","    var contextId = localId;","    if (flowId) {","        contextId = localId+\":\"+flowId;","    }","    if (contexts.hasOwnProperty(contextId)) {","        return contexts[contextId];","    }","    var newContext = createContext(contextId);","    if (flowId) {","        newContext.flow = getContext(flowId);","        if (globalContext) {","            newContext.global = globalContext;","        }","    }","    contexts[contextId] = newContext;","    return newContext;","}","function deleteContext(id,flowId) {","    var contextId = id;","    if (flowId) {","        contextId = id+\":\"+flowId;","    }","    delete contexts[contextId];","}","function clean(flowConfig) {","    var activeIds = {};","    var contextId;","    var node;","    for (var id in contexts) {","        if (contexts.hasOwnProperty(id)) {","            var idParts = id.split(\":\");","            if (!flowConfig.allNodes.hasOwnProperty(idParts[0])) {","                delete contexts[id];","            }","        }","    }","}","module.exports = {","    init: function(settings) {","        globalContext = createContext(\"global\",settings.functionGlobalContext || {});","    },","    get: getContext,","    delete: deleteContext,","    clean:clean","};",""],"l":{"17":1,"18":1,"19":1,"21":1,"22":0,"23":0,"24":0,"25":0,"27":0,"28":0,"30":0,"33":1,"34":1,"36":1,"37":0,"38":0,"39":0,"41":0,"42":0,"44":0,"45":0,"46":0,"47":0,"48":0,"51":0,"52":0,"54":1,"55":0,"56":0,"57":0,"59":0,"61":1,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"74":1,"76":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/registry/deprecated.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/registry/deprecated.js","s":{"1":1,"2":1,"3":0},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":46,"loc":{"start":{"line":46,"column":9},"end":{"line":46,"column":22}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":43,"column":1}},"2":{"start":{"line":45,"column":0},"end":{"line":49,"column":1}},"3":{"start":{"line":47,"column":8},"end":{"line":47,"column":25}}},"branchMap":{},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/"," ","var nodes = {","    \"irc in\":     {module:\"node-red-node-irc\"},","    \"irc out\":    {module:\"node-red-node-irc\"},","    \"irc-server\": {module:\"node-red-node-irc\"},","    ","    \"arduino in\":    {module:\"node-red-node-arduino\"},","    \"arduino out\":   {module:\"node-red-node-arduino\"},","    \"arduino-board\": {module:\"node-red-node-arduino\"},","    ","    \"redis out\": {module:\"node-red-node-redis\"},","    ","    \"mongodb\": {module:\"node-red-node-mongodb\"},","    \"mongodb out\": {module:\"node-red-node-mongodb\"},","    ","    \"serial in\": {module:\"node-red-node-serialport\"},","    \"serial out\": {module:\"node-red-node-serialport\"},","    \"serial-port\": {module:\"node-red-node-serialport\"},","    ","    \"twitter-credentials\": {module:\"node-red-node-twitter\"},","    \"twitter in\": {module:\"node-red-node-twitter\"},","    \"twitter out\": {module:\"node-red-node-twitter\"},","    ","    \"e-mail\": {module:\"node-red-node-email\"},","    \"e-mail in\": {module:\"node-red-node-email\"},","    ","    \"feedparse\": {module:\"node-red-node-feedparser\"}","}","","module.exports = {","    get: function(id) {","        return nodes[id];","    }","}",""],"l":{"17":1,"45":1,"47":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/Node.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/nodes/Node.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":1,"19":1,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":1,"32":0,"33":0,"34":0,"35":1,"36":1,"37":0,"38":0,"39":0,"40":0,"41":1,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":1,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":1,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":1,"115":0,"116":0,"117":0,"118":0,"119":1,"120":0,"121":1,"122":0,"123":1,"124":0,"125":0,"126":0,"127":0,"128":0,"129":1,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":1,"140":0,"141":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},"fnMap":{"1":{"name":"Node","line":26,"loc":{"start":{"line":26,"column":0},"end":{"line":26,"column":17}}},"2":{"name":"(anonymous_2)","line":43,"loc":{"start":{"line":43,"column":29},"end":{"line":43,"column":45}}},"3":{"name":"(anonymous_3)","line":49,"loc":{"start":{"line":49,"column":23},"end":{"line":49,"column":35}}},"4":{"name":"(anonymous_4)","line":55,"loc":{"start":{"line":55,"column":20},"end":{"line":55,"column":34}}},"5":{"name":"(anonymous_5)","line":66,"loc":{"start":{"line":66,"column":25},"end":{"line":66,"column":36}}},"6":{"name":"(anonymous_6)","line":75,"loc":{"start":{"line":75,"column":20},"end":{"line":75,"column":46}}},"7":{"name":"(anonymous_7)","line":84,"loc":{"start":{"line":84,"column":23},"end":{"line":84,"column":34}}},"8":{"name":"(anonymous_8)","line":91,"loc":{"start":{"line":91,"column":29},"end":{"line":91,"column":47}}},"9":{"name":"(anonymous_9)","line":92,"loc":{"start":{"line":92,"column":40},"end":{"line":92,"column":51}}},"10":{"name":"(anonymous_10)","line":102,"loc":{"start":{"line":102,"column":42},"end":{"line":102,"column":53}}},"11":{"name":"(anonymous_11)","line":115,"loc":{"start":{"line":115,"column":22},"end":{"line":115,"column":36}}},"12":{"name":"(anonymous_12)","line":202,"loc":{"start":{"line":202,"column":25},"end":{"line":202,"column":39}}},"13":{"name":"log_helper","line":217,"loc":{"start":{"line":217,"column":0},"end":{"line":217,"column":38}}},"14":{"name":"(anonymous_14)","line":230,"loc":{"start":{"line":230,"column":21},"end":{"line":230,"column":35}}},"15":{"name":"(anonymous_15)","line":234,"loc":{"start":{"line":234,"column":22},"end":{"line":234,"column":36}}},"16":{"name":"(anonymous_16)","line":238,"loc":{"start":{"line":238,"column":23},"end":{"line":238,"column":48}}},"17":{"name":"(anonymous_17)","line":252,"loc":{"start":{"line":252,"column":24},"end":{"line":252,"column":62}}},"18":{"name":"(anonymous_18)","line":268,"loc":{"start":{"line":268,"column":24},"end":{"line":268,"column":41}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":50}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":27}},"4":{"start":{"line":21,"column":0},"end":{"line":21,"column":33}},"5":{"start":{"line":22,"column":0},"end":{"line":22,"column":28}},"6":{"start":{"line":23,"column":0},"end":{"line":23,"column":35}},"7":{"start":{"line":24,"column":0},"end":{"line":24,"column":31}},"8":{"start":{"line":26,"column":0},"end":{"line":39,"column":1}},"9":{"start":{"line":27,"column":4},"end":{"line":27,"column":19}},"10":{"start":{"line":28,"column":4},"end":{"line":28,"column":23}},"11":{"start":{"line":29,"column":4},"end":{"line":29,"column":17}},"12":{"start":{"line":30,"column":4},"end":{"line":30,"column":30}},"13":{"start":{"line":32,"column":4},"end":{"line":34,"column":5}},"14":{"start":{"line":33,"column":8},"end":{"line":33,"column":27}},"15":{"start":{"line":35,"column":4},"end":{"line":37,"column":5}},"16":{"start":{"line":36,"column":8},"end":{"line":36,"column":31}},"17":{"start":{"line":38,"column":4},"end":{"line":38,"column":30}},"18":{"start":{"line":41,"column":0},"end":{"line":41,"column":34}},"19":{"start":{"line":43,"column":0},"end":{"line":65,"column":1}},"20":{"start":{"line":45,"column":4},"end":{"line":45,"column":29}},"21":{"start":{"line":46,"column":4},"end":{"line":46,"column":22}},"22":{"start":{"line":48,"column":4},"end":{"line":48,"column":15}},"23":{"start":{"line":49,"column":4},"end":{"line":51,"column":7}},"24":{"start":{"line":50,"column":8},"end":{"line":50,"column":21}},"25":{"start":{"line":52,"column":4},"end":{"line":52,"column":25}},"26":{"start":{"line":53,"column":4},"end":{"line":63,"column":5}},"27":{"start":{"line":55,"column":8},"end":{"line":55,"column":36}},"28":{"start":{"line":57,"column":8},"end":{"line":57,"column":40}},"29":{"start":{"line":58,"column":8},"end":{"line":62,"column":9}},"30":{"start":{"line":61,"column":12},"end":{"line":61,"column":42}},"31":{"start":{"line":66,"column":0},"end":{"line":71,"column":1}},"32":{"start":{"line":67,"column":4},"end":{"line":69,"column":5}},"33":{"start":{"line":68,"column":9},"end":{"line":68,"column":66}},"34":{"start":{"line":70,"column":4},"end":{"line":70,"column":25}},"35":{"start":{"line":73,"column":0},"end":{"line":73,"column":39}},"36":{"start":{"line":75,"column":0},"end":{"line":82,"column":2}},"37":{"start":{"line":76,"column":4},"end":{"line":76,"column":20}},"38":{"start":{"line":77,"column":4},"end":{"line":81,"column":5}},"39":{"start":{"line":78,"column":8},"end":{"line":78,"column":44}},"40":{"start":{"line":80,"column":8},"end":{"line":80,"column":34}},"41":{"start":{"line":84,"column":0},"end":{"line":113,"column":2}},"42":{"start":{"line":85,"column":4},"end":{"line":85,"column":22}},"43":{"start":{"line":86,"column":4},"end":{"line":86,"column":20}},"44":{"start":{"line":87,"column":4},"end":{"line":100,"column":5}},"45":{"start":{"line":88,"column":8},"end":{"line":88,"column":47}},"46":{"start":{"line":89,"column":8},"end":{"line":99,"column":9}},"47":{"start":{"line":90,"column":12},"end":{"line":96,"column":14}},"48":{"start":{"line":92,"column":20},"end":{"line":94,"column":23}},"49":{"start":{"line":93,"column":24},"end":{"line":93,"column":34}},"50":{"start":{"line":98,"column":12},"end":{"line":98,"column":32}},"51":{"start":{"line":101,"column":4},"end":{"line":112,"column":5}},"52":{"start":{"line":102,"column":8},"end":{"line":106,"column":11}},"53":{"start":{"line":103,"column":12},"end":{"line":105,"column":13}},"54":{"start":{"line":104,"column":17},"end":{"line":104,"column":61}},"55":{"start":{"line":108,"column":8},"end":{"line":110,"column":9}},"56":{"start":{"line":109,"column":13},"end":{"line":109,"column":57}},"57":{"start":{"line":111,"column":8},"end":{"line":111,"column":15}},"58":{"start":{"line":115,"column":0},"end":{"line":200,"column":2}},"59":{"start":{"line":116,"column":4},"end":{"line":116,"column":24}},"60":{"start":{"line":117,"column":4},"end":{"line":117,"column":13}},"61":{"start":{"line":119,"column":4},"end":{"line":139,"column":5}},"62":{"start":{"line":120,"column":8},"end":{"line":120,"column":15}},"63":{"start":{"line":121,"column":11},"end":{"line":139,"column":5}},"64":{"start":{"line":122,"column":8},"end":{"line":138,"column":9}},"65":{"start":{"line":126,"column":12},"end":{"line":128,"column":13}},"66":{"start":{"line":127,"column":16},"end":{"line":127,"column":50}},"67":{"start":{"line":129,"column":12},"end":{"line":129,"column":36}},"68":{"start":{"line":130,"column":12},"end":{"line":130,"column":41}},"69":{"start":{"line":132,"column":12},"end":{"line":134,"column":13}},"70":{"start":{"line":133,"column":16},"end":{"line":133,"column":34}},"71":{"start":{"line":135,"column":12},"end":{"line":135,"column":19}},"72":{"start":{"line":137,"column":12},"end":{"line":137,"column":24}},"73":{"start":{"line":141,"column":4},"end":{"line":141,"column":39}},"74":{"start":{"line":145,"column":4},"end":{"line":145,"column":24}},"75":{"start":{"line":147,"column":4},"end":{"line":147,"column":29}},"76":{"start":{"line":150,"column":4},"end":{"line":185,"column":5}},"77":{"start":{"line":151,"column":8},"end":{"line":151,"column":34}},"78":{"start":{"line":153,"column":8},"end":{"line":184,"column":9}},"79":{"start":{"line":154,"column":12},"end":{"line":154,"column":30}},"80":{"start":{"line":155,"column":12},"end":{"line":183,"column":13}},"81":{"start":{"line":156,"column":16},"end":{"line":158,"column":17}},"82":{"start":{"line":157,"column":20},"end":{"line":157,"column":34}},"83":{"start":{"line":159,"column":16},"end":{"line":159,"column":26}},"84":{"start":{"line":161,"column":16},"end":{"line":182,"column":17}},"85":{"start":{"line":162,"column":20},"end":{"line":162,"column":47}},"86":{"start":{"line":163,"column":20},"end":{"line":181,"column":21}},"87":{"start":{"line":165,"column":24},"end":{"line":180,"column":25}},"88":{"start":{"line":166,"column":28},"end":{"line":166,"column":44}},"89":{"start":{"line":167,"column":28},"end":{"line":179,"column":29}},"90":{"start":{"line":169,"column":32},"end":{"line":171,"column":33}},"91":{"start":{"line":170,"column":36},"end":{"line":170,"column":61}},"92":{"start":{"line":172,"column":32},"end":{"line":178,"column":33}},"93":{"start":{"line":173,"column":36},"end":{"line":173,"column":76}},"94":{"start":{"line":174,"column":36},"end":{"line":174,"column":74}},"95":{"start":{"line":176,"column":36},"end":{"line":176,"column":66}},"96":{"start":{"line":177,"column":36},"end":{"line":177,"column":51}},"97":{"start":{"line":187,"column":4},"end":{"line":189,"column":5}},"98":{"start":{"line":188,"column":8},"end":{"line":188,"column":45}},"99":{"start":{"line":190,"column":4},"end":{"line":190,"column":47}},"100":{"start":{"line":192,"column":4},"end":{"line":199,"column":5}},"101":{"start":{"line":193,"column":8},"end":{"line":193,"column":31}},"102":{"start":{"line":195,"column":8},"end":{"line":197,"column":9}},"103":{"start":{"line":196,"column":12},"end":{"line":196,"column":40}},"104":{"start":{"line":198,"column":8},"end":{"line":198,"column":27}},"105":{"start":{"line":202,"column":0},"end":{"line":215,"column":2}},"106":{"start":{"line":203,"column":4},"end":{"line":205,"column":5}},"107":{"start":{"line":204,"column":8},"end":{"line":204,"column":17}},"108":{"start":{"line":206,"column":4},"end":{"line":208,"column":5}},"109":{"start":{"line":207,"column":8},"end":{"line":207,"column":42}},"110":{"start":{"line":209,"column":4},"end":{"line":209,"column":31}},"111":{"start":{"line":210,"column":4},"end":{"line":214,"column":5}},"112":{"start":{"line":211,"column":8},"end":{"line":211,"column":32}},"113":{"start":{"line":213,"column":8},"end":{"line":213,"column":28}},"114":{"start":{"line":217,"column":0},"end":{"line":228,"column":1}},"115":{"start":{"line":218,"column":4},"end":{"line":223,"column":6}},"116":{"start":{"line":224,"column":4},"end":{"line":226,"column":5}},"117":{"start":{"line":225,"column":8},"end":{"line":225,"column":27}},"118":{"start":{"line":227,"column":4},"end":{"line":227,"column":15}},"119":{"start":{"line":230,"column":0},"end":{"line":232,"column":2}},"120":{"start":{"line":231,"column":4},"end":{"line":231,"column":36}},"121":{"start":{"line":234,"column":0},"end":{"line":236,"column":2}},"122":{"start":{"line":235,"column":4},"end":{"line":235,"column":36}},"123":{"start":{"line":238,"column":0},"end":{"line":247,"column":2}},"124":{"start":{"line":239,"column":4},"end":{"line":241,"column":5}},"125":{"start":{"line":240,"column":8},"end":{"line":240,"column":38}},"126":{"start":{"line":242,"column":4},"end":{"line":242,"column":44}},"127":{"start":{"line":244,"column":4},"end":{"line":246,"column":5}},"128":{"start":{"line":245,"column":8},"end":{"line":245,"column":47}},"129":{"start":{"line":252,"column":0},"end":{"line":263,"column":1}},"130":{"start":{"line":253,"column":4},"end":{"line":255,"column":5}},"131":{"start":{"line":254,"column":8},"end":{"line":254,"column":28}},"132":{"start":{"line":256,"column":4},"end":{"line":256,"column":21}},"133":{"start":{"line":257,"column":4},"end":{"line":257,"column":31}},"134":{"start":{"line":258,"column":4},"end":{"line":258,"column":29}},"135":{"start":{"line":259,"column":4},"end":{"line":259,"column":52}},"136":{"start":{"line":260,"column":4},"end":{"line":260,"column":31}},"137":{"start":{"line":261,"column":4},"end":{"line":261,"column":32}},"138":{"start":{"line":262,"column":4},"end":{"line":262,"column":21}},"139":{"start":{"line":268,"column":0},"end":{"line":270,"column":2}},"140":{"start":{"line":269,"column":4},"end":{"line":269,"column":36}},"141":{"start":{"line":271,"column":0},"end":{"line":271,"column":22}}},"branchMap":{"1":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":4},"end":{"line":32,"column":4}},{"start":{"line":32,"column":4},"end":{"line":32,"column":4}}]},"2":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":4},"end":{"line":35,"column":4}},{"start":{"line":35,"column":4},"end":{"line":35,"column":4}}]},"3":{"line":45,"type":"binary-expr","locations":[{"start":{"line":45,"column":17},"end":{"line":45,"column":22}},{"start":{"line":45,"column":26},"end":{"line":45,"column":28}}]},"4":{"line":53,"type":"if","locations":[{"start":{"line":53,"column":4},"end":{"line":53,"column":4}},{"start":{"line":53,"column":4},"end":{"line":53,"column":4}}]},"5":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":8},"end":{"line":58,"column":8}},{"start":{"line":58,"column":8},"end":{"line":58,"column":8}}]},"6":{"line":58,"type":"binary-expr","locations":[{"start":{"line":58,"column":12},"end":{"line":58,"column":35}},{"start":{"line":58,"column":39},"end":{"line":58,"column":65}}]},"7":{"line":67,"type":"if","locations":[{"start":{"line":67,"column":4},"end":{"line":67,"column":4}},{"start":{"line":67,"column":4},"end":{"line":67,"column":4}}]},"8":{"line":68,"type":"binary-expr","locations":[{"start":{"line":68,"column":37},"end":{"line":68,"column":48}},{"start":{"line":68,"column":50},"end":{"line":68,"column":57}}]},"9":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":4},"end":{"line":77,"column":4}},{"start":{"line":77,"column":4},"end":{"line":77,"column":4}}]},"10":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":8},"end":{"line":89,"column":8}},{"start":{"line":89,"column":8},"end":{"line":89,"column":8}}]},"11":{"line":101,"type":"if","locations":[{"start":{"line":101,"column":4},"end":{"line":101,"column":4}},{"start":{"line":101,"column":4},"end":{"line":101,"column":4}}]},"12":{"line":103,"type":"if","locations":[{"start":{"line":103,"column":12},"end":{"line":103,"column":12}},{"start":{"line":103,"column":12},"end":{"line":103,"column":12}}]},"13":{"line":104,"type":"binary-expr","locations":[{"start":{"line":104,"column":32},"end":{"line":104,"column":43}},{"start":{"line":104,"column":45},"end":{"line":104,"column":52}}]},"14":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":8},"end":{"line":108,"column":8}},{"start":{"line":108,"column":8},"end":{"line":108,"column":8}}]},"15":{"line":109,"type":"binary-expr","locations":[{"start":{"line":109,"column":28},"end":{"line":109,"column":39}},{"start":{"line":109,"column":41},"end":{"line":109,"column":48}}]},"16":{"line":119,"type":"if","locations":[{"start":{"line":119,"column":4},"end":{"line":119,"column":4}},{"start":{"line":119,"column":4},"end":{"line":119,"column":4}}]},"17":{"line":119,"type":"binary-expr","locations":[{"start":{"line":119,"column":8},"end":{"line":119,"column":20}},{"start":{"line":119,"column":24},"end":{"line":119,"column":50}}]},"18":{"line":121,"type":"if","locations":[{"start":{"line":121,"column":11},"end":{"line":121,"column":11}},{"start":{"line":121,"column":11},"end":{"line":121,"column":11}}]},"19":{"line":122,"type":"if","locations":[{"start":{"line":122,"column":8},"end":{"line":122,"column":8}},{"start":{"line":122,"column":8},"end":{"line":122,"column":8}}]},"20":{"line":126,"type":"if","locations":[{"start":{"line":126,"column":12},"end":{"line":126,"column":12}},{"start":{"line":126,"column":12},"end":{"line":126,"column":12}}]},"21":{"line":132,"type":"if","locations":[{"start":{"line":132,"column":12},"end":{"line":132,"column":12}},{"start":{"line":132,"column":12},"end":{"line":132,"column":12},"skip":true}]},"22":{"line":153,"type":"if","locations":[{"start":{"line":153,"column":8},"end":{"line":153,"column":8}},{"start":{"line":153,"column":8},"end":{"line":153,"column":8},"skip":true}]},"23":{"line":155,"type":"if","locations":[{"start":{"line":155,"column":12},"end":{"line":155,"column":12}},{"start":{"line":155,"column":12},"end":{"line":155,"column":12}}]},"24":{"line":155,"type":"binary-expr","locations":[{"start":{"line":155,"column":16},"end":{"line":155,"column":29}},{"start":{"line":155,"column":33},"end":{"line":155,"column":60}}]},"25":{"line":156,"type":"if","locations":[{"start":{"line":156,"column":16},"end":{"line":156,"column":16}},{"start":{"line":156,"column":16},"end":{"line":156,"column":16}}]},"26":{"line":163,"type":"if","locations":[{"start":{"line":163,"column":20},"end":{"line":163,"column":20}},{"start":{"line":163,"column":20},"end":{"line":163,"column":20}}]},"27":{"line":167,"type":"if","locations":[{"start":{"line":167,"column":28},"end":{"line":167,"column":28}},{"start":{"line":167,"column":28},"end":{"line":167,"column":28}}]},"28":{"line":167,"type":"binary-expr","locations":[{"start":{"line":167,"column":32},"end":{"line":167,"column":42}},{"start":{"line":167,"column":46},"end":{"line":167,"column":61}}]},"29":{"line":169,"type":"if","locations":[{"start":{"line":169,"column":32},"end":{"line":169,"column":32}},{"start":{"line":169,"column":32},"end":{"line":169,"column":32},"skip":true}]},"30":{"line":172,"type":"if","locations":[{"start":{"line":172,"column":32},"end":{"line":172,"column":32}},{"start":{"line":172,"column":32},"end":{"line":172,"column":32}}]},"31":{"line":187,"type":"if","locations":[{"start":{"line":187,"column":4},"end":{"line":187,"column":4}},{"start":{"line":187,"column":4},"end":{"line":187,"column":4},"skip":true}]},"32":{"line":195,"type":"if","locations":[{"start":{"line":195,"column":8},"end":{"line":195,"column":8}},{"start":{"line":195,"column":8},"end":{"line":195,"column":8},"skip":true}]},"33":{"line":203,"type":"if","locations":[{"start":{"line":203,"column":4},"end":{"line":203,"column":4}},{"start":{"line":203,"column":4},"end":{"line":203,"column":4}}]},"34":{"line":206,"type":"if","locations":[{"start":{"line":206,"column":4},"end":{"line":206,"column":4}},{"start":{"line":206,"column":4},"end":{"line":206,"column":4}}]},"35":{"line":224,"type":"if","locations":[{"start":{"line":224,"column":4},"end":{"line":224,"column":4}},{"start":{"line":224,"column":4},"end":{"line":224,"column":4}}]},"36":{"line":239,"type":"if","locations":[{"start":{"line":239,"column":4},"end":{"line":239,"column":4}},{"start":{"line":239,"column":4},"end":{"line":239,"column":4}}]},"37":{"line":240,"type":"binary-expr","locations":[{"start":{"line":240,"column":21},"end":{"line":240,"column":31}},{"start":{"line":240,"column":35},"end":{"line":240,"column":37}}]},"38":{"line":244,"type":"if","locations":[{"start":{"line":244,"column":4},"end":{"line":244,"column":4}},{"start":{"line":244,"column":4},"end":{"line":244,"column":4},"skip":true}]},"39":{"line":253,"type":"if","locations":[{"start":{"line":253,"column":4},"end":{"line":253,"column":4}},{"start":{"line":253,"column":4},"end":{"line":253,"column":4}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var util = require(\"util\");","var EventEmitter = require(\"events\").EventEmitter;","var when = require(\"when\");","","var redUtil = require(\"../util\");","var Log = require(\"../log\");","var context = require(\"./context\");","var flows = require(\"./flows\");","","function Node(n) {","    this.id = n.id;","    this.type = n.type;","    this.z = n.z;","    this._closeCallbacks = [];","","    if (n.name) {","        this.name = n.name;","    }","    if (n._alias) {","        this._alias = n._alias;","    }","    this.updateWires(n.wires);","}","","util.inherits(Node, EventEmitter);","","Node.prototype.updateWires = function(wires) {","    //console.log(\"UPDATE\",this.id);","    this.wires = wires || [];","    delete this._wire;","","    var wc = 0;","    this.wires.forEach(function(w) {","        wc+=w.length;","    });","    this._wireCount = wc;","    if (wc === 0) {","        // With nothing wired to the node, no-op send","        this.send = function(msg) {}","    } else {","        this.send = Node.prototype.send;","        if (this.wires.length === 1 && this.wires[0].length === 1) {","            // Single wire, so we can shortcut the send when","            // a single message is sent","            this._wire = this.wires[0][0];","        }","    }","","}","Node.prototype.context = function() {","    if (!this._context) {","         this._context = context.get(this._alias||this.id,this.z);","    }","    return this._context;","}","","Node.prototype._on = Node.prototype.on;","","Node.prototype.on = function(event, callback) {","    var node = this;","    if (event == \"close\") {","        this._closeCallbacks.push(callback);","    } else {","        this._on(event, callback);","    }","};","","Node.prototype.close = function() {","    var promises = [];","    var node = this;","    for (var i=0;i<this._closeCallbacks.length;i++) {","        var callback = this._closeCallbacks[i];","        if (callback.length == 1) {","            promises.push(","                when.promise(function(resolve) {","                    callback.call(node, function() {","                        resolve();","                    });","                })","            );","        } else {","            callback.call(node);","        }","    }","    if (promises.length > 0) {","        return when.settle(promises).then(function() {","            if (this._context) {","                 context.delete(this._alias||this.id,this.z);","            }","        });","    } else {","        if (this._context) {","             context.delete(this._alias||this.id,this.z);","        }","        return;","    }","};","","Node.prototype.send = function(msg) {","    var msgSent = false;","    var node;","","    if (msg === null || typeof msg === \"undefined\") {","        return;","    } else if (!util.isArray(msg)) {","        if (this._wire) {","            // A single message and a single wire on output 0","            // TODO: pre-load flows.get calls - cannot do in constructor","            //       as not all nodes are defined at that point","            if (!msg._msgid) {","                msg._msgid = redUtil.generateId();","            }","            this.metric(\"send\",msg);","            node = flows.get(this._wire);","            /* istanbul ignore else */","            if (node) {","                node.receive(msg);","            }","            return;","        } else {","            msg = [msg];","        }","    }","","    var numOutputs = this.wires.length;","","    // Build a list of send events so that all cloning is done before","    // any calls to node.receive","    var sendEvents = [];","","    var sentMessageId = null;","","    // for each output of node eg. [msgs to output 0, msgs to output 1, ...]","    for (var i = 0; i < numOutputs; i++) {","        var wires = this.wires[i]; // wires leaving output i","        /* istanbul ignore else */","        if (i < msg.length) {","            var msgs = msg[i]; // msgs going to output i","            if (msgs !== null && typeof msgs !== \"undefined\") {","                if (!util.isArray(msgs)) {","                    msgs = [msgs];","                }","                var k = 0;","                // for each recipent node of that output","                for (var j = 0; j < wires.length; j++) {","                    node = flows.get(wires[j]); // node at end of wire j","                    if (node) {","                        // for each msg to send eg. [[m1, m2, ...], ...]","                        for (k = 0; k < msgs.length; k++) {","                            var m = msgs[k];","                            if (m !== null && m !== undefined) {","                                /* istanbul ignore else */","                                if (!sentMessageId) {","                                    sentMessageId = m._msgid;","                                }","                                if (msgSent) {","                                    var clonedmsg = redUtil.cloneMessage(m);","                                    sendEvents.push({n:node,m:clonedmsg});","                                } else {","                                    sendEvents.push({n:node,m:m});","                                    msgSent = true;","                                }","                            }","                        }","                    }","                }","            }","        }","    }","    /* istanbul ignore else */","    if (!sentMessageId) {","        sentMessageId = redUtil.generateId();","    }","    this.metric(\"send\",{_msgid:sentMessageId});","","    for (i=0;i<sendEvents.length;i++) {","        var ev = sendEvents[i];","        /* istanbul ignore else */","        if (!ev.m._msgid) {","            ev.m._msgid = sentMessageId;","        }","        ev.n.receive(ev.m);","    }","};","","Node.prototype.receive = function(msg) {","    if (!msg) {","        msg = {};","    }","    if (!msg._msgid) {","        msg._msgid = redUtil.generateId();","    }","    this.metric(\"receive\",msg);","    try {","        this.emit(\"input\", msg);","    } catch(err) {","        this.error(err,msg);","    }","};","","function log_helper(self, level, msg) {","    var o = {","        level: level,","        id: self.id,","        type: self.type,","        msg: msg","    };","    if (self.name) {","        o.name = self.name;","    }","    Log.log(o);","}","","Node.prototype.log = function(msg) {","    log_helper(this, Log.INFO, msg);","};","","Node.prototype.warn = function(msg) {","    log_helper(this, Log.WARN, msg);","};","","Node.prototype.error = function(logMessage,msg) {","    if (typeof logMessage != 'boolean') {","        logMessage = logMessage || \"\";","    }","    log_helper(this, Log.ERROR, logMessage);","    /* istanbul ignore else */","    if (msg) {","        flows.handleError(this,logMessage,msg);","    }","};","","/**"," * If called with no args, returns whether metric collection is enabled"," */","Node.prototype.metric = function(eventname, msg, metricValue) {","    if (typeof eventname === \"undefined\") {","        return Log.metric();","    }","    var metrics = {};","    metrics.level = Log.METRIC;","    metrics.nodeid = this.id;","    metrics.event = \"node.\"+this.type+\".\"+eventname;","    metrics.msgid = msg._msgid;","    metrics.value = metricValue;","    Log.log(metrics);","}","","/**"," * status: { fill:\"red|green\", shape:\"dot|ring\", text:\"blah\" }"," */","Node.prototype.status = function(status) {","    flows.handleStatus(this,status);","};","module.exports = Node;",""],"l":{"17":1,"18":1,"19":1,"21":1,"22":1,"23":1,"24":1,"26":1,"27":0,"28":0,"29":0,"30":0,"32":0,"33":0,"35":0,"36":0,"38":0,"41":1,"43":1,"45":0,"46":0,"48":0,"49":0,"50":0,"52":0,"53":0,"55":0,"57":0,"58":0,"61":0,"66":1,"67":0,"68":0,"70":0,"73":1,"75":1,"76":0,"77":0,"78":0,"80":0,"84":1,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"92":0,"93":0,"98":0,"101":0,"102":0,"103":0,"104":0,"108":0,"109":0,"111":0,"115":1,"116":0,"117":0,"119":0,"120":0,"121":0,"122":0,"126":0,"127":0,"129":0,"130":0,"132":0,"133":0,"135":0,"137":0,"141":0,"145":0,"147":0,"150":0,"151":0,"153":0,"154":0,"155":0,"156":0,"157":0,"159":0,"161":0,"162":0,"163":0,"165":0,"166":0,"167":0,"169":0,"170":0,"172":0,"173":0,"174":0,"176":0,"177":0,"187":0,"188":0,"190":0,"192":0,"193":0,"195":0,"196":0,"198":0,"202":1,"203":0,"204":0,"206":0,"207":0,"209":0,"210":0,"211":0,"213":0,"217":1,"218":0,"224":0,"225":0,"227":0,"230":1,"231":0,"234":1,"235":0,"238":1,"239":0,"240":0,"242":0,"244":0,"245":0,"252":1,"253":0,"254":0,"256":0,"257":0,"258":0,"259":0,"260":0,"261":0,"262":0,"268":1,"269":0,"271":1}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/storage/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/storage/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":1,"18":0,"19":1,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":1,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},"fnMap":{"1":{"name":"moduleSelector","line":28,"loc":{"start":{"line":28,"column":0},"end":{"line":28,"column":35}}},"2":{"name":"is_malicious","line":43,"loc":{"start":{"line":43,"column":0},"end":{"line":43,"column":28}}},"3":{"name":"(anonymous_3)","line":48,"loc":{"start":{"line":48,"column":14},"end":{"line":48,"column":33}}},"4":{"name":"(anonymous_4)","line":59,"loc":{"start":{"line":59,"column":18},"end":{"line":59,"column":29}}},"5":{"name":"(anonymous_5)","line":60,"loc":{"start":{"line":60,"column":49},"end":{"line":60,"column":65}}},"6":{"name":"(anonymous_6)","line":61,"loc":{"start":{"line":61,"column":59},"end":{"line":61,"column":75}}},"7":{"name":"(anonymous_7)","line":71,"loc":{"start":{"line":71,"column":19},"end":{"line":71,"column":36}}},"8":{"name":"(anonymous_8)","line":82,"loc":{"start":{"line":82,"column":46},"end":{"line":82,"column":57}}},"9":{"name":"(anonymous_9)","line":83,"loc":{"start":{"line":83,"column":59},"end":{"line":83,"column":70}}},"10":{"name":"(anonymous_10)","line":94,"loc":{"start":{"line":94,"column":21},"end":{"line":94,"column":32}}},"11":{"name":"(anonymous_11)","line":101,"loc":{"start":{"line":101,"column":22},"end":{"line":101,"column":41}}},"12":{"name":"(anonymous_12)","line":108,"loc":{"start":{"line":108,"column":21},"end":{"line":108,"column":32}}},"13":{"name":"(anonymous_13)","line":115,"loc":{"start":{"line":115,"column":22},"end":{"line":115,"column":41}}},"14":{"name":"(anonymous_14)","line":125,"loc":{"start":{"line":125,"column":25},"end":{"line":125,"column":46}}},"15":{"name":"(anonymous_15)","line":133,"loc":{"start":{"line":133,"column":26},"end":{"line":133,"column":59}}},"16":{"name":"(anonymous_16)","line":143,"loc":{"start":{"line":143,"column":21},"end":{"line":143,"column":32}}},"17":{"name":"(anonymous_17)","line":150,"loc":{"start":{"line":150,"column":17},"end":{"line":150,"column":30}}},"18":{"name":"(anonymous_18)","line":163,"loc":{"start":{"line":163,"column":18},"end":{"line":163,"column":37}}},"19":{"name":"listFlows","line":180,"loc":{"start":{"line":180,"column":0},"end":{"line":180,"column":25}}},"20":{"name":"(anonymous_20)","line":181,"loc":{"start":{"line":181,"column":60},"end":{"line":181,"column":74}}},"21":{"name":"(anonymous_21)","line":182,"loc":{"start":{"line":182,"column":28},"end":{"line":182,"column":46}}},"22":{"name":"(anonymous_22)","line":184,"loc":{"start":{"line":184,"column":24},"end":{"line":184,"column":36}}},"23":{"name":"(anonymous_23)","line":192,"loc":{"start":{"line":192,"column":39},"end":{"line":192,"column":54}}},"24":{"name":"(anonymous_24)","line":194,"loc":{"start":{"line":194,"column":29},"end":{"line":194,"column":41}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":31}},"4":{"start":{"line":21,"column":0},"end":{"line":21,"column":28}},"5":{"start":{"line":23,"column":0},"end":{"line":23,"column":12}},"6":{"start":{"line":24,"column":0},"end":{"line":24,"column":18}},"7":{"start":{"line":25,"column":0},"end":{"line":25,"column":22}},"8":{"start":{"line":26,"column":0},"end":{"line":26,"column":22}},"9":{"start":{"line":28,"column":0},"end":{"line":41,"column":1}},"10":{"start":{"line":29,"column":4},"end":{"line":29,"column":17}},"11":{"start":{"line":30,"column":4},"end":{"line":39,"column":5}},"12":{"start":{"line":31,"column":8},"end":{"line":36,"column":9}},"13":{"start":{"line":33,"column":12},"end":{"line":33,"column":61}},"14":{"start":{"line":35,"column":12},"end":{"line":35,"column":47}},"15":{"start":{"line":38,"column":8},"end":{"line":38,"column":48}},"16":{"start":{"line":40,"column":4},"end":{"line":40,"column":20}},"17":{"start":{"line":43,"column":0},"end":{"line":45,"column":1}},"18":{"start":{"line":44,"column":4},"end":{"line":44,"column":67}},"19":{"start":{"line":47,"column":0},"end":{"line":177,"column":1}},"20":{"start":{"line":49,"column":12},"end":{"line":49,"column":31}},"21":{"start":{"line":50,"column":12},"end":{"line":56,"column":13}},"22":{"start":{"line":51,"column":16},"end":{"line":51,"column":65}},"23":{"start":{"line":52,"column":16},"end":{"line":52,"column":128}},"24":{"start":{"line":53,"column":16},"end":{"line":53,"column":128}},"25":{"start":{"line":55,"column":16},"end":{"line":55,"column":38}},"26":{"start":{"line":57,"column":12},"end":{"line":57,"column":56}},"27":{"start":{"line":60,"column":12},"end":{"line":69,"column":15}},"28":{"start":{"line":61,"column":16},"end":{"line":68,"column":18}},"29":{"start":{"line":62,"column":20},"end":{"line":65,"column":22}},"30":{"start":{"line":66,"column":20},"end":{"line":66,"column":103}},"31":{"start":{"line":67,"column":20},"end":{"line":67,"column":34}},"32":{"start":{"line":72,"column":12},"end":{"line":72,"column":37}},"33":{"start":{"line":73,"column":12},"end":{"line":73,"column":49}},"34":{"start":{"line":74,"column":12},"end":{"line":74,"column":38}},"35":{"start":{"line":75,"column":12},"end":{"line":79,"column":13}},"36":{"start":{"line":76,"column":16},"end":{"line":76,"column":83}},"37":{"start":{"line":78,"column":16},"end":{"line":78,"column":55}},"38":{"start":{"line":80,"column":12},"end":{"line":80,"column":43}},"39":{"start":{"line":82,"column":12},"end":{"line":86,"column":15}},"40":{"start":{"line":83,"column":16},"end":{"line":85,"column":18}},"41":{"start":{"line":84,"column":20},"end":{"line":84,"column":97}},"42":{"start":{"line":95,"column":12},"end":{"line":99,"column":13}},"43":{"start":{"line":96,"column":16},"end":{"line":96,"column":51}},"44":{"start":{"line":98,"column":16},"end":{"line":98,"column":42}},"45":{"start":{"line":102,"column":12},"end":{"line":106,"column":13}},"46":{"start":{"line":103,"column":16},"end":{"line":103,"column":60}},"47":{"start":{"line":105,"column":16},"end":{"line":105,"column":38}},"48":{"start":{"line":109,"column":12},"end":{"line":113,"column":13}},"49":{"start":{"line":110,"column":16},"end":{"line":110,"column":51}},"50":{"start":{"line":112,"column":16},"end":{"line":112,"column":42}},"51":{"start":{"line":116,"column":12},"end":{"line":120,"column":13}},"52":{"start":{"line":117,"column":16},"end":{"line":117,"column":60}},"53":{"start":{"line":119,"column":16},"end":{"line":119,"column":38}},"54":{"start":{"line":126,"column":12},"end":{"line":130,"column":13}},"55":{"start":{"line":127,"column":16},"end":{"line":127,"column":38}},"56":{"start":{"line":128,"column":16},"end":{"line":128,"column":39}},"57":{"start":{"line":129,"column":16},"end":{"line":129,"column":40}},"58":{"start":{"line":131,"column":12},"end":{"line":131,"column":61}},"59":{"start":{"line":134,"column":12},"end":{"line":138,"column":13}},"60":{"start":{"line":135,"column":16},"end":{"line":135,"column":38}},"61":{"start":{"line":136,"column":16},"end":{"line":136,"column":39}},"62":{"start":{"line":137,"column":16},"end":{"line":137,"column":40}},"63":{"start":{"line":139,"column":12},"end":{"line":139,"column":74}},"64":{"start":{"line":144,"column":12},"end":{"line":148,"column":13}},"65":{"start":{"line":145,"column":16},"end":{"line":145,"column":51}},"66":{"start":{"line":147,"column":16},"end":{"line":147,"column":38}},"67":{"start":{"line":151,"column":12},"end":{"line":155,"column":13}},"68":{"start":{"line":152,"column":16},"end":{"line":152,"column":38}},"69":{"start":{"line":153,"column":16},"end":{"line":153,"column":39}},"70":{"start":{"line":154,"column":16},"end":{"line":154,"column":40}},"71":{"start":{"line":156,"column":12},"end":{"line":160,"column":13}},"72":{"start":{"line":157,"column":16},"end":{"line":157,"column":49}},"73":{"start":{"line":159,"column":16},"end":{"line":159,"column":65}},"74":{"start":{"line":164,"column":12},"end":{"line":168,"column":13}},"75":{"start":{"line":165,"column":16},"end":{"line":165,"column":38}},"76":{"start":{"line":166,"column":16},"end":{"line":166,"column":39}},"77":{"start":{"line":167,"column":16},"end":{"line":167,"column":40}},"78":{"start":{"line":169,"column":12},"end":{"line":173,"column":13}},"79":{"start":{"line":170,"column":16},"end":{"line":170,"column":56}},"80":{"start":{"line":172,"column":16},"end":{"line":172,"column":74}},"81":{"start":{"line":180,"column":0},"end":{"line":214,"column":1}},"82":{"start":{"line":181,"column":4},"end":{"line":213,"column":7}},"83":{"start":{"line":182,"column":8},"end":{"line":212,"column":11}},"84":{"start":{"line":183,"column":12},"end":{"line":183,"column":30}},"85":{"start":{"line":184,"column":12},"end":{"line":190,"column":15}},"86":{"start":{"line":185,"column":16},"end":{"line":189,"column":17}},"87":{"start":{"line":186,"column":20},"end":{"line":186,"column":64}},"88":{"start":{"line":188,"column":20},"end":{"line":188,"column":51}},"89":{"start":{"line":191,"column":12},"end":{"line":191,"column":20}},"90":{"start":{"line":192,"column":12},"end":{"line":211,"column":15}},"91":{"start":{"line":193,"column":16},"end":{"line":193,"column":32}},"92":{"start":{"line":194,"column":16},"end":{"line":209,"column":19}},"93":{"start":{"line":196,"column":20},"end":{"line":207,"column":21}},"94":{"start":{"line":197,"column":24},"end":{"line":197,"column":48}},"95":{"start":{"line":198,"column":24},"end":{"line":200,"column":25}},"96":{"start":{"line":199,"column":28},"end":{"line":199,"column":60}},"97":{"start":{"line":201,"column":24},"end":{"line":201,"column":50}},"98":{"start":{"line":202,"column":24},"end":{"line":202,"column":44}},"99":{"start":{"line":204,"column":24},"end":{"line":204,"column":50}},"100":{"start":{"line":205,"column":24},"end":{"line":205,"column":51}},"101":{"start":{"line":208,"column":20},"end":{"line":208,"column":24}},"102":{"start":{"line":210,"column":16},"end":{"line":210,"column":32}},"103":{"start":{"line":218,"column":0},"end":{"line":218,"column":40}}},"branchMap":{"1":{"line":30,"type":"if","locations":[{"start":{"line":30,"column":4},"end":{"line":30,"column":4}},{"start":{"line":30,"column":4},"end":{"line":30,"column":4}}]},"2":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":8},"end":{"line":31,"column":8}},{"start":{"line":31,"column":8},"end":{"line":31,"column":8}}]},"3":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":11},"end":{"line":44,"column":36}},{"start":{"line":44,"column":40},"end":{"line":44,"column":66}}]},"4":{"line":52,"type":"binary-expr","locations":[{"start":{"line":52,"column":36},"end":{"line":52,"column":79}},{"start":{"line":52,"column":83},"end":{"line":52,"column":127}}]},"5":{"line":53,"type":"binary-expr","locations":[{"start":{"line":53,"column":36},"end":{"line":53,"column":79}},{"start":{"line":53,"column":83},"end":{"line":53,"column":127}}]},"6":{"line":75,"type":"if","locations":[{"start":{"line":75,"column":12},"end":{"line":75,"column":12}},{"start":{"line":75,"column":12},"end":{"line":75,"column":12}}]},"7":{"line":95,"type":"if","locations":[{"start":{"line":95,"column":12},"end":{"line":95,"column":12}},{"start":{"line":95,"column":12},"end":{"line":95,"column":12}}]},"8":{"line":102,"type":"if","locations":[{"start":{"line":102,"column":12},"end":{"line":102,"column":12}},{"start":{"line":102,"column":12},"end":{"line":102,"column":12}}]},"9":{"line":109,"type":"if","locations":[{"start":{"line":109,"column":12},"end":{"line":109,"column":12}},{"start":{"line":109,"column":12},"end":{"line":109,"column":12}}]},"10":{"line":116,"type":"if","locations":[{"start":{"line":116,"column":12},"end":{"line":116,"column":12}},{"start":{"line":116,"column":12},"end":{"line":116,"column":12}}]},"11":{"line":126,"type":"if","locations":[{"start":{"line":126,"column":12},"end":{"line":126,"column":12}},{"start":{"line":126,"column":12},"end":{"line":126,"column":12}}]},"12":{"line":134,"type":"if","locations":[{"start":{"line":134,"column":12},"end":{"line":134,"column":12}},{"start":{"line":134,"column":12},"end":{"line":134,"column":12}}]},"13":{"line":144,"type":"if","locations":[{"start":{"line":144,"column":12},"end":{"line":144,"column":12}},{"start":{"line":144,"column":12},"end":{"line":144,"column":12}}]},"14":{"line":151,"type":"if","locations":[{"start":{"line":151,"column":12},"end":{"line":151,"column":12}},{"start":{"line":151,"column":12},"end":{"line":151,"column":12}}]},"15":{"line":156,"type":"if","locations":[{"start":{"line":156,"column":12},"end":{"line":156,"column":12}},{"start":{"line":156,"column":12},"end":{"line":156,"column":12}}]},"16":{"line":164,"type":"if","locations":[{"start":{"line":164,"column":12},"end":{"line":164,"column":12}},{"start":{"line":164,"column":12},"end":{"line":164,"column":12}}]},"17":{"line":169,"type":"if","locations":[{"start":{"line":169,"column":12},"end":{"line":169,"column":12}},{"start":{"line":169,"column":12},"end":{"line":169,"column":12}}]},"18":{"line":185,"type":"if","locations":[{"start":{"line":185,"column":16},"end":{"line":185,"column":16}},{"start":{"line":185,"column":16},"end":{"line":185,"column":16}}]},"19":{"line":196,"type":"if","locations":[{"start":{"line":196,"column":20},"end":{"line":196,"column":20}},{"start":{"line":196,"column":20},"end":{"line":196,"column":20}}]},"20":{"line":198,"type":"if","locations":[{"start":{"line":198,"column":24},"end":{"line":198,"column":24}},{"start":{"line":198,"column":24},"end":{"line":198,"column":24}}]},"21":{"line":201,"type":"binary-expr","locations":[{"start":{"line":201,"column":35},"end":{"line":201,"column":43}},{"start":{"line":201,"column":47},"end":{"line":201,"column":49}}]},"22":{"line":204,"type":"binary-expr","locations":[{"start":{"line":204,"column":35},"end":{"line":204,"column":43}},{"start":{"line":204,"column":47},"end":{"line":204,"column":49}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var when = require('when');","var Path = require('path');","var crypto = require('crypto');","","var log = require(\"../log\");","","var runtime;","var storageModule;","var settingsAvailable;","var sessionsAvailable;","","function moduleSelector(aSettings) {","    var toReturn;","    if (aSettings.storageModule) {","        if (typeof aSettings.storageModule === \"string\") {","            // TODO: allow storage modules to be specified by absolute path","            toReturn = require(\"./\"+aSettings.storageModule);","        } else {","            toReturn = aSettings.storageModule;","        }","    } else {","        toReturn = require(\"./localfilesystem\");","    }","    return toReturn;","}","","function is_malicious(path) {","    return path.indexOf('../') != -1 || path.indexOf('..\\\\') != -1;","}","","var storageModuleInterface = {","        init: function(_runtime) {","            runtime = _runtime;","            try {","                storageModule = moduleSelector(runtime.settings);","                settingsAvailable = storageModule.hasOwnProperty(\"getSettings\") && storageModule.hasOwnProperty(\"saveSettings\");","                sessionsAvailable = storageModule.hasOwnProperty(\"getSessions\") && storageModule.hasOwnProperty(\"saveSessions\");","            } catch (e) {","                return when.reject(e);","            }","            return storageModule.init(runtime.settings);","        },","        getFlows: function() {","            return storageModule.getFlows().then(function(flows) {","                return storageModule.getCredentials().then(function(creds) {","                    var result = {","                        flows: flows,","                        credentials: creds","                    };","                    result.rev = crypto.createHash('md5').update(JSON.stringify(result)).digest(\"hex\");","                    return result;","                })","            });","        },","        saveFlows: function(config) {","            var flows = config.flows;","            var credentials = config.credentials;","            var credentialSavePromise;","            if (config.credentialsDirty) {","                credentialSavePromise = storageModule.saveCredentials(credentials);","            } else {","                credentialSavePromise = when.resolve();","            }","            delete config.credentialsDirty;","","            return credentialSavePromise.then(function() {","                return storageModule.saveFlows(flows).then(function() {","                    return crypto.createHash('md5').update(JSON.stringify(config)).digest(\"hex\");","                })","            });","        },","        // getCredentials: function() {","        //     return storageModule.getCredentials();","        // },","        // saveCredentials: function(credentials) {","        //     return storageModule.saveCredentials(credentials);","        // },","        getSettings: function() {","            if (settingsAvailable) {","                return storageModule.getSettings();","            } else {","                return when.resolve(null);","            }","        },","        saveSettings: function(settings) {","            if (settingsAvailable) {","                return storageModule.saveSettings(settings);","            } else {","                return when.resolve();","            }","        },","        getSessions: function() {","            if (sessionsAvailable) {","                return storageModule.getSessions();","            } else {","                return when.resolve(null);","            }","        },","        saveSessions: function(sessions) {","            if (sessionsAvailable) {","                return storageModule.saveSessions(sessions);","            } else {","                return when.resolve();","            }","        },","","        /* Library Functions */","","        getLibraryEntry: function(type, path) {","            if (is_malicious(path)) {","                var err = new Error();","                err.code = \"forbidden\";","                return when.reject(err);","            }","            return storageModule.getLibraryEntry(type, path);","        },","        saveLibraryEntry: function(type, path, meta, body) {","            if (is_malicious(path)) {","                var err = new Error();","                err.code = \"forbidden\";","                return when.reject(err);","            }","            return storageModule.saveLibraryEntry(type, path, meta, body);","        },","","/* Deprecated functions */","        getAllFlows: function() {","            if (storageModule.hasOwnProperty(\"getAllFlows\")) {","                return storageModule.getAllFlows();","            } else {","                return listFlows(\"/\");","            }","        },","        getFlow: function(fn) {","            if (is_malicious(fn)) {","                var err = new Error();","                err.code = \"forbidden\";","                return when.reject(err);","            }","            if (storageModule.hasOwnProperty(\"getFlow\")) {","                return storageModule.getFlow(fn);","            } else {","                return storageModule.getLibraryEntry(\"flows\",fn);","            }","","        },","        saveFlow: function(fn, data) {","            if (is_malicious(fn)) {","                var err = new Error();","                err.code = \"forbidden\";","                return when.reject(err);","            }","            if (storageModule.hasOwnProperty(\"saveFlow\")) {","                return storageModule.saveFlow(fn, data);","            } else {","                return storageModule.saveLibraryEntry(\"flows\",fn,{},data);","            }","        }","/* End deprecated functions */","","}","","","function listFlows(path) {","    return storageModule.getLibraryEntry(\"flows\",path).then(function(res) {","        return when.promise(function(resolve) {","            var promises = [];","            res.forEach(function(r) {","                if (typeof r === \"string\") {","                    promises.push(listFlows(Path.join(path,r)));","                } else {","                    promises.push(when.resolve(r));","                }","            });","            var i=0;","            when.settle(promises).then(function(res2) {","                var result = {};","                res2.forEach(function(r) {","                    // TODO: name||fn","                    if (r.value.fn) {","                        var name = r.value.name;","                        if (!name) {","                            name = r.value.fn.split(\".\")[0];","                        }","                        result.f = result.f || [];","                        result.f.push(name);","                    } else {","                        result.d = result.d || {};","                        result.d[res[i]] = r.value;","                        //console.log(\">\",r.value);","                    }","                    i++;","                });","                resolve(result);","            });","        });","    });","}","","","","module.exports = storageModuleInterface;",""],"l":{"17":1,"18":1,"19":1,"21":1,"23":1,"24":1,"25":1,"26":1,"28":1,"29":0,"30":0,"31":0,"33":0,"35":0,"38":0,"40":0,"43":1,"44":0,"47":1,"49":0,"50":0,"51":0,"52":0,"53":0,"55":0,"57":0,"60":0,"61":0,"62":0,"66":0,"67":0,"72":0,"73":0,"74":0,"75":0,"76":0,"78":0,"80":0,"82":0,"83":0,"84":0,"95":0,"96":0,"98":0,"102":0,"103":0,"105":0,"109":0,"110":0,"112":0,"116":0,"117":0,"119":0,"126":0,"127":0,"128":0,"129":0,"131":0,"134":0,"135":0,"136":0,"137":0,"139":0,"144":0,"145":0,"147":0,"151":0,"152":0,"153":0,"154":0,"156":0,"157":0,"159":0,"164":0,"165":0,"166":0,"167":0,"169":0,"170":0,"172":0,"180":1,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"188":0,"191":0,"192":0,"193":0,"194":0,"196":0,"197":0,"198":0,"199":0,"201":0,"202":0,"204":0,"205":0,"208":0,"210":0,"218":1}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/settings.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/runtime/settings.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":1},"b":{"1":[0,0],"2":[0,0,0,0,0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},"fnMap":{"1":{"name":"(anonymous_1)","line":27,"loc":{"start":{"line":27,"column":10},"end":{"line":27,"column":29}}},"2":{"name":"(anonymous_2)","line":33,"loc":{"start":{"line":33,"column":17},"end":{"line":33,"column":28}}},"3":{"name":"(anonymous_3)","line":35,"loc":{"start":{"line":35,"column":58},"end":{"line":35,"column":69}}},"4":{"name":"(anonymous_4)","line":36,"loc":{"start":{"line":36,"column":58},"end":{"line":36,"column":69}}},"5":{"name":"(anonymous_5)","line":42,"loc":{"start":{"line":42,"column":10},"end":{"line":42,"column":29}}},"6":{"name":"(anonymous_6)","line":44,"loc":{"start":{"line":44,"column":42},"end":{"line":44,"column":62}}},"7":{"name":"(anonymous_7)","line":48,"loc":{"start":{"line":48,"column":9},"end":{"line":48,"column":24}}},"8":{"name":"(anonymous_8)","line":58,"loc":{"start":{"line":58,"column":9},"end":{"line":58,"column":30}}},"9":{"name":"(anonymous_9)","line":74,"loc":{"start":{"line":74,"column":12},"end":{"line":74,"column":27}}},"10":{"name":"(anonymous_10)","line":88,"loc":{"start":{"line":88,"column":15},"end":{"line":88,"column":26}}},"11":{"name":"(anonymous_11)","line":92,"loc":{"start":{"line":92,"column":11},"end":{"line":92,"column":22}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":29}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":31}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":27}},"5":{"start":{"line":22,"column":0},"end":{"line":22,"column":24}},"6":{"start":{"line":23,"column":0},"end":{"line":23,"column":26}},"7":{"start":{"line":24,"column":0},"end":{"line":24,"column":19}},"8":{"start":{"line":26,"column":0},"end":{"line":103,"column":1}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":32}},"10":{"start":{"line":29,"column":8},"end":{"line":39,"column":9}},"11":{"start":{"line":31,"column":12},"end":{"line":38,"column":13}},"12":{"start":{"line":33,"column":16},"end":{"line":37,"column":21}},"13":{"start":{"line":34,"column":20},"end":{"line":34,"column":30}},"14":{"start":{"line":35,"column":20},"end":{"line":35,"column":98}},"15":{"start":{"line":35,"column":71},"end":{"line":35,"column":94}},"16":{"start":{"line":36,"column":20},"end":{"line":36,"column":124}},"17":{"start":{"line":36,"column":71},"end":{"line":36,"column":120}},"18":{"start":{"line":40,"column":8},"end":{"line":40,"column":30}},"19":{"start":{"line":43,"column":8},"end":{"line":43,"column":27}},"20":{"start":{"line":44,"column":8},"end":{"line":46,"column":11}},"21":{"start":{"line":45,"column":12},"end":{"line":45,"column":39}},"22":{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},"23":{"start":{"line":50,"column":12},"end":{"line":50,"column":45}},"24":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"25":{"start":{"line":53,"column":12},"end":{"line":53,"column":61}},"26":{"start":{"line":55,"column":8},"end":{"line":55,"column":43}},"27":{"start":{"line":59,"column":8},"end":{"line":61,"column":9}},"28":{"start":{"line":60,"column":12},"end":{"line":60,"column":79}},"29":{"start":{"line":62,"column":8},"end":{"line":64,"column":9}},"30":{"start":{"line":63,"column":12},"end":{"line":63,"column":61}},"31":{"start":{"line":65,"column":8},"end":{"line":65,"column":43}},"32":{"start":{"line":66,"column":8},"end":{"line":66,"column":37}},"33":{"start":{"line":67,"column":8},"end":{"line":72,"column":9}},"34":{"start":{"line":68,"column":12},"end":{"line":68,"column":44}},"35":{"start":{"line":69,"column":12},"end":{"line":69,"column":34}},"36":{"start":{"line":71,"column":12},"end":{"line":71,"column":56}},"37":{"start":{"line":75,"column":8},"end":{"line":77,"column":9}},"38":{"start":{"line":76,"column":12},"end":{"line":76,"column":79}},"39":{"start":{"line":78,"column":8},"end":{"line":80,"column":9}},"40":{"start":{"line":79,"column":12},"end":{"line":79,"column":61}},"41":{"start":{"line":81,"column":8},"end":{"line":84,"column":9}},"42":{"start":{"line":82,"column":12},"end":{"line":82,"column":40}},"43":{"start":{"line":83,"column":12},"end":{"line":83,"column":56}},"44":{"start":{"line":85,"column":8},"end":{"line":85,"column":30}},"45":{"start":{"line":89,"column":8},"end":{"line":89,"column":41}},"46":{"start":{"line":93,"column":8},"end":{"line":98,"column":9}},"47":{"start":{"line":95,"column":12},"end":{"line":97,"column":13}},"48":{"start":{"line":96,"column":16},"end":{"line":96,"column":45}},"49":{"start":{"line":99,"column":8},"end":{"line":99,"column":28}},"50":{"start":{"line":100,"column":8},"end":{"line":100,"column":30}},"51":{"start":{"line":101,"column":8},"end":{"line":101,"column":23}},"52":{"start":{"line":105,"column":0},"end":{"line":105,"column":36}}},"branchMap":{"1":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":12},"end":{"line":31,"column":12}},{"start":{"line":31,"column":12},"end":{"line":31,"column":12},"skip":true}]},"2":{"line":31,"type":"binary-expr","locations":[{"start":{"line":31,"column":16},"end":{"line":31,"column":42}},{"start":{"line":31,"column":46},"end":{"line":31,"column":58}},{"start":{"line":31,"column":62},"end":{"line":31,"column":73}},{"start":{"line":31,"column":77},"end":{"line":31,"column":88}},{"start":{"line":31,"column":92},"end":{"line":31,"column":109}},{"start":{"line":31,"column":113},"end":{"line":31,"column":126}}]},"3":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":8},"end":{"line":49,"column":8}},{"start":{"line":49,"column":8},"end":{"line":49,"column":8}}]},"4":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":8},"end":{"line":52,"column":8}},{"start":{"line":52,"column":8},"end":{"line":52,"column":8}}]},"5":{"line":59,"type":"if","locations":[{"start":{"line":59,"column":8},"end":{"line":59,"column":8}},{"start":{"line":59,"column":8},"end":{"line":59,"column":8}}]},"6":{"line":62,"type":"if","locations":[{"start":{"line":62,"column":8},"end":{"line":62,"column":8}},{"start":{"line":62,"column":8},"end":{"line":62,"column":8}}]},"7":{"line":75,"type":"if","locations":[{"start":{"line":75,"column":8},"end":{"line":75,"column":8}},{"start":{"line":75,"column":8},"end":{"line":75,"column":8}}]},"8":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":8},"end":{"line":78,"column":8}},{"start":{"line":78,"column":8},"end":{"line":78,"column":8}}]},"9":{"line":81,"type":"if","locations":[{"start":{"line":81,"column":8},"end":{"line":81,"column":8}},{"start":{"line":81,"column":8},"end":{"line":81,"column":8}}]},"10":{"line":95,"type":"if","locations":[{"start":{"line":95,"column":12},"end":{"line":95,"column":12}},{"start":{"line":95,"column":12},"end":{"line":95,"column":12},"skip":true}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var when = require(\"when\");","var clone = require(\"clone\");","var assert = require(\"assert\");","var log = require(\"./log\");","","var userSettings = null;","var globalSettings = null;","var storage = null;","","var persistentSettings = {","    init: function(settings) {","        userSettings = settings;","        for (var i in settings) {","            /* istanbul ignore else */","            if (settings.hasOwnProperty(i) && i !== 'load' && i !== 'get' && i !== 'set' && i !== 'available' && i !== 'reset') {","                // Don't allow any of the core functions get replaced via settings","                (function() {","                    var j = i;","                    persistentSettings.__defineGetter__(j,function() { return userSettings[j]; });","                    persistentSettings.__defineSetter__(j,function() { throw new Error(\"Property '\"+j+\"' is read-only\"); });","                })();","            }","        }","        globalSettings = null;","    },","    load: function(_storage) {","        storage = _storage;","        return storage.getSettings().then(function(_settings) {","            globalSettings = _settings;","        });","    },","    get: function(prop) {","        if (userSettings.hasOwnProperty(prop)) {","            return clone(userSettings[prop]);","        }","        if (globalSettings === null) {","            throw new Error(log._(\"settings.not-available\"));","        }","        return clone(globalSettings[prop]);","    },","","    set: function(prop,value) {","        if (userSettings.hasOwnProperty(prop)) {","            throw new Error(log._(\"settings.property-read-only\", {prop:prop}));","        }","        if (globalSettings === null) {","            throw new Error(log._(\"settings.not-available\"));","        }","        var current = globalSettings[prop];","        globalSettings[prop] = value;","        try {","            assert.deepEqual(current,value);","            return when.resolve();","        } catch(err) {","            return storage.saveSettings(globalSettings);","        }","    },","    delete: function(prop) {","        if (userSettings.hasOwnProperty(prop)) {","            throw new Error(log._(\"settings.property-read-only\", {prop:prop}));","        }","        if (globalSettings === null) {","            throw new Error(log._(\"settings.not-available\"));","        }","        if (globalSettings.hasOwnProperty(prop)) {","            delete globalSettings[prop];","            return storage.saveSettings(globalSettings);","        }","        return when.resolve();","    },","","    available: function() {","        return (globalSettings !== null);","    },","","    reset: function() {","        for (var i in userSettings) {","            /* istanbul ignore else */","            if (userSettings.hasOwnProperty(i)) {","                delete persistentSettings[i];","            }","        }","        userSettings = null;","        globalSettings = null;","        storage = null;","    }","}","","module.exports = persistentSettings;",""],"l":{"17":1,"18":1,"19":1,"20":1,"22":1,"23":1,"24":1,"26":1,"28":0,"29":0,"31":0,"33":0,"34":0,"35":0,"36":0,"40":0,"43":0,"44":0,"45":0,"49":0,"50":0,"52":0,"53":0,"55":0,"59":0,"60":0,"62":0,"63":0,"65":0,"66":0,"67":0,"68":0,"69":0,"71":0,"75":0,"76":0,"78":0,"79":0,"81":0,"82":0,"83":0,"85":0,"89":0,"93":0,"95":0,"96":0,"99":0,"100":0,"101":0,"105":1}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":0,"27":0,"28":0,"29":0,"30":0,"31":1,"32":0,"33":0,"34":0,"35":0,"36":1,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":1,"100":0,"101":0,"102":0,"103":1,"104":0,"105":0,"106":1,"107":0,"108":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"fnMap":{"1":{"name":"(anonymous_1)","line":45,"loc":{"start":{"line":45,"column":19},"end":{"line":45,"column":46}}},"2":{"name":"(anonymous_2)","line":55,"loc":{"start":{"line":55,"column":27},"end":{"line":55,"column":50}}},"3":{"name":"init","line":64,"loc":{"start":{"line":64,"column":0},"end":{"line":64,"column":32}}},"4":{"name":"(anonymous_4)","line":88,"loc":{"start":{"line":88,"column":30},"end":{"line":88,"column":56}}},"5":{"name":"start","line":163,"loc":{"start":{"line":163,"column":0},"end":{"line":163,"column":17}}},"6":{"name":"(anonymous_6)","line":169,"loc":{"start":{"line":169,"column":12},"end":{"line":169,"column":22}}},"7":{"name":"stop","line":173,"loc":{"start":{"line":173,"column":0},"end":{"line":173,"column":16}}},"8":{"name":"(anonymous_8)","line":190,"loc":{"start":{"line":190,"column":16},"end":{"line":190,"column":19}}},"9":{"name":"(anonymous_9)","line":191,"loc":{"start":{"line":191,"column":14},"end":{"line":191,"column":17}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":33}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":40}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":27}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":27}},"5":{"start":{"line":21,"column":0},"end":{"line":21,"column":35}},"6":{"start":{"line":22,"column":0},"end":{"line":22,"column":27}},"7":{"start":{"line":23,"column":0},"end":{"line":23,"column":27}},"8":{"start":{"line":25,"column":0},"end":{"line":25,"column":25}},"9":{"start":{"line":26,"column":0},"end":{"line":26,"column":31}},"10":{"start":{"line":27,"column":0},"end":{"line":27,"column":31}},"11":{"start":{"line":28,"column":0},"end":{"line":28,"column":29}},"12":{"start":{"line":29,"column":0},"end":{"line":29,"column":35}},"13":{"start":{"line":30,"column":0},"end":{"line":30,"column":29}},"14":{"start":{"line":31,"column":0},"end":{"line":31,"column":31}},"15":{"start":{"line":32,"column":0},"end":{"line":32,"column":35}},"16":{"start":{"line":33,"column":0},"end":{"line":33,"column":43}},"17":{"start":{"line":34,"column":0},"end":{"line":34,"column":31}},"18":{"start":{"line":36,"column":0},"end":{"line":36,"column":29}},"19":{"start":{"line":37,"column":0},"end":{"line":37,"column":43}},"20":{"start":{"line":39,"column":0},"end":{"line":39,"column":9}},"21":{"start":{"line":40,"column":0},"end":{"line":40,"column":8}},"22":{"start":{"line":41,"column":0},"end":{"line":41,"column":13}},"23":{"start":{"line":42,"column":0},"end":{"line":42,"column":11}},"24":{"start":{"line":43,"column":0},"end":{"line":43,"column":12}},"25":{"start":{"line":45,"column":0},"end":{"line":53,"column":2}},"26":{"start":{"line":46,"column":4},"end":{"line":50,"column":5}},"27":{"start":{"line":47,"column":8},"end":{"line":47,"column":23}},"28":{"start":{"line":49,"column":8},"end":{"line":49,"column":31}},"29":{"start":{"line":51,"column":4},"end":{"line":51,"column":98}},"30":{"start":{"line":52,"column":4},"end":{"line":52,"column":77}},"31":{"start":{"line":55,"column":0},"end":{"line":62,"column":1}},"32":{"start":{"line":56,"column":4},"end":{"line":61,"column":5}},"33":{"start":{"line":57,"column":8},"end":{"line":57,"column":50}},"34":{"start":{"line":58,"column":8},"end":{"line":58,"column":44}},"35":{"start":{"line":60,"column":8},"end":{"line":60,"column":15}},"36":{"start":{"line":64,"column":0},"end":{"line":162,"column":1}},"37":{"start":{"line":65,"column":4},"end":{"line":65,"column":21}},"38":{"start":{"line":66,"column":4},"end":{"line":66,"column":23}},"39":{"start":{"line":67,"column":4},"end":{"line":67,"column":36}},"40":{"start":{"line":68,"column":4},"end":{"line":68,"column":24}},"41":{"start":{"line":69,"column":4},"end":{"line":69,"column":22}},"42":{"start":{"line":70,"column":4},"end":{"line":161,"column":5}},"43":{"start":{"line":71,"column":8},"end":{"line":71,"column":35}},"44":{"start":{"line":72,"column":8},"end":{"line":72,"column":29}},"45":{"start":{"line":73,"column":8},"end":{"line":73,"column":27}},"46":{"start":{"line":74,"column":8},"end":{"line":74,"column":34}},"47":{"start":{"line":75,"column":8},"end":{"line":75,"column":28}},"48":{"start":{"line":76,"column":8},"end":{"line":76,"column":27}},"49":{"start":{"line":77,"column":8},"end":{"line":77,"column":27}},"50":{"start":{"line":78,"column":8},"end":{"line":78,"column":39}},"51":{"start":{"line":79,"column":8},"end":{"line":79,"column":30}},"52":{"start":{"line":80,"column":8},"end":{"line":80,"column":28}},"53":{"start":{"line":83,"column":8},"end":{"line":104,"column":9}},"54":{"start":{"line":84,"column":12},"end":{"line":84,"column":29}},"55":{"start":{"line":85,"column":12},"end":{"line":85,"column":38}},"56":{"start":{"line":86,"column":12},"end":{"line":95,"column":13}},"57":{"start":{"line":87,"column":16},"end":{"line":87,"column":48}},"58":{"start":{"line":88,"column":16},"end":{"line":94,"column":19}},"59":{"start":{"line":89,"column":20},"end":{"line":93,"column":21}},"60":{"start":{"line":90,"column":24},"end":{"line":90,"column":31}},"61":{"start":{"line":92,"column":24},"end":{"line":92,"column":86}},"62":{"start":{"line":96,"column":12},"end":{"line":96,"column":77}},"63":{"start":{"line":97,"column":12},"end":{"line":97,"column":50}},"64":{"start":{"line":98,"column":12},"end":{"line":98,"column":32}},"65":{"start":{"line":99,"column":12},"end":{"line":101,"column":13}},"66":{"start":{"line":100,"column":16},"end":{"line":100,"column":52}},"67":{"start":{"line":102,"column":12},"end":{"line":102,"column":50}},"68":{"start":{"line":103,"column":12},"end":{"line":103,"column":36}},"69":{"start":{"line":105,"column":8},"end":{"line":105,"column":63}},"70":{"start":{"line":106,"column":8},"end":{"line":106,"column":65}},"71":{"start":{"line":107,"column":8},"end":{"line":107,"column":85}},"72":{"start":{"line":109,"column":8},"end":{"line":109,"column":60}},"73":{"start":{"line":111,"column":8},"end":{"line":121,"column":9}},"74":{"start":{"line":113,"column":12},"end":{"line":113,"column":48}},"75":{"start":{"line":114,"column":12},"end":{"line":119,"column":14}},"76":{"start":{"line":120,"column":12},"end":{"line":120,"column":87}},"77":{"start":{"line":122,"column":8},"end":{"line":125,"column":9}},"78":{"start":{"line":123,"column":12},"end":{"line":123,"column":59}},"79":{"start":{"line":124,"column":12},"end":{"line":124,"column":38}},"80":{"start":{"line":128,"column":8},"end":{"line":128,"column":84}},"81":{"start":{"line":129,"column":8},"end":{"line":129,"column":87}},"82":{"start":{"line":131,"column":8},"end":{"line":131,"column":86}},"83":{"start":{"line":132,"column":8},"end":{"line":132,"column":85}},"84":{"start":{"line":133,"column":8},"end":{"line":133,"column":93}},"85":{"start":{"line":134,"column":8},"end":{"line":134,"column":87}},"86":{"start":{"line":137,"column":8},"end":{"line":137,"column":87}},"87":{"start":{"line":138,"column":8},"end":{"line":138,"column":87}},"88":{"start":{"line":140,"column":8},"end":{"line":140,"column":114}},"89":{"start":{"line":141,"column":8},"end":{"line":141,"column":115}},"90":{"start":{"line":142,"column":8},"end":{"line":142,"column":115}},"91":{"start":{"line":144,"column":8},"end":{"line":144,"column":121}},"92":{"start":{"line":145,"column":8},"end":{"line":145,"column":122}},"93":{"start":{"line":147,"column":8},"end":{"line":147,"column":113}},"94":{"start":{"line":149,"column":8},"end":{"line":149,"column":67}},"95":{"start":{"line":152,"column":8},"end":{"line":152,"column":117}},"96":{"start":{"line":153,"column":8},"end":{"line":153,"column":99}},"97":{"start":{"line":154,"column":8},"end":{"line":154,"column":114}},"98":{"start":{"line":157,"column":8},"end":{"line":157,"column":94}},"99":{"start":{"line":163,"column":0},"end":{"line":172,"column":1}},"100":{"start":{"line":164,"column":4},"end":{"line":164,"column":67}},"101":{"start":{"line":165,"column":4},"end":{"line":171,"column":7}},"102":{"start":{"line":170,"column":8},"end":{"line":170,"column":22}},"103":{"start":{"line":173,"column":0},"end":{"line":176,"column":1}},"104":{"start":{"line":174,"column":4},"end":{"line":174,"column":17}},"105":{"start":{"line":175,"column":4},"end":{"line":175,"column":26}},"106":{"start":{"line":177,"column":0},"end":{"line":192,"column":2}},"107":{"start":{"line":190,"column":21},"end":{"line":190,"column":37}},"108":{"start":{"line":191,"column":19},"end":{"line":191,"column":33}}},"branchMap":{"1":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":4},"end":{"line":46,"column":4}},{"start":{"line":46,"column":4},"end":{"line":46,"column":4}}]},"2":{"line":51,"type":"binary-expr","locations":[{"start":{"line":51,"column":40},"end":{"line":51,"column":48}},{"start":{"line":51,"column":50},"end":{"line":51,"column":68}}]},"3":{"line":56,"type":"if","locations":[{"start":{"line":56,"column":4},"end":{"line":56,"column":4}},{"start":{"line":56,"column":4},"end":{"line":56,"column":4}}]},"4":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":4},"end":{"line":70,"column":4}},{"start":{"line":70,"column":4},"end":{"line":70,"column":4}}]},"5":{"line":83,"type":"if","locations":[{"start":{"line":83,"column":8},"end":{"line":83,"column":8}},{"start":{"line":83,"column":8},"end":{"line":83,"column":8}}]},"6":{"line":86,"type":"if","locations":[{"start":{"line":86,"column":12},"end":{"line":86,"column":12}},{"start":{"line":86,"column":12},"end":{"line":86,"column":12}}]},"7":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":20},"end":{"line":89,"column":20}},{"start":{"line":89,"column":20},"end":{"line":89,"column":20}}]},"8":{"line":99,"type":"if","locations":[{"start":{"line":99,"column":12},"end":{"line":99,"column":12}},{"start":{"line":99,"column":12},"end":{"line":99,"column":12}}]},"9":{"line":105,"type":"binary-expr","locations":[{"start":{"line":105,"column":32},"end":{"line":105,"column":53}},{"start":{"line":105,"column":57},"end":{"line":105,"column":62}}]},"10":{"line":111,"type":"if","locations":[{"start":{"line":111,"column":8},"end":{"line":111,"column":8}},{"start":{"line":111,"column":8},"end":{"line":111,"column":8}}]},"11":{"line":122,"type":"if","locations":[{"start":{"line":122,"column":8},"end":{"line":122,"column":8}},{"start":{"line":122,"column":8},"end":{"line":122,"column":8}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var express = require(\"express\");","var bodyParser = require(\"body-parser\");","var util = require('util');","var path = require('path');","var passport = require('passport');","var when = require('when');","var cors = require('cors');","","var ui = require(\"./ui\");","var nodes = require(\"./nodes\");","var flows = require(\"./flows\");","var flow = require(\"./flow\");","var library = require(\"./library\");","var info = require(\"./info\");","var theme = require(\"./theme\");","var locales = require(\"./locales\");","var credentials = require(\"./credentials\");","var comms = require(\"./comms\");","","var auth = require(\"./auth\");","var needsPermission = auth.needsPermission;","","var i18n;","var log;","var adminApp;","var server;","var runtime;","","var errorHandler = function(err,req,res,next) {","    if (err.message === \"request entity too large\") {","        log.error(err);","    } else {","        console.log(err.stack);","    }","    log.audit({event: \"api.error\",error:err.code||\"unexpected_error\",message:err.toString()},req);","    res.status(400).json({error:\"unexpected_error\", message:err.toString()});","};","","var ensureRuntimeStarted = function(req,res,next) {","    if (!runtime.isStarted()) {","        log.error(\"Node-RED runtime not started\");","        res.status(503).send(\"Not started\");","    } else {","        next();","    }","}","","function init(_server,_runtime) {","    server = _server;","    runtime = _runtime;","    var settings = runtime.settings;","    i18n = runtime.i18n;","    log = runtime.log;","    if (settings.httpAdminRoot !== false) {","        comms.init(server,runtime);","        adminApp = express();","        auth.init(runtime);","        credentials.init(runtime);","        flows.init(runtime);","        flow.init(runtime);","        info.init(runtime);","        library.init(adminApp,runtime);","        locales.init(runtime);","        nodes.init(runtime);","","        // Editor","        if (!settings.disableEditor) {","            ui.init(runtime);","            var editorApp = express();","            if (settings.requireHttps === true) {","                editorApp.enable('trust proxy');","                editorApp.use(function (req, res, next) {","                    if (req.secure) {","                        next();","                    } else {","                        res.redirect('https://' + req.headers.host + req.originalUrl);","                    }","                });","            }","            editorApp.get(\"/\",ensureRuntimeStarted,ui.ensureSlash,ui.editor);","            editorApp.get(\"/icons/:icon\",ui.icon);","            theme.init(runtime);","            if (settings.editorTheme) {","                editorApp.use(\"/theme\",theme.app());","            }","            editorApp.use(\"/\",ui.editorResources);","            adminApp.use(editorApp);","        }","        var maxApiRequestSize = settings.apiMaxLength || '5mb';","        adminApp.use(bodyParser.json({limit:maxApiRequestSize}));","        adminApp.use(bodyParser.urlencoded({limit:maxApiRequestSize,extended:true}));","","        adminApp.get(\"/auth/login\",auth.login,errorHandler);","","        if (settings.adminAuth) {","            //TODO: all passport references ought to be in ./auth","            adminApp.use(passport.initialize());","            adminApp.post(\"/auth/token\",","                auth.ensureClientSecret,","                auth.authenticateClient,","                auth.getToken,","                auth.errorHandler","            );","            adminApp.post(\"/auth/revoke\",needsPermission(\"\"),auth.revoke,errorHandler);","        }","        if (settings.httpAdminCors) {","            var corsHandler = cors(settings.httpAdminCors);","            adminApp.use(corsHandler);","        }","","        // Flows","        adminApp.get(\"/flows\",needsPermission(\"flows.read\"),flows.get,errorHandler);","        adminApp.post(\"/flows\",needsPermission(\"flows.write\"),flows.post,errorHandler);","","        adminApp.get(\"/flow/:id\",needsPermission(\"flows.read\"),flow.get,errorHandler);","        adminApp.post(\"/flow\",needsPermission(\"flows.write\"),flow.post,errorHandler);","        adminApp.delete(\"/flow/:id\",needsPermission(\"flows.write\"),flow.delete,errorHandler);","        adminApp.put(\"/flow/:id\",needsPermission(\"flows.write\"),flow.put,errorHandler);","","        // Nodes","        adminApp.get(\"/nodes\",needsPermission(\"nodes.read\"),nodes.getAll,errorHandler);","        adminApp.post(\"/nodes\",needsPermission(\"nodes.write\"),nodes.post,errorHandler);","","        adminApp.get(/\\/nodes\\/((@[^\\/]+\\/)?[^\\/]+)$/,needsPermission(\"nodes.read\"),nodes.getModule,errorHandler);","        adminApp.put(/\\/nodes\\/((@[^\\/]+\\/)?[^\\/]+)$/,needsPermission(\"nodes.write\"),nodes.putModule,errorHandler);","        adminApp.delete(/\\/nodes\\/((@[^\\/]+\\/)?[^\\/]+)$/,needsPermission(\"nodes.write\"),nodes.delete,errorHandler);","","        adminApp.get(/\\/nodes\\/((@[^\\/]+\\/)?[^\\/]+)\\/([^\\/]+)$/,needsPermission(\"nodes.read\"),nodes.getSet,errorHandler);","        adminApp.put(/\\/nodes\\/((@[^\\/]+\\/)?[^\\/]+)\\/([^\\/]+)$/,needsPermission(\"nodes.write\"),nodes.putSet,errorHandler);","","        adminApp.get('/credentials/:type/:id', needsPermission(\"credentials.read\"),credentials.get,errorHandler);","","        adminApp.get(/locales\\/(.+)\\/?$/,locales.get,errorHandler);","","        // Library","        adminApp.post(new RegExp(\"/library/flows\\/(.*)\"),needsPermission(\"library.write\"),library.post,errorHandler);","        adminApp.get(\"/library/flows\",needsPermission(\"library.read\"),library.getAll,errorHandler);","        adminApp.get(new RegExp(\"/library/flows\\/(.*)\"),needsPermission(\"library.read\"),library.get,errorHandler);","","        // Settings","        adminApp.get(\"/settings\",needsPermission(\"settings.read\"),info.settings,errorHandler);","","        // Error Handler","        //adminApp.use(errorHandler);","    }","}","function start() {","    var catalogPath = path.resolve(path.join(__dirname,\"locales\"));","    return i18n.registerMessageCatalogs([","        {namespace: \"editor\",   dir: catalogPath, file:\"editor.json\"},","        {namespace: \"jsonata\",  dir: catalogPath, file:\"jsonata.json\"},","        {namespace: \"infotips\", dir: catalogPath, file:\"infotips.json\"}","    ]).then(function(){","        comms.start();","    });","}","function stop() {","    comms.stop();","    return when.resolve();","}","module.exports = {","    init: init,","    start: start,","    stop: stop,","    library: {","        register: library.register","    },","    auth: {","        needsPermission: auth.needsPermission","    },","    comms: {","        publish: comms.publish","    },","    get adminApp() { return adminApp; },","    get server() { return server; }","};",""],"l":{"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"36":1,"37":1,"39":1,"40":1,"41":1,"42":1,"43":1,"45":1,"46":0,"47":0,"49":0,"51":0,"52":0,"55":1,"56":0,"57":0,"58":0,"60":0,"64":1,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"92":0,"96":0,"97":0,"98":0,"99":0,"100":0,"102":0,"103":0,"105":0,"106":0,"107":0,"109":0,"111":0,"113":0,"114":0,"120":0,"122":0,"123":0,"124":0,"128":0,"129":0,"131":0,"132":0,"133":0,"134":0,"137":0,"138":0,"140":0,"141":0,"142":0,"144":0,"145":0,"147":0,"149":0,"152":0,"153":0,"154":0,"157":0,"163":1,"164":0,"165":0,"170":0,"173":1,"174":0,"175":0,"177":1,"190":0,"191":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/ui.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/ui.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":0,"13":1,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"nodeIconDir","line":31,"loc":{"start":{"line":31,"column":0},"end":{"line":31,"column":26}}},"2":{"name":"(anonymous_2)","line":36,"loc":{"start":{"line":36,"column":10},"end":{"line":36,"column":28}}},"3":{"name":"(anonymous_3)","line":46,"loc":{"start":{"line":46,"column":17},"end":{"line":46,"column":40}}},"4":{"name":"(anonymous_4)","line":56,"loc":{"start":{"line":56,"column":10},"end":{"line":56,"column":28}}},"5":{"name":"(anonymous_5)","line":74,"loc":{"start":{"line":74,"column":12},"end":{"line":74,"column":30}}}},"statementMap":{"1":{"start":{"line":16,"column":0},"end":{"line":16,"column":33}},"2":{"start":{"line":17,"column":0},"end":{"line":17,"column":23}},"3":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":31}},"5":{"start":{"line":22,"column":0},"end":{"line":22,"column":35}},"6":{"start":{"line":24,"column":0},"end":{"line":24,"column":67}},"7":{"start":{"line":25,"column":0},"end":{"line":25,"column":19}},"8":{"start":{"line":27,"column":0},"end":{"line":27,"column":79}},"9":{"start":{"line":28,"column":0},"end":{"line":28,"column":68}},"10":{"start":{"line":29,"column":0},"end":{"line":29,"column":19}},"11":{"start":{"line":31,"column":0},"end":{"line":33,"column":1}},"12":{"start":{"line":32,"column":4},"end":{"line":32,"column":39}},"13":{"start":{"line":35,"column":0},"end":{"line":78,"column":2}},"14":{"start":{"line":37,"column":8},"end":{"line":37,"column":84}},"15":{"start":{"line":38,"column":8},"end":{"line":38,"column":39}},"16":{"start":{"line":42,"column":8},"end":{"line":42,"column":67}},"17":{"start":{"line":43,"column":8},"end":{"line":43,"column":55}},"18":{"start":{"line":47,"column":8},"end":{"line":47,"column":47}},"19":{"start":{"line":48,"column":8},"end":{"line":54,"column":9}},"20":{"start":{"line":49,"column":12},"end":{"line":49,"column":28}},"21":{"start":{"line":50,"column":12},"end":{"line":50,"column":43}},"22":{"start":{"line":51,"column":12},"end":{"line":51,"column":39}},"23":{"start":{"line":53,"column":12},"end":{"line":53,"column":19}},"24":{"start":{"line":57,"column":8},"end":{"line":72,"column":9}},"25":{"start":{"line":58,"column":12},"end":{"line":58,"column":53}},"26":{"start":{"line":60,"column":12},"end":{"line":70,"column":13}},"27":{"start":{"line":61,"column":16},"end":{"line":61,"column":72}},"28":{"start":{"line":62,"column":16},"end":{"line":69,"column":17}},"29":{"start":{"line":63,"column":20},"end":{"line":63,"column":42}},"30":{"start":{"line":64,"column":20},"end":{"line":64,"column":43}},"31":{"start":{"line":65,"column":20},"end":{"line":65,"column":58}},"32":{"start":{"line":66,"column":20},"end":{"line":66,"column":27}},"33":{"start":{"line":71,"column":12},"end":{"line":71,"column":38}},"34":{"start":{"line":75,"column":8},"end":{"line":75,"column":66}}},"branchMap":{"1":{"line":48,"type":"if","locations":[{"start":{"line":48,"column":8},"end":{"line":48,"column":8}},{"start":{"line":48,"column":8},"end":{"line":48,"column":8}}]},"2":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":8},"end":{"line":57,"column":8}},{"start":{"line":57,"column":8},"end":{"line":57,"column":8}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","var express = require('express');","var fs = require(\"fs\");","var path = require(\"path\");","","var theme = require(\"./theme\");","","var Mustache = require(\"mustache\");","","var icon_paths = [path.resolve(__dirname + '/../../public/icons')];","var iconCache = {};","//TODO: create a default icon","var defaultIcon = path.resolve(__dirname + '/../../public/icons/arrow-in.png');","var templateDir = path.resolve(__dirname+\"/../../editor/templates\");","var editorTemplate;","","function nodeIconDir(dir) {","    icon_paths.push(path.resolve(dir));","}","","module.exports = {","    init: function(runtime) {","        editorTemplate = fs.readFileSync(path.join(templateDir,\"index.mst\"),\"utf8\");","        Mustache.parse(editorTemplate);","        // TODO: this allows init to be called multiple times without","        //       registering multiple instances of the listener.","        //       It isn't.... ideal.","        runtime.events.removeListener(\"node-icon-dir\",nodeIconDir);","        runtime.events.on(\"node-icon-dir\",nodeIconDir);","    },","","    ensureSlash: function(req,res,next) {","        var parts = req.originalUrl.split(\"?\");","        if (parts[0].slice(-1) != \"/\") {","            parts[0] += \"/\";","            var redirect = parts.join(\"?\");","            res.redirect(301,redirect);","        } else {","            next();","        }","    },","    icon: function(req,res) {","        if (iconCache[req.params.icon]) {","            res.sendFile(iconCache[req.params.icon]); // if not found, express prints this to the console and serves 404","        } else {","            for (var p=0;p<icon_paths.length;p++) {","                var iconPath = path.join(icon_paths[p],req.params.icon);","                try {","                    fs.statSync(iconPath);","                    res.sendFile(iconPath);","                    iconCache[req.params.icon] = iconPath;","                    return;","                } catch(err) {","                    // iconPath doesn't exist","                }","            }","            res.sendFile(defaultIcon);","        }","    },","    editor: function(req,res) {","        res.send(Mustache.render(editorTemplate,theme.context()));","    },","    editorResources: express.static(__dirname + '/../../public')","};",""],"l":{"16":1,"17":1,"18":1,"20":1,"22":1,"24":1,"25":1,"27":1,"28":1,"29":1,"31":1,"32":0,"35":1,"37":0,"38":0,"42":0,"43":0,"47":0,"48":0,"49":0,"50":0,"51":0,"53":0,"57":0,"58":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"71":0,"75":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/theme.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/theme.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":1,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0},"b":{"1":[0,1],"2":[0,1],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"serveFile","line":45,"loc":{"start":{"line":45,"column":0},"end":{"line":45,"column":37}}},"2":{"name":"(anonymous_2)","line":50,"loc":{"start":{"line":50,"column":20},"end":{"line":50,"column":39}}},"3":{"name":"(anonymous_3)","line":61,"loc":{"start":{"line":61,"column":10},"end":{"line":61,"column":28}}},"4":{"name":"(anonymous_4)","line":71,"loc":{"start":{"line":71,"column":9},"end":{"line":71,"column":20}}},"5":{"name":"(anonymous_5)","line":172,"loc":{"start":{"line":172,"column":13},"end":{"line":172,"column":24}}},"6":{"name":"(anonymous_6)","line":175,"loc":{"start":{"line":175,"column":14},"end":{"line":175,"column":25}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":33}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":27}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":23}},"5":{"start":{"line":21,"column":0},"end":{"line":21,"column":29}},"6":{"start":{"line":23,"column":0},"end":{"line":38,"column":2}},"7":{"start":{"line":40,"column":0},"end":{"line":40,"column":17}},"8":{"start":{"line":41,"column":0},"end":{"line":41,"column":41}},"9":{"start":{"line":42,"column":0},"end":{"line":42,"column":25}},"10":{"start":{"line":43,"column":0},"end":{"line":43,"column":19}},"11":{"start":{"line":45,"column":0},"end":{"line":58,"column":1}},"12":{"start":{"line":46,"column":4},"end":{"line":57,"column":5}},"13":{"start":{"line":47,"column":8},"end":{"line":47,"column":38}},"14":{"start":{"line":48,"column":8},"end":{"line":48,"column":46}},"15":{"start":{"line":50,"column":8},"end":{"line":52,"column":11}},"16":{"start":{"line":51,"column":12},"end":{"line":51,"column":31}},"17":{"start":{"line":53,"column":8},"end":{"line":53,"column":27}},"18":{"start":{"line":56,"column":8},"end":{"line":56,"column":20}},"19":{"start":{"line":60,"column":0},"end":{"line":178,"column":1}},"20":{"start":{"line":62,"column":8},"end":{"line":62,"column":40}},"21":{"start":{"line":63,"column":8},"end":{"line":63,"column":45}},"22":{"start":{"line":64,"column":8},"end":{"line":66,"column":9}},"23":{"start":{"line":65,"column":12},"end":{"line":65,"column":53}},"24":{"start":{"line":67,"column":8},"end":{"line":67,"column":29}},"25":{"start":{"line":68,"column":8},"end":{"line":68,"column":37}},"26":{"start":{"line":72,"column":8},"end":{"line":72,"column":14}},"27":{"start":{"line":73,"column":8},"end":{"line":73,"column":16}},"28":{"start":{"line":74,"column":8},"end":{"line":74,"column":27}},"29":{"start":{"line":76,"column":8},"end":{"line":76,"column":33}},"30":{"start":{"line":78,"column":8},"end":{"line":109,"column":9}},"31":{"start":{"line":79,"column":12},"end":{"line":92,"column":13}},"32":{"start":{"line":80,"column":16},"end":{"line":80,"column":44}},"33":{"start":{"line":81,"column":16},"end":{"line":83,"column":17}},"34":{"start":{"line":82,"column":20},"end":{"line":82,"column":38}},"35":{"start":{"line":84,"column":16},"end":{"line":84,"column":43}},"36":{"start":{"line":86,"column":16},"end":{"line":91,"column":17}},"37":{"start":{"line":87,"column":20},"end":{"line":87,"column":64}},"38":{"start":{"line":88,"column":20},"end":{"line":90,"column":21}},"39":{"start":{"line":89,"column":24},"end":{"line":89,"column":56}},"40":{"start":{"line":94,"column":12},"end":{"line":99,"column":13}},"41":{"start":{"line":95,"column":16},"end":{"line":95,"column":72}},"42":{"start":{"line":96,"column":16},"end":{"line":98,"column":17}},"43":{"start":{"line":97,"column":20},"end":{"line":97,"column":52}},"44":{"start":{"line":101,"column":12},"end":{"line":106,"column":13}},"45":{"start":{"line":102,"column":16},"end":{"line":102,"column":72}},"46":{"start":{"line":103,"column":16},"end":{"line":105,"column":17}},"47":{"start":{"line":104,"column":20},"end":{"line":104,"column":52}},"48":{"start":{"line":108,"column":12},"end":{"line":108,"column":82}},"49":{"start":{"line":111,"column":8},"end":{"line":129,"column":9}},"50":{"start":{"line":113,"column":12},"end":{"line":113,"column":88}},"51":{"start":{"line":115,"column":12},"end":{"line":117,"column":13}},"52":{"start":{"line":116,"column":16},"end":{"line":116,"column":59}},"53":{"start":{"line":119,"column":12},"end":{"line":128,"column":13}},"54":{"start":{"line":120,"column":16},"end":{"line":127,"column":17}},"55":{"start":{"line":121,"column":20},"end":{"line":121,"column":76}},"56":{"start":{"line":122,"column":20},"end":{"line":124,"column":21}},"57":{"start":{"line":123,"column":24},"end":{"line":123,"column":56}},"58":{"start":{"line":126,"column":20},"end":{"line":126,"column":53}},"59":{"start":{"line":131,"column":8},"end":{"line":146,"column":9}},"60":{"start":{"line":132,"column":12},"end":{"line":145,"column":13}},"61":{"start":{"line":133,"column":16},"end":{"line":135,"column":17}},"62":{"start":{"line":136,"column":16},"end":{"line":138,"column":17}},"63":{"start":{"line":137,"column":20},"end":{"line":137,"column":80}},"64":{"start":{"line":139,"column":16},"end":{"line":144,"column":17}},"65":{"start":{"line":140,"column":20},"end":{"line":140,"column":81}},"66":{"start":{"line":141,"column":20},"end":{"line":143,"column":21}},"67":{"start":{"line":142,"column":24},"end":{"line":142,"column":62}},"68":{"start":{"line":148,"column":8},"end":{"line":150,"column":9}},"69":{"start":{"line":149,"column":12},"end":{"line":149,"column":52}},"70":{"start":{"line":152,"column":8},"end":{"line":161,"column":9}},"71":{"start":{"line":153,"column":12},"end":{"line":160,"column":13}},"72":{"start":{"line":154,"column":16},"end":{"line":154,"column":70}},"73":{"start":{"line":155,"column":16},"end":{"line":159,"column":17}},"74":{"start":{"line":156,"column":20},"end":{"line":158,"column":21}},"75":{"start":{"line":163,"column":8},"end":{"line":165,"column":9}},"76":{"start":{"line":164,"column":12},"end":{"line":164,"column":44}},"77":{"start":{"line":167,"column":8},"end":{"line":169,"column":9}},"78":{"start":{"line":168,"column":12},"end":{"line":168,"column":50}},"79":{"start":{"line":170,"column":8},"end":{"line":170,"column":24}},"80":{"start":{"line":173,"column":8},"end":{"line":173,"column":28}},"81":{"start":{"line":176,"column":8},"end":{"line":176,"column":29}}},"branchMap":{"1":{"line":34,"type":"cond-expr","locations":[{"start":{"line":34,"column":54},"end":{"line":34,"column":66}},{"start":{"line":34,"column":67},"end":{"line":34,"column":83}}]},"2":{"line":35,"type":"cond-expr","locations":[{"start":{"line":35,"column":55},"end":{"line":35,"column":68}},{"start":{"line":35,"column":69},"end":{"line":35,"column":86}}]},"3":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":8},"end":{"line":64,"column":8}},{"start":{"line":64,"column":8},"end":{"line":64,"column":8}}]},"4":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":8},"end":{"line":78,"column":8}},{"start":{"line":78,"column":8},"end":{"line":78,"column":8}}]},"5":{"line":79,"type":"if","locations":[{"start":{"line":79,"column":12},"end":{"line":79,"column":12}},{"start":{"line":79,"column":12},"end":{"line":79,"column":12}}]},"6":{"line":81,"type":"if","locations":[{"start":{"line":81,"column":16},"end":{"line":81,"column":16}},{"start":{"line":81,"column":16},"end":{"line":81,"column":16}}]},"7":{"line":88,"type":"if","locations":[{"start":{"line":88,"column":20},"end":{"line":88,"column":20}},{"start":{"line":88,"column":20},"end":{"line":88,"column":20}}]},"8":{"line":94,"type":"if","locations":[{"start":{"line":94,"column":12},"end":{"line":94,"column":12}},{"start":{"line":94,"column":12},"end":{"line":94,"column":12}}]},"9":{"line":96,"type":"if","locations":[{"start":{"line":96,"column":16},"end":{"line":96,"column":16}},{"start":{"line":96,"column":16},"end":{"line":96,"column":16}}]},"10":{"line":101,"type":"if","locations":[{"start":{"line":101,"column":12},"end":{"line":101,"column":12}},{"start":{"line":101,"column":12},"end":{"line":101,"column":12}}]},"11":{"line":103,"type":"if","locations":[{"start":{"line":103,"column":16},"end":{"line":103,"column":16}},{"start":{"line":103,"column":16},"end":{"line":103,"column":16}}]},"12":{"line":108,"type":"binary-expr","locations":[{"start":{"line":108,"column":38},"end":{"line":108,"column":54}},{"start":{"line":108,"column":58},"end":{"line":108,"column":81}}]},"13":{"line":111,"type":"if","locations":[{"start":{"line":111,"column":8},"end":{"line":111,"column":8}},{"start":{"line":111,"column":8},"end":{"line":111,"column":8}}]},"14":{"line":113,"type":"binary-expr","locations":[{"start":{"line":113,"column":40},"end":{"line":113,"column":58}},{"start":{"line":113,"column":62},"end":{"line":113,"column":87}}]},"15":{"line":115,"type":"if","locations":[{"start":{"line":115,"column":12},"end":{"line":115,"column":12}},{"start":{"line":115,"column":12},"end":{"line":115,"column":12}}]},"16":{"line":119,"type":"if","locations":[{"start":{"line":119,"column":12},"end":{"line":119,"column":12}},{"start":{"line":119,"column":12},"end":{"line":119,"column":12}}]},"17":{"line":120,"type":"if","locations":[{"start":{"line":120,"column":16},"end":{"line":120,"column":16}},{"start":{"line":120,"column":16},"end":{"line":120,"column":16}}]},"18":{"line":122,"type":"if","locations":[{"start":{"line":122,"column":20},"end":{"line":122,"column":20}},{"start":{"line":122,"column":20},"end":{"line":122,"column":20}}]},"19":{"line":131,"type":"if","locations":[{"start":{"line":131,"column":8},"end":{"line":131,"column":8}},{"start":{"line":131,"column":8},"end":{"line":131,"column":8}}]},"20":{"line":132,"type":"if","locations":[{"start":{"line":132,"column":12},"end":{"line":132,"column":12}},{"start":{"line":132,"column":12},"end":{"line":132,"column":12}}]},"21":{"line":136,"type":"if","locations":[{"start":{"line":136,"column":16},"end":{"line":136,"column":16}},{"start":{"line":136,"column":16},"end":{"line":136,"column":16}}]},"22":{"line":139,"type":"if","locations":[{"start":{"line":139,"column":16},"end":{"line":139,"column":16}},{"start":{"line":139,"column":16},"end":{"line":139,"column":16}}]},"23":{"line":141,"type":"if","locations":[{"start":{"line":141,"column":20},"end":{"line":141,"column":20}},{"start":{"line":141,"column":20},"end":{"line":141,"column":20}}]},"24":{"line":148,"type":"if","locations":[{"start":{"line":148,"column":8},"end":{"line":148,"column":8}},{"start":{"line":148,"column":8},"end":{"line":148,"column":8}}]},"25":{"line":152,"type":"if","locations":[{"start":{"line":152,"column":8},"end":{"line":152,"column":8}},{"start":{"line":152,"column":8},"end":{"line":152,"column":8}}]},"26":{"line":153,"type":"if","locations":[{"start":{"line":153,"column":12},"end":{"line":153,"column":12}},{"start":{"line":153,"column":12},"end":{"line":153,"column":12}}]},"27":{"line":155,"type":"if","locations":[{"start":{"line":155,"column":16},"end":{"line":155,"column":16}},{"start":{"line":155,"column":16},"end":{"line":155,"column":16}}]},"28":{"line":163,"type":"if","locations":[{"start":{"line":163,"column":8},"end":{"line":163,"column":8}},{"start":{"line":163,"column":8},"end":{"line":163,"column":8}}]},"29":{"line":167,"type":"if","locations":[{"start":{"line":167,"column":8},"end":{"line":167,"column":8}},{"start":{"line":167,"column":8},"end":{"line":167,"column":8}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var express = require(\"express\");","var util = require(\"util\");","var path = require(\"path\");","var fs = require(\"fs\");","var clone = require(\"clone\");","","var defaultContext = {","    page: {","        title: \"Node-RED\",","        favicon: \"favicon.ico\",","        tabicon: \"red/images/node-red-icon-black.svg\"","    },","    header: {","        title: \"Node-RED\",","        image: \"red/images/node-red.png\"","    },","    asset: {","        red: (process.env.NODE_ENV == \"development\")? \"red/red.js\":\"red/red.min.js\",","        main: (process.env.NODE_ENV == \"development\")? \"red/main.js\":\"red/main.min.js\",","","    }","};","","var theme = null;","var themeContext = clone(defaultContext);","var themeSettings = null;","var runtime = null;","","function serveFile(app,baseUrl,file) {","    try {","        var stats = fs.statSync(file);","        var url = baseUrl+path.basename(file);","        //console.log(url,\"->\",file);","        app.get(url,function(req, res) {","            res.sendFile(file);","        });","        return \"theme\"+url;","    } catch(err) {","        //TODO: log filenotfound","        return null;","    }","}","","module.exports = {","    init: function(runtime) {","        var settings = runtime.settings;","        themeContext = clone(defaultContext);","        if (runtime.version) {","            themeContext.version = runtime.version();","        }","        themeSettings = null;","        theme = settings.editorTheme;","    },","","    app: function() {","        var i;","        var url;","        themeSettings = {};","","        var themeApp = express();","","        if (theme.page) {","            if (theme.page.css) {","                var styles = theme.page.css;","                if (!util.isArray(styles)) {","                    styles = [styles];","                }","                themeContext.page.css = [];","","                for (i=0;i<styles.length;i++) {","                    url = serveFile(themeApp,\"/css/\",styles[i]);","                    if (url) {","                        themeContext.page.css.push(url);","                    }","                }","            }","","            if (theme.page.favicon) {","                url = serveFile(themeApp,\"/favicon/\",theme.page.favicon)","                if (url) {","                    themeContext.page.favicon = url;","                }","            }","","            if (theme.page.tabicon) {","                url = serveFile(themeApp,\"/tabicon/\",theme.page.tabicon)","                if (url) {","                    themeContext.page.tabicon = url;","                }","            }","","            themeContext.page.title = theme.page.title || themeContext.page.title;","        }","","        if (theme.header) {","","            themeContext.header.title = theme.header.title || themeContext.header.title;","","            if (theme.header.hasOwnProperty(\"url\")) {","                themeContext.header.url = theme.header.url;","            }","","            if (theme.header.hasOwnProperty(\"image\")) {","                if (theme.header.image) {","                    url = serveFile(themeApp,\"/header/\",theme.header.image);","                    if (url) {","                        themeContext.header.image = url;","                    }","                } else {","                    themeContext.header.image = null;","                }","            }","        }","","        if (theme.deployButton) {","            if (theme.deployButton.type == \"simple\") {","                themeSettings.deployButton = {","                    type: \"simple\"","                }","                if (theme.deployButton.label) {","                    themeSettings.deployButton.label = theme.deployButton.label;","                }","                if (theme.deployButton.icon) {","                    url = serveFile(themeApp,\"/deploy/\",theme.deployButton.icon);","                    if (url) {","                        themeSettings.deployButton.icon = url;","                    }","                }","            }","        }","","        if (theme.hasOwnProperty(\"userMenu\")) {","            themeSettings.userMenu = theme.userMenu;","        }","","        if (theme.login) {","            if (theme.login.image) {","                url = serveFile(themeApp,\"/login/\",theme.login.image);","                if (url) {","                    themeContext.login = {","                        image: url","                    }","                }","            }","        }","","        if (theme.hasOwnProperty(\"menu\")) {","            themeSettings.menu = theme.menu;","        }","","        if (theme.hasOwnProperty(\"palette\")) {","            themeSettings.palette = theme.palette;","        }","        return themeApp;","    },","    context: function() {","        return themeContext;","    },","    settings: function() {","        return themeSettings;","    }","}",""],"l":{"17":1,"18":1,"19":1,"20":1,"21":1,"23":1,"40":1,"41":1,"42":1,"43":1,"45":1,"46":0,"47":0,"48":0,"50":0,"51":0,"53":0,"56":0,"60":1,"62":0,"63":0,"64":0,"65":0,"67":0,"68":0,"72":0,"73":0,"74":0,"76":0,"78":0,"79":0,"80":0,"81":0,"82":0,"84":0,"86":0,"87":0,"88":0,"89":0,"94":0,"95":0,"96":0,"97":0,"101":0,"102":0,"103":0,"104":0,"108":0,"111":0,"113":0,"115":0,"116":0,"119":0,"120":0,"121":0,"122":0,"123":0,"126":0,"131":0,"132":0,"133":0,"136":0,"137":0,"139":0,"140":0,"141":0,"142":0,"148":0,"149":0,"152":0,"153":0,"154":0,"155":0,"156":0,"163":0,"164":0,"167":0,"168":0,"170":0,"173":0,"176":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/nodes.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/nodes.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":1,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},"fnMap":{"1":{"name":"(anonymous_1)","line":26,"loc":{"start":{"line":26,"column":10},"end":{"line":26,"column":28}}},"2":{"name":"(anonymous_2)","line":32,"loc":{"start":{"line":32,"column":12},"end":{"line":32,"column":30}}},"3":{"name":"(anonymous_3)","line":43,"loc":{"start":{"line":43,"column":10},"end":{"line":43,"column":28}}},"4":{"name":"(anonymous_4)","line":64,"loc":{"start":{"line":64,"column":21},"end":{"line":64,"column":36}}},"5":{"name":"(anonymous_5)","line":70,"loc":{"start":{"line":70,"column":21},"end":{"line":70,"column":35}}},"6":{"name":"(anonymous_6)","line":84,"loc":{"start":{"line":84,"column":12},"end":{"line":84,"column":30}}},"7":{"name":"(anonymous_7)","line":102,"loc":{"start":{"line":102,"column":25},"end":{"line":102,"column":40}}},"8":{"name":"(anonymous_8)","line":106,"loc":{"start":{"line":106,"column":25},"end":{"line":106,"column":39}}},"9":{"name":"(anonymous_9)","line":116,"loc":{"start":{"line":116,"column":12},"end":{"line":116,"column":30}}},"10":{"name":"(anonymous_10)","line":142,"loc":{"start":{"line":142,"column":15},"end":{"line":142,"column":33}}},"11":{"name":"(anonymous_11)","line":154,"loc":{"start":{"line":154,"column":12},"end":{"line":154,"column":30}}},"12":{"name":"(anonymous_12)","line":175,"loc":{"start":{"line":175,"column":49},"end":{"line":175,"column":66}}},"13":{"name":"(anonymous_13)","line":186,"loc":{"start":{"line":186,"column":15},"end":{"line":186,"column":33}}},"14":{"name":"(anonymous_14)","line":211,"loc":{"start":{"line":211,"column":39},"end":{"line":211,"column":50}}},"15":{"name":"putNode","line":221,"loc":{"start":{"line":221,"column":0},"end":{"line":221,"column":32}}},"16":{"name":"(anonymous_16)","line":233,"loc":{"start":{"line":233,"column":28},"end":{"line":233,"column":43}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":31}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":35}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":13}},"5":{"start":{"line":21,"column":0},"end":{"line":21,"column":8}},"6":{"start":{"line":22,"column":0},"end":{"line":22,"column":9}},"7":{"start":{"line":23,"column":0},"end":{"line":23,"column":13}},"8":{"start":{"line":25,"column":0},"end":{"line":219,"column":2}},"9":{"start":{"line":27,"column":8},"end":{"line":27,"column":33}},"10":{"start":{"line":28,"column":8},"end":{"line":28,"column":26}},"11":{"start":{"line":29,"column":8},"end":{"line":29,"column":28}},"12":{"start":{"line":30,"column":8},"end":{"line":30,"column":36}},"13":{"start":{"line":33,"column":8},"end":{"line":40,"column":9}},"14":{"start":{"line":34,"column":12},"end":{"line":34,"column":53}},"15":{"start":{"line":35,"column":12},"end":{"line":35,"column":45}},"16":{"start":{"line":37,"column":12},"end":{"line":37,"column":80}},"17":{"start":{"line":38,"column":12},"end":{"line":38,"column":56}},"18":{"start":{"line":39,"column":12},"end":{"line":39,"column":52}},"19":{"start":{"line":44,"column":8},"end":{"line":48,"column":9}},"20":{"start":{"line":45,"column":12},"end":{"line":45,"column":81}},"21":{"start":{"line":46,"column":12},"end":{"line":46,"column":97}},"22":{"start":{"line":47,"column":12},"end":{"line":47,"column":19}},"23":{"start":{"line":49,"column":8},"end":{"line":49,"column":28}},"24":{"start":{"line":50,"column":8},"end":{"line":50,"column":20}},"25":{"start":{"line":51,"column":8},"end":{"line":63,"column":9}},"26":{"start":{"line":52,"column":12},"end":{"line":52,"column":61}},"27":{"start":{"line":53,"column":12},"end":{"line":57,"column":13}},"28":{"start":{"line":54,"column":16},"end":{"line":54,"column":105}},"29":{"start":{"line":55,"column":16},"end":{"line":55,"column":103}},"30":{"start":{"line":56,"column":16},"end":{"line":56,"column":23}},"31":{"start":{"line":58,"column":12},"end":{"line":58,"column":58}},"32":{"start":{"line":60,"column":12},"end":{"line":60,"column":95}},"33":{"start":{"line":61,"column":12},"end":{"line":61,"column":87}},"34":{"start":{"line":62,"column":12},"end":{"line":62,"column":19}},"35":{"start":{"line":64,"column":8},"end":{"line":81,"column":11}},"36":{"start":{"line":65,"column":12},"end":{"line":65,"column":57}},"37":{"start":{"line":66,"column":12},"end":{"line":69,"column":13}},"38":{"start":{"line":67,"column":16},"end":{"line":67,"column":75}},"39":{"start":{"line":68,"column":16},"end":{"line":68,"column":31}},"40":{"start":{"line":71,"column":12},"end":{"line":80,"column":13}},"41":{"start":{"line":72,"column":16},"end":{"line":72,"column":93}},"42":{"start":{"line":73,"column":16},"end":{"line":73,"column":38}},"43":{"start":{"line":74,"column":19},"end":{"line":80,"column":13}},"44":{"start":{"line":75,"column":16},"end":{"line":75,"column":90}},"45":{"start":{"line":76,"column":16},"end":{"line":76,"column":76}},"46":{"start":{"line":78,"column":16},"end":{"line":78,"column":133}},"47":{"start":{"line":79,"column":16},"end":{"line":79,"column":99}},"48":{"start":{"line":85,"column":8},"end":{"line":89,"column":9}},"49":{"start":{"line":86,"column":12},"end":{"line":86,"column":80}},"50":{"start":{"line":87,"column":12},"end":{"line":87,"column":97}},"51":{"start":{"line":88,"column":12},"end":{"line":88,"column":19}},"52":{"start":{"line":90,"column":8},"end":{"line":90,"column":32}},"53":{"start":{"line":91,"column":8},"end":{"line":113,"column":9}},"54":{"start":{"line":92,"column":12},"end":{"line":92,"column":31}},"55":{"start":{"line":93,"column":12},"end":{"line":93,"column":53}},"56":{"start":{"line":94,"column":12},"end":{"line":100,"column":13}},"57":{"start":{"line":95,"column":16},"end":{"line":95,"column":84}},"58":{"start":{"line":96,"column":16},"end":{"line":96,"column":38}},"59":{"start":{"line":97,"column":16},"end":{"line":97,"column":23}},"60":{"start":{"line":99,"column":16},"end":{"line":99,"column":56}},"61":{"start":{"line":102,"column":12},"end":{"line":109,"column":15}},"62":{"start":{"line":103,"column":16},"end":{"line":103,"column":57}},"63":{"start":{"line":104,"column":16},"end":{"line":104,"column":66}},"64":{"start":{"line":105,"column":16},"end":{"line":105,"column":38}},"65":{"start":{"line":107,"column":16},"end":{"line":107,"column":124}},"66":{"start":{"line":108,"column":16},"end":{"line":108,"column":99}},"67":{"start":{"line":111,"column":12},"end":{"line":111,"column":120}},"68":{"start":{"line":112,"column":12},"end":{"line":112,"column":95}},"69":{"start":{"line":117,"column":8},"end":{"line":117,"column":53}},"70":{"start":{"line":118,"column":8},"end":{"line":118,"column":26}},"71":{"start":{"line":119,"column":8},"end":{"line":139,"column":9}},"72":{"start":{"line":120,"column":12},"end":{"line":120,"column":46}},"73":{"start":{"line":121,"column":12},"end":{"line":128,"column":13}},"74":{"start":{"line":122,"column":16},"end":{"line":122,"column":63}},"75":{"start":{"line":123,"column":16},"end":{"line":123,"column":37}},"76":{"start":{"line":124,"column":16},"end":{"line":124,"column":33}},"77":{"start":{"line":126,"column":16},"end":{"line":126,"column":81}},"78":{"start":{"line":127,"column":16},"end":{"line":127,"column":38}},"79":{"start":{"line":130,"column":12},"end":{"line":130,"column":80}},"80":{"start":{"line":131,"column":12},"end":{"line":131,"column":53}},"81":{"start":{"line":132,"column":12},"end":{"line":138,"column":13}},"82":{"start":{"line":133,"column":16},"end":{"line":133,"column":65}},"83":{"start":{"line":134,"column":16},"end":{"line":134,"column":33}},"84":{"start":{"line":136,"column":16},"end":{"line":136,"column":83}},"85":{"start":{"line":137,"column":16},"end":{"line":137,"column":38}},"86":{"start":{"line":143,"column":8},"end":{"line":143,"column":35}},"87":{"start":{"line":144,"column":8},"end":{"line":144,"column":52}},"88":{"start":{"line":145,"column":8},"end":{"line":151,"column":9}},"89":{"start":{"line":146,"column":12},"end":{"line":146,"column":69}},"90":{"start":{"line":147,"column":12},"end":{"line":147,"column":29}},"91":{"start":{"line":149,"column":12},"end":{"line":149,"column":87}},"92":{"start":{"line":150,"column":12},"end":{"line":150,"column":34}},"93":{"start":{"line":155,"column":8},"end":{"line":159,"column":9}},"94":{"start":{"line":156,"column":12},"end":{"line":156,"column":82}},"95":{"start":{"line":157,"column":12},"end":{"line":157,"column":97}},"96":{"start":{"line":158,"column":12},"end":{"line":158,"column":19}},"97":{"start":{"line":160,"column":8},"end":{"line":160,"column":28}},"98":{"start":{"line":161,"column":8},"end":{"line":165,"column":9}},"99":{"start":{"line":162,"column":12},"end":{"line":162,"column":77}},"100":{"start":{"line":163,"column":12},"end":{"line":163,"column":87}},"101":{"start":{"line":164,"column":12},"end":{"line":164,"column":19}},"102":{"start":{"line":166,"column":8},"end":{"line":166,"column":53}},"103":{"start":{"line":167,"column":8},"end":{"line":183,"column":9}},"104":{"start":{"line":168,"column":12},"end":{"line":168,"column":48}},"105":{"start":{"line":169,"column":12},"end":{"line":169,"column":21}},"106":{"start":{"line":170,"column":12},"end":{"line":179,"column":13}},"107":{"start":{"line":171,"column":16},"end":{"line":171,"column":81}},"108":{"start":{"line":172,"column":16},"end":{"line":172,"column":38}},"109":{"start":{"line":174,"column":16},"end":{"line":174,"column":35}},"110":{"start":{"line":175,"column":16},"end":{"line":178,"column":19}},"111":{"start":{"line":176,"column":20},"end":{"line":176,"column":88}},"112":{"start":{"line":177,"column":20},"end":{"line":177,"column":37}},"113":{"start":{"line":181,"column":12},"end":{"line":181,"column":138}},"114":{"start":{"line":182,"column":12},"end":{"line":182,"column":95}},"115":{"start":{"line":187,"column":8},"end":{"line":191,"column":9}},"116":{"start":{"line":188,"column":12},"end":{"line":188,"column":84}},"117":{"start":{"line":189,"column":12},"end":{"line":189,"column":97}},"118":{"start":{"line":190,"column":12},"end":{"line":190,"column":19}},"119":{"start":{"line":192,"column":8},"end":{"line":192,"column":28}},"120":{"start":{"line":193,"column":8},"end":{"line":197,"column":9}},"121":{"start":{"line":194,"column":12},"end":{"line":194,"column":79}},"122":{"start":{"line":195,"column":12},"end":{"line":195,"column":87}},"123":{"start":{"line":196,"column":12},"end":{"line":196,"column":19}},"124":{"start":{"line":198,"column":8},"end":{"line":198,"column":32}},"125":{"start":{"line":199,"column":8},"end":{"line":217,"column":9}},"126":{"start":{"line":200,"column":12},"end":{"line":200,"column":53}},"127":{"start":{"line":201,"column":12},"end":{"line":204,"column":13}},"128":{"start":{"line":202,"column":16},"end":{"line":202,"column":88}},"129":{"start":{"line":203,"column":16},"end":{"line":203,"column":45}},"130":{"start":{"line":206,"column":12},"end":{"line":206,"column":37}},"131":{"start":{"line":207,"column":12},"end":{"line":207,"column":30}},"132":{"start":{"line":208,"column":12},"end":{"line":210,"column":13}},"133":{"start":{"line":209,"column":16},"end":{"line":209,"column":62}},"134":{"start":{"line":211,"column":12},"end":{"line":213,"column":15}},"135":{"start":{"line":212,"column":16},"end":{"line":212,"column":54}},"136":{"start":{"line":215,"column":12},"end":{"line":215,"column":145}},"137":{"start":{"line":216,"column":12},"end":{"line":216,"column":95}},"138":{"start":{"line":221,"column":0},"end":{"line":249,"column":1}},"139":{"start":{"line":222,"column":4},"end":{"line":222,"column":13}},"140":{"start":{"line":223,"column":4},"end":{"line":223,"column":16}},"141":{"start":{"line":224,"column":4},"end":{"line":246,"column":5}},"142":{"start":{"line":225,"column":8},"end":{"line":225,"column":37}},"143":{"start":{"line":227,"column":8},"end":{"line":231,"column":9}},"144":{"start":{"line":228,"column":12},"end":{"line":228,"column":51}},"145":{"start":{"line":230,"column":12},"end":{"line":230,"column":52}},"146":{"start":{"line":233,"column":8},"end":{"line":245,"column":11}},"147":{"start":{"line":234,"column":12},"end":{"line":243,"column":13}},"148":{"start":{"line":235,"column":16},"end":{"line":235,"column":81}},"149":{"start":{"line":236,"column":16},"end":{"line":236,"column":81}},"150":{"start":{"line":237,"column":16},"end":{"line":239,"column":17}},"151":{"start":{"line":238,"column":20},"end":{"line":238,"column":50}},"152":{"start":{"line":240,"column":19},"end":{"line":243,"column":13}},"153":{"start":{"line":241,"column":12},"end":{"line":241,"column":54}},"154":{"start":{"line":242,"column":16},"end":{"line":242,"column":57}},"155":{"start":{"line":244,"column":12},"end":{"line":244,"column":24}},"156":{"start":{"line":248,"column":4},"end":{"line":248,"column":19}}},"branchMap":{"1":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":8},"end":{"line":33,"column":8}},{"start":{"line":33,"column":8},"end":{"line":33,"column":8}}]},"2":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":8},"end":{"line":44,"column":8}},{"start":{"line":44,"column":8},"end":{"line":44,"column":8}}]},"3":{"line":51,"type":"if","locations":[{"start":{"line":51,"column":8},"end":{"line":51,"column":8}},{"start":{"line":51,"column":8},"end":{"line":51,"column":8}}]},"4":{"line":53,"type":"if","locations":[{"start":{"line":53,"column":12},"end":{"line":53,"column":12}},{"start":{"line":53,"column":12},"end":{"line":53,"column":12}}]},"5":{"line":66,"type":"if","locations":[{"start":{"line":66,"column":12},"end":{"line":66,"column":12}},{"start":{"line":66,"column":12},"end":{"line":66,"column":12}}]},"6":{"line":71,"type":"if","locations":[{"start":{"line":71,"column":12},"end":{"line":71,"column":12}},{"start":{"line":71,"column":12},"end":{"line":71,"column":12}}]},"7":{"line":74,"type":"if","locations":[{"start":{"line":74,"column":19},"end":{"line":74,"column":19}},{"start":{"line":74,"column":19},"end":{"line":74,"column":19}}]},"8":{"line":78,"type":"binary-expr","locations":[{"start":{"line":78,"column":75},"end":{"line":78,"column":83}},{"start":{"line":78,"column":85},"end":{"line":78,"column":103}}]},"9":{"line":79,"type":"binary-expr","locations":[{"start":{"line":79,"column":44},"end":{"line":79,"column":52}},{"start":{"line":79,"column":54},"end":{"line":79,"column":72}}]},"10":{"line":85,"type":"if","locations":[{"start":{"line":85,"column":8},"end":{"line":85,"column":8}},{"start":{"line":85,"column":8},"end":{"line":85,"column":8}}]},"11":{"line":94,"type":"if","locations":[{"start":{"line":94,"column":12},"end":{"line":94,"column":12}},{"start":{"line":94,"column":12},"end":{"line":94,"column":12}}]},"12":{"line":107,"type":"binary-expr","locations":[{"start":{"line":107,"column":66},"end":{"line":107,"column":74}},{"start":{"line":107,"column":76},"end":{"line":107,"column":94}}]},"13":{"line":108,"type":"binary-expr","locations":[{"start":{"line":108,"column":44},"end":{"line":108,"column":52}},{"start":{"line":108,"column":54},"end":{"line":108,"column":72}}]},"14":{"line":111,"type":"binary-expr","locations":[{"start":{"line":111,"column":62},"end":{"line":111,"column":70}},{"start":{"line":111,"column":72},"end":{"line":111,"column":90}}]},"15":{"line":112,"type":"binary-expr","locations":[{"start":{"line":112,"column":40},"end":{"line":112,"column":48}},{"start":{"line":112,"column":50},"end":{"line":112,"column":68}}]},"16":{"line":119,"type":"if","locations":[{"start":{"line":119,"column":8},"end":{"line":119,"column":8}},{"start":{"line":119,"column":8},"end":{"line":119,"column":8}}]},"17":{"line":121,"type":"if","locations":[{"start":{"line":121,"column":12},"end":{"line":121,"column":12}},{"start":{"line":121,"column":12},"end":{"line":121,"column":12}}]},"18":{"line":132,"type":"if","locations":[{"start":{"line":132,"column":12},"end":{"line":132,"column":12}},{"start":{"line":132,"column":12},"end":{"line":132,"column":12}}]},"19":{"line":145,"type":"if","locations":[{"start":{"line":145,"column":8},"end":{"line":145,"column":8}},{"start":{"line":145,"column":8},"end":{"line":145,"column":8}}]},"20":{"line":155,"type":"if","locations":[{"start":{"line":155,"column":8},"end":{"line":155,"column":8}},{"start":{"line":155,"column":8},"end":{"line":155,"column":8}}]},"21":{"line":161,"type":"if","locations":[{"start":{"line":161,"column":8},"end":{"line":161,"column":8}},{"start":{"line":161,"column":8},"end":{"line":161,"column":8}}]},"22":{"line":170,"type":"if","locations":[{"start":{"line":170,"column":12},"end":{"line":170,"column":12}},{"start":{"line":170,"column":12},"end":{"line":170,"column":12}}]},"23":{"line":181,"type":"binary-expr","locations":[{"start":{"line":181,"column":80},"end":{"line":181,"column":88}},{"start":{"line":181,"column":90},"end":{"line":181,"column":108}}]},"24":{"line":182,"type":"binary-expr","locations":[{"start":{"line":182,"column":40},"end":{"line":182,"column":48}},{"start":{"line":182,"column":50},"end":{"line":182,"column":68}}]},"25":{"line":187,"type":"if","locations":[{"start":{"line":187,"column":8},"end":{"line":187,"column":8}},{"start":{"line":187,"column":8},"end":{"line":187,"column":8}}]},"26":{"line":193,"type":"if","locations":[{"start":{"line":193,"column":8},"end":{"line":193,"column":8}},{"start":{"line":193,"column":8},"end":{"line":193,"column":8}}]},"27":{"line":201,"type":"if","locations":[{"start":{"line":201,"column":12},"end":{"line":201,"column":12}},{"start":{"line":201,"column":12},"end":{"line":201,"column":12}}]},"28":{"line":215,"type":"binary-expr","locations":[{"start":{"line":215,"column":87},"end":{"line":215,"column":95}},{"start":{"line":215,"column":97},"end":{"line":215,"column":115}}]},"29":{"line":216,"type":"binary-expr","locations":[{"start":{"line":216,"column":40},"end":{"line":216,"column":48}},{"start":{"line":216,"column":50},"end":{"line":216,"column":68}}]},"30":{"line":224,"type":"if","locations":[{"start":{"line":224,"column":4},"end":{"line":224,"column":4}},{"start":{"line":224,"column":4},"end":{"line":224,"column":4}}]},"31":{"line":224,"type":"binary-expr","locations":[{"start":{"line":224,"column":8},"end":{"line":224,"column":17}},{"start":{"line":224,"column":21},"end":{"line":224,"column":45}}]},"32":{"line":227,"type":"if","locations":[{"start":{"line":227,"column":8},"end":{"line":227,"column":8}},{"start":{"line":227,"column":8},"end":{"line":227,"column":8}}]},"33":{"line":234,"type":"if","locations":[{"start":{"line":234,"column":12},"end":{"line":234,"column":12}},{"start":{"line":234,"column":12},"end":{"line":234,"column":12}}]},"34":{"line":234,"type":"binary-expr","locations":[{"start":{"line":234,"column":16},"end":{"line":234,"column":40}},{"start":{"line":234,"column":44},"end":{"line":234,"column":53}}]},"35":{"line":235,"type":"cond-expr","locations":[{"start":{"line":235,"column":47},"end":{"line":235,"column":56}},{"start":{"line":235,"column":57},"end":{"line":235,"column":67}}]},"36":{"line":236,"type":"cond-expr","locations":[{"start":{"line":236,"column":57},"end":{"line":236,"column":66}},{"start":{"line":236,"column":67},"end":{"line":236,"column":77}}]},"37":{"line":240,"type":"if","locations":[{"start":{"line":240,"column":19},"end":{"line":240,"column":19}},{"start":{"line":240,"column":19},"end":{"line":240,"column":19}}]},"38":{"line":240,"type":"binary-expr","locations":[{"start":{"line":240,"column":23},"end":{"line":240,"column":30}},{"start":{"line":240,"column":34},"end":{"line":240,"column":42}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var when = require(\"when\");","var comms = require(\"./comms\");","var locales = require(\"./locales\");","var redNodes;","var log;","var i18n;","var settings;","","module.exports = {","    init: function(runtime) {","        redNodes = runtime.nodes;","        log = runtime.log;","        i18n = runtime.i18n;","        settings = runtime.settings;","    },","    getAll: function(req,res) {","        if (req.get(\"accept\") == \"application/json\") {","            log.audit({event: \"nodes.list.get\"},req);","            res.json(redNodes.getNodeList());","        } else {","            var lang = locales.determineLangFromHeaders(req.acceptsLanguages());","            log.audit({event: \"nodes.configs.get\"},req);","            res.send(redNodes.getNodeConfigs(lang));","        }","    },","","    post: function(req,res) {","        if (!settings.available()) {","            log.audit({event: \"nodes.install\",error:\"settings_unavailable\"},req);","            res.status(400).json({error:\"settings_unavailable\", message:\"Settings unavailable\"});","            return;","        }","        var node = req.body;","        var promise;","        if (node.module) {","            var module = redNodes.getModuleInfo(node.module);","            if (module) {","                log.audit({event: \"nodes.install\",module:node.module,error:\"module_already_loaded\"},req);","                res.status(400).json({error:\"module_already_loaded\", message:\"Module already loaded\"});","                return;","            }","            promise = redNodes.installModule(node.module);","        } else {","            log.audit({event: \"nodes.install\",module:node.module,error:\"invalid_request\"},req);","            res.status(400).json({error:\"invalid_request\", message:\"Invalid request\"});","            return;","        }","        promise.then(function(info) {","            comms.publish(\"node/added\",info.nodes,false);","            if (node.module) {","                log.audit({event: \"nodes.install\",module:node.module},req);","                res.json(info);","            }","        }).otherwise(function(err) {","            if (err.code === 404) {","                log.audit({event: \"nodes.install\",module:node.module,error:\"not_found\"},req);","                res.status(404).end();","            } else if (err.code) {","                log.audit({event: \"nodes.install\",module:node.module,error:err.code},req);","                res.status(400).json({error:err.code, message:err.message});","            } else {","                log.audit({event: \"nodes.install\",module:node.module,error:err.code||\"unexpected_error\",message:err.toString()},req);","                res.status(400).json({error:err.code||\"unexpected_error\", message:err.toString()});","            }","        });","    },","","    delete: function(req,res) {","        if (!settings.available()) {","            log.audit({event: \"nodes.remove\",error:\"settings_unavailable\"},req);","            res.status(400).json({error:\"settings_unavailable\", message:\"Settings unavailable\"});","            return;","        }","        var mod = req.params[0];","        try {","            var promise = null;","            var module = redNodes.getModuleInfo(mod);","            if (!module) {","                log.audit({event: \"nodes.remove\",module:mod,error:\"not_found\"},req);","                res.status(404).end();","                return;","            } else {","                promise = redNodes.uninstallModule(mod);","            }","","            promise.then(function(list) {","                comms.publish(\"node/removed\",list,false);","                log.audit({event: \"nodes.remove\",module:mod},req);","                res.status(204).end();","            }).otherwise(function(err) {","                log.audit({event: \"nodes.remove\",module:mod,error:err.code||\"unexpected_error\",message:err.toString()},req);","                res.status(400).json({error:err.code||\"unexpected_error\", message:err.toString()});","            });","        } catch(err) {","            log.audit({event: \"nodes.remove\",module:mod,error:err.code||\"unexpected_error\",message:err.toString()},req);","            res.status(400).json({error:err.code||\"unexpected_error\", message:err.toString()});","        }","    },","","    getSet: function(req,res) {","        var id = req.params[0] + \"/\" + req.params[2];","        var result = null;","        if (req.get(\"accept\") === \"application/json\") {","            result = redNodes.getNodeInfo(id);","            if (result) {","                log.audit({event: \"nodes.info.get\",id:id},req);","                delete result.loaded;","                res.send(result);","            } else {","                log.audit({event: \"nodes.info.get\",id:id,error:\"not_found\"},req);","                res.status(404).end();","            }","        } else {","            var lang = locales.determineLangFromHeaders(req.acceptsLanguages());","            result = redNodes.getNodeConfig(id,lang);","            if (result) {","                log.audit({event: \"nodes.config.get\",id:id},req);","                res.send(result);","            } else {","                log.audit({event: \"nodes.config.get\",id:id,error:\"not_found\"},req);","                res.status(404).end();","            }","        }","    },","","    getModule: function(req,res) {","        var module = req.params[0];","        var result = redNodes.getModuleInfo(module);","        if (result) {","            log.audit({event: \"nodes.module.get\",module:module},req);","            res.json(result);","        } else {","            log.audit({event: \"nodes.module.get\",module:module,error:\"not_found\"},req);","            res.status(404).end();","        }","    },","","    putSet: function(req,res) {","        if (!settings.available()) {","            log.audit({event: \"nodes.info.set\",error:\"settings_unavailable\"},req);","            res.status(400).json({error:\"settings_unavailable\", message:\"Settings unavailable\"});","            return;","        }","        var body = req.body;","        if (!body.hasOwnProperty(\"enabled\")) {","            log.audit({event: \"nodes.info.set\",error:\"invalid_request\"},req);","            res.status(400).json({error:\"invalid_request\", message:\"Invalid request\"});","            return;","        }","        var id = req.params[0] + \"/\" + req.params[2];","        try {","            var node = redNodes.getNodeInfo(id);","            var info;","            if (!node) {","                log.audit({event: \"nodes.info.set\",id:id,error:\"not_found\"},req);","                res.status(404).end();","            } else {","                delete node.loaded;","                putNode(node, body.enabled).then(function(result) {","                    log.audit({event: \"nodes.info.set\",id:id,enabled:body.enabled},req);","                    res.json(result);","                });","            }","        } catch(err) {","            log.audit({event: \"nodes.info.set\",id:id,enabled:body.enabled,error:err.code||\"unexpected_error\",message:err.toString()},req);","            res.status(400).json({error:err.code||\"unexpected_error\", message:err.toString()});","        }","    },","","    putModule: function(req,res) {","        if (!settings.available()) {","            log.audit({event: \"nodes.module.set\",error:\"settings_unavailable\"},req);","            res.status(400).json({error:\"settings_unavailable\", message:\"Settings unavailable\"});","            return;","        }","        var body = req.body;","        if (!body.hasOwnProperty(\"enabled\")) {","            log.audit({event: \"nodes.module.set\",error:\"invalid_request\"},req);","            res.status(400).json({error:\"invalid_request\", message:\"Invalid request\"});","            return;","        }","        var mod = req.params[0];","        try {","            var module = redNodes.getModuleInfo(mod);","            if (!module) {","                log.audit({event: \"nodes.module.set\",module:mod,error:\"not_found\"},req);","                return res.status(404).end();","            }","","            var nodes = module.nodes;","            var promises = [];","            for (var i = 0; i < nodes.length; ++i) {","                promises.push(putNode(nodes[i],body.enabled));","            }","            when.settle(promises).then(function() {","                res.json(redNodes.getModuleInfo(mod));","            });","        } catch(err) {","            log.audit({event: \"nodes.module.set\",module:mod,enabled:body.enabled,error:err.code||\"unexpected_error\",message:err.toString()},req);","            res.status(400).json({error:err.code||\"unexpected_error\", message:err.toString()});","        }","    }","};","","function putNode(node, enabled) {","    var info;","    var promise;","    if (!node.err && node.enabled === enabled) {","        promise = when.resolve(node);","    } else {","        if (enabled) {","            promise = redNodes.enableNode(node.id);","        } else {","            promise = redNodes.disableNode(node.id);","        }","","        return promise.then(function(info) {","            if (info.enabled === enabled && !info.err) {","                comms.publish(\"node/\"+(enabled?\"enabled\":\"disabled\"),info,false);","                log.info(\" \"+log._(\"api.nodes.\"+(enabled?\"enabled\":\"disabled\")));","                for (var i=0;i<info.types.length;i++) {","                    log.info(\" - \"+info.types[i]);","                }","            } else if (enabled && info.err) {","            log.warn(log._(\"api.nodes.error-enable\"));","                log.warn(\" - \"+info.name+\" : \"+info.err);","            }","            return info;","        });","    }","","    return promise;","}",""],"l":{"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"25":1,"27":0,"28":0,"29":0,"30":0,"33":0,"34":0,"35":0,"37":0,"38":0,"39":0,"44":0,"45":0,"46":0,"47":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"58":0,"60":0,"61":0,"62":0,"64":0,"65":0,"66":0,"67":0,"68":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"78":0,"79":0,"85":0,"86":0,"87":0,"88":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"99":0,"102":0,"103":0,"104":0,"105":0,"107":0,"108":0,"111":0,"112":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"126":0,"127":0,"130":0,"131":0,"132":0,"133":0,"134":0,"136":0,"137":0,"143":0,"144":0,"145":0,"146":0,"147":0,"149":0,"150":0,"155":0,"156":0,"157":0,"158":0,"160":0,"161":0,"162":0,"163":0,"164":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"174":0,"175":0,"176":0,"177":0,"181":0,"182":0,"187":0,"188":0,"189":0,"190":0,"192":0,"193":0,"194":0,"195":0,"196":0,"198":0,"199":0,"200":0,"201":0,"202":0,"203":0,"206":0,"207":0,"208":0,"209":0,"211":0,"212":0,"215":0,"216":0,"221":1,"222":0,"223":0,"224":0,"225":0,"227":0,"228":0,"230":0,"233":0,"234":0,"235":0,"236":0,"237":0,"238":0,"240":0,"241":0,"242":0,"244":0,"248":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/comms.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/comms.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":0,"13":1,"14":0,"15":1,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":1,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":1,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":1,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":1,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":1,"113":0,"114":0,"115":0,"116":0,"117":1,"118":0,"119":0,"120":0,"121":0,"122":1,"123":0,"124":0,"125":0,"126":0,"127":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0},"fnMap":{"1":{"name":"handleStatus","line":32,"loc":{"start":{"line":32,"column":0},"end":{"line":32,"column":29}}},"2":{"name":"handleRuntimeEvent","line":35,"loc":{"start":{"line":35,"column":0},"end":{"line":35,"column":35}}},"3":{"name":"init","line":38,"loc":{"start":{"line":38,"column":0},"end":{"line":38,"column":31}}},"4":{"name":"start","line":50,"loc":{"start":{"line":50,"column":0},"end":{"line":50,"column":17}}},"5":{"name":"(anonymous_5)","line":55,"loc":{"start":{"line":55,"column":29},"end":{"line":55,"column":53}}},"6":{"name":"(anonymous_6)","line":69,"loc":{"start":{"line":69,"column":37},"end":{"line":69,"column":50}}},"7":{"name":"(anonymous_7)","line":77,"loc":{"start":{"line":77,"column":30},"end":{"line":77,"column":41}}},"8":{"name":"(anonymous_8)","line":82,"loc":{"start":{"line":82,"column":33},"end":{"line":82,"column":54}}},"9":{"name":"(anonymous_9)","line":95,"loc":{"start":{"line":95,"column":49},"end":{"line":95,"column":77}}},"10":{"name":"(anonymous_10)","line":114,"loc":{"start":{"line":114,"column":54},"end":{"line":114,"column":71}}},"11":{"name":"(anonymous_11)","line":116,"loc":{"start":{"line":116,"column":64},"end":{"line":116,"column":79}}},"12":{"name":"(anonymous_12)","line":146,"loc":{"start":{"line":146,"column":31},"end":{"line":146,"column":45}}},"13":{"name":"(anonymous_13)","line":151,"loc":{"start":{"line":151,"column":33},"end":{"line":151,"column":47}}},"14":{"name":"(anonymous_14)","line":157,"loc":{"start":{"line":157,"column":41},"end":{"line":157,"column":52}}},"15":{"name":"stop","line":167,"loc":{"start":{"line":167,"column":0},"end":{"line":167,"column":16}}},"16":{"name":"publish","line":178,"loc":{"start":{"line":178,"column":0},"end":{"line":178,"column":36}}},"17":{"name":"(anonymous_17)","line":186,"loc":{"start":{"line":186,"column":34},"end":{"line":186,"column":49}}},"18":{"name":"publishTo","line":192,"loc":{"start":{"line":192,"column":0},"end":{"line":192,"column":34}}},"19":{"name":"handleRemoteSubscription","line":203,"loc":{"start":{"line":203,"column":0},"end":{"line":203,"column":44}}},"20":{"name":"removeActiveConnection","line":212,"loc":{"start":{"line":212,"column":0},"end":{"line":212,"column":36}}},"21":{"name":"removePendingConnection","line":220,"loc":{"start":{"line":220,"column":0},"end":{"line":220,"column":37}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":23}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":8}},"3":{"start":{"line":20,"column":0},"end":{"line":20,"column":11}},"4":{"start":{"line":21,"column":0},"end":{"line":21,"column":13}},"5":{"start":{"line":23,"column":0},"end":{"line":23,"column":13}},"6":{"start":{"line":24,"column":0},"end":{"line":24,"column":28}},"7":{"start":{"line":25,"column":0},"end":{"line":25,"column":27}},"8":{"start":{"line":27,"column":0},"end":{"line":27,"column":18}},"9":{"start":{"line":29,"column":0},"end":{"line":29,"column":19}},"10":{"start":{"line":30,"column":0},"end":{"line":30,"column":17}},"11":{"start":{"line":32,"column":0},"end":{"line":34,"column":1}},"12":{"start":{"line":33,"column":4},"end":{"line":33,"column":50}},"13":{"start":{"line":35,"column":0},"end":{"line":37,"column":1}},"14":{"start":{"line":36,"column":4},"end":{"line":36,"column":49}},"15":{"start":{"line":38,"column":0},"end":{"line":48,"column":1}},"16":{"start":{"line":39,"column":4},"end":{"line":39,"column":21}},"17":{"start":{"line":40,"column":4},"end":{"line":40,"column":32}},"18":{"start":{"line":41,"column":4},"end":{"line":41,"column":22}},"19":{"start":{"line":43,"column":4},"end":{"line":43,"column":62}},"20":{"start":{"line":44,"column":4},"end":{"line":44,"column":50}},"21":{"start":{"line":46,"column":4},"end":{"line":46,"column":70}},"22":{"start":{"line":47,"column":4},"end":{"line":47,"column":58}},"23":{"start":{"line":50,"column":0},"end":{"line":165,"column":1}},"24":{"start":{"line":51,"column":4},"end":{"line":51,"column":42}},"25":{"start":{"line":52,"column":4},"end":{"line":52,"column":40}},"26":{"start":{"line":53,"column":4},"end":{"line":53,"column":52}},"27":{"start":{"line":54,"column":4},"end":{"line":164,"column":5}},"28":{"start":{"line":55,"column":8},"end":{"line":163,"column":11}},"29":{"start":{"line":56,"column":12},"end":{"line":56,"column":82}},"30":{"start":{"line":57,"column":12},"end":{"line":57,"column":53}},"31":{"start":{"line":58,"column":12},"end":{"line":58,"column":105}},"32":{"start":{"line":59,"column":12},"end":{"line":67,"column":15}},"33":{"start":{"line":69,"column":12},"end":{"line":149,"column":15}},"34":{"start":{"line":70,"column":16},"end":{"line":70,"column":49}},"35":{"start":{"line":71,"column":16},"end":{"line":71,"column":63}},"36":{"start":{"line":72,"column":16},"end":{"line":76,"column":17}},"37":{"start":{"line":73,"column":20},"end":{"line":73,"column":47}},"38":{"start":{"line":75,"column":20},"end":{"line":75,"column":48}},"39":{"start":{"line":77,"column":16},"end":{"line":81,"column":19}},"40":{"start":{"line":78,"column":20},"end":{"line":78,"column":67}},"41":{"start":{"line":79,"column":20},"end":{"line":79,"column":47}},"42":{"start":{"line":80,"column":20},"end":{"line":80,"column":48}},"43":{"start":{"line":82,"column":16},"end":{"line":145,"column":19}},"44":{"start":{"line":83,"column":20},"end":{"line":83,"column":35}},"45":{"start":{"line":84,"column":20},"end":{"line":89,"column":21}},"46":{"start":{"line":85,"column":24},"end":{"line":85,"column":47}},"47":{"start":{"line":87,"column":24},"end":{"line":87,"column":88}},"48":{"start":{"line":88,"column":24},"end":{"line":88,"column":31}},"49":{"start":{"line":90,"column":20},"end":{"line":144,"column":21}},"50":{"start":{"line":91,"column":24},"end":{"line":93,"column":25}},"51":{"start":{"line":92,"column":28},"end":{"line":92,"column":71}},"52":{"start":{"line":95,"column":24},"end":{"line":112,"column":25}},"53":{"start":{"line":96,"column":28},"end":{"line":111,"column":29}},"54":{"start":{"line":97,"column":32},"end":{"line":107,"column":33}},"55":{"start":{"line":98,"column":36},"end":{"line":98,"column":75}},"56":{"start":{"line":99,"column":36},"end":{"line":99,"column":47}},"57":{"start":{"line":101,"column":36},"end":{"line":101,"column":56}},"58":{"start":{"line":102,"column":36},"end":{"line":102,"column":64}},"59":{"start":{"line":103,"column":36},"end":{"line":103,"column":63}},"60":{"start":{"line":104,"column":36},"end":{"line":106,"column":37}},"61":{"start":{"line":105,"column":40},"end":{"line":105,"column":77}},"62":{"start":{"line":113,"column":24},"end":{"line":143,"column":25}},"63":{"start":{"line":114,"column":28},"end":{"line":130,"column":31}},"64":{"start":{"line":115,"column":32},"end":{"line":129,"column":33}},"65":{"start":{"line":116,"column":36},"end":{"line":125,"column":39}},"66":{"start":{"line":117,"column":40},"end":{"line":124,"column":41}},"67":{"start":{"line":118,"column":44},"end":{"line":118,"column":59}},"68":{"start":{"line":119,"column":44},"end":{"line":119,"column":90}},"69":{"start":{"line":120,"column":44},"end":{"line":120,"column":82}},"70":{"start":{"line":122,"column":44},"end":{"line":122,"column":82}},"71":{"start":{"line":123,"column":44},"end":{"line":123,"column":75}},"72":{"start":{"line":127,"column":36},"end":{"line":127,"column":74}},"73":{"start":{"line":128,"column":36},"end":{"line":128,"column":67}},"74":{"start":{"line":132,"column":28},"end":{"line":138,"column":29}},"75":{"start":{"line":133,"column":32},"end":{"line":133,"column":84}},"76":{"start":{"line":134,"column":32},"end":{"line":134,"column":84}},"77":{"start":{"line":136,"column":32},"end":{"line":136,"column":70}},"78":{"start":{"line":137,"column":32},"end":{"line":137,"column":63}},"79":{"start":{"line":140,"column":28},"end":{"line":142,"column":29}},"80":{"start":{"line":141,"column":32},"end":{"line":141,"column":75}},"81":{"start":{"line":146,"column":16},"end":{"line":148,"column":19}},"82":{"start":{"line":147,"column":20},"end":{"line":147,"column":76}},"83":{"start":{"line":151,"column":12},"end":{"line":153,"column":15}},"84":{"start":{"line":152,"column":16},"end":{"line":152,"column":79}},"85":{"start":{"line":155,"column":12},"end":{"line":155,"column":38}},"86":{"start":{"line":157,"column":12},"end":{"line":162,"column":39}},"87":{"start":{"line":158,"column":16},"end":{"line":158,"column":37}},"88":{"start":{"line":159,"column":16},"end":{"line":161,"column":17}},"89":{"start":{"line":160,"column":20},"end":{"line":160,"column":47}},"90":{"start":{"line":167,"column":0},"end":{"line":176,"column":1}},"91":{"start":{"line":168,"column":4},"end":{"line":171,"column":5}},"92":{"start":{"line":169,"column":8},"end":{"line":169,"column":38}},"93":{"start":{"line":170,"column":8},"end":{"line":170,"column":30}},"94":{"start":{"line":172,"column":4},"end":{"line":175,"column":5}},"95":{"start":{"line":173,"column":8},"end":{"line":173,"column":25}},"96":{"start":{"line":174,"column":8},"end":{"line":174,"column":24}},"97":{"start":{"line":178,"column":0},"end":{"line":190,"column":1}},"98":{"start":{"line":179,"column":4},"end":{"line":189,"column":5}},"99":{"start":{"line":180,"column":8},"end":{"line":184,"column":9}},"100":{"start":{"line":181,"column":12},"end":{"line":181,"column":35}},"101":{"start":{"line":183,"column":12},"end":{"line":183,"column":35}},"102":{"start":{"line":185,"column":8},"end":{"line":185,"column":34}},"103":{"start":{"line":186,"column":8},"end":{"line":188,"column":11}},"104":{"start":{"line":187,"column":12},"end":{"line":187,"column":39}},"105":{"start":{"line":192,"column":0},"end":{"line":201,"column":1}},"106":{"start":{"line":193,"column":4},"end":{"line":193,"column":54}},"107":{"start":{"line":194,"column":4},"end":{"line":200,"column":5}},"108":{"start":{"line":195,"column":8},"end":{"line":195,"column":21}},"109":{"start":{"line":197,"column":8},"end":{"line":197,"column":35}},"110":{"start":{"line":198,"column":8},"end":{"line":198,"column":36}},"111":{"start":{"line":199,"column":8},"end":{"line":199,"column":69}},"112":{"start":{"line":203,"column":0},"end":{"line":210,"column":1}},"113":{"start":{"line":204,"column":4},"end":{"line":204,"column":134}},"114":{"start":{"line":205,"column":4},"end":{"line":209,"column":5}},"115":{"start":{"line":206,"column":8},"end":{"line":208,"column":9}},"116":{"start":{"line":207,"column":12},"end":{"line":207,"column":40}},"117":{"start":{"line":212,"column":0},"end":{"line":219,"column":1}},"118":{"start":{"line":213,"column":4},"end":{"line":218,"column":5}},"119":{"start":{"line":214,"column":8},"end":{"line":217,"column":9}},"120":{"start":{"line":215,"column":12},"end":{"line":215,"column":42}},"121":{"start":{"line":216,"column":12},"end":{"line":216,"column":18}},"122":{"start":{"line":220,"column":0},"end":{"line":227,"column":1}},"123":{"start":{"line":221,"column":4},"end":{"line":226,"column":5}},"124":{"start":{"line":222,"column":8},"end":{"line":225,"column":9}},"125":{"start":{"line":223,"column":12},"end":{"line":223,"column":43}},"126":{"start":{"line":224,"column":12},"end":{"line":224,"column":18}},"127":{"start":{"line":229,"column":0},"end":{"line":234,"column":1}}},"branchMap":{"1":{"line":54,"type":"if","locations":[{"start":{"line":54,"column":4},"end":{"line":54,"column":4}},{"start":{"line":54,"column":4},"end":{"line":54,"column":4}}]},"2":{"line":56,"type":"binary-expr","locations":[{"start":{"line":56,"column":41},"end":{"line":56,"column":72}},{"start":{"line":56,"column":76},"end":{"line":56,"column":81}}]},"3":{"line":57,"type":"binary-expr","locations":[{"start":{"line":57,"column":23},"end":{"line":57,"column":45}},{"start":{"line":57,"column":49},"end":{"line":57,"column":52}}]},"4":{"line":58,"type":"cond-expr","locations":[{"start":{"line":58,"column":45},"end":{"line":58,"column":48}},{"start":{"line":58,"column":49},"end":{"line":58,"column":51}}]},"5":{"line":58,"type":"cond-expr","locations":[{"start":{"line":58,"column":87},"end":{"line":58,"column":89}},{"start":{"line":58,"column":90},"end":{"line":58,"column":93}}]},"6":{"line":72,"type":"if","locations":[{"start":{"line":72,"column":16},"end":{"line":72,"column":16}},{"start":{"line":72,"column":16},"end":{"line":72,"column":16}}]},"7":{"line":90,"type":"if","locations":[{"start":{"line":90,"column":20},"end":{"line":90,"column":20}},{"start":{"line":90,"column":20},"end":{"line":90,"column":20}}]},"8":{"line":91,"type":"if","locations":[{"start":{"line":91,"column":24},"end":{"line":91,"column":24}},{"start":{"line":91,"column":24},"end":{"line":91,"column":24}}]},"9":{"line":97,"type":"if","locations":[{"start":{"line":97,"column":32},"end":{"line":97,"column":32}},{"start":{"line":97,"column":32},"end":{"line":97,"column":32}}]},"10":{"line":97,"type":"binary-expr","locations":[{"start":{"line":97,"column":36},"end":{"line":97,"column":46}},{"start":{"line":97,"column":50},"end":{"line":97,"column":101}}]},"11":{"line":104,"type":"if","locations":[{"start":{"line":104,"column":36},"end":{"line":104,"column":36}},{"start":{"line":104,"column":36},"end":{"line":104,"column":36}}]},"12":{"line":113,"type":"if","locations":[{"start":{"line":113,"column":24},"end":{"line":113,"column":24}},{"start":{"line":113,"column":24},"end":{"line":113,"column":24}}]},"13":{"line":115,"type":"if","locations":[{"start":{"line":115,"column":32},"end":{"line":115,"column":32}},{"start":{"line":115,"column":32},"end":{"line":115,"column":32}}]},"14":{"line":117,"type":"if","locations":[{"start":{"line":117,"column":40},"end":{"line":117,"column":40}},{"start":{"line":117,"column":40},"end":{"line":117,"column":40}}]},"15":{"line":132,"type":"if","locations":[{"start":{"line":132,"column":28},"end":{"line":132,"column":28}},{"start":{"line":132,"column":28},"end":{"line":132,"column":28}}]},"16":{"line":140,"type":"if","locations":[{"start":{"line":140,"column":28},"end":{"line":140,"column":28}},{"start":{"line":140,"column":28},"end":{"line":140,"column":28}}]},"17":{"line":159,"type":"if","locations":[{"start":{"line":159,"column":16},"end":{"line":159,"column":16}},{"start":{"line":159,"column":16},"end":{"line":159,"column":16}}]},"18":{"line":168,"type":"if","locations":[{"start":{"line":168,"column":4},"end":{"line":168,"column":4}},{"start":{"line":168,"column":4},"end":{"line":168,"column":4}}]},"19":{"line":172,"type":"if","locations":[{"start":{"line":172,"column":4},"end":{"line":172,"column":4}},{"start":{"line":172,"column":4},"end":{"line":172,"column":4}}]},"20":{"line":179,"type":"if","locations":[{"start":{"line":179,"column":4},"end":{"line":179,"column":4}},{"start":{"line":179,"column":4},"end":{"line":179,"column":4}}]},"21":{"line":180,"type":"if","locations":[{"start":{"line":180,"column":8},"end":{"line":180,"column":8}},{"start":{"line":180,"column":8},"end":{"line":180,"column":8}}]},"22":{"line":206,"type":"if","locations":[{"start":{"line":206,"column":8},"end":{"line":206,"column":8}},{"start":{"line":206,"column":8},"end":{"line":206,"column":8}}]},"23":{"line":214,"type":"if","locations":[{"start":{"line":214,"column":8},"end":{"line":214,"column":8}},{"start":{"line":214,"column":8},"end":{"line":214,"column":8}}]},"24":{"line":222,"type":"if","locations":[{"start":{"line":222,"column":8},"end":{"line":222,"column":8}},{"start":{"line":222,"column":8},"end":{"line":222,"column":8}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var ws = require(\"ws\");","var log;","","var server;","var settings;","","var wsServer;","var pendingConnections = [];","var activeConnections = [];","","var retained = {};","","var heartbeatTimer;","var lastSentTime;","","function handleStatus(event) {","    publish(\"status/\"+event.id,event.status,true);","}","function handleRuntimeEvent(event) {","    publish(\"notification/\"+event.id,event,true);","}","function init(_server,runtime) {","    server = _server;","    settings = runtime.settings;","    log = runtime.log;","","    runtime.events.removeListener(\"node-status\",handleStatus);","    runtime.events.on(\"node-status\",handleStatus);","","    runtime.events.removeListener(\"runtime-event\",handleRuntimeEvent);","    runtime.events.on(\"runtime-event\",handleRuntimeEvent);","}","","function start() {","    var Tokens = require(\"./auth/tokens\");","    var Users = require(\"./auth/users\");","    var Permissions = require(\"./auth/permissions\");","    if (!settings.disableEditor) {","        Users.default().then(function(anonymousUser) {","            var webSocketKeepAliveTime = settings.webSocketKeepAliveTime || 15000;","            var path = settings.httpAdminRoot || \"/\";","            path = (path.slice(0,1) != \"/\" ? \"/\":\"\") + path + (path.slice(-1) == \"/\" ? \"\":\"/\") + \"comms\";","            wsServer = new ws.Server({","                server:server,","                path:path,","                // Disable the deflate option due to this issue","                //  https://github.com/websockets/ws/pull/632","                // that is fixed in the 1.x release of the ws module","                // that we cannot currently pickup as it drops node 0.10 support","                perMessageDeflate: false","            });","","            wsServer.on('connection',function(ws) {","                log.audit({event: \"comms.open\"});","                var pendingAuth = (settings.adminAuth != null);","                if (!pendingAuth) {","                    activeConnections.push(ws);","                } else {","                    pendingConnections.push(ws);","                }","                ws.on('close',function() {","                    log.audit({event: \"comms.close\",user:ws.user});","                    removeActiveConnection(ws);","                    removePendingConnection(ws);","                });","                ws.on('message', function(data,flags) {","                    var msg = null;","                    try {","                        msg = JSON.parse(data);","                    } catch(err) {","                        log.trace(\"comms received malformed message : \"+err.toString());","                        return;","                    }","                    if (!pendingAuth) {","                        if (msg.subscribe) {","                            handleRemoteSubscription(ws,msg.subscribe);","                        }","                    } else {","                        var completeConnection = function(userScope,sendAck) {","                            try {","                                if (!userScope || !Permissions.hasPermission(userScope,\"status.read\")) {","                                    ws.send(JSON.stringify({auth:\"fail\"}));","                                    ws.close();","                                } else {","                                    pendingAuth = false;","                                    removePendingConnection(ws);","                                    activeConnections.push(ws);","                                    if (sendAck) {","                                        ws.send(JSON.stringify({auth:\"ok\"}));","                                    }","                                }","                            } catch(err) {","                                // Just in case the socket closes before we attempt","                                // to send anything.","                            }","                        }","                        if (msg.auth) {","                            Tokens.get(msg.auth).then(function(client) {","                                if (client) {","                                    Users.get(client.user).then(function(user) {","                                        if (user) {","                                            ws.user = user;","                                            log.audit({event: \"comms.auth\",user:ws.user});","                                            completeConnection(client.scope,true);","                                        } else {","                                            log.audit({event: \"comms.auth.fail\"});","                                            completeConnection(null,false);","                                        }","                                    });","                                } else {","                                    log.audit({event: \"comms.auth.fail\"});","                                    completeConnection(null,false);","                                }","                            });","                        } else {","                            if (anonymousUser) {","                                log.audit({event: \"comms.auth\",user:anonymousUser});","                                completeConnection(anonymousUser.permissions,false);","                            } else {","                                log.audit({event: \"comms.auth.fail\"});","                                completeConnection(null,false);","                            }","                            //TODO: duplicated code - pull non-auth message handling out","                            if (msg.subscribe) {","                                handleRemoteSubscription(ws,msg.subscribe);","                            }","                        }","                    }","                });","                ws.on('error', function(err) {","                    log.warn(log._(\"comms.error\",{message:err.toString()}));","                });","            });","","            wsServer.on('error', function(err) {","                log.warn(log._(\"comms.error-server\",{message:err.toString()}));","            });","","            lastSentTime = Date.now();","","            heartbeatTimer = setInterval(function() {","                var now = Date.now();","                if (now-lastSentTime > webSocketKeepAliveTime) {","                    publish(\"hb\",lastSentTime);","                }","            }, webSocketKeepAliveTime);","        });","    }","}","","function stop() {","    if (heartbeatTimer) {","        clearInterval(heartbeatTimer);","        heartbeatTimer = null;","    }","    if (wsServer) {","        wsServer.close();","        wsServer = null;","    }","}","","function publish(topic,data,retain) {","    if (server) {","        if (retain) {","            retained[topic] = data;","        } else {","            delete retained[topic];","        }","        lastSentTime = Date.now();","        activeConnections.forEach(function(conn) {","            publishTo(conn,topic,data);","        });","    }","}","","function publishTo(ws,topic,data) {","    var msg = JSON.stringify({topic:topic,data:data});","    try {","        ws.send(msg);","    } catch(err) {","        removeActiveConnection(ws);","        removePendingConnection(ws);","        log.warn(log._(\"comms.error-send\",{message:err.toString()}));","    }","}","","function handleRemoteSubscription(ws,topic) {","    var re = new RegExp(\"^\"+topic.replace(/([\\[\\]\\?\\(\\)\\\\\\\\$\\^\\*\\.|])/g,\"\\\\$1\").replace(/\\+/g,\"[^/]+\").replace(/\\/#$/,\"(\\/.*)?\")+\"$\");","    for (var t in retained) {","        if (re.test(t)) {","            publishTo(ws,t,retained[t]);","        }","    }","}","","function removeActiveConnection(ws) {","    for (var i=0;i<activeConnections.length;i++) {","        if (activeConnections[i] === ws) {","            activeConnections.splice(i,1);","            break;","        }","    }","}","function removePendingConnection(ws) {","    for (var i=0;i<pendingConnections.length;i++) {","        if (pendingConnections[i] === ws) {","            pendingConnections.splice(i,1);","            break;","        }","    }","}","","module.exports = {","    init:init,","    start:start,","    stop:stop,","    publish:publish","}",""],"l":{"17":1,"18":1,"20":1,"21":1,"23":1,"24":1,"25":1,"27":1,"29":1,"30":1,"32":1,"33":0,"35":1,"36":0,"38":1,"39":0,"40":0,"41":0,"43":0,"44":0,"46":0,"47":0,"50":1,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"69":0,"70":0,"71":0,"72":0,"73":0,"75":0,"77":0,"78":0,"79":0,"80":0,"82":0,"83":0,"84":0,"85":0,"87":0,"88":0,"90":0,"91":0,"92":0,"95":0,"96":0,"97":0,"98":0,"99":0,"101":0,"102":0,"103":0,"104":0,"105":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"122":0,"123":0,"127":0,"128":0,"132":0,"133":0,"134":0,"136":0,"137":0,"140":0,"141":0,"146":0,"147":0,"151":0,"152":0,"155":0,"157":0,"158":0,"159":0,"160":0,"167":1,"168":0,"169":0,"170":0,"172":0,"173":0,"174":0,"178":1,"179":0,"180":0,"181":0,"183":0,"185":0,"186":0,"187":0,"192":1,"193":0,"194":0,"195":0,"197":0,"198":0,"199":0,"203":1,"204":0,"205":0,"206":0,"207":0,"212":1,"213":0,"214":0,"215":0,"216":0,"220":1,"221":0,"222":0,"223":0,"224":0,"229":1}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/locales.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/locales.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":0,"9":0,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":1,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"(anonymous_1)","line":23,"loc":{"start":{"line":23,"column":25},"end":{"line":23,"column":36}}},"2":{"name":"(anonymous_2)","line":24,"loc":{"start":{"line":24,"column":28},"end":{"line":24,"column":48}}},"3":{"name":"determineLangFromHeaders","line":31,"loc":{"start":{"line":31,"column":0},"end":{"line":31,"column":52}}},"4":{"name":"(anonymous_4)","line":48,"loc":{"start":{"line":48,"column":10},"end":{"line":48,"column":28}}},"5":{"name":"(anonymous_5)","line":52,"loc":{"start":{"line":52,"column":9},"end":{"line":52,"column":27}}},"6":{"name":"(anonymous_6)","line":57,"loc":{"start":{"line":57,"column":28},"end":{"line":57,"column":38}}}},"statementMap":{"1":{"start":{"line":16,"column":0},"end":{"line":16,"column":23}},"2":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"3":{"start":{"line":18,"column":0},"end":{"line":18,"column":9}},"4":{"start":{"line":19,"column":0},"end":{"line":19,"column":24}},"5":{"start":{"line":21,"column":0},"end":{"line":21,"column":63}},"6":{"start":{"line":23,"column":0},"end":{"line":29,"column":1}},"7":{"start":{"line":24,"column":4},"end":{"line":28,"column":7}},"8":{"start":{"line":25,"column":8},"end":{"line":27,"column":9}},"9":{"start":{"line":26,"column":12},"end":{"line":26,"column":35}},"10":{"start":{"line":31,"column":0},"end":{"line":45,"column":1}},"11":{"start":{"line":32,"column":4},"end":{"line":32,"column":32}},"12":{"start":{"line":33,"column":4},"end":{"line":33,"column":48}},"13":{"start":{"line":34,"column":4},"end":{"line":43,"column":5}},"14":{"start":{"line":35,"column":8},"end":{"line":42,"column":9}},"15":{"start":{"line":36,"column":12},"end":{"line":36,"column":40}},"16":{"start":{"line":37,"column":12},"end":{"line":37,"column":18}},"17":{"start":{"line":39,"column":15},"end":{"line":42,"column":9}},"18":{"start":{"line":40,"column":12},"end":{"line":40,"column":54}},"19":{"start":{"line":41,"column":12},"end":{"line":41,"column":18}},"20":{"start":{"line":44,"column":4},"end":{"line":44,"column":16}},"21":{"start":{"line":47,"column":0},"end":{"line":64,"column":1}},"22":{"start":{"line":49,"column":8},"end":{"line":49,"column":28}},"23":{"start":{"line":50,"column":8},"end":{"line":50,"column":29}},"24":{"start":{"line":53,"column":8},"end":{"line":53,"column":38}},"25":{"start":{"line":54,"column":8},"end":{"line":54,"column":52}},"26":{"start":{"line":55,"column":8},"end":{"line":55,"column":74}},"27":{"start":{"line":56,"column":8},"end":{"line":56,"column":36}},"28":{"start":{"line":57,"column":8},"end":{"line":60,"column":11}},"29":{"start":{"line":58,"column":12},"end":{"line":58,"column":55}},"30":{"start":{"line":59,"column":12},"end":{"line":59,"column":34}},"31":{"start":{"line":61,"column":8},"end":{"line":61,"column":32}}},"branchMap":{"1":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":8},"end":{"line":25,"column":8}},{"start":{"line":25,"column":8},"end":{"line":25,"column":8}}]},"2":{"line":33,"type":"binary-expr","locations":[{"start":{"line":33,"column":24},"end":{"line":33,"column":41}},{"start":{"line":33,"column":45},"end":{"line":33,"column":47}}]},"3":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":8},"end":{"line":35,"column":8}},{"start":{"line":35,"column":8},"end":{"line":35,"column":8}}]},"4":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":15},"end":{"line":39,"column":15}},{"start":{"line":39,"column":15},"end":{"line":39,"column":15}}]},"5":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":44},"end":{"line":55,"column":66}},{"start":{"line":55,"column":70},"end":{"line":55,"column":72}}]},"6":{"line":59,"type":"binary-expr","locations":[{"start":{"line":59,"column":21},"end":{"line":59,"column":28}},{"start":{"line":59,"column":30},"end":{"line":59,"column":32}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","var fs = require('fs');","var path = require('path');","var i18n;","var supportedLangs = [];","","var apiLocalDir = path.resolve(path.join(__dirname,\"locales\"));","","var initSupportedLangs = function() {","    fs.readdir(apiLocalDir, function(err,files) {","        if(!err) {","            supportedLangs = files;","        }","    });","}","","function determineLangFromHeaders(acceptedLanguages){","    var lang = i18n.defaultLang;","    acceptedLanguages = acceptedLanguages || [];","    for (var i=0;i<acceptedLanguages.length;i++){","        if (supportedLangs.indexOf(acceptedLanguages[i]) !== -1){","            lang = acceptedLanguages[i];","            break;","        // check the language without the country code","        } else if (supportedLangs.indexOf(acceptedLanguages[i].split(\"-\")[0]) !== -1) {","            lang = acceptedLanguages[i].split(\"-\")[0];","            break;","        }","    }","    return lang;","}","","module.exports = {","    init: function(runtime) {","        i18n = runtime.i18n;","        initSupportedLangs();","    },","    get: function(req,res) {","        var namespace = req.params[0];","        namespace = namespace.replace(/\\.json$/,\"\");","        var lang = determineLangFromHeaders(req.acceptsLanguages() || []);","        var prevLang = i18n.i.lng();","        i18n.i.setLng(lang, function(){","            var catalog = i18n.catalog(namespace,lang);","            res.json(catalog||{});","        });","        i18n.i.setLng(prevLang);","    },","    determineLangFromHeaders: determineLangFromHeaders","}",""],"l":{"16":1,"17":1,"18":1,"19":1,"21":1,"23":1,"24":0,"25":0,"26":0,"31":1,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"39":0,"40":0,"41":0,"44":0,"47":1,"49":0,"50":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"61":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/flows.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/flows.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"(anonymous_1)","line":22,"loc":{"start":{"line":22,"column":10},"end":{"line":22,"column":28}}},"2":{"name":"(anonymous_2)","line":27,"loc":{"start":{"line":27,"column":9},"end":{"line":27,"column":27}}},"3":{"name":"(anonymous_3)","line":40,"loc":{"start":{"line":40,"column":10},"end":{"line":40,"column":28}}},"4":{"name":"(anonymous_4)","line":46,"loc":{"start":{"line":46,"column":38},"end":{"line":46,"column":49}}},"5":{"name":"(anonymous_5)","line":48,"loc":{"start":{"line":48,"column":25},"end":{"line":48,"column":39}}},"6":{"name":"(anonymous_6)","line":68,"loc":{"start":{"line":68,"column":62},"end":{"line":68,"column":79}}},"7":{"name":"(anonymous_7)","line":76,"loc":{"start":{"line":76,"column":25},"end":{"line":76,"column":39}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":8}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":13}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":13}},"4":{"start":{"line":21,"column":0},"end":{"line":83,"column":1}},"5":{"start":{"line":23,"column":8},"end":{"line":23,"column":36}},"6":{"start":{"line":24,"column":8},"end":{"line":24,"column":33}},"7":{"start":{"line":25,"column":8},"end":{"line":25,"column":26}},"8":{"start":{"line":28,"column":8},"end":{"line":28,"column":60}},"9":{"start":{"line":29,"column":8},"end":{"line":38,"column":9}},"10":{"start":{"line":30,"column":12},"end":{"line":30,"column":61}},"11":{"start":{"line":31,"column":12},"end":{"line":31,"column":48}},"12":{"start":{"line":32,"column":15},"end":{"line":38,"column":9}},"13":{"start":{"line":33,"column":12},"end":{"line":33,"column":61}},"14":{"start":{"line":34,"column":12},"end":{"line":34,"column":42}},"15":{"start":{"line":36,"column":12},"end":{"line":36,"column":92}},"16":{"start":{"line":37,"column":12},"end":{"line":37,"column":104}},"17":{"start":{"line":41,"column":8},"end":{"line":41,"column":60}},"18":{"start":{"line":42,"column":8},"end":{"line":42,"column":29}},"19":{"start":{"line":43,"column":8},"end":{"line":43,"column":73}},"20":{"start":{"line":44,"column":8},"end":{"line":44,"column":80}},"21":{"start":{"line":45,"column":8},"end":{"line":81,"column":9}},"22":{"start":{"line":46,"column":12},"end":{"line":52,"column":15}},"23":{"start":{"line":47,"column":16},"end":{"line":47,"column":38}},"24":{"start":{"line":49,"column":16},"end":{"line":49,"column":80}},"25":{"start":{"line":50,"column":16},"end":{"line":50,"column":36}},"26":{"start":{"line":51,"column":16},"end":{"line":51,"column":86}},"27":{"start":{"line":54,"column":12},"end":{"line":54,"column":35}},"28":{"start":{"line":55,"column":12},"end":{"line":67,"column":13}},"29":{"start":{"line":56,"column":16},"end":{"line":56,"column":41}},"30":{"start":{"line":57,"column":16},"end":{"line":63,"column":17}},"31":{"start":{"line":58,"column":20},"end":{"line":58,"column":65}},"32":{"start":{"line":59,"column":20},"end":{"line":62,"column":21}},"33":{"start":{"line":61,"column":24},"end":{"line":61,"column":79}},"34":{"start":{"line":64,"column":19},"end":{"line":67,"column":13}},"35":{"start":{"line":65,"column":16},"end":{"line":65,"column":96}},"36":{"start":{"line":66,"column":16},"end":{"line":66,"column":108}},"37":{"start":{"line":68,"column":12},"end":{"line":80,"column":15}},"38":{"start":{"line":69,"column":16},"end":{"line":75,"column":17}},"39":{"start":{"line":70,"column":20},"end":{"line":70,"column":42}},"40":{"start":{"line":71,"column":23},"end":{"line":75,"column":17}},"41":{"start":{"line":72,"column":20},"end":{"line":72,"column":43}},"42":{"start":{"line":77,"column":16},"end":{"line":77,"column":78}},"43":{"start":{"line":78,"column":16},"end":{"line":78,"column":36}},"44":{"start":{"line":79,"column":16},"end":{"line":79,"column":86}}},"branchMap":{"1":{"line":28,"type":"binary-expr","locations":[{"start":{"line":28,"column":22},"end":{"line":28,"column":53}},{"start":{"line":28,"column":55},"end":{"line":28,"column":59}}]},"2":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":8},"end":{"line":29,"column":8}},{"start":{"line":29,"column":8},"end":{"line":29,"column":8}}]},"3":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":15},"end":{"line":32,"column":15}},{"start":{"line":32,"column":15},"end":{"line":32,"column":15}}]},"4":{"line":41,"type":"binary-expr","locations":[{"start":{"line":41,"column":22},"end":{"line":41,"column":53}},{"start":{"line":41,"column":55},"end":{"line":41,"column":59}}]},"5":{"line":43,"type":"binary-expr","locations":[{"start":{"line":43,"column":29},"end":{"line":43,"column":64}},{"start":{"line":43,"column":66},"end":{"line":43,"column":72}}]},"6":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":45,"column":8}},{"start":{"line":45,"column":8},"end":{"line":45,"column":8}}]},"7":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":12},"end":{"line":55,"column":12}},{"start":{"line":55,"column":12},"end":{"line":55,"column":12}}]},"8":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":16},"end":{"line":57,"column":16}},{"start":{"line":57,"column":16},"end":{"line":57,"column":16}}]},"9":{"line":59,"type":"if","locations":[{"start":{"line":59,"column":20},"end":{"line":59,"column":20}},{"start":{"line":59,"column":20},"end":{"line":59,"column":20}}]},"10":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":19},"end":{"line":64,"column":19}},{"start":{"line":64,"column":19},"end":{"line":64,"column":19}}]},"11":{"line":69,"type":"if","locations":[{"start":{"line":69,"column":16},"end":{"line":69,"column":16}},{"start":{"line":69,"column":16},"end":{"line":69,"column":16}}]},"12":{"line":71,"type":"if","locations":[{"start":{"line":71,"column":23},"end":{"line":71,"column":23}},{"start":{"line":71,"column":23},"end":{"line":71,"column":23}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var log;","var redNodes;","var settings;","","module.exports = {","    init: function(runtime) {","        settings = runtime.settings;","        redNodes = runtime.nodes;","        log = runtime.log;","    },","    get: function(req,res) {","        var version = req.get(\"Node-RED-API-Version\")||\"v1\";","        if (version === \"v1\") {","            log.audit({event: \"flows.get\",version:\"v1\"},req);","            res.json(redNodes.getFlows().flows);","        } else if (version === \"v2\") {","            log.audit({event: \"flows.get\",version:\"v2\"},req);","            res.json(redNodes.getFlows());","        } else {","            log.audit({event: \"flows.get\",version:version,error:\"invalid_api_version\"},req);","            res.status(400).json({code:\"invalid_api_version\", message:\"Invalid API Version requested\"});","        }","    },","    post: function(req,res) {","        var version = req.get(\"Node-RED-API-Version\")||\"v1\";","        var flows = req.body;","        var deploymentType = req.get(\"Node-RED-Deployment-Type\")||\"full\";","        log.audit({event: \"flows.set\",type:deploymentType,version:version},req);","        if (deploymentType === 'reload') {","            redNodes.loadFlows().then(function() {","                res.status(204).end();","            }).otherwise(function(err) {","                log.warn(log._(\"api.flows.error-reload\",{message:err.message}));","                log.warn(err.stack);","                res.status(500).json({error:\"unexpected_error\", message:err.message});","            });","        } else {","            var flowConfig = flows;","            if (version === \"v2\") {","                flowConfig = flows.flows;","                if (flows.hasOwnProperty('rev')) {","                    var currentVersion = redNodes.getFlows().rev;","                    if (currentVersion !== flows.rev) {","                        //TODO: log warning","                        return res.status(409).json({code:\"version_mismatch\"});","                    }","                }","            } else if (version !== 'v1') {","                log.audit({event: \"flows.set\",version:version,error:\"invalid_api_version\"},req);","                res.status(400).json({code:\"invalid_api_version\", message:\"Invalid API Version requested\"});","            }","            redNodes.setFlows(flowConfig,deploymentType).then(function(flowId) {","                if (version === \"v1\") {","                    res.status(204).end();","                } else if (version === \"v2\") {","                    res.json({rev:flowId});","                } else {","                    // TODO: invalid version","                }","            }).otherwise(function(err) {","                log.warn(log._(\"api.flows.error-save\",{message:err.message}));","                log.warn(err.stack);","                res.status(500).json({error:\"unexpected_error\", message:err.message});","            });","        }","    }","}",""],"l":{"17":1,"18":1,"19":1,"21":1,"23":0,"24":0,"25":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"36":0,"37":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"49":0,"50":0,"51":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"61":0,"64":0,"65":0,"66":0,"68":0,"69":0,"70":0,"71":0,"72":0,"77":0,"78":0,"79":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/flow.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/flow.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"fnMap":{"1":{"name":"(anonymous_1)","line":22,"loc":{"start":{"line":22,"column":10},"end":{"line":22,"column":28}}},"2":{"name":"(anonymous_2)","line":27,"loc":{"start":{"line":27,"column":9},"end":{"line":27,"column":27}}},"3":{"name":"(anonymous_3)","line":38,"loc":{"start":{"line":38,"column":10},"end":{"line":38,"column":28}}},"4":{"name":"(anonymous_4)","line":40,"loc":{"start":{"line":40,"column":36},"end":{"line":40,"column":49}}},"5":{"name":"(anonymous_5)","line":43,"loc":{"start":{"line":43,"column":21},"end":{"line":43,"column":35}}},"6":{"name":"(anonymous_6)","line":49,"loc":{"start":{"line":49,"column":9},"end":{"line":49,"column":27}}},"7":{"name":"(anonymous_7)","line":53,"loc":{"start":{"line":53,"column":46},"end":{"line":53,"column":57}}},"8":{"name":"(anonymous_8)","line":56,"loc":{"start":{"line":56,"column":25},"end":{"line":56,"column":39}}},"9":{"name":"(anonymous_9)","line":70,"loc":{"start":{"line":70,"column":12},"end":{"line":70,"column":30}}},"10":{"name":"(anonymous_10)","line":73,"loc":{"start":{"line":73,"column":41},"end":{"line":73,"column":52}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":8}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":13}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":13}},"4":{"start":{"line":21,"column":0},"end":{"line":87,"column":1}},"5":{"start":{"line":23,"column":8},"end":{"line":23,"column":36}},"6":{"start":{"line":24,"column":8},"end":{"line":24,"column":33}},"7":{"start":{"line":25,"column":8},"end":{"line":25,"column":26}},"8":{"start":{"line":28,"column":8},"end":{"line":28,"column":31}},"9":{"start":{"line":29,"column":8},"end":{"line":29,"column":40}},"10":{"start":{"line":30,"column":8},"end":{"line":36,"column":9}},"11":{"start":{"line":31,"column":12},"end":{"line":31,"column":53}},"12":{"start":{"line":32,"column":12},"end":{"line":32,"column":27}},"13":{"start":{"line":34,"column":12},"end":{"line":34,"column":71}},"14":{"start":{"line":35,"column":12},"end":{"line":35,"column":34}},"15":{"start":{"line":39,"column":8},"end":{"line":39,"column":28}},"16":{"start":{"line":40,"column":8},"end":{"line":46,"column":10}},"17":{"start":{"line":41,"column":12},"end":{"line":41,"column":53}},"18":{"start":{"line":42,"column":12},"end":{"line":42,"column":30}},"19":{"start":{"line":44,"column":12},"end":{"line":44,"column":105}},"20":{"start":{"line":45,"column":12},"end":{"line":45,"column":95}},"21":{"start":{"line":50,"column":8},"end":{"line":50,"column":31}},"22":{"start":{"line":51,"column":8},"end":{"line":51,"column":28}},"23":{"start":{"line":52,"column":8},"end":{"line":68,"column":9}},"24":{"start":{"line":53,"column":12},"end":{"line":59,"column":14}},"25":{"start":{"line":54,"column":16},"end":{"line":54,"column":60}},"26":{"start":{"line":55,"column":16},"end":{"line":55,"column":34}},"27":{"start":{"line":57,"column":16},"end":{"line":57,"column":112}},"28":{"start":{"line":58,"column":16},"end":{"line":58,"column":99}},"29":{"start":{"line":61,"column":12},"end":{"line":67,"column":13}},"30":{"start":{"line":62,"column":16},"end":{"line":62,"column":78}},"31":{"start":{"line":63,"column":16},"end":{"line":63,"column":38}},"32":{"start":{"line":65,"column":16},"end":{"line":65,"column":112}},"33":{"start":{"line":66,"column":16},"end":{"line":66,"column":99}},"34":{"start":{"line":71,"column":8},"end":{"line":71,"column":31}},"35":{"start":{"line":72,"column":8},"end":{"line":85,"column":9}},"36":{"start":{"line":73,"column":12},"end":{"line":76,"column":14}},"37":{"start":{"line":74,"column":16},"end":{"line":74,"column":60}},"38":{"start":{"line":75,"column":16},"end":{"line":75,"column":38}},"39":{"start":{"line":78,"column":12},"end":{"line":84,"column":13}},"40":{"start":{"line":79,"column":16},"end":{"line":79,"column":78}},"41":{"start":{"line":80,"column":16},"end":{"line":80,"column":38}},"42":{"start":{"line":82,"column":16},"end":{"line":82,"column":118}},"43":{"start":{"line":83,"column":16},"end":{"line":83,"column":99}}},"branchMap":{"1":{"line":30,"type":"if","locations":[{"start":{"line":30,"column":8},"end":{"line":30,"column":8}},{"start":{"line":30,"column":8},"end":{"line":30,"column":8}}]},"2":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":47},"end":{"line":44,"column":55}},{"start":{"line":44,"column":57},"end":{"line":44,"column":75}}]},"3":{"line":45,"type":"binary-expr","locations":[{"start":{"line":45,"column":40},"end":{"line":45,"column":48}},{"start":{"line":45,"column":50},"end":{"line":45,"column":68}}]},"4":{"line":57,"type":"binary-expr","locations":[{"start":{"line":57,"column":54},"end":{"line":57,"column":62}},{"start":{"line":57,"column":64},"end":{"line":57,"column":82}}]},"5":{"line":58,"type":"binary-expr","locations":[{"start":{"line":58,"column":44},"end":{"line":58,"column":52}},{"start":{"line":58,"column":54},"end":{"line":58,"column":72}}]},"6":{"line":61,"type":"if","locations":[{"start":{"line":61,"column":12},"end":{"line":61,"column":12}},{"start":{"line":61,"column":12},"end":{"line":61,"column":12}}]},"7":{"line":65,"type":"binary-expr","locations":[{"start":{"line":65,"column":54},"end":{"line":65,"column":62}},{"start":{"line":65,"column":64},"end":{"line":65,"column":82}}]},"8":{"line":66,"type":"binary-expr","locations":[{"start":{"line":66,"column":44},"end":{"line":66,"column":52}},{"start":{"line":66,"column":54},"end":{"line":66,"column":72}}]},"9":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":12},"end":{"line":78,"column":12}},{"start":{"line":78,"column":12},"end":{"line":78,"column":12}}]},"10":{"line":82,"type":"binary-expr","locations":[{"start":{"line":82,"column":60},"end":{"line":82,"column":68}},{"start":{"line":82,"column":70},"end":{"line":82,"column":88}}]},"11":{"line":83,"type":"binary-expr","locations":[{"start":{"line":83,"column":44},"end":{"line":83,"column":52}},{"start":{"line":83,"column":54},"end":{"line":83,"column":72}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var log;","var redNodes;","var settings;","","module.exports = {","    init: function(runtime) {","        settings = runtime.settings;","        redNodes = runtime.nodes;","        log = runtime.log;","    },","    get: function(req,res) {","        var id = req.params.id;","        var flow = redNodes.getFlow(id);","        if (flow) {","            log.audit({event: \"flow.get\",id:id},req);","            res.json(flow);","        } else {","            log.audit({event: \"flow.get\",id:id,error:\"not_found\"},req);","            res.status(404).end();","        }","    },","    post: function(req,res) {","        var flow = req.body;","        redNodes.addFlow(flow).then(function(id) {","            log.audit({event: \"flow.add\",id:id},req);","            res.json({id:id});","        }).otherwise(function(err) {","            log.audit({event: \"flow.add\",error:err.code||\"unexpected_error\",message:err.toString()},req);","            res.status(400).json({error:err.code||\"unexpected_error\", message:err.toString()});","        })","","    },","    put: function(req,res) {","        var id = req.params.id;","        var flow = req.body;","        try {","            redNodes.updateFlow(id,flow).then(function() {","                log.audit({event: \"flow.update\",id:id},req);","                res.json({id:id});","            }).otherwise(function(err) {","                log.audit({event: \"flow.update\",error:err.code||\"unexpected_error\",message:err.toString()},req);","                res.status(400).json({error:err.code||\"unexpected_error\", message:err.toString()});","            })","        } catch(err) {","            if (err.code === 404) {","                log.audit({event: \"flow.update\",id:id,error:\"not_found\"},req);","                res.status(404).end();","            } else {","                log.audit({event: \"flow.update\",error:err.code||\"unexpected_error\",message:err.toString()},req);","                res.status(400).json({error:err.code||\"unexpected_error\", message:err.toString()});","            }","        }","    },","    delete: function(req,res) {","        var id = req.params.id;","        try {","            redNodes.removeFlow(id).then(function() {","                log.audit({event: \"flow.remove\",id:id},req);","                res.status(204).end();","            })","        } catch(err) {","            if (err.code === 404) {","                log.audit({event: \"flow.remove\",id:id,error:\"not_found\"},req);","                res.status(404).end();","            } else {","                log.audit({event: \"flow.remove\",id:id,error:err.code||\"unexpected_error\",message:err.toString()},req);","                res.status(400).json({error:err.code||\"unexpected_error\", message:err.toString()});","            }","        }","    }","}",""],"l":{"17":1,"18":1,"19":1,"21":1,"23":0,"24":0,"25":0,"28":0,"29":0,"30":0,"31":0,"32":0,"34":0,"35":0,"39":0,"40":0,"41":0,"42":0,"44":0,"45":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"57":0,"58":0,"61":0,"62":0,"63":0,"65":0,"66":0,"71":0,"72":0,"73":0,"74":0,"75":0,"78":0,"79":0,"80":0,"82":0,"83":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/library.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/library.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":1,"43":1,"44":1,"45":1,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":1,"72":0,"73":0,"74":0,"75":1,"76":0,"77":0,"78":1,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0},"fnMap":{"1":{"name":"createLibrary","line":25,"loc":{"start":{"line":25,"column":0},"end":{"line":25,"column":29}}},"2":{"name":"(anonymous_2)","line":27,"loc":{"start":{"line":27,"column":93},"end":{"line":27,"column":111}}},"3":{"name":"(anonymous_3)","line":29,"loc":{"start":{"line":29,"column":52},"end":{"line":29,"column":69}}},"4":{"name":"(anonymous_4)","line":38,"loc":{"start":{"line":38,"column":25},"end":{"line":38,"column":39}}},"5":{"name":"(anonymous_5)","line":52,"loc":{"start":{"line":52,"column":91},"end":{"line":52,"column":109}}},"6":{"name":"(anonymous_6)","line":58,"loc":{"start":{"line":58,"column":63},"end":{"line":58,"column":74}}},"7":{"name":"(anonymous_7)","line":61,"loc":{"start":{"line":61,"column":25},"end":{"line":61,"column":39}}},"8":{"name":"getFlowsFromPath","line":79,"loc":{"start":{"line":79,"column":0},"end":{"line":79,"column":32}}},"9":{"name":"(anonymous_9)","line":80,"loc":{"start":{"line":80,"column":24},"end":{"line":80,"column":49}}},"10":{"name":"(anonymous_10)","line":82,"loc":{"start":{"line":82,"column":24},"end":{"line":82,"column":44}}},"11":{"name":"(anonymous_11)","line":85,"loc":{"start":{"line":85,"column":26},"end":{"line":85,"column":41}}},"12":{"name":"(anonymous_12)","line":98,"loc":{"start":{"line":98,"column":36},"end":{"line":98,"column":54}}},"13":{"name":"(anonymous_13)","line":99,"loc":{"start":{"line":99,"column":32},"end":{"line":99,"column":44}}},"14":{"name":"addNodeExamplesDir","line":116,"loc":{"start":{"line":116,"column":0},"end":{"line":116,"column":36}}},"15":{"name":"(anonymous_15)","line":118,"loc":{"start":{"line":118,"column":39},"end":{"line":118,"column":56}}},"16":{"name":"removeNodeExamplesDir","line":122,"loc":{"start":{"line":122,"column":0},"end":{"line":122,"column":39}}},"17":{"name":"(anonymous_17)","line":128,"loc":{"start":{"line":128,"column":10},"end":{"line":128,"column":32}}},"18":{"name":"(anonymous_18)","line":143,"loc":{"start":{"line":143,"column":12},"end":{"line":143,"column":30}}},"19":{"name":"(anonymous_19)","line":144,"loc":{"start":{"line":144,"column":35},"end":{"line":144,"column":51}}},"20":{"name":"(anonymous_20)","line":153,"loc":{"start":{"line":153,"column":9},"end":{"line":153,"column":27}}},"21":{"name":"(anonymous_21)","line":178,"loc":{"start":{"line":178,"column":48},"end":{"line":178,"column":63}}},"22":{"name":"(anonymous_22)","line":183,"loc":{"start":{"line":183,"column":25},"end":{"line":183,"column":39}}},"23":{"name":"(anonymous_23)","line":197,"loc":{"start":{"line":197,"column":10},"end":{"line":197,"column":28}}},"24":{"name":"(anonymous_24)","line":204,"loc":{"start":{"line":204,"column":50},"end":{"line":204,"column":61}}},"25":{"name":"(anonymous_25)","line":207,"loc":{"start":{"line":207,"column":21},"end":{"line":207,"column":35}}}},"statementMap":{"1":{"start":{"line":16,"column":0},"end":{"line":16,"column":23}},"2":{"start":{"line":17,"column":0},"end":{"line":17,"column":29}},"3":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":18}},"5":{"start":{"line":21,"column":0},"end":{"line":21,"column":12}},"6":{"start":{"line":22,"column":0},"end":{"line":22,"column":8}},"7":{"start":{"line":23,"column":0},"end":{"line":23,"column":56}},"8":{"start":{"line":25,"column":0},"end":{"line":73,"column":1}},"9":{"start":{"line":26,"column":4},"end":{"line":72,"column":5}},"10":{"start":{"line":27,"column":8},"end":{"line":50,"column":11}},"11":{"start":{"line":28,"column":12},"end":{"line":28,"column":41}},"12":{"start":{"line":29,"column":12},"end":{"line":49,"column":15}},"13":{"start":{"line":30,"column":16},"end":{"line":30,"column":64}},"14":{"start":{"line":31,"column":16},"end":{"line":37,"column":17}},"15":{"start":{"line":32,"column":20},"end":{"line":32,"column":71}},"16":{"start":{"line":33,"column":20},"end":{"line":33,"column":38}},"17":{"start":{"line":34,"column":20},"end":{"line":34,"column":30}},"18":{"start":{"line":36,"column":20},"end":{"line":36,"column":37}},"19":{"start":{"line":39,"column":16},"end":{"line":46,"column":17}},"20":{"start":{"line":40,"column":20},"end":{"line":40,"column":103}},"21":{"start":{"line":41,"column":20},"end":{"line":45,"column":21}},"22":{"start":{"line":42,"column":24},"end":{"line":42,"column":90}},"23":{"start":{"line":43,"column":24},"end":{"line":43,"column":46}},"24":{"start":{"line":44,"column":24},"end":{"line":44,"column":31}},"25":{"start":{"line":47,"column":16},"end":{"line":47,"column":82}},"26":{"start":{"line":48,"column":16},"end":{"line":48,"column":38}},"27":{"start":{"line":52,"column":8},"end":{"line":71,"column":11}},"28":{"start":{"line":53,"column":12},"end":{"line":53,"column":37}},"29":{"start":{"line":54,"column":12},"end":{"line":54,"column":32}},"30":{"start":{"line":55,"column":12},"end":{"line":55,"column":33}},"31":{"start":{"line":56,"column":12},"end":{"line":56,"column":29}},"32":{"start":{"line":58,"column":12},"end":{"line":70,"column":15}},"33":{"start":{"line":59,"column":16},"end":{"line":59,"column":64}},"34":{"start":{"line":60,"column":16},"end":{"line":60,"column":38}},"35":{"start":{"line":62,"column":16},"end":{"line":62,"column":99}},"36":{"start":{"line":63,"column":20},"end":{"line":67,"column":17}},"37":{"start":{"line":64,"column":20},"end":{"line":64,"column":86}},"38":{"start":{"line":65,"column":20},"end":{"line":65,"column":42}},"39":{"start":{"line":66,"column":20},"end":{"line":66,"column":27}},"40":{"start":{"line":68,"column":16},"end":{"line":68,"column":112}},"41":{"start":{"line":69,"column":16},"end":{"line":69,"column":89}},"42":{"start":{"line":75,"column":0},"end":{"line":75,"column":22}},"43":{"start":{"line":76,"column":0},"end":{"line":76,"column":26}},"44":{"start":{"line":77,"column":0},"end":{"line":77,"column":21}},"45":{"start":{"line":79,"column":0},"end":{"line":114,"column":1}},"46":{"start":{"line":80,"column":4},"end":{"line":113,"column":6}},"47":{"start":{"line":81,"column":8},"end":{"line":81,"column":24}},"48":{"start":{"line":82,"column":8},"end":{"line":112,"column":11}},"49":{"start":{"line":83,"column":12},"end":{"line":83,"column":30}},"50":{"start":{"line":84,"column":12},"end":{"line":84,"column":32}},"51":{"start":{"line":85,"column":12},"end":{"line":96,"column":14}},"52":{"start":{"line":86,"column":16},"end":{"line":86,"column":54}},"53":{"start":{"line":87,"column":16},"end":{"line":87,"column":51}},"54":{"start":{"line":88,"column":16},"end":{"line":95,"column":17}},"55":{"start":{"line":89,"column":20},"end":{"line":89,"column":42}},"56":{"start":{"line":90,"column":20},"end":{"line":90,"column":62}},"57":{"start":{"line":91,"column":23},"end":{"line":95,"column":17}},"58":{"start":{"line":92,"column":20},"end":{"line":92,"column":42}},"59":{"start":{"line":93,"column":20},"end":{"line":93,"column":35}},"60":{"start":{"line":94,"column":20},"end":{"line":94,"column":67}},"61":{"start":{"line":97,"column":12},"end":{"line":97,"column":20}},"62":{"start":{"line":98,"column":12},"end":{"line":111,"column":14}},"63":{"start":{"line":99,"column":16},"end":{"line":108,"column":18}},"64":{"start":{"line":100,"column":20},"end":{"line":106,"column":21}},"65":{"start":{"line":101,"column":24},"end":{"line":101,"column":48}},"66":{"start":{"line":102,"column":24},"end":{"line":102,"column":41}},"67":{"start":{"line":104,"column":24},"end":{"line":104,"column":48}},"68":{"start":{"line":105,"column":24},"end":{"line":105,"column":52}},"69":{"start":{"line":107,"column":20},"end":{"line":107,"column":24}},"70":{"start":{"line":110,"column":16},"end":{"line":110,"column":32}},"71":{"start":{"line":116,"column":0},"end":{"line":121,"column":1}},"72":{"start":{"line":117,"column":4},"end":{"line":117,"column":44}},"73":{"start":{"line":118,"column":4},"end":{"line":120,"column":7}},"74":{"start":{"line":119,"column":8},"end":{"line":119,"column":45}},"75":{"start":{"line":122,"column":0},"end":{"line":125,"column":1}},"76":{"start":{"line":123,"column":4},"end":{"line":123,"column":32}},"77":{"start":{"line":124,"column":4},"end":{"line":124,"column":34}},"78":{"start":{"line":127,"column":0},"end":{"line":218,"column":1}},"79":{"start":{"line":129,"column":8},"end":{"line":129,"column":21}},"80":{"start":{"line":130,"column":8},"end":{"line":130,"column":26}},"81":{"start":{"line":131,"column":8},"end":{"line":131,"column":34}},"82":{"start":{"line":135,"column":8},"end":{"line":135,"column":78}},"83":{"start":{"line":136,"column":8},"end":{"line":136,"column":66}},"84":{"start":{"line":137,"column":8},"end":{"line":137,"column":87}},"85":{"start":{"line":138,"column":8},"end":{"line":138,"column":75}},"86":{"start":{"line":144,"column":8},"end":{"line":151,"column":11}},"87":{"start":{"line":145,"column":12},"end":{"line":145,"column":66}},"88":{"start":{"line":146,"column":12},"end":{"line":149,"column":13}},"89":{"start":{"line":147,"column":16},"end":{"line":147,"column":38}},"90":{"start":{"line":148,"column":16},"end":{"line":148,"column":50}},"91":{"start":{"line":150,"column":12},"end":{"line":150,"column":28}},"92":{"start":{"line":154,"column":8},"end":{"line":195,"column":9}},"93":{"start":{"line":155,"column":12},"end":{"line":155,"column":71}},"94":{"start":{"line":156,"column":12},"end":{"line":173,"column":13}},"95":{"start":{"line":157,"column":16},"end":{"line":157,"column":34}},"96":{"start":{"line":158,"column":16},"end":{"line":158,"column":40}},"97":{"start":{"line":159,"column":16},"end":{"line":172,"column":17}},"98":{"start":{"line":160,"column":20},"end":{"line":160,"column":74}},"99":{"start":{"line":161,"column":20},"end":{"line":171,"column":21}},"100":{"start":{"line":162,"column":24},"end":{"line":162,"column":46}},"101":{"start":{"line":163,"column":24},"end":{"line":163,"column":93}},"102":{"start":{"line":164,"column":24},"end":{"line":168,"column":26}},"103":{"start":{"line":170,"column":24},"end":{"line":170,"column":41}},"104":{"start":{"line":175,"column":12},"end":{"line":175,"column":99}},"105":{"start":{"line":176,"column":12},"end":{"line":176,"column":41}},"106":{"start":{"line":178,"column":12},"end":{"line":194,"column":15}},"107":{"start":{"line":180,"column":16},"end":{"line":180,"column":85}},"108":{"start":{"line":181,"column":16},"end":{"line":181,"column":60}},"109":{"start":{"line":182,"column":16},"end":{"line":182,"column":31}},"110":{"start":{"line":184,"column":16},"end":{"line":191,"column":17}},"111":{"start":{"line":185,"column":20},"end":{"line":185,"column":111}},"112":{"start":{"line":186,"column":20},"end":{"line":190,"column":21}},"113":{"start":{"line":187,"column":24},"end":{"line":187,"column":111}},"114":{"start":{"line":188,"column":24},"end":{"line":188,"column":46}},"115":{"start":{"line":189,"column":24},"end":{"line":189,"column":31}},"116":{"start":{"line":192,"column":16},"end":{"line":192,"column":103}},"117":{"start":{"line":193,"column":16},"end":{"line":193,"column":38}},"118":{"start":{"line":203,"column":8},"end":{"line":203,"column":44}},"119":{"start":{"line":204,"column":8},"end":{"line":216,"column":11}},"120":{"start":{"line":205,"column":12},"end":{"line":205,"column":81}},"121":{"start":{"line":206,"column":12},"end":{"line":206,"column":34}},"122":{"start":{"line":208,"column":12},"end":{"line":208,"column":103}},"123":{"start":{"line":209,"column":12},"end":{"line":213,"column":13}},"124":{"start":{"line":210,"column":16},"end":{"line":210,"column":103}},"125":{"start":{"line":211,"column":16},"end":{"line":211,"column":38}},"126":{"start":{"line":212,"column":16},"end":{"line":212,"column":23}},"127":{"start":{"line":214,"column":12},"end":{"line":214,"column":129}},"128":{"start":{"line":215,"column":12},"end":{"line":215,"column":85}}},"branchMap":{"1":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":4},"end":{"line":26,"column":4}},{"start":{"line":26,"column":4},"end":{"line":26,"column":4}}]},"2":{"line":28,"type":"binary-expr","locations":[{"start":{"line":28,"column":23},"end":{"line":28,"column":36}},{"start":{"line":28,"column":38},"end":{"line":28,"column":40}}]},"3":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":16},"end":{"line":31,"column":16}},{"start":{"line":31,"column":16},"end":{"line":31,"column":16}}]},"4":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":16},"end":{"line":39,"column":16}},{"start":{"line":39,"column":16},"end":{"line":39,"column":16}}]},"5":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":20},"end":{"line":41,"column":20}},{"start":{"line":41,"column":20},"end":{"line":41,"column":20}}]},"6":{"line":63,"type":"if","locations":[{"start":{"line":63,"column":20},"end":{"line":63,"column":20}},{"start":{"line":63,"column":20},"end":{"line":63,"column":20}}]},"7":{"line":88,"type":"if","locations":[{"start":{"line":88,"column":16},"end":{"line":88,"column":16}},{"start":{"line":88,"column":16},"end":{"line":88,"column":16}}]},"8":{"line":91,"type":"if","locations":[{"start":{"line":91,"column":23},"end":{"line":91,"column":23}},{"start":{"line":91,"column":23},"end":{"line":91,"column":23}}]},"9":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":20},"end":{"line":100,"column":20}},{"start":{"line":100,"column":20},"end":{"line":100,"column":20}}]},"10":{"line":101,"type":"binary-expr","locations":[{"start":{"line":101,"column":35},"end":{"line":101,"column":43}},{"start":{"line":101,"column":45},"end":{"line":101,"column":47}}]},"11":{"line":104,"type":"binary-expr","locations":[{"start":{"line":104,"column":35},"end":{"line":104,"column":43}},{"start":{"line":104,"column":45},"end":{"line":104,"column":47}}]},"12":{"line":146,"type":"if","locations":[{"start":{"line":146,"column":12},"end":{"line":146,"column":12}},{"start":{"line":146,"column":12},"end":{"line":146,"column":12}}]},"13":{"line":147,"type":"binary-expr","locations":[{"start":{"line":147,"column":26},"end":{"line":147,"column":33}},{"start":{"line":147,"column":35},"end":{"line":147,"column":37}}]},"14":{"line":154,"type":"if","locations":[{"start":{"line":154,"column":8},"end":{"line":154,"column":8}},{"start":{"line":154,"column":8},"end":{"line":154,"column":8}}]},"15":{"line":156,"type":"if","locations":[{"start":{"line":156,"column":12},"end":{"line":156,"column":12}},{"start":{"line":156,"column":12},"end":{"line":156,"column":12}}]},"16":{"line":159,"type":"if","locations":[{"start":{"line":159,"column":16},"end":{"line":159,"column":16}},{"start":{"line":159,"column":16},"end":{"line":159,"column":16}}]},"17":{"line":184,"type":"if","locations":[{"start":{"line":184,"column":16},"end":{"line":184,"column":16}},{"start":{"line":184,"column":16},"end":{"line":184,"column":16}}]},"18":{"line":186,"type":"if","locations":[{"start":{"line":186,"column":20},"end":{"line":186,"column":20}},{"start":{"line":186,"column":20},"end":{"line":186,"column":20}}]},"19":{"line":209,"type":"if","locations":[{"start":{"line":209,"column":12},"end":{"line":209,"column":12}},{"start":{"line":209,"column":12},"end":{"line":209,"column":12}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","var fs = require('fs');","var fspath = require('path');","var when = require('when');","","var redApp = null;","var storage;","var log;","var needsPermission = require(\"./auth\").needsPermission;","","function createLibrary(type) {","    if (redApp) {","        redApp.get(new RegExp(\"/library/\"+type+\"($|\\/(.*))\"),needsPermission(\"library.read\"),function(req,res) {","            var path = req.params[1]||\"\";","            storage.getLibraryEntry(type,path).then(function(result) {","                log.audit({event: \"library.get\",type:type},req);","                if (typeof result === \"string\") {","                    res.writeHead(200, {'Content-Type': 'text/plain'});","                    res.write(result);","                    res.end();","                } else {","                    res.json(result);","                }","            }).otherwise(function(err) {","                if (err) {","                    log.warn(log._(\"api.library.error-load-entry\",{path:path,message:err.toString()}));","                    if (err.code === 'forbidden') {","                        log.audit({event: \"library.get\",type:type,error:\"forbidden\"},req);","                        res.status(403).end();","                        return;","                    }","                }","                log.audit({event: \"library.get\",type:type,error:\"not_found\"},req);","                res.status(404).end();","            });","        });","","        redApp.post(new RegExp(\"/library/\"+type+\"\\/(.*)\"),needsPermission(\"library.write\"),function(req,res) {","            var path = req.params[0];","            var meta = req.body;","            var text = meta.text;","            delete meta.text;","","            storage.saveLibraryEntry(type,path,meta,text).then(function() {","                log.audit({event: \"library.set\",type:type},req);","                res.status(204).end();","            }).otherwise(function(err) {","                log.warn(log._(\"api.library.error-save-entry\",{path:path,message:err.toString()}));","                    if (err.code === 'forbidden') {","                    log.audit({event: \"library.set\",type:type,error:\"forbidden\"},req);","                    res.status(403).end();","                    return;","                }","                log.audit({event: \"library.set\",type:type,error:\"unexpected_error\",message:err.toString()},req);","                res.status(500).json({error:\"unexpected_error\", message:err.toString()});","            });","        });","    }","}","","var exampleRoots = {};","var exampleFlows = {d:{}};","var exampleCount = 0;","","function getFlowsFromPath(path) {","    return when.promise(function(resolve,reject) {","        var result = {};","        fs.readdir(path,function(err,files) {","            var promises = [];","            var validFiles = [];","            files.forEach(function(file) {","                var fullPath = fspath.join(path,file);","                var stats = fs.lstatSync(fullPath);","                if (stats.isDirectory()) {","                    validFiles.push(file);","                    promises.push(getFlowsFromPath(fullPath));","                } else if (/\\.json$/.test(file)){","                    validFiles.push(file);","                    exampleCount++;","                    promises.push(when.resolve(file.split(\".\")[0]))","                }","            })","            var i=0;","            when.all(promises).then(function(results) {","                results.forEach(function(r) {","                    if (typeof r === 'string') {","                        result.f = result.f||[];","                        result.f.push(r);","                    } else {","                        result.d = result.d||{};","                        result.d[validFiles[i]] = r;","                    }","                    i++;","                })","","                resolve(result);","            })","        });","    })","}","","function addNodeExamplesDir(module) {","    exampleRoots[module.name] = module.path;","    getFlowsFromPath(module.path).then(function(result) {","        exampleFlows.d[module.name] = result;","    });","}","function removeNodeExamplesDir(module) {","    delete exampleRoots[module];","    delete exampleFlows.d[module];","}","","module.exports = {","    init: function(app,runtime) {","        redApp = app;","        log = runtime.log;","        storage = runtime.storage;","        // TODO: this allows init to be called multiple times without","        //       registering multiple instances of the listener.","        //       It isn't.... ideal.","        runtime.events.removeListener(\"node-examples-dir\",addNodeExamplesDir);","        runtime.events.on(\"node-examples-dir\",addNodeExamplesDir);","        runtime.events.removeListener(\"node-module-uninstalled\",removeNodeExamplesDir);","        runtime.events.on(\"node-module-uninstalled\",removeNodeExamplesDir);","","    },","    register: createLibrary,","","    getAll: function(req,res) {","        storage.getAllFlows().then(function(flows) {","            log.audit({event: \"library.get.all\",type:\"flow\"},req);","            if (exampleCount > 0) {","                flows.d = flows.d||{};","                flows.d._examples_ = exampleFlows;","            }","            res.json(flows);","        });","    },","    get: function(req,res) {","        if (req.params[0].indexOf(\"_examples_/\") === 0) {","            var m = /^_examples_\\/([^\\/]+)\\/(.*)$/.exec(req.params[0]);","            if (m) {","                var module = m[1];","                var path = m[2]+\".json\";","                if (exampleRoots[module]) {","                    var fullPath = fspath.join(exampleRoots[module],path);","                    try {","                        fs.statSync(fullPath);","                        log.audit({event: \"library.get\",type:\"flow\",path:req.params[0]},req);","                        return res.sendFile(fullPath,{","                            headers:{","                                'Content-Type': 'application/json'","                            }","                        })","                    } catch(err) {","                        console.log(err);","                    }","                }","            }","            // IF we get here, we didn't find the file","            log.audit({event: \"library.get\",type:\"flow\",path:req.params[0],error:\"not_found\"},req);","            return res.status(404).end();","        } else {","            storage.getFlow(req.params[0]).then(function(data) {","                // data is already a JSON string","                log.audit({event: \"library.get\",type:\"flow\",path:req.params[0]},req);","                res.set('Content-Type', 'application/json');","                res.send(data);","            }).otherwise(function(err) {","                if (err) {","                    log.warn(log._(\"api.library.error-load-flow\",{path:req.params[0],message:err.toString()}));","                    if (err.code === 'forbidden') {","                        log.audit({event: \"library.get\",type:\"flow\",path:req.params[0],error:\"forbidden\"},req);","                        res.status(403).end();","                        return;","                    }","                }","                log.audit({event: \"library.get\",type:\"flow\",path:req.params[0],error:\"not_found\"},req);","                res.status(404).end();","            });","        }","    },","    post: function(req,res) {","        // if (req.params[0].indexOf(\"_examples_/\") === 0) {","        //     log.warn(log._(\"api.library.error-save-flow\",{path:req.params[0],message:\"forbidden\"}));","        //     log.audit({event: \"library.set\",type:\"flow\",path:req.params[0],error:\"forbidden\"},req);","        //     return res.status(403).send({error:\"unexpected_error\", message:\"forbidden\"});","        // }","        var flow = JSON.stringify(req.body);","        storage.saveFlow(req.params[0],flow).then(function() {","            log.audit({event: \"library.set\",type:\"flow\",path:req.params[0]},req);","            res.status(204).end();","        }).otherwise(function(err) {","            log.warn(log._(\"api.library.error-save-flow\",{path:req.params[0],message:err.toString()}));","            if (err.code === 'forbidden') {","                log.audit({event: \"library.set\",type:\"flow\",path:req.params[0],error:\"forbidden\"},req);","                res.status(403).end();","                return;","            }","            log.audit({event: \"library.set\",type:\"flow\",path:req.params[0],error:\"unexpected_error\",message:err.toString()},req);","            res.status(500).send({error:\"unexpected_error\", message:err.toString()});","        });","    }","}",""],"l":{"16":1,"17":1,"18":1,"20":1,"21":1,"22":1,"23":1,"25":1,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"36":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"47":0,"48":0,"52":0,"53":0,"54":0,"55":0,"56":0,"58":0,"59":0,"60":0,"62":0,"63":0,"64":0,"65":0,"66":0,"68":0,"69":0,"75":1,"76":1,"77":1,"79":1,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"104":0,"105":0,"107":0,"110":0,"116":1,"117":0,"118":0,"119":0,"122":1,"123":0,"124":0,"127":1,"129":0,"130":0,"131":0,"135":0,"136":0,"137":0,"138":0,"144":0,"145":0,"146":0,"147":0,"148":0,"150":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":0,"164":0,"170":0,"175":0,"176":0,"178":0,"180":0,"181":0,"182":0,"184":0,"185":0,"186":0,"187":0,"188":0,"189":0,"192":0,"193":0,"203":0,"204":0,"205":0,"206":0,"208":0,"209":0,"210":0,"211":0,"212":0,"214":0,"215":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/auth/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/auth/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":1,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":1,"34":0,"35":0,"36":0,"37":1,"38":0,"39":1,"40":0,"41":1,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":1,"49":0,"50":0,"51":0,"52":0,"53":1,"54":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},"fnMap":{"1":{"name":"init","line":39,"loc":{"start":{"line":39,"column":0},"end":{"line":39,"column":23}}},"2":{"name":"needsPermission","line":49,"loc":{"start":{"line":49,"column":0},"end":{"line":49,"column":37}}},"3":{"name":"(anonymous_3)","line":50,"loc":{"start":{"line":50,"column":11},"end":{"line":50,"column":34}}},"4":{"name":"(anonymous_4)","line":52,"loc":{"start":{"line":52,"column":87},"end":{"line":52,"column":98}}},"5":{"name":"ensureClientSecret","line":68,"loc":{"start":{"line":68,"column":0},"end":{"line":68,"column":42}}},"6":{"name":"authenticateClient","line":74,"loc":{"start":{"line":74,"column":0},"end":{"line":74,"column":42}}},"7":{"name":"getToken","line":77,"loc":{"start":{"line":77,"column":0},"end":{"line":77,"column":32}}},"8":{"name":"login","line":81,"loc":{"start":{"line":81,"column":0},"end":{"line":81,"column":24}}},"9":{"name":"revoke","line":95,"loc":{"start":{"line":95,"column":0},"end":{"line":95,"column":25}}},"10":{"name":"(anonymous_10)","line":98,"loc":{"start":{"line":98,"column":30},"end":{"line":98,"column":41}}},"11":{"name":"(anonymous_11)","line":110,"loc":{"start":{"line":110,"column":18},"end":{"line":110,"column":45}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":35}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":41}},"3":{"start":{"line":20,"column":0},"end":{"line":20,"column":41}},"4":{"start":{"line":21,"column":0},"end":{"line":21,"column":33}},"5":{"start":{"line":22,"column":0},"end":{"line":22,"column":31}},"6":{"start":{"line":23,"column":0},"end":{"line":23,"column":43}},"7":{"start":{"line":25,"column":0},"end":{"line":25,"column":32}},"8":{"start":{"line":27,"column":0},"end":{"line":27,"column":20}},"9":{"start":{"line":28,"column":0},"end":{"line":28,"column":14}},"10":{"start":{"line":31,"column":0},"end":{"line":31,"column":55}},"11":{"start":{"line":32,"column":0},"end":{"line":32,"column":71}},"12":{"start":{"line":33,"column":0},"end":{"line":33,"column":43}},"13":{"start":{"line":35,"column":0},"end":{"line":35,"column":40}},"14":{"start":{"line":37,"column":0},"end":{"line":37,"column":81}},"15":{"start":{"line":39,"column":0},"end":{"line":47,"column":1}},"16":{"start":{"line":40,"column":4},"end":{"line":40,"column":32}},"17":{"start":{"line":41,"column":4},"end":{"line":41,"column":22}},"18":{"start":{"line":42,"column":4},"end":{"line":46,"column":5}},"19":{"start":{"line":43,"column":8},"end":{"line":43,"column":39}},"20":{"start":{"line":44,"column":8},"end":{"line":44,"column":56}},"21":{"start":{"line":45,"column":8},"end":{"line":45,"column":33}},"22":{"start":{"line":49,"column":0},"end":{"line":66,"column":1}},"23":{"start":{"line":50,"column":4},"end":{"line":65,"column":5}},"24":{"start":{"line":51,"column":8},"end":{"line":64,"column":9}},"25":{"start":{"line":52,"column":12},"end":{"line":61,"column":15}},"26":{"start":{"line":53,"column":16},"end":{"line":55,"column":17}},"27":{"start":{"line":54,"column":20},"end":{"line":54,"column":34}},"28":{"start":{"line":56,"column":16},"end":{"line":58,"column":17}},"29":{"start":{"line":57,"column":20},"end":{"line":57,"column":34}},"30":{"start":{"line":59,"column":16},"end":{"line":59,"column":83}},"31":{"start":{"line":60,"column":16},"end":{"line":60,"column":45}},"32":{"start":{"line":63,"column":12},"end":{"line":63,"column":19}},"33":{"start":{"line":68,"column":0},"end":{"line":73,"column":1}},"34":{"start":{"line":69,"column":4},"end":{"line":71,"column":5}},"35":{"start":{"line":70,"column":8},"end":{"line":70,"column":49}},"36":{"start":{"line":72,"column":4},"end":{"line":72,"column":11}},"37":{"start":{"line":74,"column":0},"end":{"line":76,"column":1}},"38":{"start":{"line":75,"column":4},"end":{"line":75,"column":93}},"39":{"start":{"line":77,"column":0},"end":{"line":79,"column":1}},"40":{"start":{"line":78,"column":4},"end":{"line":78,"column":40}},"41":{"start":{"line":81,"column":0},"end":{"line":93,"column":1}},"42":{"start":{"line":82,"column":4},"end":{"line":82,"column":22}},"43":{"start":{"line":83,"column":4},"end":{"line":91,"column":5}},"44":{"start":{"line":84,"column":8},"end":{"line":87,"column":9}},"45":{"start":{"line":88,"column":8},"end":{"line":90,"column":9}},"46":{"start":{"line":89,"column":12},"end":{"line":89,"column":57}},"47":{"start":{"line":92,"column":4},"end":{"line":92,"column":23}},"48":{"start":{"line":95,"column":0},"end":{"line":102,"column":1}},"49":{"start":{"line":96,"column":4},"end":{"line":96,"column":31}},"50":{"start":{"line":98,"column":4},"end":{"line":101,"column":7}},"51":{"start":{"line":99,"column":8},"end":{"line":99,"column":52}},"52":{"start":{"line":100,"column":8},"end":{"line":100,"column":30}},"53":{"start":{"line":104,"column":0},"end":{"line":118,"column":1}},"54":{"start":{"line":114,"column":8},"end":{"line":114,"column":55}}},"branchMap":{"1":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":4},"end":{"line":42,"column":4}},{"start":{"line":42,"column":4},"end":{"line":42,"column":4}}]},"2":{"line":51,"type":"if","locations":[{"start":{"line":51,"column":8},"end":{"line":51,"column":8}},{"start":{"line":51,"column":8},"end":{"line":51,"column":8}}]},"3":{"line":51,"type":"binary-expr","locations":[{"start":{"line":51,"column":12},"end":{"line":51,"column":20}},{"start":{"line":51,"column":24},"end":{"line":51,"column":42}}]},"4":{"line":53,"type":"if","locations":[{"start":{"line":53,"column":16},"end":{"line":53,"column":16}},{"start":{"line":53,"column":16},"end":{"line":53,"column":16}}]},"5":{"line":56,"type":"if","locations":[{"start":{"line":56,"column":16},"end":{"line":56,"column":16}},{"start":{"line":56,"column":16},"end":{"line":56,"column":16}}]},"6":{"line":69,"type":"if","locations":[{"start":{"line":69,"column":4},"end":{"line":69,"column":4}},{"start":{"line":69,"column":4},"end":{"line":69,"column":4}}]},"7":{"line":83,"type":"if","locations":[{"start":{"line":83,"column":4},"end":{"line":83,"column":4}},{"start":{"line":83,"column":4},"end":{"line":83,"column":4}}]},"8":{"line":88,"type":"if","locations":[{"start":{"line":88,"column":8},"end":{"line":88,"column":8}},{"start":{"line":88,"column":8},"end":{"line":88,"column":8}}]},"9":{"line":88,"type":"binary-expr","locations":[{"start":{"line":88,"column":12},"end":{"line":88,"column":33}},{"start":{"line":88,"column":37},"end":{"line":88,"column":64}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var passport = require(\"passport\");","var oauth2orize = require(\"oauth2orize\");","","var strategies = require(\"./strategies\");","var Tokens = require(\"./tokens\");","var Users = require(\"./users\");","var permissions = require(\"./permissions\");","","var theme = require(\"../theme\");","","var settings = null;","var log = null","","","passport.use(strategies.bearerStrategy.BearerStrategy);","passport.use(strategies.clientPasswordStrategy.ClientPasswordStrategy);","passport.use(strategies.anonymousStrategy);","","var server = oauth2orize.createServer();","","server.exchange(oauth2orize.exchange.password(strategies.passwordTokenExchange));","","function init(runtime) {","    settings = runtime.settings;","    log = runtime.log;","    if (settings.adminAuth) {","        Users.init(settings.adminAuth);","        Tokens.init(settings.adminAuth,runtime.storage);","        strategies.init(runtime);","    }","}","","function needsPermission(permission) {","    return function(req,res,next) {","        if (settings && settings.adminAuth) {","            return passport.authenticate(['bearer','anon'],{ session: false })(req,res,function() {","                if (!req.user) {","                    return next();","                }","                if (permissions.hasPermission(req.authInfo.scope,permission)) {","                    return next();","                }","                log.audit({event: \"permission.fail\", permissions: permission},req);","                return res.status(401).end();","            });","        } else {","            next();","        }","    }","}","","function ensureClientSecret(req,res,next) {","    if (!req.body.client_secret) {","        req.body.client_secret = 'not_available';","    }","    next();","}","function authenticateClient(req,res,next) {","    return passport.authenticate(['oauth2-client-password'], {session: false})(req,res,next);","}","function getToken(req,res,next) {","    return server.token()(req,res,next);","}","","function login(req,res) {","    var response = {};","    if (settings.adminAuth) {","        response = {","            \"type\":\"credentials\",","            \"prompts\":[{id:\"username\",type:\"text\",label:\"Username\"},{id:\"password\",type:\"password\",label:\"Password\"}]","        }","        if (theme.context().login && theme.context().login.image) {","            response.image = theme.context().login.image;","        }","    }","    res.json(response);","}","","function revoke(req,res) {","    var token = req.body.token;","    // TODO: audit log","    Tokens.revoke(token).then(function() {","        log.audit({event: \"auth.login.revoke\"},req);","        res.status(200).end();","    });","}","","module.exports = {","    init: init,","    needsPermission: needsPermission,","    ensureClientSecret: ensureClientSecret,","    authenticateClient: authenticateClient,","    getToken: getToken,","    errorHandler: function(err,req,res,next) {","        //TODO: audit log statment","        //console.log(err.stack);","        //log.log({level:\"audit\",type:\"auth\",msg:err.toString()});","        return server.errorHandler()(err,req,res,next);","    },","    login: login,","    revoke: revoke","}",""],"l":{"17":1,"18":1,"20":1,"21":1,"22":1,"23":1,"25":1,"27":1,"28":1,"31":1,"32":1,"33":1,"35":1,"37":1,"39":1,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"49":1,"50":0,"51":0,"52":0,"53":0,"54":0,"56":0,"57":0,"59":0,"60":0,"63":0,"68":1,"69":0,"70":0,"72":0,"74":1,"75":0,"77":1,"78":0,"81":1,"82":0,"83":0,"84":0,"88":0,"89":0,"92":0,"95":1,"96":0,"98":0,"99":0,"100":0,"104":1,"114":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/auth/strategies.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/auth/strategies.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":1,"22":1,"23":0,"24":0,"25":0,"26":0,"27":0,"28":1,"29":1,"30":1,"31":1,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":1,"59":1,"60":1,"61":1,"62":1,"63":0,"64":0,"65":0,"66":0,"67":0,"68":1,"69":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":1,"13":0,"14":0,"15":0},"fnMap":{"1":{"name":"(anonymous_1)","line":31,"loc":{"start":{"line":31,"column":21},"end":{"line":31,"column":50}}},"2":{"name":"(anonymous_2)","line":33,"loc":{"start":{"line":33,"column":33},"end":{"line":33,"column":49}}},"3":{"name":"(anonymous_3)","line":35,"loc":{"start":{"line":35,"column":39},"end":{"line":35,"column":54}}},"4":{"name":"(anonymous_4)","line":51,"loc":{"start":{"line":51,"column":29},"end":{"line":51,"column":68}}},"5":{"name":"(anonymous_5)","line":52,"loc":{"start":{"line":52,"column":31},"end":{"line":52,"column":48}}},"6":{"name":"(anonymous_6)","line":67,"loc":{"start":{"line":67,"column":28},"end":{"line":67,"column":78}}},"7":{"name":"(anonymous_7)","line":69,"loc":{"start":{"line":69,"column":41},"end":{"line":69,"column":60}}},"8":{"name":"(anonymous_8)","line":74,"loc":{"start":{"line":74,"column":26},"end":{"line":74,"column":45}}},"9":{"name":"(anonymous_9)","line":86,"loc":{"start":{"line":86,"column":47},"end":{"line":86,"column":62}}},"10":{"name":"(anonymous_10)","line":92,"loc":{"start":{"line":92,"column":53},"end":{"line":92,"column":72}}},"11":{"name":"(anonymous_11)","line":95,"loc":{"start":{"line":95,"column":61},"end":{"line":95,"column":78}}},"12":{"name":"AnonymousStrategy","line":110,"loc":{"start":{"line":110,"column":0},"end":{"line":110,"column":29}}},"13":{"name":"(anonymous_13)","line":115,"loc":{"start":{"line":115,"column":43},"end":{"line":115,"column":57}}},"14":{"name":"(anonymous_14)","line":117,"loc":{"start":{"line":117,"column":25},"end":{"line":117,"column":40}}},"15":{"name":"(anonymous_15)","line":127,"loc":{"start":{"line":127,"column":10},"end":{"line":127,"column":28}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":62}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":81}},"3":{"start":{"line":20,"column":0},"end":{"line":20,"column":35}},"4":{"start":{"line":21,"column":0},"end":{"line":21,"column":31}},"5":{"start":{"line":22,"column":0},"end":{"line":22,"column":27}},"6":{"start":{"line":24,"column":0},"end":{"line":24,"column":33}},"7":{"start":{"line":25,"column":0},"end":{"line":25,"column":31}},"8":{"start":{"line":26,"column":0},"end":{"line":26,"column":35}},"9":{"start":{"line":27,"column":0},"end":{"line":27,"column":43}},"10":{"start":{"line":29,"column":0},"end":{"line":29,"column":8}},"11":{"start":{"line":31,"column":0},"end":{"line":48,"column":1}},"12":{"start":{"line":33,"column":4},"end":{"line":47,"column":7}},"13":{"start":{"line":34,"column":8},"end":{"line":46,"column":9}},"14":{"start":{"line":35,"column":12},"end":{"line":42,"column":15}},"15":{"start":{"line":36,"column":16},"end":{"line":41,"column":17}},"16":{"start":{"line":37,"column":20},"end":{"line":37,"column":56}},"17":{"start":{"line":39,"column":20},"end":{"line":39,"column":61}},"18":{"start":{"line":40,"column":20},"end":{"line":40,"column":37}},"19":{"start":{"line":44,"column":12},"end":{"line":44,"column":53}},"20":{"start":{"line":45,"column":12},"end":{"line":45,"column":29}},"21":{"start":{"line":49,"column":0},"end":{"line":49,"column":67}},"22":{"start":{"line":51,"column":0},"end":{"line":60,"column":1}},"23":{"start":{"line":52,"column":4},"end":{"line":59,"column":7}},"24":{"start":{"line":53,"column":8},"end":{"line":58,"column":9}},"25":{"start":{"line":54,"column":12},"end":{"line":54,"column":30}},"26":{"start":{"line":56,"column":12},"end":{"line":56,"column":70}},"27":{"start":{"line":57,"column":12},"end":{"line":57,"column":29}},"28":{"start":{"line":61,"column":0},"end":{"line":61,"column":99}},"29":{"start":{"line":63,"column":0},"end":{"line":63,"column":23}},"30":{"start":{"line":64,"column":0},"end":{"line":64,"column":31}},"31":{"start":{"line":67,"column":0},"end":{"line":108,"column":1}},"32":{"start":{"line":68,"column":4},"end":{"line":68,"column":25}},"33":{"start":{"line":69,"column":4},"end":{"line":71,"column":7}},"34":{"start":{"line":70,"column":8},"end":{"line":70,"column":55}},"35":{"start":{"line":72,"column":4},"end":{"line":72,"column":50}},"36":{"start":{"line":73,"column":4},"end":{"line":73,"column":25}},"37":{"start":{"line":74,"column":4},"end":{"line":79,"column":7}},"38":{"start":{"line":76,"column":8},"end":{"line":78,"column":9}},"39":{"start":{"line":77,"column":12},"end":{"line":77,"column":27}},"40":{"start":{"line":80,"column":4},"end":{"line":84,"column":5}},"41":{"start":{"line":81,"column":8},"end":{"line":81,"column":99}},"42":{"start":{"line":82,"column":8},"end":{"line":82,"column":88}},"43":{"start":{"line":83,"column":8},"end":{"line":83,"column":15}},"44":{"start":{"line":86,"column":4},"end":{"line":107,"column":7}},"45":{"start":{"line":87,"column":8},"end":{"line":106,"column":9}},"46":{"start":{"line":88,"column":12},"end":{"line":90,"column":13}},"47":{"start":{"line":89,"column":16},"end":{"line":89,"column":41}},"48":{"start":{"line":91,"column":12},"end":{"line":102,"column":13}},"49":{"start":{"line":92,"column":16},"end":{"line":94,"column":19}},"50":{"start":{"line":93,"column":20},"end":{"line":93,"column":54}},"51":{"start":{"line":95,"column":16},"end":{"line":98,"column":19}},"52":{"start":{"line":96,"column":20},"end":{"line":96,"column":100}},"53":{"start":{"line":97,"column":20},"end":{"line":97,"column":86}},"54":{"start":{"line":100,"column":16},"end":{"line":100,"column":113}},"55":{"start":{"line":101,"column":16},"end":{"line":101,"column":33}},"56":{"start":{"line":104,"column":12},"end":{"line":104,"column":109}},"57":{"start":{"line":105,"column":12},"end":{"line":105,"column":29}},"58":{"start":{"line":110,"column":0},"end":{"line":113,"column":1}},"59":{"start":{"line":111,"column":2},"end":{"line":111,"column":31}},"60":{"start":{"line":112,"column":2},"end":{"line":112,"column":21}},"61":{"start":{"line":114,"column":0},"end":{"line":114,"column":52}},"62":{"start":{"line":115,"column":0},"end":{"line":124,"column":1}},"63":{"start":{"line":116,"column":4},"end":{"line":116,"column":20}},"64":{"start":{"line":117,"column":4},"end":{"line":123,"column":7}},"65":{"start":{"line":118,"column":8},"end":{"line":122,"column":9}},"66":{"start":{"line":119,"column":12},"end":{"line":119,"column":56}},"67":{"start":{"line":121,"column":12},"end":{"line":121,"column":27}},"68":{"start":{"line":126,"column":0},"end":{"line":134,"column":1}},"69":{"start":{"line":128,"column":8},"end":{"line":128,"column":26}}},"branchMap":{"1":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":8},"end":{"line":34,"column":8}},{"start":{"line":34,"column":8},"end":{"line":34,"column":8}}]},"2":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":16},"end":{"line":36,"column":16}},{"start":{"line":36,"column":16},"end":{"line":36,"column":16}}]},"3":{"line":53,"type":"if","locations":[{"start":{"line":53,"column":8},"end":{"line":53,"column":8}},{"start":{"line":53,"column":8},"end":{"line":53,"column":8}}]},"4":{"line":53,"type":"binary-expr","locations":[{"start":{"line":53,"column":12},"end":{"line":53,"column":18}},{"start":{"line":53,"column":22},"end":{"line":53,"column":51}}]},"5":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":8},"end":{"line":76,"column":8}},{"start":{"line":76,"column":8},"end":{"line":76,"column":8},"skip":true}]},"6":{"line":80,"type":"if","locations":[{"start":{"line":80,"column":4},"end":{"line":80,"column":4}},{"start":{"line":80,"column":4},"end":{"line":80,"column":4}}]},"7":{"line":87,"type":"if","locations":[{"start":{"line":87,"column":8},"end":{"line":87,"column":8}},{"start":{"line":87,"column":8},"end":{"line":87,"column":8}}]},"8":{"line":88,"type":"if","locations":[{"start":{"line":88,"column":12},"end":{"line":88,"column":12}},{"start":{"line":88,"column":12},"end":{"line":88,"column":12}}]},"9":{"line":91,"type":"if","locations":[{"start":{"line":91,"column":12},"end":{"line":91,"column":12}},{"start":{"line":91,"column":12},"end":{"line":91,"column":12}}]},"10":{"line":118,"type":"if","locations":[{"start":{"line":118,"column":8},"end":{"line":118,"column":8}},{"start":{"line":118,"column":8},"end":{"line":118,"column":8}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var BearerStrategy = require('passport-http-bearer').Strategy;","var ClientPasswordStrategy = require('passport-oauth2-client-password').Strategy;","","var passport = require(\"passport\");","var crypto = require(\"crypto\");","var util = require(\"util\");","","var Tokens = require(\"./tokens\");","var Users = require(\"./users\");","var Clients = require(\"./clients\");","var permissions = require(\"./permissions\");","","var log;","","var bearerStrategy = function (accessToken, done) {","    // is this a valid token?","    Tokens.get(accessToken).then(function(token) {","        if (token) {","            Users.get(token.user).then(function(user) {","                if (user) {","                    done(null,user,{scope:token.scope});","                } else {","                    log.audit({event: \"auth.invalid-token\"});","                    done(null,false);","                }","            });","        } else {","            log.audit({event: \"auth.invalid-token\"});","            done(null,false);","        }","    });","}","bearerStrategy.BearerStrategy = new BearerStrategy(bearerStrategy);","","var clientPasswordStrategy = function(clientId, clientSecret, done) {","    Clients.get(clientId).then(function(client) {","        if (client && client.secret == clientSecret) {","            done(null,client);","        } else {","            log.audit({event: \"auth.invalid-client\",client:clientId});","            done(null,false);","        }","    });","}","clientPasswordStrategy.ClientPasswordStrategy = new ClientPasswordStrategy(clientPasswordStrategy);","","var loginAttempts = [];","var loginSignInWindow = 600000; // 10 minutes","","","var passwordTokenExchange = function(client, username, password, scope, done) {","    var now = Date.now();","    loginAttempts = loginAttempts.filter(function(logEntry) {","        return logEntry.time + loginSignInWindow > now;","    });","    loginAttempts.push({time:now, user:username});","    var attemptCount = 0;","    loginAttempts.forEach(function(logEntry) {","        /* istanbul ignore else */","        if (logEntry.user == username) {","            attemptCount++;","        }","    });","    if (attemptCount > 5) {","        log.audit({event: \"auth.login.fail.too-many-attempts\",username:username,client:client.id});","        done(new Error(\"Too many login attempts. Wait 10 minutes and try again\"),false);","        return;","    }","","    Users.authenticate(username,password).then(function(user) {","        if (user) {","            if (scope === \"\") {","                scope = user.permissions;","            }","            if (permissions.hasPermission(user.permissions,scope)) {","                loginAttempts = loginAttempts.filter(function(logEntry) {","                    return logEntry.user !== username;","                });","                Tokens.create(username,client.id,scope).then(function(tokens) {","                    log.audit({event: \"auth.login\",username:username,client:client.id,scope:scope});","                    done(null,tokens.accessToken,null,{expires_in:tokens.expires_in});","                });","            } else {","                log.audit({event: \"auth.login.fail.permissions\",username:username,client:client.id,scope:scope});","                done(null,false);","            }","        } else {","            log.audit({event: \"auth.login.fail.credentials\",username:username,client:client.id,scope:scope});","            done(null,false);","        }","    });","}","","function AnonymousStrategy() {","  passport.Strategy.call(this);","  this.name = 'anon';","}","util.inherits(AnonymousStrategy, passport.Strategy);","AnonymousStrategy.prototype.authenticate = function(req) {","    var self = this;","    Users.default().then(function(anon) {","        if (anon) {","            self.success(anon,{scope:anon.permissions});","        } else {","            self.fail(401);","        }","    });","}","","module.exports = {","    init: function(runtime) {","        log = runtime.log;","    },","    bearerStrategy: bearerStrategy,","    clientPasswordStrategy: clientPasswordStrategy,","    passwordTokenExchange: passwordTokenExchange,","    anonymousStrategy: new AnonymousStrategy()","}",""],"l":{"17":1,"18":1,"20":1,"21":1,"22":1,"24":1,"25":1,"26":1,"27":1,"29":1,"31":1,"33":0,"34":0,"35":0,"36":0,"37":0,"39":0,"40":0,"44":0,"45":0,"49":1,"51":1,"52":0,"53":0,"54":0,"56":0,"57":0,"61":1,"63":1,"64":1,"67":1,"68":0,"69":0,"70":0,"72":0,"73":0,"74":0,"76":0,"77":0,"80":0,"81":0,"82":0,"83":0,"86":0,"87":0,"88":0,"89":0,"91":0,"92":0,"93":0,"95":0,"96":0,"97":0,"100":0,"101":0,"104":0,"105":0,"110":1,"111":1,"112":1,"114":1,"115":1,"116":0,"117":0,"118":0,"119":0,"121":0,"126":1,"128":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/auth/tokens.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/auth/tokens.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":1,"9":1,"10":1,"11":1,"12":1,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":1,"25":0,"26":0,"27":0,"28":0,"29":0,"30":1,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"fnMap":{"1":{"name":"generateToken","line":19,"loc":{"start":{"line":19,"column":0},"end":{"line":19,"column":31}}},"2":{"name":"expireSessions","line":37,"loc":{"start":{"line":37,"column":0},"end":{"line":37,"column":26}}},"3":{"name":"loadSessions","line":55,"loc":{"start":{"line":55,"column":0},"end":{"line":55,"column":24}}},"4":{"name":"(anonymous_4)","line":57,"loc":{"start":{"line":57,"column":52},"end":{"line":57,"column":72}}},"5":{"name":"(anonymous_5)","line":66,"loc":{"start":{"line":66,"column":10},"end":{"line":66,"column":48}}},"6":{"name":"(anonymous_6)","line":74,"loc":{"start":{"line":74,"column":9},"end":{"line":74,"column":25}}},"7":{"name":"(anonymous_7)","line":75,"loc":{"start":{"line":75,"column":35},"end":{"line":75,"column":46}}},"8":{"name":"(anonymous_8)","line":78,"loc":{"start":{"line":78,"column":49},"end":{"line":78,"column":60}}},"9":{"name":"(anonymous_9)","line":84,"loc":{"start":{"line":84,"column":12},"end":{"line":84,"column":40}}},"10":{"name":"(anonymous_10)","line":85,"loc":{"start":{"line":85,"column":35},"end":{"line":85,"column":46}}},"11":{"name":"(anonymous_11)","line":98,"loc":{"start":{"line":98,"column":55},"end":{"line":98,"column":66}}},"12":{"name":"(anonymous_12)","line":106,"loc":{"start":{"line":106,"column":12},"end":{"line":106,"column":28}}},"13":{"name":"(anonymous_13)","line":107,"loc":{"start":{"line":107,"column":35},"end":{"line":107,"column":46}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":19,"column":0},"end":{"line":26,"column":1}},"3":{"start":{"line":20,"column":4},"end":{"line":20,"column":77}},"4":{"start":{"line":21,"column":4},"end":{"line":21,"column":19}},"5":{"start":{"line":22,"column":4},"end":{"line":24,"column":5}},"6":{"start":{"line":23,"column":8},"end":{"line":23,"column":58}},"7":{"start":{"line":25,"column":4},"end":{"line":25,"column":26}},"8":{"start":{"line":29,"column":0},"end":{"line":29,"column":12}},"9":{"start":{"line":31,"column":0},"end":{"line":31,"column":21}},"10":{"start":{"line":33,"column":0},"end":{"line":33,"column":18}},"11":{"start":{"line":35,"column":0},"end":{"line":35,"column":26}},"12":{"start":{"line":37,"column":0},"end":{"line":54,"column":1}},"13":{"start":{"line":38,"column":4},"end":{"line":38,"column":25}},"14":{"start":{"line":39,"column":4},"end":{"line":39,"column":25}},"15":{"start":{"line":40,"column":4},"end":{"line":48,"column":5}},"16":{"start":{"line":41,"column":8},"end":{"line":47,"column":9}},"17":{"start":{"line":42,"column":12},"end":{"line":42,"column":38}},"18":{"start":{"line":43,"column":12},"end":{"line":46,"column":13}},"19":{"start":{"line":44,"column":16},"end":{"line":44,"column":35}},"20":{"start":{"line":45,"column":16},"end":{"line":45,"column":32}},"21":{"start":{"line":49,"column":4},"end":{"line":53,"column":5}},"22":{"start":{"line":50,"column":8},"end":{"line":50,"column":46}},"23":{"start":{"line":52,"column":8},"end":{"line":52,"column":30}},"24":{"start":{"line":55,"column":0},"end":{"line":63,"column":1}},"25":{"start":{"line":56,"column":4},"end":{"line":61,"column":5}},"26":{"start":{"line":57,"column":8},"end":{"line":60,"column":11}},"27":{"start":{"line":58,"column":13},"end":{"line":58,"column":38}},"28":{"start":{"line":59,"column":13},"end":{"line":59,"column":37}},"29":{"start":{"line":62,"column":4},"end":{"line":62,"column":26}},"30":{"start":{"line":65,"column":0},"end":{"line":112,"column":1}},"31":{"start":{"line":67,"column":8},"end":{"line":67,"column":27}},"32":{"start":{"line":68,"column":8},"end":{"line":68,"column":74}},"33":{"start":{"line":71,"column":8},"end":{"line":71,"column":30}},"34":{"start":{"line":72,"column":8},"end":{"line":72,"column":30}},"35":{"start":{"line":75,"column":8},"end":{"line":82,"column":11}},"36":{"start":{"line":76,"column":12},"end":{"line":80,"column":13}},"37":{"start":{"line":77,"column":16},"end":{"line":79,"column":17}},"38":{"start":{"line":78,"column":20},"end":{"line":78,"column":77}},"39":{"start":{"line":78,"column":62},"end":{"line":78,"column":74}},"40":{"start":{"line":81,"column":12},"end":{"line":81,"column":49}},"41":{"start":{"line":85,"column":8},"end":{"line":104,"column":11}},"42":{"start":{"line":86,"column":12},"end":{"line":86,"column":49}},"43":{"start":{"line":88,"column":12},"end":{"line":88,"column":77}},"44":{"start":{"line":90,"column":12},"end":{"line":96,"column":14}},"45":{"start":{"line":97,"column":12},"end":{"line":97,"column":44}},"46":{"start":{"line":98,"column":12},"end":{"line":103,"column":15}},"47":{"start":{"line":99,"column":16},"end":{"line":102,"column":17}},"48":{"start":{"line":107,"column":8},"end":{"line":110,"column":11}},"49":{"start":{"line":108,"column":12},"end":{"line":108,"column":35}},"50":{"start":{"line":109,"column":12},"end":{"line":109,"column":50}}},"branchMap":{"1":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":8},"end":{"line":41,"column":8}},{"start":{"line":41,"column":8},"end":{"line":41,"column":8}}]},"2":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":12},"end":{"line":43,"column":12}},{"start":{"line":43,"column":12},"end":{"line":43,"column":12}}]},"3":{"line":43,"type":"binary-expr","locations":[{"start":{"line":43,"column":16},"end":{"line":43,"column":50}},{"start":{"line":43,"column":54},"end":{"line":43,"column":75}}]},"4":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":4},"end":{"line":49,"column":4}},{"start":{"line":49,"column":4},"end":{"line":49,"column":4}}]},"5":{"line":56,"type":"if","locations":[{"start":{"line":56,"column":4},"end":{"line":56,"column":4}},{"start":{"line":56,"column":4},"end":{"line":56,"column":4}}]},"6":{"line":58,"type":"binary-expr","locations":[{"start":{"line":58,"column":24},"end":{"line":58,"column":33}},{"start":{"line":58,"column":35},"end":{"line":58,"column":37}}]},"7":{"line":68,"type":"binary-expr","locations":[{"start":{"line":68,"column":28},"end":{"line":68,"column":63}},{"start":{"line":68,"column":67},"end":{"line":68,"column":73}}]},"8":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":12},"end":{"line":76,"column":12}},{"start":{"line":76,"column":12},"end":{"line":76,"column":12}}]},"9":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":16},"end":{"line":77,"column":16}},{"start":{"line":77,"column":16},"end":{"line":77,"column":16}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var when = require(\"when\");","","function generateToken(length) {","    var c = \"ABCDEFGHIJKLMNOPQRSTUZWXYZabcdefghijklmnopqrstuvwxyz1234567890\";","    var token = [];","    for (var i=0;i<length;i++) {","        token.push(c[Math.floor(Math.random()*c.length)]);","    }","    return token.join(\"\");","}","","","var storage;","","var sessionExpiryTime","","var sessions = {};","","var loadedSessions = null;","","function expireSessions() {","    var now = Date.now();","    var modified = false;","    for (var t in sessions) {","        if (sessions.hasOwnProperty(t)) {","            var session = sessions[t];","            if (!session.hasOwnProperty(\"expires\") || session.expires < now) {","                delete sessions[t];","                modified = true;","            }","        }","    }","    if (modified) {","        return storage.saveSessions(sessions);","    } else {","        return when.resolve();","    }","}","function loadSessions() {","    if (loadedSessions === null) {","        loadedSessions = storage.getSessions().then(function(_sessions) {","             sessions = _sessions||{};","             return expireSessions();","        });","    }","    return loadedSessions;","}","","module.exports = {","    init: function(adminAuthSettings, _storage) {","        storage = _storage;","        sessionExpiryTime = adminAuthSettings.sessionExpiryTime || 604800; // 1 week in seconds","        // At this point, storage will not have been initialised, so defer loading","        // the sessions until there's a request for them.","        loadedSessions = null;","        return when.resolve();","    },","    get: function(token) {","        return loadSessions().then(function() {","            if (sessions[token]) {","                if (sessions[token].expires < Date.now()) {","                    return expireSessions().then(function() { return null });","                }","            }","            return when.resolve(sessions[token]);","        });","    },","    create: function(user,client,scope) {","        return loadSessions().then(function() {","            var accessToken = generateToken(128);","","            var accessTokenExpiresAt = Date.now() + (sessionExpiryTime*1000);","","            var session = {","                user:user,","                client:client,","                scope:scope,","                accessToken: accessToken,","                expires: accessTokenExpiresAt","            };","            sessions[accessToken] = session;","            return storage.saveSessions(sessions).then(function() {","                return {","                    accessToken: accessToken,","                    expires_in: sessionExpiryTime","                }","            });","        });","    },","    revoke: function(token) {","        return loadSessions().then(function() {","            delete sessions[token];","            return storage.saveSessions(sessions);","        });","    }","}",""],"l":{"17":1,"19":1,"20":0,"21":0,"22":0,"23":0,"25":0,"29":1,"31":1,"33":1,"35":1,"37":1,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"49":0,"50":0,"52":0,"55":1,"56":0,"57":0,"58":0,"59":0,"62":0,"65":1,"67":0,"68":0,"71":0,"72":0,"75":0,"76":0,"77":0,"78":0,"81":0,"85":0,"86":0,"88":0,"90":0,"97":0,"98":0,"99":0,"107":0,"108":0,"109":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/auth/users.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/auth/users.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":1,"8":1,"9":1,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":1,"18":0,"19":1,"20":0,"21":1,"22":1,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":1,"47":0,"48":0,"49":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"fnMap":{"1":{"name":"authenticate","line":26,"loc":{"start":{"line":26,"column":0},"end":{"line":26,"column":41}}},"2":{"name":"(anonymous_2)","line":29,"loc":{"start":{"line":29,"column":28},"end":{"line":29,"column":53}}},"3":{"name":"(anonymous_3)","line":30,"loc":{"start":{"line":30,"column":58},"end":{"line":30,"column":77}}},"4":{"name":"get","line":37,"loc":{"start":{"line":37,"column":0},"end":{"line":37,"column":23}}},"5":{"name":"getDefaultUser","line":40,"loc":{"start":{"line":40,"column":0},"end":{"line":40,"column":26}}},"6":{"name":"init","line":50,"loc":{"start":{"line":50,"column":0},"end":{"line":50,"column":22}}},"7":{"name":"(anonymous_7)","line":84,"loc":{"start":{"line":84,"column":26},"end":{"line":84,"column":37}}},"8":{"name":"(anonymous_8)","line":98,"loc":{"start":{"line":98,"column":9},"end":{"line":98,"column":28}}},"9":{"name":"(anonymous_9)","line":99,"loc":{"start":{"line":99,"column":18},"end":{"line":99,"column":46}}},"10":{"name":"(anonymous_10)","line":100,"loc":{"start":{"line":100,"column":13},"end":{"line":100,"column":24}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":11}},"4":{"start":{"line":20,"column":0},"end":{"line":21,"column":42}},"5":{"start":{"line":20,"column":6},"end":{"line":20,"column":33}},"6":{"start":{"line":21,"column":11},"end":{"line":21,"column":40}},"7":{"start":{"line":22,"column":0},"end":{"line":22,"column":15}},"8":{"start":{"line":23,"column":0},"end":{"line":23,"column":19}},"9":{"start":{"line":24,"column":0},"end":{"line":24,"column":23}},"10":{"start":{"line":26,"column":0},"end":{"line":36,"column":1}},"11":{"start":{"line":27,"column":4},"end":{"line":27,"column":31}},"12":{"start":{"line":28,"column":4},"end":{"line":34,"column":5}},"13":{"start":{"line":29,"column":8},"end":{"line":33,"column":11}},"14":{"start":{"line":30,"column":12},"end":{"line":32,"column":15}},"15":{"start":{"line":31,"column":16},"end":{"line":31,"column":39}},"16":{"start":{"line":35,"column":4},"end":{"line":35,"column":30}},"17":{"start":{"line":37,"column":0},"end":{"line":39,"column":1}},"18":{"start":{"line":38,"column":4},"end":{"line":38,"column":41}},"19":{"start":{"line":40,"column":0},"end":{"line":42,"column":1}},"20":{"start":{"line":41,"column":4},"end":{"line":41,"column":30}},"21":{"start":{"line":44,"column":0},"end":{"line":48,"column":1}},"22":{"start":{"line":50,"column":0},"end":{"line":94,"column":1}},"23":{"start":{"line":51,"column":4},"end":{"line":51,"column":15}},"24":{"start":{"line":52,"column":4},"end":{"line":52,"column":19}},"25":{"start":{"line":53,"column":4},"end":{"line":53,"column":23}},"26":{"start":{"line":54,"column":4},"end":{"line":79,"column":5}},"27":{"start":{"line":55,"column":8},"end":{"line":73,"column":9}},"28":{"start":{"line":56,"column":12},"end":{"line":72,"column":13}},"29":{"start":{"line":57,"column":16},"end":{"line":57,"column":39}},"30":{"start":{"line":59,"column":16},"end":{"line":59,"column":38}},"31":{"start":{"line":61,"column":16},"end":{"line":63,"column":17}},"32":{"start":{"line":62,"column":20},"end":{"line":62,"column":30}},"33":{"start":{"line":64,"column":16},"end":{"line":71,"column":17}},"34":{"start":{"line":65,"column":20},"end":{"line":65,"column":34}},"35":{"start":{"line":66,"column":20},"end":{"line":69,"column":22}},"36":{"start":{"line":70,"column":20},"end":{"line":70,"column":55}},"37":{"start":{"line":74,"column":8},"end":{"line":78,"column":9}},"38":{"start":{"line":75,"column":12},"end":{"line":75,"column":51}},"39":{"start":{"line":77,"column":12},"end":{"line":77,"column":44}},"40":{"start":{"line":80,"column":4},"end":{"line":93,"column":5}},"41":{"start":{"line":81,"column":8},"end":{"line":90,"column":9}},"42":{"start":{"line":82,"column":12},"end":{"line":82,"column":41}},"43":{"start":{"line":84,"column":12},"end":{"line":89,"column":13}},"44":{"start":{"line":85,"column":16},"end":{"line":88,"column":19}},"45":{"start":{"line":92,"column":8},"end":{"line":92,"column":37}},"46":{"start":{"line":96,"column":0},"end":{"line":101,"column":2}},"47":{"start":{"line":98,"column":30},"end":{"line":98,"column":55}},"48":{"start":{"line":99,"column":48},"end":{"line":99,"column":91}},"49":{"start":{"line":100,"column":26},"end":{"line":100,"column":47}}},"branchMap":{"1":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":4},"end":{"line":28,"column":4}},{"start":{"line":28,"column":4},"end":{"line":28,"column":4}}]},"2":{"line":31,"type":"cond-expr","locations":[{"start":{"line":31,"column":28},"end":{"line":31,"column":32}},{"start":{"line":31,"column":33},"end":{"line":31,"column":37}}]},"3":{"line":54,"type":"if","locations":[{"start":{"line":54,"column":4},"end":{"line":54,"column":4}},{"start":{"line":54,"column":4},"end":{"line":54,"column":4}}]},"4":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":8},"end":{"line":55,"column":8}},{"start":{"line":55,"column":8},"end":{"line":55,"column":8}}]},"5":{"line":56,"type":"if","locations":[{"start":{"line":56,"column":12},"end":{"line":56,"column":12}},{"start":{"line":56,"column":12},"end":{"line":56,"column":12}}]},"6":{"line":61,"type":"if","locations":[{"start":{"line":61,"column":16},"end":{"line":61,"column":16}},{"start":{"line":61,"column":16},"end":{"line":61,"column":16},"skip":true}]},"7":{"line":74,"type":"if","locations":[{"start":{"line":74,"column":8},"end":{"line":74,"column":8}},{"start":{"line":74,"column":8},"end":{"line":74,"column":8}}]},"8":{"line":74,"type":"binary-expr","locations":[{"start":{"line":74,"column":12},"end":{"line":74,"column":31}},{"start":{"line":74,"column":35},"end":{"line":74,"column":76}}]},"9":{"line":80,"type":"if","locations":[{"start":{"line":80,"column":4},"end":{"line":80,"column":4}},{"start":{"line":80,"column":4},"end":{"line":80,"column":4}}]},"10":{"line":81,"type":"if","locations":[{"start":{"line":81,"column":8},"end":{"line":81,"column":8}},{"start":{"line":81,"column":8},"end":{"line":81,"column":8}}]}},"code":["/**","* Copyright JS Foundation and other contributors, http://js.foundation","*","* Licensed under the Apache License, Version 2.0 (the \"License\");","* you may not use this file except in compliance with the License.","* You may obtain a copy of the License at","*","* http://www.apache.org/licenses/LICENSE-2.0","*","* Unless required by applicable law or agreed to in writing, software","* distributed under the License is distributed on an \"AS IS\" BASIS,","* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.","* See the License for the specific language governing permissions and","* limitations under the License.","**/","","var when = require(\"when\");","var util = require(\"util\");","var bcrypt;","try { bcrypt = require('bcrypt'); }","catch(e) { bcrypt = require('bcryptjs'); }","var users = {};","var passwords = {};","var defaultUser = null;","","function authenticate(username,password) {","    var user = users[username];","    if (user) {","        return when.promise(function(resolve,reject) {","            bcrypt.compare(password, passwords[username], function(err, res) {","                resolve(res?user:null);","            });","        });","    }","    return when.resolve(null);","}","function get(username) {","    return when.resolve(users[username]);","}","function getDefaultUser() {","    return when.resolve(null);","}","","var api = {","    get: get,","    authenticate: authenticate,","    default: getDefaultUser","}","","function init(config) {","    users = {};","    passwords = {};","    defaultUser = null;","    if (config.type == \"credentials\") {","        if (config.users) {","            if (typeof config.users === \"function\") {","                api.get = config.users;","            } else {","                var us = config.users;","                /* istanbul ignore else */","                if (!util.isArray(us)) {","                    us = [us];","                }","                for (var i=0;i<us.length;i++) {","                    var u = us[i];","                    users[u.username] = {","                        \"username\":u.username,","                        \"permissions\":u.permissions","                    };","                    passwords[u.username] = u.password;","                }","            }","        }","        if (config.authenticate && typeof config.authenticate === \"function\") {","            api.authenticate = config.authenticate;","        } else {","            api.authenticate = authenticate;","        }","    }","    if (config.default) {","        if (typeof config.default === \"function\") {","            api.default = config.default;","        } else {","            api.default = function() {","                return when.resolve({","                    \"anonymous\": true,","                    \"permissions\":config.default.permissions","                });","            }","        }","    } else {","        api.default = getDefaultUser;","    }","}","","module.exports = {","    init: init,","    get: function(username) { return api.get(username) },","    authenticate: function(username,password) { return api.authenticate(username,password) },","    default: function() { return api.default(); }","};",""],"l":{"17":1,"18":1,"19":1,"20":1,"21":0,"22":1,"23":1,"24":1,"26":1,"27":0,"28":0,"29":0,"30":0,"31":0,"35":0,"37":1,"38":0,"40":1,"41":0,"44":1,"50":1,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"59":0,"61":0,"62":0,"64":0,"65":0,"66":0,"70":0,"74":0,"75":0,"77":0,"80":0,"81":0,"82":0,"84":0,"85":0,"92":0,"96":1,"98":0,"99":0,"100":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/auth/clients.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/auth/clients.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0},"b":{"1":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":25,"loc":{"start":{"line":25,"column":9},"end":{"line":25,"column":22}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":19,"column":0},"end":{"line":22,"column":2}},"3":{"start":{"line":24,"column":0},"end":{"line":33,"column":1}},"4":{"start":{"line":26,"column":8},"end":{"line":30,"column":9}},"5":{"start":{"line":27,"column":12},"end":{"line":29,"column":13}},"6":{"start":{"line":28,"column":16},"end":{"line":28,"column":48}},"7":{"start":{"line":31,"column":8},"end":{"line":31,"column":34}}},"branchMap":{"1":{"line":27,"type":"if","locations":[{"start":{"line":27,"column":12},"end":{"line":27,"column":12}},{"start":{"line":27,"column":12},"end":{"line":27,"column":12}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/"," ","var when = require(\"when\");","","var clients = [","    {id:\"node-red-editor\",secret:\"not_available\"},","    {id:\"node-red-admin\",secret:\"not_available\"}","];","","module.exports = {","    get: function(id) {","        for (var i=0;i<clients.length;i++) {","            if (clients[i].id == id) {","                return when.resolve(clients[i]);","            }","        }","        return when.resolve(null);","    }","}",""],"l":{"17":1,"19":1,"24":1,"26":0,"27":0,"28":0,"31":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/auth/permissions.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/auth/permissions.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"hasPermission","line":22,"loc":{"start":{"line":22,"column":0},"end":{"line":22,"column":45}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":19,"column":0},"end":{"line":19,"column":30}},"3":{"start":{"line":20,"column":0},"end":{"line":20,"column":32}},"4":{"start":{"line":22,"column":0},"end":{"line":61,"column":1}},"5":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"6":{"start":{"line":24,"column":8},"end":{"line":24,"column":20}},"7":{"start":{"line":26,"column":4},"end":{"line":26,"column":10}},"8":{"start":{"line":28,"column":4},"end":{"line":37,"column":5}},"9":{"start":{"line":30,"column":8},"end":{"line":34,"column":9}},"10":{"start":{"line":31,"column":12},"end":{"line":33,"column":13}},"11":{"start":{"line":32,"column":16},"end":{"line":32,"column":29}},"12":{"start":{"line":36,"column":8},"end":{"line":36,"column":20}},"13":{"start":{"line":39,"column":4},"end":{"line":49,"column":5}},"14":{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},"15":{"start":{"line":41,"column":12},"end":{"line":41,"column":25}},"16":{"start":{"line":43,"column":8},"end":{"line":47,"column":9}},"17":{"start":{"line":44,"column":12},"end":{"line":46,"column":13}},"18":{"start":{"line":45,"column":16},"end":{"line":45,"column":28}},"19":{"start":{"line":48,"column":8},"end":{"line":48,"column":21}},"20":{"start":{"line":51,"column":4},"end":{"line":53,"column":5}},"21":{"start":{"line":52,"column":8},"end":{"line":52,"column":20}},"22":{"start":{"line":55,"column":4},"end":{"line":59,"column":5}},"23":{"start":{"line":56,"column":8},"end":{"line":56,"column":39}},"24":{"start":{"line":57,"column":11},"end":{"line":59,"column":5}},"25":{"start":{"line":58,"column":8},"end":{"line":58,"column":40}},"26":{"start":{"line":60,"column":4},"end":{"line":60,"column":17}},"27":{"start":{"line":63,"column":0},"end":{"line":65,"column":1}}},"branchMap":{"1":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":4},"end":{"line":23,"column":4}},{"start":{"line":23,"column":4},"end":{"line":23,"column":4}}]},"2":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":4},"end":{"line":28,"column":4}},{"start":{"line":28,"column":4},"end":{"line":28,"column":4}}]},"3":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":12},"end":{"line":31,"column":12}},{"start":{"line":31,"column":12},"end":{"line":31,"column":12}}]},"4":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":4},"end":{"line":39,"column":4}},{"start":{"line":39,"column":4},"end":{"line":39,"column":4}}]},"5":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":8},"end":{"line":40,"column":8}},{"start":{"line":40,"column":8},"end":{"line":40,"column":8}}]},"6":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":12},"end":{"line":44,"column":12}},{"start":{"line":44,"column":12},"end":{"line":44,"column":12}}]},"7":{"line":51,"type":"if","locations":[{"start":{"line":51,"column":4},"end":{"line":51,"column":4}},{"start":{"line":51,"column":4},"end":{"line":51,"column":4}}]},"8":{"line":51,"type":"binary-expr","locations":[{"start":{"line":51,"column":8},"end":{"line":51,"column":25}},{"start":{"line":51,"column":29},"end":{"line":51,"column":53}}]},"9":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":4},"end":{"line":55,"column":4}},{"start":{"line":55,"column":4},"end":{"line":55,"column":4}}]},"10":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":8},"end":{"line":55,"column":28}},{"start":{"line":55,"column":32},"end":{"line":55,"column":54}}]},"11":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":11},"end":{"line":57,"column":11}},{"start":{"line":57,"column":11},"end":{"line":57,"column":11}}]},"12":{"line":57,"type":"binary-expr","locations":[{"start":{"line":57,"column":15},"end":{"line":57,"column":36}},{"start":{"line":57,"column":40},"end":{"line":57,"column":63}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var util = require('util');","","var readRE = /^((.+)\\.)?read$/","var writeRE = /^((.+)\\.)?write$/","","function hasPermission(userScope,permission) {","    if (permission === \"\") {","        return true;","    }","    var i;","","    if (util.isArray(permission)) {","        // Multiple permissions requested - check each one","        for (i=0;i<permission.length;i++) {","            if (!hasPermission(userScope,permission[i])) {","                return false;","            }","        }","        // All permissions check out","        return true;","    }","","    if (util.isArray(userScope)) {","        if (userScope.length === 0) {","            return false;","        }","        for (i=0;i<userScope.length;i++) {","            if (hasPermission(userScope[i],permission)) {","                return true;","            }","        }","        return false;","    }","","    if (userScope === \"*\" || userScope === permission) {","        return true;","    }","","    if (userScope === \"read\" || userScope === \"*.read\") {","        return readRE.test(permission);","    } else if (userScope === \"write\" || userScope === \"*.write\") {","        return writeRE.test(permission);","    }","    return false;","}","","module.exports = {","    hasPermission: hasPermission,","}",""],"l":{"17":1,"19":1,"20":1,"22":1,"23":0,"24":0,"26":0,"28":0,"30":0,"31":0,"32":0,"36":0,"39":0,"40":0,"41":0,"43":0,"44":0,"45":0,"48":0,"51":0,"52":0,"55":0,"56":0,"57":0,"58":0,"60":0,"63":1}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/info.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/info.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":22,"loc":{"start":{"line":22,"column":10},"end":{"line":22,"column":29}}},"2":{"name":"(anonymous_2)","line":26,"loc":{"start":{"line":26,"column":14},"end":{"line":26,"column":32}}}},"statementMap":{"1":{"start":{"line":16,"column":0},"end":{"line":16,"column":31}},"2":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"3":{"start":{"line":18,"column":0},"end":{"line":18,"column":12}},"4":{"start":{"line":19,"column":0},"end":{"line":19,"column":13}},"5":{"start":{"line":21,"column":0},"end":{"line":54,"column":1}},"6":{"start":{"line":23,"column":8},"end":{"line":23,"column":27}},"7":{"start":{"line":24,"column":8},"end":{"line":24,"column":36}},"8":{"start":{"line":27,"column":8},"end":{"line":31,"column":9}},"9":{"start":{"line":33,"column":8},"end":{"line":33,"column":45}},"10":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"11":{"start":{"line":35,"column":12},"end":{"line":35,"column":53}},"12":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"13":{"start":{"line":39,"column":12},"end":{"line":39,"column":72}},"14":{"start":{"line":42,"column":8},"end":{"line":44,"column":9}},"15":{"start":{"line":43,"column":12},"end":{"line":43,"column":66}},"16":{"start":{"line":46,"column":8},"end":{"line":50,"column":9}},"17":{"start":{"line":47,"column":12},"end":{"line":47,"column":70}},"18":{"start":{"line":48,"column":12},"end":{"line":48,"column":86}},"19":{"start":{"line":49,"column":12},"end":{"line":49,"column":62}},"20":{"start":{"line":52,"column":8},"end":{"line":52,"column":31}}},"branchMap":{"1":{"line":28,"type":"binary-expr","locations":[{"start":{"line":28,"column":26},"end":{"line":28,"column":47}},{"start":{"line":28,"column":49},"end":{"line":28,"column":52}}]},"2":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":8},"end":{"line":34,"column":8}},{"start":{"line":34,"column":8},"end":{"line":34,"column":8}}]},"3":{"line":38,"type":"if","locations":[{"start":{"line":38,"column":8},"end":{"line":38,"column":8}},{"start":{"line":38,"column":8},"end":{"line":38,"column":8}}]},"4":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":8},"end":{"line":42,"column":8}},{"start":{"line":42,"column":8},"end":{"line":42,"column":8}}]},"5":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":8},"end":{"line":46,"column":8}},{"start":{"line":46,"column":8},"end":{"line":46,"column":8}}]},"6":{"line":47,"type":"binary-expr","locations":[{"start":{"line":47,"column":39},"end":{"line":47,"column":63}},{"start":{"line":47,"column":67},"end":{"line":47,"column":69}}]},"7":{"line":48,"type":"binary-expr","locations":[{"start":{"line":48,"column":47},"end":{"line":48,"column":79}},{"start":{"line":48,"column":83},"end":{"line":48,"column":85}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","var theme = require(\"./theme\");","var util = require('util');","var runtime;","var settings;","","module.exports = {","    init: function(_runtime) {","        runtime = _runtime;","        settings = runtime.settings;","    },","    settings: function(req,res) {","        var safeSettings = {","            httpNodeRoot: settings.httpNodeRoot||\"/\",","            version: settings.version,","            user: req.user","        }","","        var themeSettings = theme.settings();","        if (themeSettings) {","            safeSettings.editorTheme = themeSettings;","        }","","        if (util.isArray(settings.paletteCategories)) {","            safeSettings.paletteCategories = settings.paletteCategories;","        }","","        if (settings.flowFilePretty) {","            safeSettings.flowFilePretty = settings.flowFilePretty;","        }","","        if (!runtime.nodes.paletteEditorEnabled()) {","            safeSettings.editorTheme = safeSettings.editorTheme || {};","            safeSettings.editorTheme.palette = safeSettings.editorTheme.palette || {};","            safeSettings.editorTheme.palette.editable = false;","        }","","        res.json(safeSettings);","    }","}",""],"l":{"16":1,"17":1,"18":1,"19":1,"21":1,"23":0,"24":0,"27":0,"33":0,"34":0,"35":0,"38":0,"39":0,"42":0,"43":0,"46":0,"47":0,"48":0,"49":0,"52":0}},"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/credentials.js":{"path":"/home/travis/build/npmtest/node-npmtest-node-red/node-red/red/api/credentials.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":21,"loc":{"start":{"line":21,"column":10},"end":{"line":21,"column":28}}},"2":{"name":"(anonymous_2)","line":25,"loc":{"start":{"line":25,"column":9},"end":{"line":25,"column":29}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":8}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":8}},"3":{"start":{"line":20,"column":0},"end":{"line":52,"column":1}},"4":{"start":{"line":22,"column":8},"end":{"line":22,"column":26}},"5":{"start":{"line":23,"column":8},"end":{"line":23,"column":28}},"6":{"start":{"line":29,"column":8},"end":{"line":29,"column":39}},"7":{"start":{"line":30,"column":8},"end":{"line":30,"column":35}},"8":{"start":{"line":31,"column":8},"end":{"line":31,"column":74}},"9":{"start":{"line":32,"column":8},"end":{"line":32,"column":53}},"10":{"start":{"line":33,"column":8},"end":{"line":36,"column":9}},"11":{"start":{"line":34,"column":12},"end":{"line":34,"column":25}},"12":{"start":{"line":35,"column":12},"end":{"line":35,"column":19}},"13":{"start":{"line":37,"column":8},"end":{"line":37,"column":63}},"14":{"start":{"line":39,"column":8},"end":{"line":39,"column":33}},"15":{"start":{"line":40,"column":8},"end":{"line":49,"column":9}},"16":{"start":{"line":41,"column":12},"end":{"line":48,"column":13}},"17":{"start":{"line":42,"column":16},"end":{"line":46,"column":17}},"18":{"start":{"line":43,"column":20},"end":{"line":43,"column":44}},"19":{"start":{"line":44,"column":20},"end":{"line":44,"column":97}},"20":{"start":{"line":45,"column":20},"end":{"line":45,"column":29}},"21":{"start":{"line":47,"column":16},"end":{"line":47,"column":64}},"22":{"start":{"line":50,"column":8},"end":{"line":50,"column":34}}},"branchMap":{"1":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":8},"end":{"line":33,"column":8}},{"start":{"line":33,"column":8},"end":{"line":33,"column":8}}]},"2":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":12},"end":{"line":41,"column":12}},{"start":{"line":41,"column":12},"end":{"line":41,"column":12}}]},"3":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":16},"end":{"line":42,"column":16}},{"start":{"line":42,"column":16},"end":{"line":42,"column":16}}]},"4":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":43},"end":{"line":44,"column":68}},{"start":{"line":44,"column":72},"end":{"line":44,"column":96}}]},"5":{"line":47,"type":"binary-expr","locations":[{"start":{"line":47,"column":40},"end":{"line":47,"column":57}},{"start":{"line":47,"column":61},"end":{"line":47,"column":63}}]}},"code":["/**"," * Copyright JS Foundation and other contributors, http://js.foundation"," *"," * Licensed under the Apache License, Version 2.0 (the \"License\");"," * you may not use this file except in compliance with the License."," * You may obtain a copy of the License at"," *"," * http://www.apache.org/licenses/LICENSE-2.0"," *"," * Unless required by applicable law or agreed to in writing, software"," * distributed under the License is distributed on an \"AS IS\" BASIS,"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."," * See the License for the specific language governing permissions and"," * limitations under the License."," **/","","var log;","var api;","","module.exports = {","    init: function(runtime) {","        log = runtime.log;","        api = runtime.nodes;","    },","    get: function (req, res) {","        // TODO: It should verify the given node id is of the type specified -","        //       but that would add a dependency from this module to the","        //       registry module that knows about node types.","        var nodeType = req.params.type;","        var nodeID = req.params.id;","        log.audit({event: \"credentials.get\",type:nodeType,id:nodeID},req);","        var credentials = api.getCredentials(nodeID);","        if (!credentials) {","            res.json({});","            return;","        }","        var definition = api.getCredentialDefinition(nodeType);","","        var sendCredentials = {};","        for (var cred in definition) {","            if (definition.hasOwnProperty(cred)) {","                if (definition[cred].type == \"password\") {","                    var key = 'has_' + cred;","                    sendCredentials[key] = credentials[cred] != null && credentials[cred] !== '';","                    continue;","                }","                sendCredentials[cred] = credentials[cred] || '';","            }","        }","        res.json(sendCredentials);","    }","}",""],"l":{"17":1,"18":1,"20":1,"22":0,"23":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"37":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"47":0,"50":0}}}